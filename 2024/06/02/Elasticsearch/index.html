
  <!DOCTYPE html>
  <html lang="zh-CN"  data-theme="dark" >
  <head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script src="https://www.googletagmanager.com/gtag/js?id=true"></script>
  <script data-pjax>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'true');
  </script>
  <!-- End Google Analytics -->


  

  
  <script async src="https://hm.baidu.com/hm.js?true"></script>
  <script data-pjax>
    var _hmt = _hmt || [];
    _hmt.push(["_trackPageview", location.pathname]);
  </script>


  
  <script>window.icon_font = '4552607_tq6stt6tcg';window.clipboard_tips = {"success":"复制成功(*^▽^*)","fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","copyright":{"enable":false,"count":50,"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！"}};window.outdate = {"enable":true,"daysAgo":180,"message":"本文最后更新于 {time}，请注意文中内容可能已经发生变化。"};</script>
  
  
  <title>
    Elasticsearch |
    
    yyjccc的博客
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CUbuntu%20Mono:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CUbuntu%20Mono:400,400italic,700,700italic&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_tq6stt6tcg.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  <meta name="description" content="Elasticsearch基于java编写的Lucence的一层封装 基本概念Elasticsearch是面向文档的，关系行数据库  索引（indices）:对应mysql中的数据库 types: 对应表  documents: 对应mysql中行 fields:  对应mysql中的字段  物理设计：        elasticsearch 在后台把每个索引划分成多个分片，每份分片可以在集群中">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch">
<meta property="og:url" content="https://yyjccc.github.io/2024/06/02/Elasticsearch/index.html">
<meta property="og:site_name" content="yyjccc的博客">
<meta property="og:description" content="Elasticsearch基于java编写的Lucence的一层封装 基本概念Elasticsearch是面向文档的，关系行数据库  索引（indices）:对应mysql中的数据库 types: 对应表  documents: 对应mysql中行 fields:  对应mysql中的字段  物理设计：        elasticsearch 在后台把每个索引划分成多个分片，每份分片可以在集群中">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://camo.githubusercontent.com/bdfe42be1c7f7bfd43cf725c109206d87b4d5a23d5097d1fff03663163d2ab4e/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353131353533313637312e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=DxPHD&amp;originHeight=260&amp;originWidth=880&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=">
<meta property="og:image" content="https://camo.githubusercontent.com/4465cac9a719b15a6eb7b447d86a2c84b5703b4377df4e826c46099f1e688f34/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353132323533333339362e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=SVhQ0&amp;originHeight=611&amp;originWidth=1004&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=">
<meta property="og:image" content="https://camo.githubusercontent.com/c9161246f23f804c797938895c8928cdfc17087c6d2ee1a17edc63a87323ace6/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353132323535353433322e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=anffG&amp;originHeight=239&amp;originWidth=1015&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=">
<meta property="og:image" content="https://camo.githubusercontent.com/feadd222988837bcc9e1e40daef110bd5925f8d9f04223a49c6a9d452de6db35/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353132323731353336372e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=yaeAH&amp;originHeight=281&amp;originWidth=881&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/1.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/2.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/3.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/4.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/5.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/6.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/7.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/8.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/9.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/10.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/11.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/12.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/13.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/14.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/15.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/16.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/17.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/18.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/19.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/20.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/21.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/22.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/23.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/24.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/25.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/26.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/27.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/28.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/29.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/30.png">
<meta property="og:image" content="https://yyjccc.github.io/img/24-6-2/31.png">
<meta property="article:published_time" content="2024-06-02T09:57:22.194Z">
<meta property="article:modified_time" content="2024-06-02T10:06:58.604Z">
<meta property="article:author" content="Yyjccc">
<meta property="article:tag" content="开发">
<meta property="article:tag" content="Elasticsearch">
<meta property="article:tag" content="java">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://camo.githubusercontent.com/bdfe42be1c7f7bfd43cf725c109206d87b4d5a23d5097d1fff03663163d2ab4e/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353131353533313637312e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=DxPHD&amp;originHeight=260&amp;originWidth=880&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=">
  
    <link rel="alternate" href="/atom.xml" title="yyjccc的博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
  
  
    
      
<link rel="stylesheet" href="https://npm.webcache.cn/gitalk/dist/gitalk.css">

    
  
  
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"></script>

  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.0.1/dist/aos.css">

  
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

  <body>
    
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
          <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="#ff5252" />
          <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
         M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="#ff5252" />
        </svg>
      </div>
      <div class="loading-word">少女祈祷中...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/">首页</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/archives">归档</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/about">关于</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/friend">友链</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
    
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="搜索"></a>
    
  </nav>
</div>
<header id="header">
  
    
      <img fetchpriority="high" src="/images/banner.webp" alt="Elasticsearch">
    
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">Elasticsearch</h1>
          </a>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content">
          
          <section id="main"><article id="post-Elasticsearch" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <a href="/2024/06/02/Elasticsearch/" class="article-date-link" data-aos="zoom-in">
    <time datetime="2024-06-02T09:57:22.194Z" itemprop="datePublished">2024-06-02</time>
    <time style="display: none;" id="post-update-time">2024-06-02</time>
  </a>
</div>

      

    </div>
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote id="outdate-blockquote" style="display: none;"><p></p></blockquote>
      
      
        <h1 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h1><p>基于java编写的Lucence的一层封装</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>Elasticsearch是面向文档的，关系行数据库</p>
<ul>
<li>索引（indices）:对应mysql中的数据库</li>
<li>types: 对应表 </li>
<li>documents: 对应mysql中行</li>
<li>fields:  对应mysql中的字段</li>
</ul>
<p><strong>物理设计</strong>：<br>        elasticsearch 在后台把每个索引划分成多个分片，每份分片可以在集群中的不同服务器间迁移</p>
<p><strong>逻辑设计</strong>：<br>        一个索引类型中，包含多个文档，比如说文档1，文档2。 当我们索引一篇文档时，可以通过这样的一个顺序找到 它: 索引 ▷ 类型 ▷ 文档ID ，通过这个组合我们就能索引到某个具体的文档。 注意 : ID不必是整数，实际上它是个字符串。</p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p><em>文档就是一条一条的数据</em><br>         elasticsearch 是面向文档的，那么就意味着索引和搜索数据的最小单位是文档，elasticsearch 中，文档有几个 重要属性 :</p>
<ul>
<li><p><strong>自我包含</strong>，一篇文档同时包含字段和对应的值，也就是同时包含 key:value！</p>
</li>
<li><p><strong>可以是层次型的</strong>，一个文档中包含自文档，复杂的逻辑实体就是这么来的！其实就是个JSON对象</p>
</li>
<li><p><strong>灵活的结构</strong>，文档不依赖预先定义的模式，我们知道关系型数据库中，要提前定义字段才能使用，在 elasticsearch 中，对于字段是非常灵活的，有时候，我们可以忽略该字段，或者动态的添加一个新的字段。</p>
<p> 尽管我们可以随意的新增或者忽略某个字段，但是，每个字段的类型非常重要，比如一个年龄字段类型，可以是字符串也可以是整形。因为 elasticsearch 会保存字段和类型之间的映射及其他的设置。这种映射具体到每个映射的每种类型，这也是为什么在 elasticsearch 中，类型有时候也称为映射类型。</p>
</li>
</ul>
<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><p>​    类型是文档的逻辑容器，就像关系型数据库一样，表格是行的容器。 类型中对于字段的定义称为映射，比如 name 映 射为字符串类型。 我们说文档是无模式的，它们不需要拥有映射中所定义的所有字段，比如新增一个字段，那么 elasticsearch 是怎么做的呢?elasticsearch会自动的将新字段加入映射，但是这个字段的不确定它是什么类型，elasticsearch就开始猜，如果这个值是18，那么elasticsearch会认为它是整形。 但是elasticsearch也可能猜不对， 所以最安全的方式就是提前定义好所需要的映射，这点跟关系型数据库殊途同归了，先定义好字段，然后再使用。</p>
<p>总之类型就是数据字段对应的数据类型的映射</p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>​    索引是映射类型的容器，elasticsearch 中的索引是一个非常大的文档集合。索引存储了映射类型的字段和其他设置。 然后它们被存储到了各个分片上了。 我们来研究下分片是如何工作的。</p>
<p>物理设计 ：节点和分片如何工作</p>
<p>​    一个集群至少有一个节点，而一个节点就是一个 elasricsearch 进程，节点可以有多个索引默认的，如果你创建索引，那么索引将会有个5个分片 ( primary shard ,又称主分片 ) 构成的，每一个主分片会有一个副本 ( replica shard ,又称复制分片 )</p>
<p> 下图是一个有3个节点的集群，可以看到主分片和对应的复制分片都不会在同一个节点内，这样有利于某个节点挂掉 了，数据也不至于丢失。<br><img src="https://camo.githubusercontent.com/bdfe42be1c7f7bfd43cf725c109206d87b4d5a23d5097d1fff03663163d2ab4e/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353131353533313637312e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=DxPHD&amp;originHeight=260&amp;originWidth=880&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=">实际上，一个分片是一个 Lucene 索引，一个包含倒排索引的文件目录，倒排索引的结构使得elasticsearch在不扫描全部文档的情况下，就能告诉你哪些文档包含特定的关键字</p>
<h3 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h3><p>​    elasticsearch 使用的是一种称为倒排索引的结构，采用Lucene倒排索引作为底层。这种结构适用于快速的全文搜索， 一个索引由文档中所有不重复的列表构成，对于每一个词，都有一个包含它的文档列表。 例如，现在有两个文档， 每个文档包含如下内容：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Study every day, good good up to forever # 文档<span class="number">1</span>包含的内容</span><br><span class="line">To forever, study every day, good good up # 文档<span class="number">2</span>包含的内容</span><br></pre></td></tr></tbody></table></figure>

<p>​    为了创建倒排索引，我们首先要将每个文档拆分成独立的词(或称为词条或者tokens)，然后创建一个包含所有不重复的词条的排序列表，然后列出每个词条出现在哪个文档 :       </p>
<p><img src="https://camo.githubusercontent.com/4465cac9a719b15a6eb7b447d86a2c84b5703b4377df4e826c46099f1e688f34/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353132323533333339362e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=SVhQ0&amp;originHeight=611&amp;originWidth=1004&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title="><br>   现在，我们试图搜索 to forever，只需要查看包含每个词条的文档<br><img src="https://camo.githubusercontent.com/c9161246f23f804c797938895c8928cdfc17087c6d2ee1a17edc63a87323ace6/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353132323535353433322e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=anffG&amp;originHeight=239&amp;originWidth=1015&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title="><br>        两个文档都匹配，但是第一个文档比第二个匹配程度更高。如果没有别的条件，现在，这两个包含关键字的文档都将返回。</p>
<p>​    再来看一个示例，比如我们通过博客标签来搜索博客文章。那么倒排索引列表就是这样的一个结构 :       </p>
<p><img src="https://camo.githubusercontent.com/feadd222988837bcc9e1e40daef110bd5925f8d9f04223a49c6a9d452de6db35/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303231353132323731353336372e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730#from=url&amp;id=yaeAH&amp;originHeight=281&amp;originWidth=881&amp;originalType=binary&amp;ratio=1.3499999046325684&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title="><br>   如果要搜索含有 python 标签的文章，那相对于查找所有原始数据而言，查找倒排索引后的数据将会快的多。只需要 查看标签这一栏，然后获取相关的文章ID即可。完全过滤掉无关的所有数据，提高效率！</p>
<p>​    在 elasticsearch 中， 索引这个词被频繁使用，这就是术语的使用。在 elasticsearch 中，索引被分为多个分片，每份分片是一个 Lucene 的索引。所以 一个 elasticsearch 索引是由多个Lucene索引组成的。</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="IK分词器"><a href="#IK分词器" class="headerlink" title="IK分词器"></a>IK分词器</h3><p><strong>分词</strong>：即把一段中文或者别的内容划分成一个个的关键字，我们在搜索时候会把自己的信息进行分词，是因为数据库中或者索引库中的数据也会进行分词，然后进行一个匹配操作，默认的中文分词是将每个字看成一个词，比如 “我爱大数据” 会被分为”我”，”爱”，”大”, “数”，”据”，这显然是不符合要求的，所以我们需要安装中文分词器 ik 来解决这个问题。</p>
<p>  IK提供了两个分词算法：ik_smart 和 ik_max_word ，其中 ik_smart 为最少切分，ik_max_word 为 最细粒度划分</p>
<p>安装：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/">https://github.com/medcl/elasticsearch-analysis-ik/</a><br>安装对应版本并放入plugin目录下</p>
<p>使用：</p>
<ul>
<li><p>ik_smart模式：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">{</span><br><span class="line">  <span class="string">"analyzer"</span>:<span class="string">"ik_smart"</span>,</span><br><span class="line">  <span class="string">"text"</span>:<span class="string">"中国共产党"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>效果：</p>
<img src="/img/24-6-2/1.png">
</li>
<li><p>ik_max_word模式</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">{</span><br><span class="line">  <span class="string">"analyzer"</span>:<span class="string">"ik_max_word"</span>,</span><br><span class="line">  <span class="string">"text"</span>:<span class="string">"中国共产党"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>效果：</p>
<img src="/img/24-6-2/2.png"></li>
</ul>
<h3 id="Rest风格"><a href="#Rest风格" class="headerlink" title="Rest风格"></a>Rest风格</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;什么是 Rest 风格呢?</p>
<blockquote>
<p><strong>一种软件架构风格，而不是标准，只是提供了一组设计原则和约束条件。它主要用于客户端和服务器交互类的软件。基于这个风格设计的软件可以更简洁，更有层次，更易于实现缓存等机制</strong>。</p>
</blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;其中 基本 的 Rest 命令说明：</p>
<table>
<thead>
<tr>
<th>method</th>
<th>url地址</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>localhost:9200/索引名称/类型名称/文档id</td>
<td>创建文档（指定文档 id ）</td>
</tr>
<tr>
<td>POST</td>
<td>localhost:9200/索引名称/类型名称</td>
<td>创建文档（随机文档 id ）</td>
</tr>
<tr>
<td>POST</td>
<td>localhost:9200/索引名称/类型名称/文档id/_update</td>
<td>修改文档</td>
</tr>
<tr>
<td>DELETE</td>
<td>localhost:9200/索引名称/类型名称/文档id</td>
<td>删除文档</td>
</tr>
<tr>
<td>GET</td>
<td>localhost:9200/索引名称/类型名称/文档id</td>
<td>通过文档id查询文档</td>
</tr>
<tr>
<td>POST</td>
<td>localhost:9200/索引名称/类型名称/_search</td>
<td>查询所有数据</td>
</tr>
</tbody></table>
<h3 id="关于索引的基本操作"><a href="#关于索引的基本操作" class="headerlink" title="关于索引的基本操作"></a>关于索引的基本操作</h3><p><em><strong>基础测试</strong></em></p>
<ol>
<li>创建一个索引</li>
</ol>
<p><em>PUT /索引名/类型名/文档id{请求id}</em></p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 命令解释 </span></span><br><span class="line"><span class="comment">// PUT 创建命令 test1 索引 type1 类型 1 id</span></span><br><span class="line">PUT /test1/type1/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"大数据梦想家"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">21</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>如下图所示：<img src="/img/24-6-2/3.png">返回结果 （是以REST ful 风格返回的 ）：<img src="/img/24-6-2/4.png"><br>那么 name 这个字段用不用指定类型呢。毕竟我们关系型数据库 是需要指定类型的啊</p>
<h4 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h4><p>elasticsearch 常见的字段类型如下：</p>
<ul>
<li>字符串类型</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/text.html#text">text</a> 、 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/keyword.html">keyword</a></p>
<ul>
<li>数值类型</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/number.html">long, integer, short, byte, double, float, half_float, scaled_float</a></p>
<ul>
<li>日期类型</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/date.html">date</a></p>
<ul>
<li>布尔值类型</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/boolean.html">boolean</a></p>
<ul>
<li>二进制类型</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/binary.html">binary</a></p>
<ul>
<li>等等</li>
</ul>
<p><em><strong>PUT新增设置索引规则（设置字段与数据类型）</strong></em></p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">PUT /test2</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"mappings"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"properties"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span><span class="string">"text"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"age"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span><span class="string">"long"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"birthday"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span><span class="string">"date"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>输出如下，说明创建成功了</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"acknowledged"</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"shards_acknowledged"</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"index"</span> <span class="punctuation">:</span> <span class="string">"test2"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p><em><strong>GET 查看规则信息</strong></em><br>现在我们来尝试使用一下 GET 命令，请求具体的信息！<br><img src="/img/24-6-2/5.png">可以发现通过GET请求，我们能够详细获取到该索引下具体的信息，其中包含字段类型。那上面示例中字段类型是我自己定义的，那么我们不定义类型会是什么情况呢？<br>我们首先发起一个PUT请求，创建一个新的索引 test3，并添加一条数据</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">PUT /test3/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"大数据梦想家"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"birthday"</span><span class="punctuation">:</span><span class="string">"2000-02-06"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>然后通过GET请求，可以发现非常的智能。但是如果我们的文档字段类型没有指定，那么es就会给我们默认配置的字段类型！<img src="/img/24-6-2/6.png"><br><em><strong>UPDATE修改</strong></em><br>那如果我们想要修改文档里的字段信息呢？我们可以选择 UPDATE 也可以 选择 PUT进行覆盖<br>例如我可以像下图中的例子，将之前test3索引中的1号文档中的 name 字段修改后，重复提交，发现更新成功，但是注意 version 版本号已经变成了2<img src="/img/24-6-2/7.png">但是注意这种方法有弊端，如果我们在PUT的过程中，遗漏了字段，那么数据就会被新数据覆盖！所以，<font color="red">修改数据不建议使用PUT覆盖的方式！</font><br>我们使用 POST 命令，在 id 后面跟 _update ，要修改的内容放到 doc 文档(属性)中即可。<img src="/img/24-6-2/8.png">可以发现此时更新之后的version变成了3。所以，一旦索引被创建了之后，所有的修改都可以通过版本号看到变化。<br><em><strong>DELETE删除</strong></em><br><img src="/img/24-6-2/9.png">结论： 通过 DELETE 命令实现删除，根据请求判断是删除索引还是删除文档记录！因此，<font color="blue">使用 RESTFUL 风格是我们学习ES值得推荐使用的</font></p>
<h4 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h4><p>我们可以通过GET _cat/health来获取集群的一个健康状态除了看集群的健康信息，<br>通过命令GET _cat/indices?v，我们可以获取到当前索引的很多信息，返回值包括所有索引的状态健康情况，分片，数据储存大小等等<img src="/img/24-6-2/10.png"></p>
<h3 id="关于文档的基本操作"><a href="#关于文档的基本操作" class="headerlink" title="关于文档的基本操作"></a>关于文档的基本操作</h3><p>接下来我们学习关于文档的基本操作，首先先重新创建一个新的索引，并添加一些数据</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">PUT /alice/user/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"爱丽丝"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"在最美的年华，做最好的自己！"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"技术宅"</span><span class="punctuation">,</span><span class="string">"温暖"</span><span class="punctuation">,</span><span class="string">"思维活跃"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /alice/user/<span class="number">2</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"张三"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"法外狂徒"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"渣男"</span><span class="punctuation">,</span><span class="string">"交友"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /alice/user/<span class="number">3</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"路人甲"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"不可描述"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"靓仔"</span><span class="punctuation">,</span><span class="string">"网游"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>接下来就可以进行文档的基本操作了！</p>
<h4 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h4><p>通过 GET 命令，我们可以搜索到指定 id 的文档信息<br>GET alice/user/1<br><img src="/img/24-6-2/11.png">当然这是简单的搜索，下面我们来看一下 es 如何做条件查询<br>条件查询_search?q=<br>我们可以通过如下命令，来进行条件查询<br>GET alice/user/_search?q=name:张三<br><img src="/img/24-6-2/12.png"><br>我们看一下结果 返回并不是 数据本身，是给我们了一个 hits ，还有 _score得分，就是根据算法算出和查询条件匹配度高的分就越高。<br>我们在以某度为例的搜索引擎上进行搜索也是一样的道理，权重越高网站的位置就越靠前！<br>但我们一般使用<strong>不会直接加条件去查询</strong>，更多的会用到下面要介绍到的<strong>复杂操作搜索</strong>。<br><em><strong>复杂操作搜索 select（ 排序，分页，高亮，模糊查询，精准查询！）</strong></em><br>为了方便测试，我又执行下面的命令，往Alice索引下添加了2个文档</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">PUT /alice/user/<span class="number">4</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"爱丽丝学Java"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"技术成就自我！"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"思维敏捷"</span><span class="punctuation">,</span><span class="string">"喜欢学习"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /alice/user/<span class="number">5</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"爱丽丝学Python"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"人生苦短，我用Python！"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"好学"</span><span class="punctuation">,</span><span class="string">"勤奋刻苦"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>现在我们来构建一个查询：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"爱丽丝"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="/img/24-6-2/13.png">默认的话，es会查询出文档的所有字段，如果我们<strong>只想要部分的字段</strong>，就可以像下面所展示的demo进行查询：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"爱丽丝"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"_source"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"name"</span><span class="punctuation">,</span><span class="string">"desc"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>如上例所示，在查询中，通过 _source 来控制仅返回 name 和 desc 属性。页面返回的查询结果如下：<img src="/img/24-6-2/14.png"><font color="red">一般的，我们推荐使用构建查询，以后在与程序交互时的查询等也是使用构建查询方式处理查询条件，因为该方式可以构建更加复杂的查询条件，也更加一目了然。</font></p>
<h4 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h4><p>我们说到排序，有人就会想到：正序或倒序。那么我们先来根据age字段倒序查询：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"爱丽丝"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span> </span><br><span class="line">      <span class="attr">"age"</span><span class="punctuation">:</span> </span><br><span class="line">      <span class="punctuation">{</span> </span><br><span class="line">        <span class="attr">"order"</span><span class="punctuation">:</span> <span class="string">"desc"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询返回的结果如下：<img src="/img/24-6-2/15.png">同理，如果我们想要正序查询，只需要将desc换成了asc即可。</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"爱丽丝"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span> </span><br><span class="line">      <span class="attr">"age"</span><span class="punctuation">:</span> </span><br><span class="line">      <span class="punctuation">{</span> </span><br><span class="line">        <span class="attr">"order"</span><span class="punctuation">:</span> <span class="string">"asc"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"from"</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"size"</span><span class="punctuation">:</span><span class="number">1</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果如下：<img src="/img/24-6-2/16.png"><br><strong>注意:在排序的过程中，只能使用可排序的属性进行排序。那么可以排序的属性有哪些呢?</strong></p>
<ul>
<li>数字</li>
<li>日期</li>
<li>ID</li>
</ul>
<p><font color="red">其他都不行！</font></p>
<h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><p>学到这里，我们也可以看到，我们的查询条件越来越多，开始仅是<strong>简单查询</strong>，慢慢增加<strong>条件查询</strong>，增加排序，对返回结果进行限制。所以，我们可以说，对 于 elasticsearch 来说，所有的查询条件都是<strong>可插拔</strong>的。比如说，我们在查询中，仅对返回结果进行限制:</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span> </span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span></span><br><span class="line">  <span class="punctuation">{</span><span class="attr">"match_all"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"from"</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span>  # 从第n条开始</span><br><span class="line">  <span class="attr">"size"</span><span class="punctuation">:</span><span class="number">4</span>   # 返回n条数据</span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>分页查询类似于我们SQL中的 limit 语句。在 es 中我们想要实现这样的效果只需要用 from 指定 从第几条数据开始，size指定返回多少条数据即可。<img src="/img/24-6-2/17.png"></p>
<h4 id="布尔查询"><a href="#布尔查询" class="headerlink" title="布尔查询"></a>布尔查询</h4><p><strong>must (and)</strong><br>我们上面已经讲过了通过<strong>构建查询</strong>的方法去做<strong>模糊查询</strong>，那我们如果想多条件查询，例如查询name为alice，并且age是25岁，那该如何查询呢？<br>我们通过在 bool属性内使用 must 来作为查询条件！看结果，是不是 有点像and的感觉，里面的条件需要都满足！</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"bool"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"must"</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"match"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"爱丽丝"</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"match"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">25</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果如下<img src="/img/24-6-2/18.png"><strong>should (or)</strong><br>那么我要查询name为爱丽丝或 age 为 25 的呢？<br>我们只需要将boolean属性内的must值换成should 即可，这就有点相当于 or 的感觉</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"bool"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"should"</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"match"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"爱丽丝"</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"match"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">25</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果如下<br><img src="/img/24-6-2/19.png"><strong>must_not (not)</strong><br>那现在我想要查询年龄不是 25 的 数据，只需要将boolean的属性值换成must_not即可</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"bool"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"must_not"</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"match"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">25</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果如下：<img src="/img/24-6-2/20.png"><strong>Fitter</strong><br>那如果查询 name 为爱丽丝，age 大于 24 的数据，需要使用到filter进行过滤。</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"bool"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"must"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"爱丽丝"</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"filter"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"range"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"age"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">              <span class="attr">"gt"</span><span class="punctuation">:</span> <span class="number">24</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果如下，可以发现只有age为25 和 26的两条数据<img src="/img/24-6-2/21.png">这里就用到了 filter 条件过滤查询，过滤条件的范围用 range 表示，其余操作如下 :</p>
<ul>
<li>gt 表示大于</li>
<li>gte 表示大于等于</li>
<li>lt 表示小于</li>
<li>lte 表示小于等于</li>
</ul>
<p>那现在要查询，例如 age 在24到26之间的数据该如何查询？</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"bool"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"filter"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"range"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"age"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">              <span class="attr">"gte"</span><span class="punctuation">:</span> <span class="number">24</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">"lte"</span><span class="punctuation">:</span> <span class="number">26</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果：<img src="/img/24-6-2/22.png"></p>
<h4 id="短语检索"><a href="#短语检索" class="headerlink" title="短语检索"></a>短语检索</h4><p>为了方便测试，我们再加入几条文档数据：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">PUT /alice/user/<span class="number">6</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"大数据老K"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"技术成就自我！"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"男"</span><span class="punctuation">,</span><span class="string">"学习"</span><span class="punctuation">,</span><span class="string">"技术"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /alice/user/<span class="number">7</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"Python女侠"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"人生苦短，我用Python！"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"靓女"</span><span class="punctuation">,</span><span class="string">"勤奋学习"</span><span class="punctuation">,</span><span class="string">"善于交际"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>例如现在需要查询tags中包含“男”的数据	</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"tags"</span><span class="punctuation">:</span><span class="string">"男"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果如下：<br><img src="/img/24-6-2/23.png"><br><strong>匹配多个标签</strong><br>既然按照标签检索，那么，能不能写多个标签呢?</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"tags"</span><span class="punctuation">:</span><span class="string">"男 学习"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>此时我们可以观察返回的结果，可以发现<strong>只要满足一个标签</strong>就能返回这个数据了<br><img src="/img/24-6-2/24.png"></p>
<h4 id="精确查询"><a href="#精确查询" class="headerlink" title="精确查询"></a>精确查询</h4><p>term查询是直接通过倒排索引指定的词条进程精确查找的！<br><strong>关于分词：</strong></p>
<ul>
<li>term ，不经过分词，直接查询精确的值</li>
<li>match，会使用分词器解析！（先分析文档，然后再通过分析的文档进行查询！）</li>
</ul>
<p>说到分词器解析，就不得不提到两种数据类型：text和keyword。下面我们就来做个测试：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 创建一个索引，并指定类型</span></span><br><span class="line">PUT testdb</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"mappings"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"properties"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"text"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"desc"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span><span class="string">"keyword"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入数据</span></span><br><span class="line">PUT testdb/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"爱丽丝学大数据name"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"爱丽丝学大数据desc"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT testdb/_doc/<span class="number">2</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"爱丽丝学大数据name2"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"desc"</span><span class="punctuation">:</span><span class="string">"爱丽丝学大数据desc2"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>上述中testdb索引中,字段name在被查询时会被分析器进行分析后匹配查询。而属于keyword类型不会被分析器处理。<br>我们来验证一下：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"analyzer"</span><span class="punctuation">:</span> <span class="string">"keyword"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"text"</span><span class="punctuation">:</span> <span class="string">"爱丽丝学大数据 name"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果：<img src="/img/24-6-2/25.png">是不是没有被分析~就是简单的一个字符串啊。再测试一下：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"analyzer"</span><span class="punctuation">:</span> <span class="string">"standard"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"text"</span><span class="punctuation">:</span> <span class="string">"爱丽丝学大数据 name"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果：<img src="/img/24-6-2/26.png">然后我们可以得出结论：<strong>keyword 字段类型不会被分析器分析</strong>！<br>下面我们用前面添加的2条数据做过测试：<br>先精准查询text类型的字段</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET testdb/_search         <span class="comment">// text 会被分析器分析 查询</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"term"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"爱"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果，2条数据都能匹配到<img src="/img/24-6-2/27.png">然后用standard类型做精准测试</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET testdb/_search          <span class="comment">// keyword 不会被分析所以直接查询 </span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"term"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"desc"</span><span class="punctuation">:</span> <span class="string">"爱丽丝学大数据desc"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果，只有1条数据能匹配到<img src="/img/24-6-2/28.png"></p>
<h4 id="查找多个精确值"><a href="#查找多个精确值" class="headerlink" title="查找多个精确值"></a>查找多个精确值</h4><p>为了方便测试，我们再添加如下数据：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">PUT testdb/_doc/<span class="number">3</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"t1"</span><span class="punctuation">:</span><span class="string">"22"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"t2"</span><span class="punctuation">:</span><span class="string">"2021-03-01"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT testdb/_doc/<span class="number">4</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"t1"</span><span class="punctuation">:</span><span class="string">"33"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"t2"</span><span class="punctuation">:</span><span class="string">"2021-03-01"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>然后进行查询</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET testdb/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"bool"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"should"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"term"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"t1"</span><span class="punctuation">:</span><span class="string">"22"</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"term"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"t1"</span><span class="punctuation">:</span><span class="string">"33"</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果：<img src="/img/24-6-2/29.png">可以发现2条数据也都能查到，证明就算是term精确查询，也能够查询多个值。<br>当然，除了 bool 查询之外，下面这种方式也同样是可以的。</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET testdb/_doc/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"terms"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"t1"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"22"</span><span class="punctuation">,</span><span class="string">"33"</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>下面要介绍的功能，就是经常被搜索引擎用到的“<strong>高亮显示</strong>”！</p>
<h4 id="高亮显示"><a href="#高亮显示" class="headerlink" title="高亮显示"></a>高亮显示</h4><p>我们可以通过highlight属性，来对我们查询的结果的指定字段做高亮显示！</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"爱丽丝"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"highlight"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"fields"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>观察返回的结果，我们可以发现搜索相关的结果，被加上了高亮标签<em><img src="/img/24-6-2/30.png">现在效果看到了，那我们有没有办法<strong>自定义样式</strong>呢？<br>答案当然是可以的，我们需要在pre_tags中定义标签的前缀，post_tags中定义后缀！</em></p><em>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">GET alice/user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"爱丽丝"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"highlight"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"pre_tags"</span><span class="punctuation">:</span> <span class="string">"&lt;b class='key' style='color:red'&gt;"</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">"post_tags"</span><span class="punctuation">:</span> <span class="string">"&lt;/b&gt;"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"fields"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>查询结果：<img src="/img/24-6-2/31.png"></p>
<h2 id="SpringBoot集成ES"><a href="#SpringBoot集成ES" class="headerlink" title="SpringBoot集成ES"></a>SpringBoot集成ES</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/getting-started-java.html">https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/getting-started-java.html</a></p>
<p><strong>依赖</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>co.elastic.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.13.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>使用springboot</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">\<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意版本要对应</p>
<p>这里我使用最新的用法<br>配置</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yyjccc.eslearn.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> co.elastic.clients.elasticsearch.ElasticsearchClient;</span><br><span class="line"><span class="keyword">import</span> co.elastic.clients.json.jackson.JacksonJsonpMapper;</span><br><span class="line"><span class="keyword">import</span> co.elastic.clients.transport.ElasticsearchTransport;</span><br><span class="line"><span class="keyword">import</span> co.elastic.clients.transport.rest_client.RestClientTransport;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchConfig</span> {</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value("${spring.data.es.url}")</span></span><br><span class="line">	<span class="keyword">private</span> String serverUrl;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> ElasticsearchClient  <span class="title function_">restClient</span><span class="params">()</span>{</span><br><span class="line">		<span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> RestClient</span><br><span class="line">				.builder(HttpHost.create(serverUrl))</span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line">		<span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">				restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>());</span><br><span class="line"></span><br><span class="line">		<span class="type">ElasticsearchClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line">		<span class="keyword">return</span> esClient;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="索引-1"><a href="#索引-1" class="headerlink" title="索引"></a>索引</h3><p>创建索引</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ElasticsearchClient esClient;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		CreateIndexRequest createIndexRequest=<span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>.Builder().index(<span class="string">"test"</span>).build();</span><br><span class="line">		<span class="type">CreateIndexResponse</span> <span class="variable">createIndexResponse</span> <span class="operator">=</span> esClient.indices().create(createIndexRequest);</span><br><span class="line">		System.out.println(createIndexResponse);</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<p>判断索引是否存在</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">hasIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">	ExistsRequest indexRequest= <span class="keyword">new</span> <span class="title class_">ExistsRequest</span>.Builder().index(<span class="string">"test"</span>).build();</span><br><span class="line">	<span class="type">BooleanResponse</span> <span class="variable">exists</span> <span class="operator">=</span> esClient.indices().exists(indexRequest);</span><br><span class="line">	System.out.println(exists);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>删除索引</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">DeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		DeleteIndexRequest indexRequest=<span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>.Builder().index(<span class="string">"test"</span>).build();</span><br><span class="line">		<span class="type">DeleteIndexResponse</span> <span class="variable">delete</span> <span class="operator">=</span> esClient.indices().delete(indexRequest);</span><br><span class="line">		System.out.println(delete);</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="文档-1"><a href="#文档-1" class="headerlink" title="文档"></a>文档</h3><p>实体类</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yyjccc.eslearn.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>创建文档数据</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">addDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		<span class="type">User</span> <span class="variable">yyjccc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"yyjccc"</span>, <span class="number">18</span>);</span><br><span class="line">		IndexRequest indexRequest= <span class="keyword">new</span> <span class="title class_">IndexRequest</span>.Builder&lt;&gt;().index(<span class="string">"test"</span>)</span><br><span class="line">				.id(<span class="string">"1"</span>)</span><br><span class="line">				.timeout(<span class="keyword">new</span> <span class="title class_">Time</span>.Builder().time(<span class="string">"1s"</span>).build())</span><br><span class="line">				.document(yyjccc)</span><br><span class="line">				.build();</span><br><span class="line">		<span class="comment">//document()设置内容</span></span><br><span class="line">		<span class="comment">//index()设置索引名称</span></span><br><span class="line">		<span class="comment">//id ()设置插入数据的id</span></span><br><span class="line">		<span class="comment">//timeout()设置超时时间</span></span><br><span class="line">		<span class="type">IndexResponse</span> <span class="variable">index</span> <span class="operator">=</span> esClient.index(indexRequest);</span><br><span class="line">		<span class="comment">//result 操作结果</span></span><br><span class="line">		System.out.println(index.toString());</span><br><span class="line">		System.out.println(index.result());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<p>判断是否存在文档</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">hasDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		ExistsSourceRequest sourceRequest=<span class="keyword">new</span> <span class="title class_">ExistsSourceRequest</span>.Builder()</span><br><span class="line">				.index(<span class="string">"test"</span>)</span><br><span class="line">				.id(<span class="string">"2"</span>)</span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line">		<span class="type">BooleanResponse</span> <span class="variable">booleanResponse</span> <span class="operator">=</span> esClient.existsSource(sourceRequest);</span><br><span class="line">		System.out.println(booleanResponse);</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<p>获取文档内容</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">getDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		GetRequest getRequest=<span class="keyword">new</span> <span class="title class_">GetRequest</span>.Builder()</span><br><span class="line">				.index(<span class="string">"test"</span>)</span><br><span class="line">				.id(<span class="string">"1"</span>)</span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		GetResponse&lt;User&gt; userGetResponse = esClient.get(getRequest, User.class);</span><br><span class="line">		System.out.println(userGetResponse.source());</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<p>注意实体类User必须是标准的JavaBean<br>跟新文档数据</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">updateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"yyj"</span>,<span class="number">18</span>);</span><br><span class="line">		UpdateRequest updateRequest=<span class="keyword">new</span> <span class="title class_">UpdateRequest</span>.Builder()</span><br><span class="line">				.id(<span class="string">"1"</span>)</span><br><span class="line">				.index(<span class="string">"test"</span>)</span><br><span class="line">				.doc(user)</span><br><span class="line"></span><br><span class="line">				.build();</span><br><span class="line">		<span class="type">UpdateResponse</span> <span class="variable">update</span> <span class="operator">=</span> esClient.update(updateRequest, User.class);</span><br><span class="line">		System.out.println(update);</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<p>删除文档</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">deleteDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		<span class="type">DeleteRequest</span> <span class="variable">build</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>.Builder()</span><br><span class="line">				.index(<span class="string">"test"</span>)</span><br><span class="line">				.id(<span class="string">"2"</span>)</span><br><span class="line">				.build();</span><br><span class="line">		<span class="type">DeleteResponse</span> <span class="variable">delete</span> <span class="operator">=</span> esClient.delete(build);</span><br><span class="line">		System.out.println(delete);</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<p>批量操作</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">bulkDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		List&lt;BulkOperation&gt; operations=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		List&lt;User&gt; userList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"uuu"</span>,<span class="number">18</span>));</span><br><span class="line">		userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"yanyongju"</span>,<span class="number">18</span>));</span><br><span class="line">		userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"youyou"</span>,<span class="number">18</span>));</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;userList.size(); i++) {</span><br><span class="line">			<span class="type">CreateOperation</span> <span class="variable">createOperation</span> <span class="operator">=</span>((CreateOperation.Builder)<span class="keyword">new</span> <span class="title class_">CreateOperation</span>.Builder()</span><br><span class="line">					.id(<span class="string">""</span>+(i+<span class="number">2</span>)))</span><br><span class="line">					.document(userList.get(i))</span><br><span class="line">					.build();</span><br><span class="line">			<span class="type">BulkOperation</span> <span class="variable">build</span> <span class="operator">=</span> (BulkOperation) <span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder()</span><br><span class="line">					.create(createOperation)</span><br><span class="line">					.build();</span><br><span class="line">			operations.add(build);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>.Builder()</span><br><span class="line">				.index(<span class="string">"test"</span>)</span><br><span class="line">				.operations(operations)</span><br><span class="line">				.build();</span><br><span class="line">		<span class="type">BulkResponse</span> <span class="variable">bulk</span> <span class="operator">=</span> esClient.bulk(bulkRequest);</span><br><span class="line">		System.out.println(bulk.errors());</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<p>查询</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">searchDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">		MatchQuery matchQuery=<span class="keyword">new</span> <span class="title class_">MatchQuery</span>.Builder()</span><br><span class="line">				.query(<span class="string">"y"</span>)</span><br><span class="line">				.field(<span class="string">"name"</span>)</span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line">		MatchAllQuery matchAllQuery=<span class="keyword">new</span> <span class="title class_">MatchAllQuery</span>.Builder()</span><br><span class="line">				.queryName(<span class="string">"name"</span>)</span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line">		TermQuery termQuery=<span class="keyword">new</span> <span class="title class_">TermQuery</span>.Builder()</span><br><span class="line">				.field(<span class="string">"age"</span>)</span><br><span class="line">				.value(<span class="number">18</span>)</span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line">		Query query=<span class="keyword">new</span> <span class="title class_">Query</span>.Builder()</span><br><span class="line">				.matchAll(matchAllQuery)</span><br><span class="line">				<span class="comment">//.term(termQuery)</span></span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line">		SearchRequest searchRequest=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>.Builder()</span><br><span class="line">				.index(<span class="string">"test"</span>)</span><br><span class="line">				.query(query)</span><br><span class="line">				.from(<span class="number">0</span>)</span><br><span class="line">				.size(<span class="number">10</span>)</span><br><span class="line">				.build();</span><br><span class="line">		<span class="comment">//分页精准匹配</span></span><br><span class="line">		SearchResponse&lt;User&gt; search = esClient.search(searchRequest, User.class);</span><br><span class="line"></span><br><span class="line">		System.out.println(search);</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
</em>
      
    </div>
    <footer class="article-footer">
      
      
      
      
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>


    </footer>
  </div>
  
    
  <nav id="article-nav" data-aos="fade-up">
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img data-src="https://yyjccc.github.io/images/cover/5.png" data-sizes="auto" alt="Groovy" class="lazyload">
          
        
        <a href="/2024/06/06/Groovy/"></a>
        <div class="article-nav-caption">前一篇</div>
        <h3 class="article-nav-title">
          
            Groovy
          
        </h3>
      </div>
    
    
    <div class="article-nav-link-wrap article-nav-link-right">
      
        
        
          <img data-src="https://yyjccc.github.io/images/cover/5.png" data-sizes="auto" alt="幽默的Commons-Collections6调试" class="lazyload">
        
      
      <a href="/2024/05/14/%E5%B9%BD%E9%BB%98%E7%9A%84Commons-Collections6%E8%B0%83%E8%AF%95/"></a>
      <div class="article-nav-caption">后一篇</div>
      <h3 class="article-nav-title">
        
          幽默的Commons-Collections6调试
        
      </h3>
    </div>
    
  </nav>


  
</article>




  <div id="comments" class="gtcomment"></div>



</section>
          
            <aside id="sidebar">
  <div class="sidebar-wrapper wrap-sticky">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Elasticsearch"><span class="toc-number">1.</span> <span class="toc-text">Elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">1.1.1.</span> <span class="toc-text">文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.1.3.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">1.1.4.</span> <span class="toc-text">倒排索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.</span> <span class="toc-text">基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">IK分词器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rest%E9%A3%8E%E6%A0%BC"><span class="toc-number">1.2.2.</span> <span class="toc-text">Rest风格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E7%B4%A2%E5%BC%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.3.</span> <span class="toc-text">关于索引的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">字段类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">其他命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.4.</span> <span class="toc-text">关于文档的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">简单查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">排序查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">布尔查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%AD%E8%AF%AD%E6%A3%80%E7%B4%A2"><span class="toc-number">1.2.4.5.</span> <span class="toc-text">短语检索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.6.</span> <span class="toc-text">精确查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%A4%9A%E4%B8%AA%E7%B2%BE%E7%A1%AE%E5%80%BC"><span class="toc-number">1.2.4.7.</span> <span class="toc-text">查找多个精确值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA"><span class="toc-number">1.2.4.8.</span> <span class="toc-text">高亮显示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E9%9B%86%E6%88%90ES"><span class="toc-number">1.3.</span> <span class="toc-text">SpringBoot集成ES</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">文档</span></a></li></ol></li></ol></li></ol>
      
  </div>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Yyjccc" class="lazyload">
  <div class="sidebar-author-name">Yyjccc</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">42</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">6</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">64</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a href=https://github.com/Yyjccc itemprop="url" target="_blank" aria-label="github"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>
</div>
      
      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  
</aside>

          
        </div>
        <footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      2020-2024
      <span class="footer-info-sep"></span>
      Yyjccc
    </div>
    
      <div>
        基于&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        142.7k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        09:44
      </div>
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">总访客量&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
</footer>

        <div class="sidebar-top">
          <img src="/images/taichi.png" height="50" width="50" alt="backtop" />
          <div class="arrow-up"></div>
        </div>
        <div id="mask"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Elasticsearch"><span class="toc-number">1.</span> <span class="toc-text">Elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">1.1.1.</span> <span class="toc-text">文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.1.3.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">1.1.4.</span> <span class="toc-text">倒排索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.</span> <span class="toc-text">基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">IK分词器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rest%E9%A3%8E%E6%A0%BC"><span class="toc-number">1.2.2.</span> <span class="toc-text">Rest风格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E7%B4%A2%E5%BC%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.3.</span> <span class="toc-text">关于索引的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">字段类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">其他命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.4.</span> <span class="toc-text">关于文档的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">简单查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">排序查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">布尔查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%AD%E8%AF%AD%E6%A3%80%E7%B4%A2"><span class="toc-number">1.2.4.5.</span> <span class="toc-text">短语检索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.6.</span> <span class="toc-text">精确查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%A4%9A%E4%B8%AA%E7%B2%BE%E7%A1%AE%E5%80%BC"><span class="toc-number">1.2.4.7.</span> <span class="toc-text">查找多个精确值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA"><span class="toc-number">1.2.4.8.</span> <span class="toc-text">高亮显示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E9%9B%86%E6%88%90ES"><span class="toc-number">1.3.</span> <span class="toc-text">SpringBoot集成ES</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">文档</span></a></li></ol></li></ol></li></ol>
      
  </div>
</div>
</div>
      <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Yyjccc" class="lazyload">
  <div class="sidebar-author-name">Yyjccc</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">42</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">6</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">64</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a href=https://github.com/Yyjccc itemprop="url" target="_blank" aria-label="github"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>
</div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png"/>
        </div>
      </div>
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"></script>



<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>


<script type="module" data-pjax>
  import PhotoSwipeLightbox from "https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js";
  
  const pswp = () => {
    if (_$$('.article-entry a.article-gallery-item').length > 0) {
      new PhotoSwipeLightbox({
        gallery: '.article-entry',
        children: 'a.article-gallery-item',
        pswpModule: () => import("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js")
      }).init();
    }
    if(_$$('.article-gallery a.article-gallery-item').length > 0) {
      new PhotoSwipeLightbox({
        gallery: '.article-gallery',
        children: 'a.article-gallery-item',
        pswpModule: () => import("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js")
      }).init();
    }
    window.lightboxStatus = 'done';
    window.removeEventListener('lightbox:ready', pswp);
  }
  if(window.lightboxStatus === 'ready') {
    pswp()
  } else {
    window.addEventListener('lightbox:ready', pswp);
  }
</script>






  
<script src="https://npm.webcache.cn/gitalk/dist/gitalk.min.js" data-pjax></script>

  
  <script data-pjax>
    var gitalkId = location.pathname;
    var gitalk = new Gitalk({
      clientID: '0efb4a442bc09d1ba17e',
      clientSecret: 'd26f520fef841de4f4388029a0d5c0f4730357cf',
      repo: 'https://github.com/Yyjccc/yyjccc.github.io.git',
      owner: 'Yyjccc',
      admin: "Yyjccc",
      id: gitalkId, // Ensure uniqueness and length less than 50
      distractionFreeMode: false // Facebook-like distraction free mode
    })
    if (document.getElementById('comments')) {
      gitalk.render('comments')
    }
  </script>







  
<script src="/js/generator_search.js" defer></script>






  
<script src="https://npm.webcache.cn/mouse-firework@0.0.4/dist/index.umd.js"></script>

  <script>
    firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["#ff5252","#ff7c7c","#ffafaf","#ffd0d0"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["#ff0000"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>





  <script>
    function initLive2d() {
      live2d.init("https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/", {themeTipsPath: ""});
    }
  </script>
  
<script src="https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/js/live2d-autoload.js" onload="initLive2d &amp;&amp; initLive2d()" async></script>




  
<script src="https://npm.webcache.cn/quicklink@2.3.0/dist/quicklink.umd.js"></script>

  <script data-pjax>
    quicklink.listen({
      timeout: 3000,
      priority: true,
      ignores: []
    });
  </script>


<div id="lazy-script">
  <div>
    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '0.3.0-alpha.1' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  

<script data-pjax>
  var updateTime = _$('#post-update-time')?.innerHTML;

  if (updateTime) {
    const update = new Date(updateTime);
    const now = new Date();
    const diff = now - update;
    const days = diff / 86400000;
    const { daysAgo, message: template } = window.outdate;
    if (days >= daysAgo) {
      const message = template.replace(/{time}/, updateTime);
      const blockquote = _$('#outdate-blockquote');
      if (blockquote) {
        blockquote.querySelector('p').innerText = message;
        blockquote.style.display = 'block';
      }
    }
  }
</script>


  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>

  <!-- hexo injector body_end start -->
<script src="/js/insert_highlight.js" data-pjax></script>
<!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true,"react":{"opacity":0.7}}});</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body>
  </html>

